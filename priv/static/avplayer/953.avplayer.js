"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[953],{59829:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(19371),r=a(42524),n=a(31184),i=a(62787);class o{constructor(){(0,s.A)(this,"inCodecpar",void 0),(0,s.A)(this,"inTimeBase",void 0),(0,s.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,n.Gy)(168),(0,i.Yi)(this.inCodecpar,e),this.inTimeBase={den:r.f[15](t+4),num:r.f[15](t)},0}destroy(){this.inCodecpar&&((0,i.dn)(this.inCodecpar),this.inCodecpar=0)}}},43326:(e,t,a)=>{a.d(t,{A:()=>y});var s=a(19371),r=a(42524),n=a(77389),i=a(59829),o=a(41863),c=a(33134),d=a(81819),l=a(87339),h=a(91278),p=a(47378),u=a(30027),f=a(1818),m=a(31184),g=a(79939);class y extends i.A{constructor(){super(...arguments),(0,s.A)(this,"caches",void 0),(0,s.A)(this,"cache",void 0),(0,s.A)(this,"lastDts",void 0)}init(e,t){return super.init(e,t),this.caches=[],0}sendAVPacket(e){let t=0,a=this.lastDts||(r.f[17](e+16)!==h.Dh?r.f[17](e+16):r.f[17](e+8)),s=(0,o.s3)(r.f[20](e+24),r.f[15](e+28)).slice(),n=!1,i=!!this.cache;for(i&&(s=(0,c.A)(Uint8Array,[this.cache,s]),this.cache=null);t<s.length;){if(t>s.length-10)return this.cache=s.subarray(t),this.lastDts=a,0;const o=g.R(s.subarray(t));if(d.ai(o)){let e=t+1;for(;e<s.length-1;e++)if(2935==(s[e]<<8|s[e+1])){t=e;break}if(e<s.length-1)continue;return l.z3("parse ac3 header failed","packages/avformat/src/bsf/ac3/Ac32RawFilter.ts",115),p.LR}const c={dts:a,buffer:null,duration:h.N_,pos:r.f[17](e+56)};let f=o.frameSize;if(c.buffer=s.subarray(t,t+f),t+f>s.length)return this.cache=s.subarray(t),this.lastDts=a,0;const m=(0,u.k)(BigInt(1536/o.sampleRate*h.SF),h.KR,this.inTimeBase);c.duration=Number(m),this.caches.push(c),t+=f,a+=m,!n&&i&&(n=!0,a=r.f[17](e+16)||r.f[17](e+8))}return this.lastDts=BigInt(0),0}receiveAVPacket(e){if(this.caches.length){(0,f.Up)(e);const t=this.caches.shift(),a=(0,m.sY)(t.buffer.length);return(0,o.lW)(a,t.buffer.length,t.buffer),(0,f.NX)(e,a,t.buffer.length),n.M[17](e+16,t.dts),n.M[17](e+8,t.dts),n.M[17](e+56,t.pos),n.M[17](e+48,BigInt(Math.floor(t.duration))),n.M[15](e+36,1|r.f[15](e+36)),0}return p.LT}reset(){return this.cache=null,this.lastDts=BigInt(0),this.caches.length=0,0}}},87082:(e,t,a)=>{a.d(t,{A:()=>y});var s=a(19371),r=a(42524),n=a(77389),i=a(59829),o=a(97125),c=a(41863),d=a(33134),l=a(87339),h=a(91278),p=a(47378),u=a(30027),f=a(1818),m=a(31184),g=a(69048);class y extends i.A{constructor(){super(...arguments),(0,s.A)(this,"frameHeader",void 0),(0,s.A)(this,"caches",void 0),(0,s.A)(this,"cache",void 0),(0,s.A)(this,"lastDts",void 0)}init(e,t){return super.init(e,t),this.caches=[],this.frameHeader=new o.Vz,0}sendAVPacket(e){let t=0,a=this.lastDts||(r.f[17](e+16)!==h.Dh?r.f[17](e+16):r.f[17](e+8)),s=(0,c.s3)(r.f[20](e+24),r.f[15](e+28)).slice(),n=!1,i=!!this.cache;for(i&&(s=(0,d.A)(Uint8Array,[this.cache,s]),this.cache=null);t<s.length;){const c=s[t]<<4|s[t+1]>>4&14;if(4094!==c){let e=t+1;for(;e<s.length-1;e++)if(4094==(s[e]<<4|s[e+1]>>4&14)){t=e;break}if(e<s.length-1)continue;return l.z3(`found syncWord not 0xFFE, got: 0x${c.toString(16)}`,"packages/avformat/src/bsf/mp3/Mp32RawFilter.ts",112),p.LR}const d=s[1]>>>3&3,f=(12&s[2])>>>2,m={dts:a,buffer:null,extradata:null,duration:h.N_,pos:r.f[17](e+56)},y=g.Y2(d,f);o.qg(this.frameHeader,s[t]<<24|s[t+1]<<16|s[t+2]<<8|s[t+3]);let v=o.CM(this.frameHeader,y);if(m.buffer=s.subarray(t,t+v),t+v>s.length){this.cache=s.subarray(t),this.lastDts=a;break}const A=(0,u.k)(BigInt(Math.floor(v/y*h.SF)),h.KR,this.inTimeBase);m.duration=Number(A),this.caches.push(m),t+=v,a+=A,!n&&i&&(n=!0,a=r.f[17](e+16)||r.f[17](e+8))}return this.lastDts=BigInt(0),0}receiveAVPacket(e){if(this.caches.length){(0,f.Up)(e);const t=this.caches.shift(),a=(0,m.sY)(t.buffer.length);return(0,c.lW)(a,t.buffer.length,t.buffer),(0,f.NX)(e,a,t.buffer.length),n.M[17](e+16,t.dts),n.M[17](e+8,t.dts),n.M[17](e+56,t.pos),n.M[17](e+48,BigInt(Math.floor(t.duration))),n.M[15](e+36,1|r.f[15](e+36)),0}return p.LT}reset(){return this.cache=null,this.lastDts=BigInt(0),this.caches.length=0,0}}},6072:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(19371);class r{constructor(){(0,s.A)(this,"type",-1),(0,s.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},13953:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var s=a(19371),r=a(41863),n=a(75354),i=a(42524),o=a(77389),c=a(6072),d=a(3867),l=a(58267),h=a(2955),p=a(57211),u=a(65438),f=a(26499),m=a(41619),g=a(3998),y=a(51925),v=a(87082),A=a(22072),x=a(43326),k=a(47378),b=a(91278),S=a(31184),I=a(30027),w=a(1818),M=a(5639),T=a(36991),q=a(69048),P=a(87339),U=a(17630);const B="packages/avformat/src/formats/IRtspFormat.ts",z=BigInt(2208988800)*BigInt(1e6);class R extends c.A{constructor(e){super(),(0,s.A)(this,"type",6),(0,s.A)(this,"rtspSession",void 0),(0,s.A)(this,"options",void 0),(0,s.A)(this,"context",void 0),(0,s.A)(this,"cacheAVPacket",void 0),this.options=e}init(e){e.ioReader&&e.ioReader.setEndian(!0),this.rtspSession=new d.A(this.options.uri,e.ioReader,e.ioWriter),this.context={sessionId:"",canOutputPacket:!0},this.cacheAVPacket=0}async readHeader(e){try{let t=await this.rtspSession.options();if(200!==t.statusCode)return k.LR;if(t=await this.rtspSession.describe(),200!==t.statusCode)return P.z3(`describe failed, ${JSON.stringify(t)}`,B,162),k.LR;const a=l.q(t.content);let s=1,r=0;for(let i=0;i<a.media.length;i++){if(!a.media[i].rtp.length)continue;const o=e.createStream(),c=h.fm.find((e=>e.payload===a.media[i].rtp[0].payload));if(c)o.codecpar.codecType=c.codecType,o.codecpar.codecId=c.codecId,1===c.codecType?(o.codecpar.sampleRate=a.media[i].rtp[0].rate||c.rate,o.codecpar.chLayout.nbChannels=a.media[i].rtp[0].encoding||c.encoding,o.timeBase.num=1,o.timeBase.den=o.codecpar.sampleRate):(o.timeBase.num=1,o.timeBase.den=a.media[i].rtp[0].rate||c.rate);else{"audio"===a.media[i].type?o.codecpar.codecType=1:"video"===a.media[i].type&&(o.codecpar.codecType=0);const e=a.media[i].rtp[0].codec;let t=h.xl[e]||0;o.codecpar.codecId=t,1===o.codecpar.codecType?(o.codecpar.sampleRate=a.media[i].rtp[0].rate,o.codecpar.chLayout.nbChannels=a.media[i].rtp[0].encoding,o.timeBase.num=1,o.timeBase.den=o.codecpar.sampleRate):0===o.codecpar.codecType&&(o.timeBase.num=1,o.timeBase.den=a.media[i].rtp[0].rate)}const d={ssrc:0,trackId:s++,interleaved:r,payloadContext:null,queue:null,payloadType:a.media[i].rtp[0].payload,rangeStartOffset:BigInt(0),lastRtcpNtpTime:b.Dh,firstRtcpNtpTime:b.Dh,lastRtcpTimestamp:0,rtcpTsOffset:BigInt(0),baseTimestamp:0,timestamp:0,unwrappedTimestamp:BigInt(0),filter:null};if(a.media[i].control){let e=a.media[i].control.split(";").find((e=>e.indexOf("trackID")>-1));if(e){let t=e.split("=");d.trackId=+t[1].trim()}}if(a.media[i].fmtp.length&&A.zQ[o.codecpar.codecId]&&(d.payloadContext=A.zQ[o.codecpar.codecId](o,a.media[i].fmtp[0].config)),d.queue=new p.A(o.codecpar[n.o9],d.payloadContext),r+=2,o.privData=d,t=await this.rtspSession.setup({trackId:d.trackId,streamMode:2,interleaved:d.interleaved,multcast:!1},this.context.sessionId),200!==t.statusCode)return P.z3(`setup track ${d.trackId} failed, ${JSON.stringify(t)}`,B,268),k.LR;const l=t.headers.Transport.split(";").find((e=>e.indexOf("ssrc")>-1));l&&(d.ssrc=+("0x"+l.split("=")[1].trim())),this.context.sessionId=t.headers.Session,0===o.codecpar.codecType&&(this.context.canOutputPacket=!1),86017===o.codecpar.codecId?d.filter=new v.A:86019===o.codecpar.codecId&&(d.filter=new x.A),d.filter&&d.filter.init(o.codecpar[n.o9],o.timeBase[n.o9])}return e.streams.length?(t=await this.rtspSession.play(this.context.sessionId),200!==t.statusCode?(P.z3(`play failed, ${JSON.stringify(t)}`,B,301),k.LR):0):(P.z3("not found stream",B,294),k.LR)}catch(t){return P.z3(t.message,B,308),e.ioReader.error}}addPrft(e,t,a){const s=e.privData;if(s.lastRtcpNtpTime!==b.Dh){const r=(0,S.sY)(16),n=T.q(s.lastRtcpNtpTime)-z,i=BigInt(a)-s.lastRtcpNtpTime,c=(0,I.k)(i,e.timeBase,b.KR);o.M[17](r,n+c),o.M[15](r+8,24),(0,w.Ow)(t,27,r,16)}}getPacketPts(e,t,a){if(-1===a)return-BigInt(1);const s=t.privData;if(s.lastRtcpNtpTime!==b.Dh&&e.streams.length>1){const e=BigInt(a-s.lastRtcpTimestamp|0),r=(s.lastRtcpNtpTime-s.firstRtcpNtpTime)*BigInt(0|t.timeBase.den)/(BigInt(0|t.timeBase.num)<<BigInt(32));return s.rangeStartOffset+s.rtcpTsOffset+r+e}return s.baseTimestamp||(s.baseTimestamp=a),s.timestamp?s.unwrappedTimestamp+=BigInt(a-s.timestamp|0):s.unwrappedTimestamp+=BigInt(a),s.timestamp=a,s.unwrappedTimestamp+s.rangeStartOffset-BigInt(s.baseTimestamp)}handleRtcpPacket(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(200===t[1]){const s=(0,y.N)(t);let r=e.streams.find((e=>{const t=e.privData;return t.ssrc===s.ssrc||t.interleaved===a}));if(r){const e=r.privData;e.lastRtcpNtpTime=s.ntp,e.lastRtcpTimestamp=s.timestamp,e.firstRtcpNtpTime===b.Dh&&(e.firstRtcpNtpTime=s.ntp,e.baseTimestamp||(e.baseTimestamp=s.timestamp),e.rtcpTsOffset=BigInt(e.lastRtcpTimestamp-e.baseTimestamp|0))}}}async readAVPacket(e,t){try{for(;;){const{data:a,interleaved:s}=await this.rtspSession.readPacket();if((0,f.A)(a))this.handleRtcpPacket(e,a,s);else if((0,m.A)(a)){const c=(0,g.A)(a),d=e.streams.find((e=>{const t=e.privData;return t.ssrc===c.header.ssrc||t.interleaved===s||t.payloadType===c.header.payloadType}));if(d){const a=d.privData;a.queue.push(c),a.ssrc||(a.ssrc=c.header.ssrc);let s=!1;const l=(a,c,l)=>{let h=s?(0,w._5)():t;o.M[15](h+32,d.index),(0,r.Mr)(h+72,d.timeBase[n.o9],8);const p=(0,S.sY)(a.length);return(0,r.lW)(p,a.length,a),(0,w.NX)(h,p,a.length),o.M[17](h+16,l),o.M[17](h+8,l),c&&(o.M[15](h+36,1|i.f[15](h+36)),this.context.canOutputPacket=!0),s?(e.interval.packetBuffer.push(h),h=0):s=!0,h},h=function(a,c){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:BigInt(0);if(!a.length)return;let h=s?(0,w._5)():t;o.M[15](h+32,d.index),(0,r.Mr)(h+72,d.timeBase[n.o9],8);const p=(0,S.sY)(a[0].length);(0,r.lW)(p,a[0].length,a[0]),(0,w.NX)(h,p,a[0].length),o.M[17](h+16,c),o.M[17](h+8,c),o.M[15](h+36,1|i.f[15](h+36)),s?(e.interval.packetBuffer.push(h),h=0):s=!0;for(let t=1;t<a.length;t++){const s=(0,w._5)();o.M[15](s+32,d.index),(0,r.Mr)(s+72,d.timeBase[n.o9],8),o.M[17](s+16,c+BigInt(t)*l),o.M[17](s+8,c+BigInt(t)*l),o.M[15](s+36,1|i.f[15](s+36));const h=(0,S.sY)(a[t].length);(0,r.lW)(h,a[t].length,a[t]),(0,w.NX)(s,h,a[t].length),e.interval.packetBuffer.push(s)}},p=(c,l)=>{let h=s?(0,w._5)():t;o.M[15](h+32,d.index),(0,r.Mr)(h+72,d.timeBase[n.o9],8);const p=(0,S.sY)(c.length);(0,r.lW)(p,c.length,c),(0,w.NX)(h,p,c.length),o.M[17](h+16,l),o.M[17](h+8,l);let u=a.filter.sendAVPacket(h);if(u<0)return P.h2("send avpacket to bsf failed",B,487),k.LR;if(u=a.filter.receiveAVPacket(h),u!==k.LT)for((0,r.Mr)(h+72,d.timeBase[n.o9],8),o.M[15](h+32,d.index),o.M[15](h+36,1|i.f[15](h+36)),s?(e.interval.packetBuffer.push(h),h=0):s=!0;;){const t=this.cacheAVPacket||(0,w._5)();if(u=a.filter.receiveAVPacket(t),0!==u){this.cacheAVPacket=t;break}(0,r.Mr)(t+72,d.timeBase[n.o9],8),o.M[15](t+32,d.index),e.interval.packetBuffer.push(t),this.cacheAVPacket=0}};for(;a.queue.hasFrame();){const t=a.queue.getFrame();if(!t.length)continue;const s=this.getPacketPts(e,d,t[0].header.timestamp);if(0===d.codecpar.codecType||this.context.canOutputPacket)if(27===d.codecpar.codecId||173===d.codecpar.codecId){const{nalus:e,isKey:r}=27===d.codecpar.codecId?u.Hj(t):u.pA(t,a.payloadContext);if(!e.length)continue;if(!r&&!this.context.canOutputPacket)continue;const n=l(M.nW(e,2),r,s);1&d.codecpar.flags?o.M[15](n+36,64|i.f[15](n+36)):o.M[15](n+36,-65&i.f[15](n+36)),o.M[17](n+16,b.Dh)}else if(86018===d.codecpar.codecId)h(u.kx(t,d.privData.payloadContext),s,BigInt(1024));else if(12===d.codecpar.codecId){const e=u.xW(t),a=e[4]>>>6==0;if(!a&&!this.context.canOutputPacket)continue;l(e,a,s)}else if(65543===d.codecpar.codecId||65542===d.codecpar.codecId||69660===d.codecpar.codecId||65537===d.codecpar.codecId||86076===d.codecpar.codecId||86051===d.codecpar.codecId)h([u.xW(t)],s);else if(86017===d.codecpar.codecId){const e=u.Jz(t,d.codecpar.codecType);if(d.codecpar.profile===b.N_){const t=(6&e[1])>>1;d.codecpar.profile=q.Au(t)}p(e,s)}else if(86019===d.codecpar.codecId)p(u.we(t),s);else if(2===d.codecpar.codecId){const e=u.Jz(t,d.codecpar.codecType),a=1==(e[5]>>3&7);if(!a&&!this.context.canOutputPacket)continue;l(e,a,s)}else if(139===d.codecpar.codecId){const{payload:e,isKey:a}=u.hw(t);if(!a&&!this.context.canOutputPacket)continue;l(e,a,s)}else if(167===d.codecpar.codecId){const{payload:e,isKey:a}=u.o_(t);if(!a&&!this.context.canOutputPacket)continue;l(e,a,s)}else if(225===d.codecpar.codecId){const{payload:e,isKey:a}=u.l6(t);if(!a&&!this.context.canOutputPacket)continue;l(e,a,s)}}if(s)return 0}}else P.R8("received invalid data",B,636)}}catch(t){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(P.z3(`read packet error, ${t}`,B,644),k.LR):e.ioReader.error}}async seek(e,t,a,s){return BigInt(k.E$)}getAnalyzeStreamsCount(){return 0}async destroy(e){await this.rtspSession.teardown(this.context.sessionId),this.cacheAVPacket&&((0,w.Qe)(this.cacheAVPacket),this.cacheAVPacket=0),U.__(e.streams,(e=>{const t=e.privData;t.filter&&(t.filter.destroy(),t.filter=null)}))}}},97125:(e,t,a)=>{a.d(t,{CM:()=>o,Vz:()=>n,qg:()=>i});var s=a(19371),r=a(69048);class n{constructor(){(0,s.A)(this,"version",void 0),(0,s.A)(this,"layer",void 0),(0,s.A)(this,"protection",void 0),(0,s.A)(this,"bitrateIndex",void 0),(0,s.A)(this,"samplingFrequency",void 0),(0,s.A)(this,"padding",void 0),(0,s.A)(this,"private",void 0),(0,s.A)(this,"mode",void 0),(0,s.A)(this,"modeExtension",void 0),(0,s.A)(this,"copyright",void 0),(0,s.A)(this,"original",void 0),(0,s.A)(this,"emphasis",void 0)}}function i(e,t){e.version=t>>19&3,e.layer=t>>17&3,e.protection=t>>16&1,e.bitrateIndex=t>>12&15,e.samplingFrequency=t>>10&3,e.padding=t>>9&1,e.mode=t>>6&3,e.modeExtension=t>>4&3,e.copyright=t>>3&1,e.original=t>>2&1,e.emphasis=3&t}function o(e,t){let a=r.oz(e.version,e.layer,e.bitrateIndex);switch(e.layer){case 1:default:a=144e3*a/(t<<(3===e.version?0:1))>>>0,a+=e.padding;break;case 2:a=144e3*a/t>>>0,a+=e.padding;break;case 3:a=12e3*a/t>>>0,a=4*(a+e.padding)}return a}},64687:(e,t,a)=>{a.d(t,{K:()=>i,pl:()=>n});var s=a(19371);class r{constructor(){(0,s.A)(this,"version",void 0),(0,s.A)(this,"padding",void 0),(0,s.A)(this,"count",void 0),(0,s.A)(this,"payloadType",void 0),(0,s.A)(this,"length",void 0)}}class n{constructor(){(0,s.A)(this,"ssrc",void 0),(0,s.A)(this,"fractionLost",void 0),(0,s.A)(this,"packetLost",void 0),(0,s.A)(this,"highestSequence",void 0),(0,s.A)(this,"interArrivalJitter",void 0),(0,s.A)(this,"lsr",void 0),(0,s.A)(this,"dlsr",void 0)}}class i extends r{constructor(){super(...arguments),(0,s.A)(this,"ssrc",void 0),(0,s.A)(this,"ntp",void 0),(0,s.A)(this,"timestamp",void 0),(0,s.A)(this,"senderPacketCount",void 0),(0,s.A)(this,"senderOctetCount",void 0),(0,s.A)(this,"reports",[])}}},26499:(e,t,a)=>{function s(e){return e.length>4&&e[0]>127&&e[0]<192&&e[0]>>>6==2&&e[1]>=192&&e[1]<=223}a.d(t,{A:()=>s})},51925:(e,t,a)=>{a.d(t,{N:()=>n});var s=a(54570),r=a(64687);function n(e){const t=new s.A(e),a=new r.K;!function(e,t){let a=t.readUint8();e.version=a>>>6,e.padding=a>>>5&1,e.count=31&a,e.payloadType=t.readUint8(),e.length=t.readUint16()}(a,t),a.ssrc=t.readUint32(),a.ntp=t.readUint64(),a.timestamp=t.readUint32(),a.senderPacketCount=t.readUint32(),a.senderOctetCount=t.readUint32();for(let e=0;e<a.count;e++){const e=new r.pl;e.ssrc=t.readUint32(),e.fractionLost=t.readUint8(),e.packetLost=t.readUint24(),e.highestSequence=t.readUint32(),e.interArrivalJitter=t.readUint32(),e.lsr=t.readUint32(),e.dlsr=t.readUint32()}return a}},57211:(e,t,a)=>{a.d(t,{A:()=>c});var s=a(19371),r=a(42524),n=a(2955),i=a(91278);const o=i.zg>>>1;class c{constructor(e,t){(0,s.A)(this,"queue",void 0),(0,s.A)(this,"frameQueue",void 0),(0,s.A)(this,"codecpar",void 0),(0,s.A)(this,"currentSeqStart",void 0),(0,s.A)(this,"readyPos",void 0),(0,s.A)(this,"maskerQueue",void 0),(0,s.A)(this,"payloadContext",void 0),this.codecpar=e,this.queue=[],this.frameQueue=[],this.currentSeqStart=-1,this.readyPos=0,this.maskerQueue=[],this.payloadContext=t}isSeqIncreaseOne(e,t){return e+1===t||e===i.zg&&0===t}seqAMoreThenB(e,t){return e>t&&e-t<o||e<t&&t-e>o}isFirstStart(){if(this.currentSeqStart>-1)return this.isSeqIncreaseOne(this.currentSeqStart,this.queue[0].header.sequence);if(this.queue.length>5){if(1===r.f[15](this.codecpar))return!0;if(27===r.f[15](this.codecpar+4))switch(31&this.queue[0].payload[0]){case 24:for(let e=1;e<this.queue[0].payload.length-2;){const t=this.queue[0].payload[e]<<8|this.queue[0].payload[e+1],a=31&this.queue[0].payload[e+2];if(7===a||8===a||5===a||9===a)return!0;e+=2+t}break;case 28:if(128&this.queue[0].payload[1])return!0;break;case 7:case 9:return!0}else if(173===r.f[15](this.codecpar+4))switch(this.queue[0].payload[0]>>>1&63){case 48:let e=n.Dm+(this.payloadContext.usingDonlField?n.hE:0);for(;e<this.queue[0].payload.length-n.Dm;){const t=this.queue[0].payload[e]<<8|this.queue[0].payload[e+1],a=this.queue[0].payload[e+2]>>>1&63;if(34===a||32===a||33===a||20===a||19===a||35===a)return!0;e+=2+t,this.payloadContext.usingDonlField&&(e+=n.hQ)}break;case 49:if(128&this.queue[0].payload[2])return!0;break;case 32:case 35:return!0}else if(139===r.f[15](this.codecpar+4)){if(16&this.queue[0].payload[0])return!0}else if(167===r.f[15](this.codecpar+4)){if(8&this.queue[0].payload[0])return!0}else if(225===r.f[15](this.codecpar+4)){if(1&this.queue[0].payload[0])return!0}else if(2===r.f[15](this.codecpar+4)&&1==(this.queue[0].payload[2]>>>5&1))return!0;return this.readyPos>200}return!1}check(){for(;this.readyPos<this.queue.length-1&&this.isSeqIncreaseOne(this.queue[this.readyPos].header.sequence,this.queue[this.readyPos+1].header.sequence);)this.readyPos++,(this.queue[this.readyPos].header.masker||65543===r.f[15](this.codecpar+4)||65542===r.f[15](this.codecpar+4)||86017===r.f[15](this.codecpar+4)||69660===r.f[15](this.codecpar+4)||65537===r.f[15](this.codecpar+4))&&this.maskerQueue.push(this.readyPos)}push(e){if(this.currentSeqStart>-1&&this.seqAMoreThenB(this.currentSeqStart,e.header.sequence))return;if(!this.queue.length)return this.queue.push(e),void(e.header.masker&&this.maskerQueue.push(0));let t=!1;if(this.seqAMoreThenB(this.queue[0].header.sequence,e.header.sequence))this.queue.unshift(e),this.readyPos=0,this.maskerQueue.length=0,t=!0,this.check();else for(let a=this.readyPos;a<this.queue.length;a++)if(this.seqAMoreThenB(this.queue[a].header.sequence,e.header.sequence)){this.queue.splice(a,0,e),t=!0,a===this.readyPos+1&&this.check();break}t||(this.queue.push(e),this.readyPos+2===this.queue.length&&this.check());let a=0;for(;this.isFirstStart()&&this.maskerQueue.length;){const e=this.maskerQueue.shift()+1,t=this.queue.slice(a,e);this.frameQueue.push(t),a=e,this.currentSeqStart=t[t.length-1].header.sequence}if(a){this.queue=this.queue.slice(a),this.readyPos=Math.max(0,this.readyPos-a);for(let e=0;e<this.maskerQueue.length;e++)this.maskerQueue[e]-=a}}hasFrame(){return this.frameQueue.length}getFrame(){return this.frameQueue.shift()}}},28051:(e,t,a)=>{a.d(t,{El:()=>r,N8:()=>i,tW:()=>n});var s=a(19371);class r{constructor(){(0,s.A)(this,"version",void 0),(0,s.A)(this,"padding",void 0),(0,s.A)(this,"extension",void 0),(0,s.A)(this,"csrc",void 0),(0,s.A)(this,"masker",void 0),(0,s.A)(this,"payloadType",void 0),(0,s.A)(this,"sequence",void 0),(0,s.A)(this,"timestamp",void 0),(0,s.A)(this,"ssrc",void 0),(0,s.A)(this,"csrcList",[])}}class n{constructor(){(0,s.A)(this,"id",void 0),(0,s.A)(this,"length",void 0),(0,s.A)(this,"extension",void 0),(0,s.A)(this,"headers",new Map)}hasOneByteExtensions(){return 48862===this.id}hasTwoBytesExtensions(){return 4096==(65520&this.id)}parse(){if(this.hasOneByteExtensions())for(let e=0;e<this.extension.length;e++){const t=(240&this.extension[e])>>>4,a=1+(15&this.extension[e]);if(15===t)break;0!==t?(this.headers.set(t,this.extension.subarray(e+1,e+1+a)),e+=1+a):e++}else if(this.hasTwoBytesExtensions())for(let e=0;e<this.extension.length;e++){const t=this.extension[e],a=this.extension[e+1];0!==t?(this.headers.set(t,this.extension.subarray(e+2,e+2+a)),e+=2+a):e++}}}class i{constructor(){(0,s.A)(this,"header",void 0),(0,s.A)(this,"headerExtension",void 0),(0,s.A)(this,"payload",void 0)}}},65438:(e,t,a)=>{a.d(t,{Hj:()=>c,Jz:()=>f,hw:()=>h,kx:()=>l,l6:()=>u,o_:()=>p,pA:()=>d,we:()=>m,xW:()=>g});var s=a(2955),r=a(87339),n=a(33134),i=a(5043);const o="packages/avprotocol/src/rtp/depacketizer.ts";function c(e){const t=[];let a=!1;for(let s=0;s<e.length;s++){const i=e[s].payload,c=31&i[0];switch(c){case 24:for(let e=1;e<i.length-2;){const s=i[e]<<8|i[e+1];if(e+2+s>i.length)return r.z3("pack h264 STAP-A failed",o,69),{nalus:[],isKey:a};t.push(i.subarray(e+2,e+2+s)),5==(31&i[e+2])&&(a=!0),e+=2+s}break;case 25:case 26:case 27:case 29:return r.z3("not support nalu pack",o,92),{nalus:[],isKey:a};case 28:const d=i[1];if(1&~(d>>>7))return r.z3("not the first FU-A packet",o,101),{nalus:[],isKey:a};const l=31&d,h=224&i[0]|l;5===l&&(a=!0);const p=[new Uint8Array([h])];for(p.push(i.subarray(2)),s++;s<e.length&&(p.push(e[s].payload.subarray(2)),!(e[s].payload[1]>>>6&1));s++);t.push((0,n.A)(Uint8Array,p));break;default:5===c&&(a=!0),t.push(i)}}return{nalus:t,isKey:a}}function d(e,t){const a=[];let i=!1;for(let c=0;c<e.length;c++){const d=e[c].payload,l=d[0]>>>1&63;switch(l>50&&r.z3("not support nalu pack",o,148),l){case 48:for(let e=s.Dm+(t.usingDonlField?s.hE:0);e<d.length-2;){const n=d[e]<<8|d[e+1];if(e+2+n>d.length)return r.z3("pack hevc STAP-A failed",o,157),{nalus:[],isKey:i};a.push(d.subarray(e+2,e+2+n));const c=d[e+2]>>>1&63;20!==c&&19!==c||(i=!0),e+=2+n,t.usingDonlField&&(e+=s.hQ)}break;case 49:const h=63&d[2];20!==h&&19!==h||(i=!0);const p=[new Uint8Array([129&d[0]|h<<1,d[1]])];for(p.push(d.subarray(3+(t.usingDonlField?s.hE:0))),c++;c<e.length&&(p.push(e[c].payload.subarray(3+(t.usingDonlField?s.hE:0))),!(e[c].payload[2]>>>6&1));c++);a.push((0,n.A)(Uint8Array,p));break;case 50:return r.z3("not support nalu pack",o,201),{nalus:[],isKey:i};default:20!==l&&19!==l||(i=!0),a.push(d)}}return{nalus:a,isKey:i}}function l(e,t){const a=[],c=[],d=new i.A(s.MO);for(let i=0;i<e.length;i++){const l=e[i].payload;if(t.latm){let e=0;for(;e<l.length;){let t=0;for(;;){const a=l[e++];if(t+=a,255!==a)break}a.push(l.subarray(e,e+t)),e+=t}}else{if(l.length<2)return void r.z3("invalid mpeg4 payload length",o,245);const e=l[0]<<8|l[1];if(e>s.MO)return void r.z3("invalid mpeg4 payload au header length",o,250);const i=(e+7)/8>>>0;if(l.length-2<i)return void r.z3("invalid mpeg4 payload au length",o,255);const h=t.sizeLength+t.indexLength;if(e%h!=0)return void r.z3("not support mpeg4 payload au format",o,262);const p=e/h,u=[],f=[];d.reset(),d.appendBuffer(l.subarray(2));for(let e=0;e<p;e++)u.push(d.readU(t.sizeLength)),f.push(d.readU(t.indexLength));if(1===u.length&&u[0]+i+2>=l.length)u[0]+i+2===l.length?a.push(l.subarray(2+i)):c.push(l.subarray(2+i));else if(u.length>1){let e=i+2;for(let t=0;t<u.length;t++)!f[t]&&c.length&&(a.push(1===c.length?c[0]:(0,n.A)(Uint8Array,c)),c.length=0),a.push(l.subarray(e,e+u[t])),e+=u[t]}}}return c.length&&a.push(1===c.length?c[0]:(0,n.A)(Uint8Array,c)),a}function h(e){const t=[];let a=!1;for(let s=0;s<e.length;s++){const r=e[s].payload[0]>>>7,n=e[s].payload[0]>>>4&1,i=7&e[s].payload[0];let o=1;if(r){const r=e[s].payload[o]>>>7,c=e[s].payload[o]>>>6&1,d=e[s].payload[o]>>>5&1,l=e[s].payload[o]>>>4&1;o++,r&&e[s].payload[o++]>>>7&&o++,c&&o++,(d||l)&&o++,!n||0!==i||1&e[s].payload[o]||(a=!0),t.push(e[s].payload.subarray(o))}}return 1===t.length?{payload:t[0],isKey:a}:{payload:(0,n.A)(Uint8Array,t),isKey:a}}function p(e){const t=[];let a=!1;for(let s=0;s<e.length;s++){const n=e[s].payload[0]>>>7,i=e[s].payload[0]>>>5&1,c=e[s].payload[0]>>>4&1,d=e[s].payload[0]>>>3&1,l=e[s].payload[0]>>>1&1;let h=1;n&&e[s].payload[h++]>>>7&&h++;let p=0;if(i&&(c&&(p=3&e[s].payload[h]),h++),c)for(let t=0;t<p;t++)16&e[t].payload[h]?h+=2:h+=1;if(l){const t=e[s].payload[h]>>5,a=!!(16&e[s].payload[h]),n=!!(8&e[s].payload[h]);if(h++,t>0&&r.h2("VP9 scalability structure with multiple layers",o,407),a)for(s=0;s<t+1;s++)h+=4;if(n){const t=e[s].payload[h++];for(s=0;s<t;s++){const t=e[s].payload[h]>>2&3;h++;for(let e=0;e<t;e++)h++}}}if(d){const t=e[s].payload[h],r=((t>>>4&1)<<1)+(t>>>5&1);a=!(t>>>(3===r?2:3)&1||t>>>(3===r?1:2)&1)}t.push(e[s].payload.subarray(h))}return 1===t.length?{isKey:a,payload:t[0]}:{isKey:a,payload:(0,n.A)(Uint8Array,t)}}function u(e){const t=[];let a=!1;function s(e,t){let a=0;for(let s=0;s<8;s++){let r=e[t++];if(a|=(127&r)<<7*s,!(128&r))break}return{value:a,offset:t}}for(let r=0;r<e.length;r++){const n=e[r].payload[0]>>>4&3;let i=1;if(n){for(let r=0;r<n-1;r++){const n=s(e[r].payload,i);i=n.offset,1==(e[r].payload[i]>>>3&15)&&(a=!0),t.push(e[r].payload.subarray(i,i+n.value)),i+=n.value}1==(e[r].payload[i]>>>3&15)&&(a=!0),t.push(e[r].payload.subarray(i))}else for(;i<e[r].payload.length-1;){const n=s(e[r].payload,i);i=n.offset,1==(e[r].payload[i]>>>3&15)&&(a=!0),t.push(e[r].payload.subarray(i,i+n.value)),i+=n.value}}return 1===t.length?{payload:t[0],isKey:a}:{payload:(0,n.A)(Uint8Array,t),isKey:a}}function f(e,t){const a=[];for(let s=0;s<e.length;s++){let r=4;0===t&&1==(e[s].payload[0]>>>2&1)&&(r=8),a.push(e[s].payload.subarray(r))}return 1===a.length?a[0]:(0,n.A)(Uint8Array,a)}function m(e){const t=[],a=[];for(let s=0;s<e.length;s++){const r=e[s].payload;switch(3&r[0]){case 0:t.push(r.subarray(2));break;case 1:case 2:a.push(r.subarray(2));break;case 3:a.push(r.subarray(2)),t.push((0,n.A)(Uint8Array,a)),a.length=0}}return 1===t.length?t[0]:(0,n.A)(Uint8Array,t)}function g(e){if(1===e.length)return e[0].payload;const t=[];for(let a=0;a<e.length;a++)t.push(e[a].payload);return(0,n.A)(Uint8Array,t)}},22072:(e,t,a)=>{a.d(t,{zQ:()=>f});var s=a(18152),r=a(87339),n=a(5043),i=a(5639),o=a(31184),c=a(61556),d=a(73872),l=a(54829),h=a(41863);function p(e,t){const a=e.split(";");for(let e=0;e<a.length;e++){const s=a[e].split("="),r=s[0].trim();s.shift(),t(r,s.join("=").trim())}}function u(e,t){const a={};return p(t,((t,s)=>{switch(t){case"streamtype":a.streamType=+s;break;case"profile-level-id":a.profileLevelId=+s;break;case"mode":a.mode=s;break;case"sizelength":a.sizeLength=+s;break;case"indexlength":a.indexLength=+s;break;case"indexdeltalength":a.indexDeltaLength=+s;break;case"config":a.config=s,e.codecpar.extradata=(0,o.sY)(s.length/2),e.codecpar.extradataSize=s.length/2;const t=(0,h.s3)(e.codecpar.extradata,e.codecpar.extradataSize);let r=0;for(let e=0;e<s.length;e+=2)t[r++]=+("0x"+s.substring(e,e+2));86018===e.codecpar.codecId&&l.XC(e,(0,h.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}})),a}const f={27:function(e,t){e.codecpar.flags|=1;const a={};return p(t,((t,r)=>{switch(t){case"profile-level-id":a.profile=+("0x"+r.substring(0,2)),a.level=+("0x"+r.substring(4,6));break;case"packetization-mode":a.packetizationMode=+r;break;case"sprop-parameter-sets":const t=r.split(",").map((e=>s.E_(e))),n=i.nW(t,0);e.codecpar.extradata=(0,o.sY)(n.length),e.codecpar.extradataSize=n.length,(0,h.lW)(e.codecpar.extradata,n.length,n),c.XC(e,(0,h.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}})),a},173:function(e,t){const a={},r=[];if(e.codecpar.flags|=1,p(t,((e,t)=>{switch(e){case"profile-id":a.profile=+t;break;case"sprop-vps":case"sprop-sps":case"sprop-pps":case"sprop-sei":r.push(s.E_(t))}})),r.length){const t=i.nW(r,0);e.codecpar.extradata=(0,o.sY)(t.length),e.codecpar.extradataSize=t.length,(0,h.lW)(e.codecpar.extradata,t.length,t),d.XC(e,(0,h.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}return a},86018:u,86065:function(e,t){const a={latm:!0};return e.codecpar.codecId=86018,p(t,((t,s)=>{switch(t){case"profile-level-id":a.profileLevelId=+s;break;case"cpresent":a.cpresent=+s;break;case"config":a.config=s;const t=new Uint8Array(s.length/2);let i=0;for(let e=0;e<s.length;e+=2)t[i++]=+("0x"+s.substring(e,e+2));const c=new n.A(t.length);c.appendBuffer(t);const d=c.readU1(),p=c.readU1();c.skip(6);const u=c.readU(4),f=c.readU(3);0==d&&1==p&&0==u&&0==f||r.h2("LATM config not support","packages/avprotocol/src/rtp/fmtp.ts",203),e.codecpar.extradata=(0,o.sY)(2),e.codecpar.extradataSize=2;const m=(0,h.s3)(e.codecpar.extradata,e.codecpar.extradataSize);m[0]=c.readU(8),m[1]=c.readU(8),l.XC(e,(0,h.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}})),a},12:u}},41619:(e,t,a)=>{function s(e){return e.length>12&&e[0]>127&&e[0]<192&&e[0]>>>6==2}a.d(t,{A:()=>s})},3998:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(28051);function r(e){const t=new s.N8,a=t.header=new s.El;let r=0;a.version=e[r]>>6,a.padding=e[r]>>5&1,a.extension=e[r]>>4&1,a.csrc=15&e[r],r++,a.masker=e[r]>>7&1,a.payloadType=127&e[r],r++,a.sequence=e[r]<<8|e[r+1],r+=2,a.timestamp=(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0,r+=4,a.ssrc=(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0,r+=4;for(let t=0;t<a.csrc;t++)a.csrcList.push((e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0),r+=4;return a.extension&&(t.headerExtension=t.headerExtension=new s.tW,t.headerExtension.id=e[r]<<8|e[r+1],r+=2,t.headerExtension.length=e[r]<<8|e[r+1],r+=2,t.headerExtension.extension=e.subarray(r,4*t.headerExtension.length),r+=4*t.headerExtension.length),t.payload=e.subarray(r,e.length-(a.padding?e[e.length-1]:0)),t}},2955:(e,t,a)=>{a.d(t,{Dm:()=>r,MO:()=>s,fm:()=>c,hE:()=>i,hQ:()=>n,xl:()=>o});const s=8192,r=2,n=1,i=2,o={PCMU:65542,PCMA:65543,G723:86068,G722:69660,L16:65537,MPA:86017,MPV:2,MP2T:131072,H264:27,H265:173,HEVC:173,VP8:139,VP9:167,AV1:225,opus:86076,speex:86051,vorbis:86021,theora:30,"MP4A-LATM":86065,"MP4V-ES":12,"mpeg4-generic":86018,ac3:86019},c=[{payload:0,name:"PCMU",codecType:1,codecId:65542,rate:8e3,encoding:1},{payload:4,name:"G723",codecType:1,codecId:86068,rate:8e3,encoding:1},{payload:8,name:"PCMA",codecType:1,codecId:65543,rate:8e3,encoding:1},{payload:9,name:"G722",codecType:1,codecId:69660,rate:8e3,encoding:1},{payload:10,name:"L16",codecType:1,codecId:65537,rate:44100,encoding:2},{payload:11,name:"L16",codecType:1,codecId:65537,rate:44100,encoding:1},{payload:14,name:"MPA",codecType:1,codecId:86017,rate:-1,encoding:-1},{payload:31,name:"H261",codecType:0,codecId:3,rate:9e4,encoding:-1},{payload:32,name:"MPV",codecType:0,codecId:2,rate:9e4,encoding:-1},{payload:33,name:"MPV",codecType:2,codecId:131072,rate:9e4,encoding:-1},{payload:34,name:"H263",codecType:0,codecId:4,rate:9e4,encoding:-1}]},3867:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(19371),r=a(66525);class n extends r.zo{constructor(e,t,a){super(t,a),(0,s.A)(this,"seq",void 0),(0,s.A)(this,"version","RTSP/1.0"),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"authorization",void 0),this.seq=1,this.uri=e}async options(){const e=new r.yz("OPTIONS",this.uri,this.version,{CSeq:""+this.seq++});return super.request(e)}async describe(){const e=new r.yz("DESCRIBE",this.uri,this.version,{CSeq:""+this.seq++,Accept:"application/sdp",Authorization:this.authorization});return super.request(e)}async setup(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a="";2===e.streamMode&&(a="/TCP");let s="",n="";1===e.streamMode?n=`;${e.clientPort}-${e.clientPort+1}`:2===e.streamMode&&(s=`;${e.interleaved}-${e.interleaved+1}`);const i=new r.yz("SETUP",this.uri+`/trackID=${e.trackId}`,this.version,{CSeq:""+this.seq++,Session:t,Authorization:this.authorization,Transport:`RTP/AVP${a};${e.multcast?"multcast":"unicast"}${s}${n}`});return super.request(i)}async play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{from:0,to:-1};const a=new r.yz("PLAY",this.uri,this.version,{CSeq:""+this.seq++,Session:e,Authorization:this.authorization,Range:`npt=${t.from>=0?t.from:0}-${t.to>0?t.to:""}`});return super.request(a)}async pause(e){const t=new r.yz("PAUSE",this.uri,this.version,{CSeq:""+this.seq++,Session:e,Authorization:this.authorization});return super.request(t)}async teardown(e){const t=new r.yz("TEARDOWN",this.uri,this.version,{CSeq:""+this.seq++,Session:e,Authorization:this.authorization});await super.notify(t)}async readPacket(){for(;;){36!==await this.ioReader.peekUint8()&&await this.readResponse(),await this.ioReader.skip(1);const e=await this.ioReader.readUint8(),t=await this.ioReader.readUint16();return{interleaved:e,data:await this.ioReader.readBuffer(t)}}}}},99634:(e,t,a)=>{a.d(t,{lN:()=>n});const s=/(.*)/,r="%s",n={v:[{name:"version",reg:/^(\d*)$/,format:r}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name",reg:s,format:r}],i:[{name:"description",reg:s,format:r}],u:[{name:"uri",reg:s,format:r}],e:[{name:"email",reg:s,format:r}],p:[{name:"phone",reg:s,format:r}],z:[{name:"timezones",reg:s,format:r}],r:[{name:"repeats",reg:s,format:r}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/,format:r},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/,format:r},{name:"icelite",reg:/^(ice-lite)/,format:r},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){let t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/,format:r},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){let t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/,format:r},{name:"rtcpRsize",reg:/^(rtcp-rsize)/,format:r},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/,format:r},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){let t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",reg:s,names:["value"],format:r}]}},58267:(e,t,a)=>{a.d(t,{q:()=>o});var s=a(99634);const r=e=>/^([a-z])=(.*)/.test(e);function n(e){return String(Number(e))===e?Number(e):e}function i(e,t,a){const s=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:s&&!t[e.name]&&(t[e.name]={});const r=e.push?{}:s?t[e.name]:t;!function(e,t,a,s){if(s&&!a)t[s]=n(e[1]);else for(let s=0;s<a.length;s+=1)null!=e[s+1]&&(t[a[s]]=n(e[s+1]))}(a.match(e.reg),r,e.names,e.name),e.push&&t[e.push].push(r)}function o(e){const t={},a=[];let n=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach((e=>{const t=e[0],r=e.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),n=a[a.length-1]);for(let e=0;e<(s.lN[t]||[]).length;e+=1){const a=s.lN[t][e];if(a.reg.test(r))return i(a,n,r)}})),t.media=a,t}},54829:(e,t,a)=>{a.d(t,{Bq:()=>h,En:()=>c,Ij:()=>l,XC:()=>d,f7:()=>p,hY:()=>o,uF:()=>n});var s=a(91278),r=a(5043);const n={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},i={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,s.N_,s.N_,s.N_],c=[s.N_,1,2,3,4,5,6,7];function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:a,sampleRate:r,channels:n}=function(e){let t=s.N_,a=s.N_,r=s.N_;return e.length>=2&&(t=e[0]>>3&31,a=o[(7&e[0])<<1|e[1]>>7],r=c[e[1]>>3&15]),{profile:t,sampleRate:a,channels:r}}(t);e.codecpar.profile=a,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=n,e.codecpar.frameSize=5===a?2048:1024,e.codecpar.format=8}}function l(e){const t=i[e.sampleRate],a=e.chLayout.nbChannels,r=e.profile===s.N_?2:e.profile,n=new Uint8Array(2);return n[0]=(31&r)<<3|(14&t)>>1,n[1]=(1&t)<<7|(15&a)<<3,n}function h(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const a=1&e[1],s=(192&e[2])>>>6,r=(60&e[2])>>>2,n=(1&e[2])<<2|(192&e[3])>>>6,i=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,d=3&e[6];let l=1===a?7:9,h=i-l;return{syncWord:t,profile:s+1,sampleRate:o[r],channels:c[n],aacFrameLength:i,numberOfRawDataBlocksInFrame:d,headerLength:l,framePayloadLength:h}}function p(e,t){function a(){const e=t.readU(2);let a=0;for(let s=0;s<=e;s++)a<<=8,a|=t.readU(8);return a}t||(t=new r.A).appendBuffer(e);const s=t.getPointer(),n={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},i=t.readU(11);if(695!==i)return-1;n.syncWord=i,n.muxLengthBytes=t.readU(13);const d=1===t.readU1();if(n.useSameStreamMux=d,!d){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&a(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let s=e?a():0;const r=t.readU(5);s-=5;const i=t.readU(4);s-=4;const d=t.readU(4);if(s-=4,t.readU(3),s-=3,s>0&&t.readU(s),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)a();else{let e=0;for(;;){e<<=8;const a=1===t.readU1();if(e+=t.readU(8),!a)break}}1===t.readU1()&&t.readU(8),n.profile=r+1,n.sampleRate=o[i],n.channels=c[d]}let l=0;for(;;){const e=t.readU(8);if(l+=e,255!==e)break}return n.framePayloadLength=l,n.headerLength=t.getPointer()-s+(8===t.getBitLeft()?0:1),n}},79939:(e,t,a)=>{a.d(t,{R:()=>u,j:()=>r});var s=a(5043);const r=[3,4,3,7,259,263,1539,1543],n=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],i=[4,5,6,5],o=[4,6,7,6],c=[48e3,44100,32e3,0],d=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],h=[1,2,3,6],p=7;function u(e){const t=new s.A(e.length);t.appendBuffer(e);const a={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(a.syncWord=t.readU(16),2935!==a.syncWord)return-1;if(a.bitstreamId=31&t.peekU(29),a.bitstreamId>16)return-2;if(a.numBlocks=6,a.ac3BitrateCode=-1,a.centerMixLevel=5,a.surroundMixLevel=6,a.dolbySurroundMode=0,a.bitstreamId<=10){if(a.crc1=t.readU(16),a.srCode=t.readU(2),3===a.srCode)return-3;const e=t.readU(6);if(e>37)return-4;a.ac3BitrateCode=e>>1,t.readU(5),a.bitstreamMode=t.readU(3),a.channelMode=t.readU(3),2==a.channelMode?a.dolbySurroundMode=t.readU(2):(1&a.channelMode&&1!=a.channelMode&&(a.centerMixLevel=i[t.readU(2)]),4&a.channelMode&&(a.surroundMixLevel=o[t.readU(2)])),a.lfeOn=t.readU(1),a.srShift=Math.max(a.bitstreamId,8)-8,a.sampleRate=c[a.srCode]>>a.srShift,a.bitrate=1e3*d[a.ac3BitrateCode]>>a.srShift,a.channels=l[a.channelMode]+a.lfeOn,a.frameSize=2*n[e][a.srCode],a.frameType=2,a.substreamId=0}else{if(a.crc1=0,a.frameType=t.readU(2),3==a.frameType)return-5;if(a.substreamId=t.readU(3),a.frameSize=t.readU(11)+1<<1,a.frameSize<p)return-6;if(a.srCode=t.readU(2),3==a.srCode){const e=t.readU(2);if(3==e)return-7;a.sampleRate=c[e]/2,a.srShift=1}else a.numBlocks=h[t.readU(2)],a.sampleRate=c[a.srCode],a.srShift=0;a.channelMode=t.readU(3),a.lfeOn=t.readU(1),a.bitrate=8*a.frameSize*a.sampleRate/(256*a.numBlocks),a.channels=l[a.channelMode]+a.lfeOn}return a.channelLayout=BigInt(r[a.channelMode]),a.lfeOn&&(a.channelLayout|=BigInt(8)),a}},69048:(e,t,a)=>{a.d(t,{Au:()=>v,He:()=>A,XC:()=>x,Y2:()=>m,hG:()=>g,oz:()=>y});var s=a(91278);const r=[44100,48e3,32e3,0],n=[22050,24e3,16e3,0],i=[11025,12e3,8e3,0],o=[0,1152,1152,384],c=[0,576,1152,384],d=[0,576,1152,384],l=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],h=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],p=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],u=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],f=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function m(e,t){switch(e){case 0:return i[t];case 2:return n[t];case 3:return r[t]}return s.N_}function g(e,t){switch(e){case 0:return d[t];case 2:return c[t];case 3:return o[t]}return s.N_}function y(e,t,a){switch(t){case 1:switch(e){case 0:case 2:return f[a];case 3:return p[a]}break;case 2:switch(e){case 0:case 2:return f[a];case 3:return h[a]}case 3:switch(e){case 0:case 2:return u[a];case 3:return l[a]}}return s.N_}function v(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return s.N_}const A={32:"Layer1",33:"Layer2",34:"Layer3"};function x(e,t){if(t&&t.length>=4){const a=t[1]>>>3&3,s=(6&t[1])>>1,r=(12&t[2])>>>2,n=3&~(t[3]>>>6)?2:1,i=v(s),o=m(a,r);e.codecpar.profile=i,e.codecpar.sampleRate=o,e.codecpar.chLayout.nbChannels=n}}},36991:(e,t,a)=>{function s(e){const t=e>>BigInt(32),a=(e&BigInt(4294967295))*BigInt(1e6)/BigInt(4294967295);return t*BigInt(1e6)+a}a.d(t,{q:()=>s})},66525:(e,t,a)=>{a.d(t,{yz:()=>n,zo:()=>o});var s=a(19371),r=a(25092);class n{constructor(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";(0,s.A)(this,"method",void 0),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"protocol",void 0),(0,s.A)(this,"headers",void 0),(0,s.A)(this,"content",void 0),this.method=e,this.uri=t,this.protocol=a,this.headers=r,this.content=n}setHeader(e,t){this.headers[e]=t}encode(){let e=`${this.method} ${this.uri} ${this.protocol}\r\n`;return this.headers["Content-Length"]=this.content.length+"",r.__(this.headers,((t,a)=>{t&&(e+=`${a}: ${t}\r\n`)})),e+="\r\n",this.content&&(e+=this.content),e}}class i{constructor(e,t,a,r,n){(0,s.A)(this,"protocol",void 0),(0,s.A)(this,"statusCode",void 0),(0,s.A)(this,"statusText",void 0),(0,s.A)(this,"headers",void 0),(0,s.A)(this,"content",void 0),this.protocol=e,this.statusCode=t,this.statusText=a,this.headers=r,this.content=n}}class o{constructor(e,t){(0,s.A)(this,"ioReader",void 0),(0,s.A)(this,"ioWriter",void 0),this.ioReader=e,this.ioWriter=t}async readResponse(){let e=(await this.ioReader.readLine()).trim().split(" "),t="",a={};for(;;){const e=(await this.ioReader.readLine()).trim();if(!e)break;const t=e.split(":");a[t[0].trim()]=t[1].trim()}return a["Content-Length"]&&(t=await this.ioReader.readString(+a["Content-Length"])),new i(e[0].trim(),+e[1].trim(),e[2].trim(),a,t)}async request(e){return this.ioWriter.reset(),this.ioWriter.writeString(e.encode()),this.ioWriter.flush(),this.readResponse()}async notify(e){this.ioWriter.reset(),this.ioWriter.writeString(e.encode()),await this.ioWriter.flush()}}}}]);