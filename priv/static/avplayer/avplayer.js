!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AVPlayer=t():e.AVPlayer=t()}(self,(()=>(()=>{"use strict";var e,t,i={11201:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(19371),s=i(47378),a=i(81585),o=i(87339);class n{constructor(e){(0,r.A)(this,"resampler",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"inputParameters",void 0),(0,r.A)(this,"outputParameters",void 0),this.options=e,this.resampler=new a.A(this.options.resource)}async open(e,t){this.inputParameters=e,this.outputParameters=t,await this.resampler.run(),this.resampler.invoke("resample_set_input_parameters",e.sampleRate,e.channels,e.format,e.layout||0),this.resampler.invoke("resample_set_output_parameters",t.sampleRate,t.channels,t.format,t.layout||0);let i=this.resampler.invoke("resample_init");return i<0?(o.z3(`open resampler failed, ret: ${i}`,"packages/audioresample/src/Resampler.ts",82),s.nr):0}resample(e,t,i){return this.resampler.invoke("resample_process",e,t,i)}getOutputSampleCount(e){return this.resampler.invoke("resample_nb_sample",e)}close(){this.resampler.invoke("resample_destroy"),this.resampler.destroy()}getInputPCMParameters(){return this.inputParameters}getOutputPCMParameters(){return this.outputParameters}}},91728:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(81585);class a{constructor(e){(0,r.A)(this,"processor",void 0),(0,r.A)(this,"options",void 0),this.options=e,this.processor=new s.A(this.options.resource)}async open(e){await this.processor.run(),this.processor.invoke("stretchpitch_init"),this.processor.invoke("stretchpitch_set_channels",e.channels),this.processor.invoke("stretchpitch_set_samplerate",e.sampleRate)}setRate(e){this.processor.invoke("stretchpitch_set_rate",e)}setRateChange(e){this.processor.invoke("stretchpitch_set_rate_change",e)}setTempo(e){this.processor.invoke("stretchpitch_set_tempo",e)}setTempoChange(e){this.processor.invoke("stretchpitch_set_tempo_change",e)}setPitch(e){this.processor.invoke("stretchpitch_set_pitch",e)}setPitchOctaves(e){this.processor.invoke("stretchpitch_set_pitch_octaves",e)}setPitchSemiTones(e){this.processor.invoke("stretchpitch_set_pitch_semi_tones",e)}sendSamples(e,t){this.processor.invoke("stretchpitch_send_samples",e,t)}receiveSamples(e,t){return this.processor.invoke("stretchpitch_receive_samples",e,t)}flush(){this.processor.invoke("stretchpitch_flush")}clear(){this.processor.invoke("stretchpitch_clear")}getUnprocessedSamplesCount(){return this.processor.invoke("stretchpitch_get_unprocessed_samples_num")}getInputOutputSamplesRatio(){return this.processor.invoke("stretchpitch_get_input_output_sample_ratio")}getLatency(){return this.processor.invoke("get_latency")}close(){this.processor.invoke("stretchpitch_destroy"),this.processor.destroy()}}},59451:(e,t,i)=>{i.d(t,{A:()=>g});var r=i(19371),s=i(42524),a=i(77389),o=i(33740),n=i(42365),h=i(86270),d=i(31184),c=i(47378),l=i(81585),u=i(25092),f=i(81819),p=i(24788),m=i(87339);class g{constructor(e){(0,r.A)(this,"options",void 0),(0,r.A)(this,"decoder",void 0),(0,r.A)(this,"frame",0),(0,r.A)(this,"decoderOptions",0),(0,r.A)(this,"timeBase",void 0),this.options=e,this.decoder=new l.A(e.resource)}getAVFrame(){return this.frame?this.frame:this.frame=this.options.avframePool?this.options.avframePool.alloc():(0,n.FP)()}outputAVFrame(){this.frame&&(this.options.onReceiveAVFrame?(a.M[15](this.frame+124,this.timeBase.den),a.M[15](this.frame+120,this.timeBase.num),this.options.onReceiveAVFrame(this.frame)):this.options.avframePool?this.options.avframePool.release(this.frame):(0,n.xj)(this.frame),this.frame=0)}receiveAVFrame(){return this.decoder.invoke("decoder_receive",this.getAVFrame())}async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this.decoder.run();const i=o.s_.malloc(4);a.M[20](i,0),u.HP(t).length&&(this.decoderOptions&&(h.AO(this.decoderOptions),o.s_.free(this.decoderOptions),this.decoderOptions=0),this.decoderOptions=(0,d.Gy)(8),u.__(t,((e,t)=>{(f.Yj(e)||f.Yj(t))&&h.a5(this.decoderOptions,t,e)})),a.M[20](i,this.decoderOptions));let r=0;return p.A.jspi?r=await this.decoder.invokeAsync("decoder_open",e,0,1,i):(r=this.decoder.invoke("decoder_open",e,0,1,i),await this.decoder.childThreadsReady()),this.decoderOptions=s.f[20](i),o.s_.free(i),r<0?(m.z3(`open audio decoder failed, ret: ${r}`,"packages/avcodec/src/wasmcodec/AudioDecoder.ts",133),c.r8):(this.timeBase=void 0,0)}decode(e){this.timeBase||(this.timeBase={den:s.f[15](e+76),num:s.f[15](e+72)});let t=this.decoder.invoke("decoder_decode",e);if(t)return t;for(;;){if(t=this.receiveAVFrame(),1!==t){if(t<0)return t;break}this.outputAVFrame()}return 0}async flush(){for(this.decoder.invoke("decoder_flush");;){const e=this.receiveAVFrame();if(e<1)return e;this.outputAVFrame()}return 0}close(){this.decoder.invoke("decoder_close"),this.decoder.destroy(),this.frame&&(this.options.avframePool?this.options.avframePool.release(this.frame):(0,n.xj)(this.frame),this.frame=0),this.decoderOptions&&(h.AO(this.decoderOptions),o.s_.free(this.decoderOptions),this.decoderOptions=0)}}},84804:(e,t,i)=>{i.d(t,{A:()=>g});var r=i(19371),s=i(42524),a=i(77389),o=i(33740),n=i(42365),h=i(86270),d=i(31184),c=i(47378),l=i(81585),u=i(25092),f=i(81819),p=i(24788),m=i(87339);class g{constructor(e){(0,r.A)(this,"options",void 0),(0,r.A)(this,"decoder",void 0),(0,r.A)(this,"frame",0),(0,r.A)(this,"parameters",0),(0,r.A)(this,"decoderOptions",0),(0,r.A)(this,"timeBase",void 0),(0,r.A)(this,"dtsQueue",[]),this.options=e,this.decoder=new l.A(this.options.resource)}getAVFrame(){return this.frame?this.frame:this.frame=this.options.avframePool?this.options.avframePool.alloc():(0,n.FP)()}outputAVFrame(){this.frame&&(2&s.f[15](this.parameters+160)&&this.dtsQueue.length&&a.M[17](this.frame+104,this.dtsQueue.shift()),this.options.onReceiveAVFrame?(a.M[15](this.frame+124,this.timeBase.den),a.M[15](this.frame+120,this.timeBase.num),this.options.onReceiveAVFrame(this.frame)):this.options.avframePool?this.options.avframePool.release(this.frame):(0,n.xj)(this.frame),this.frame=0)}receiveAVFrame(){return this.decoder.invoke("decoder_receive",this.getAVFrame())}async receiveAVFrameAsync(){return this.decoder.invokeAsync("decoder_receive",this.getAVFrame())}async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};await this.decoder.run(void 0,t);let r=0;const n=o.s_.malloc(4);return a.M[20](n,0),u.HP(i).length&&(this.decoderOptions&&(h.AO(this.decoderOptions),o.s_.free(this.decoderOptions),this.decoderOptions=0),this.decoderOptions=(0,d.Gy)(8),u.__(i,((e,t)=>{(f.Yj(e)||f.Yj(t))&&h.a5(this.decoderOptions,t,e)})),a.M[20](n,this.decoderOptions)),p.A.jspi?r=await this.decoder.invokeAsync("decoder_open",e,0,t,n):(r=this.decoder.invoke("decoder_open",e,0,t,n),await this.decoder.childThreadsReady()),this.decoderOptions=s.f[20](n),o.s_.free(n),r<0?(m.z3(`open video decoder failed, ret: ${r}`,"packages/avcodec/src/wasmcodec/VideoDecoder.ts",189),c.r8):(this.parameters=e,this.timeBase=void 0,this.dtsQueue.length=0,0)}decode(e){this.timeBase||(this.timeBase={den:s.f[15](e+76),num:s.f[15](e+72)});let t=this.decoder.invoke("decoder_decode",e);if(t)return t;for(2&s.f[15](this.parameters+160)&&this.dtsQueue.push(s.f[17](e+16));;){if(t=this.receiveAVFrame(),1!==t){if(t<0)return t;break}this.outputAVFrame()}return 0}async decodeAsync(e){this.timeBase||(this.timeBase={den:s.f[15](e+76),num:s.f[15](e+72)});let t=await this.decoder.invokeAsync("decoder_decode",e);if(t)return t;for(2&s.f[15](this.parameters+160)&&this.dtsQueue.push(s.f[17](e+16));;){if(t=await this.receiveAVFrameAsync(),1!==t){if(t<0)return t;break}this.outputAVFrame()}return 0}async flush(){for(this.decoder.invoke("decoder_flush");;){const e=this.receiveAVFrame();if(e<1)return e;this.outputAVFrame()}return 0}async flushAsync(){for(await this.decoder.invokeAsync("decoder_flush");;){const e=await this.receiveAVFrameAsync();if(e<1)return e;this.outputAVFrame()}return 0}close(){this.decoder.invoke("decoder_close"),this.decoder.destroy(),this.frame&&(this.options.avframePool?this.options.avframePool.release(this.frame):(0,n.xj)(this.frame),this.frame=0),this.parameters=0,this.decoderOptions&&(h.AO(this.decoderOptions),o.s_.free(this.decoderOptions),this.decoderOptions=0)}setSkipFrameDiscard(e){this.decoder.invoke("decoder_discard",e)}getChildThreadCount(){return this.decoder?this.decoder.getChildThreadCount():0}}},16427:(e,t,i)=>{i.d(t,{A:()=>f});var r=i(19371),s=i(42524),a=i(92957),o=i(47378),n=i(1818),h=i(15541),d=i(41863),c=i(87339),l=i(17630);const u="packages/avcodec/src/webcodec/AudioDecoder.ts";class f{constructor(e){(0,r.A)(this,"options",void 0),(0,r.A)(this,"decoder",void 0),(0,r.A)(this,"parameters",0),(0,r.A)(this,"extradata",void 0),(0,r.A)(this,"currentError",null),this.options=e}output(e){this.options.onReceiveAudioData?this.options.onReceiveAudioData(e):e.close()}error(e){this.currentError=e,this.options.onError(e)}async open(e){var t;this.currentError=null,this.parameters=e,this.extradata=void 0,0!==s.f[20](e+12)&&(this.extradata=(0,d.s3)(s.f[20](e+12),s.f[15](e+16)).slice());const i={codec:null!==(t=this.options.codec)&&void 0!==t?t:(0,a.A)(this.parameters),sampleRate:s.f[15](e+136),numberOfChannels:s.f[15](e+116),description:this.extradata};i.description||delete i.description;try{if(!(await AudioDecoder.isConfigSupported(i)).supported)return c.z3("not support",u,98),o.nr}catch(e){return c.z3(`${e}`,u,103),o.r8}return this.decoder&&"closed"!==this.decoder.state&&this.decoder.close(),this.decoder=new AudioDecoder({output:this.output.bind(this),error:this.error.bind(this)}),this.decoder.reset(),this.decoder.configure(i),this.currentError?(c.z3(`open audio decoder error, ${this.currentError}`,u,120),o.r8):0}changeExtraData(e){var t;return l.FB(e,this.extradata)?0:(this.currentError=null,this.extradata=e.slice(),this.decoder.reset(),this.decoder.configure({codec:null!==(t=this.options.codec)&&void 0!==t?t:(0,a.A)(this.parameters),sampleRate:s.f[15](this.parameters+136),numberOfChannels:s.f[15](this.parameters+116),description:this.extradata}),this.currentError?(c.z3(`change extra data error, ${this.currentError}`,u,144),o.r8):0)}decode(e){if(this.currentError)return c.z3(`decode error, ${this.currentError}`,u,153),o.LR;const t=(0,n.rU)(e,1);if(0!==t){let e=this.changeExtraData((0,d.s3)(s.f[20](t),s.f[25](t+4)));if(e)return e}const i=(0,h.A)(e);try{this.decoder.decode(i)}catch(e){return c.z3(`decode error, ${e}`,u,172),o.LR}return 0}async flush(){if(this.currentError)return c.z3(`flush error, ${this.currentError}`,u,181),o.LR;try{return await this.decoder.flush(),0}catch(e){return c.z3(`flush error, ${e}`,u,189),o.LR}}close(){"closed"!==this.decoder.state&&this.decoder.close(),this.decoder=void 0}getQueueLength(){var e,t;return null!==(e=null===(t=this.decoder)||void 0===t?void 0:t.decodeQueueSize)&&void 0!==e?e:0}static async isSupported(e){let t;0!==s.f[20](e+12)&&(t=(0,d.s3)(s.f[20](e+12),s.f[15](e+16)).slice());const i={codec:(0,a.A)(e),sampleRate:s.f[15](e+136),numberOfChannels:s.f[15](e+116),description:t};i.description||delete i.description;try{return(await AudioDecoder.isConfigSupported(i)).supported}catch(e){return!1}}}},40852:(e,t,i)=>{i.d(t,{A:()=>I});var r=i(19371),s=i(42524),a=i(36271),o=i(75589),n=i(20770),h=i(47378),d=i(1818),c=i(34082),l=i(43776),u=i(91278),f=i(30027),p=i(41863),m=i(61556),g=i(73872),A=i(90332),v=i(17635),y=i(71195),b=i(77969),k=i(17630),w=i(87339),x=i(3760);const T="packages/avcodec/src/webcodec/VideoDecoder.ts";class I{constructor(e){(0,r.A)(this,"decoder",void 0),(0,r.A)(this,"alphaDecoder",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"parameters",0),(0,r.A)(this,"extradata",void 0),(0,r.A)(this,"currentError",null),(0,r.A)(this,"inputQueue",void 0),(0,r.A)(this,"outputQueue",void 0),(0,r.A)(this,"dtsQueue",void 0),(0,r.A)(this,"sort",void 0),(0,r.A)(this,"keyframeRequire",!1),(0,r.A)(this,"extradataRequire",!1),(0,r.A)(this,"alphaQueue",void 0),(0,r.A)(this,"alphaPending",void 0),this.options=e,this.inputQueue=[],this.outputQueue=[],this.dtsQueue=[],this.alphaQueue=[],this.alphaPending=new Map,this.sort=!(!y.A.safari&&!b.A.ios)}getAlphaFrame(e){if(this.alphaQueue.length){let t=this.alphaQueue.length-1;for(;t>=0;t--)if(this.alphaQueue[t].timestamp===e.timestamp)return this.alphaQueue.splice(t,1).shift()}}async output(e){if(2&s.f[15](this.parameters+160)&&this.dtsQueue.length){const t=e;e=new VideoFrame(t,{timestamp:this.dtsQueue.shift()}),t.close()}if(!this.alphaPending.has(e.timestamp)||(await this.alphaPending.get(e.timestamp).promise,this.decoder))if(this.sort){let t=0;for(;t<this.outputQueue.length;t++)if(this.outputQueue[t].timestamp>e.timestamp){this.outputQueue.splice(t,0,e);break}for(t===this.outputQueue.length&&this.outputQueue.push(e);this.outputQueue.length>2&&this.outputQueue[0].timestamp===this.inputQueue[0];){const e=this.outputQueue.shift(),t=this.getAlphaFrame(e);this.options.onReceiveVideoFrame?this.options.onReceiveVideoFrame(e,t):(e.close(),t&&t.close()),this.inputQueue.shift()}}else{const t=this.getAlphaFrame(e);this.options.onReceiveVideoFrame?this.options.onReceiveVideoFrame(e,t):(e.close(),t&&t.close())}else e.close()}async outputAlpha(e){this.alphaQueue.push(e),this.alphaPending.has(e.timestamp)&&(this.alphaPending.get(e.timestamp).resolve(),this.alphaPending.delete(e.timestamp))}error(e){this.currentError=e,this.options.onError(e)}errorAlpha(e){this.currentError=e,this.options.onError(e),this.alphaPending.forEach((e=>{e.resolve()})),this.alphaPending.clear()}changeExtraData(e){var t,i;if(k.FB(e,this.extradata))return 0;this.currentError=null,this.extradata=e.slice(),27===s.f[15](this.parameters+4)?m.XC({codecpar:(0,o.A)(this.parameters,a.A),sideData:{},metadata:{}},this.extradata):173===s.f[15](this.parameters+4)&&g.XC({codecpar:(0,o.A)(this.parameters,a.A),sideData:{},metadata:{}},this.extradata),this.decoder.reset();const r={codec:null!==(t=this.options.codec)&&void 0!==t?t:(0,n.A)(this.parameters,e),codedWidth:s.f[15](this.parameters+56),codedHeight:s.f[15](this.parameters+60),description:this.extradata,hardwareAcceleration:(0,A.C)(null===(i=this.options.enableHardwareAcceleration)||void 0===i||i)};return r.codedWidth||delete r.codedWidth,r.codedHeight||delete r.codedHeight,this.options.optimizeForLatency&&(r.optimizeForLatency=this.options.optimizeForLatency),this.options.colorSpace&&(r.colorSpace=this.options.colorSpace),this.options.rotation&&(r.rotation=this.options.rotation),this.options.flip&&(r.flip=this.options.flip),this.decoder.configure(r),this.alphaDecoder&&this.alphaDecoder.configure(r),this.currentError?(w.z3(`change extra data error, ${this.currentError}`,T,266),h.r8):(this.keyframeRequire=!0,0)}async open(e){var t,i;this.currentError=null,this.extradata=void 0,0!==s.f[20](e+12)&&(this.extradata=(0,p.s3)(s.f[20](e+12),s.f[15](e+16)).slice()),this.parameters=e;const r={codec:null!==(t=this.options.codec)&&void 0!==t?t:(0,n.A)(e),codedWidth:s.f[15](e+56),codedHeight:s.f[15](e+60),description:1&s.f[15](e+160)?void 0:this.extradata,hardwareAcceleration:(0,A.C)(null===(i=this.options.enableHardwareAcceleration)||void 0===i||i)};this.options.optimizeForLatency&&(r.optimizeForLatency=this.options.optimizeForLatency),this.options.colorSpace&&(r.colorSpace=this.options.colorSpace),this.options.rotation&&(r.rotation=this.options.rotation),this.options.flip&&(r.flip=this.options.flip),r.description||delete r.description,r.codedWidth||delete r.codedWidth,r.codedHeight||delete r.codedHeight;try{if(!(await VideoDecoder.isConfigSupported(r)).supported)return w.z3("not support",T,319),h.nr}catch(e){return w.z3(`${e}`,T,324),h.r8}return this.decoder&&"closed"!==this.decoder.state&&this.decoder.close(),this.alphaDecoder&&"closed"!==this.alphaDecoder.state&&this.alphaDecoder.close(),this.decoder=new VideoDecoder({output:this.output.bind(this),error:this.error.bind(this)}),this.decoder.reset(),this.decoder.configure(r),8&s.f[15](e+160)&&(139===s.f[15](e+4)||167===s.f[15](e+4)||225===s.f[15](e+4))&&"keep"===this.options.alpha&&(this.alphaDecoder=new VideoDecoder({output:this.outputAlpha.bind(this),error:this.errorAlpha.bind(this)}),this.alphaDecoder.reset(),this.alphaDecoder.configure(r)),this.currentError?(w.z3(`open video decoder error, ${this.currentError}`,T,359),h.r8):(this.keyframeRequire=!0,1&s.f[15](e+160)&&(this.extradataRequire=!0),2&s.f[15](this.parameters+160)&&(this.sort=!1),this.outputQueue.length&&this.outputQueue.forEach((e=>{e.close()})),this.alphaQueue.length&&this.alphaQueue.forEach((e=>{e.close()})),this.alphaPending.forEach((e=>{e.resolve()})),this.alphaPending.clear(),this.inputQueue.length=0,this.outputQueue.length=0,this.dtsQueue.length=0,this.alphaQueue.length=0,0)}decode(e){if(this.currentError)return w.z3(`decode error, ${this.currentError}`,T,398),h.LR;const t=(0,d.rU)(e,1);if(0!==t){let e=this.changeExtraData((0,p.s3)(s.f[20](t),s.f[25](t+4)));if(e)return e}const i=1&s.f[15](e+36);if(this.keyframeRequire){if(!i)return 0;if(1&s.f[15](this.parameters+160)&&this.extradata&&this.extradataRequire){if(27===s.f[15](this.parameters+4)){if(!m.sL((0,d.iI)(e))){const t=m.kM((0,d.iI)(e),this.extradata);t&&(0,d.NX)(e,t.bufferPointer,t.length)}}else if(173===s.f[15](this.parameters+4)){if(!g.sL((0,d.iI)(e))){const t=g.kM((0,d.iI)(e),this.extradata);t&&(0,d.NX)(e,t.bufferPointer,t.length)}}else if(196===s.f[15](this.parameters+4)&&!v.sL((0,d.iI)(e))){const t=v.kM((0,d.iI)(e),this.extradata);t&&(0,d.NX)(e,t.bufferPointer,t.length)}this.extradataRequire=!1}}const r=(0,c.A)(e),a=r.timestamp;if(this.sort){let e=0;for(;e<this.inputQueue.length;e++)if(this.inputQueue[e]>a){this.inputQueue.splice(e,0,a);break}e===this.inputQueue.length&&this.inputQueue.push(a)}try{if(this.alphaDecoder){const t=(0,d.rU)(e,15);if(t&&l.v4(s.f[20](t))===BigInt(1))if(r.timestamp!==u.N_){this.alphaDecoder.decode(new EncodedVideoChunk({type:r.type,timestamp:r.timestamp,duration:null!=r.duration?r.duration:void 0,data:(0,p.s3)(s.f[20](t)+8,s.f[25](t+4)-8)}));let{promise:e,resolve:i}=(0,x.A)();this.alphaPending.set(r.timestamp,{promise:e,resolve:i})}else w.R8("decode with alpha need avpacket's pts, ignore alpha channel data",T,488)}this.decoder.decode(r),2&s.f[15](this.parameters+160)&&this.dtsQueue.push(Number((0,f.Mr)(s.f[17](e+16),e+72,u.KR)))}catch(e){return w.z3(`decode error, ${e}`,T,500),h.LR}return i&&(this.keyframeRequire=!1),0}async flush(){if(this.currentError)return w.z3(`flush error, ${this.currentError}`,T,513),h.LR;try{this.alphaDecoder&&await this.alphaDecoder.flush(),await this.decoder.flush()}catch(e){return w.z3(`flush error, ${e}`,T,523),h.LR}if(this.sort)for(;this.outputQueue.length;){const e=this.outputQueue.shift(),t=this.getAlphaFrame(e);this.options.onReceiveVideoFrame?this.options.onReceiveVideoFrame(e,t):(e.close(),t&&t.close())}return this.keyframeRequire=!0,0}close(){this.decoder&&"closed"!==this.decoder.state&&this.decoder.close(),this.alphaDecoder&&"closed"!==this.alphaDecoder.state&&this.alphaDecoder.close(),this.alphaPending.forEach((e=>{e.resolve()})),this.alphaPending.clear(),this.decoder=void 0,this.alphaDecoder=void 0,this.currentError=null,this.outputQueue.length&&this.outputQueue.forEach((e=>{e.close()})),this.alphaQueue.length&&this.alphaQueue.forEach((e=>{e.close()})),this.inputQueue.length=0,this.outputQueue.length=0,this.alphaQueue.length=0}getQueueLength(){var e,t;return null!==(e=null===(t=this.decoder)||void 0===t?void 0:t.decodeQueueSize)&&void 0!==e?e:0}setSkipFrameDiscard(e){}static async isSupported(e,t){let i;0!==s.f[20](e+12)&&(i=(0,p.s3)(s.f[20](e+12),s.f[15](e+16)).slice());const r={codec:(0,n.A)(e),codedWidth:s.f[15](e+56),codedHeight:s.f[15](e+60),description:1&s.f[15](e+160)?void 0:i,hardwareAcceleration:(0,A.C)(null==t||t)};r.description||delete r.description;try{return(await VideoDecoder.isConfigSupported(r)).supported}catch(e){return!1}}}},20352:(e,t,i)=>{i.d(t,{Xv:()=>d,fG:()=>c,oD:()=>h});var r=i(19371),s=i(95681),a=i(1818),o=i(37523);class n{constructor(){(0,r.A)(this,"packetBuffer",void 0),this.packetBuffer=[]}}class h{constructor(){(0,r.A)(this,"metadataHeaderPadding",-1),(0,r.A)(this,"metadata",void 0),(0,r.A)(this,"streams",void 0),(0,r.A)(this,"streamGroups",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"chapters",void 0),(0,r.A)(this,"privateData",void 0),(0,r.A)(this,"privateData2",void 0),(0,r.A)(this,"iformat",void 0),(0,r.A)(this,"oformat",void 0),(0,r.A)(this,"ioReader",void 0),(0,r.A)(this,"ioWriter",void 0),(0,r.A)(this,"errorFlag",void 0),(0,r.A)(this,"interval",void 0),(0,r.A)(this,"streamIndex",void 0),(0,r.A)(this,"streamGroupIndex",void 0),(0,r.A)(this,"getDecoderResource",null),this.streams=[],this.streamGroups=[],this.errorFlag=0,this.streamIndex=0,this.streamGroupIndex=0,this.interval=new n,this.options={},this.privateData={},this.metadata={},this.chapters=[]}get format(){return this.iformat?this.iformat.type:this.oformat?this.oformat.type:-1}getStreamById(e){return this.streams.find((t=>t.id===e))}getStreamGroupById(e){return this.streamGroups.find((t=>t.id===e))}getStreamByIndex(e){return this.streams.find((t=>t.index===e))}getStreamGroupByIndex(e){return this.streamGroups.find((t=>t.index===e))}getStreamByMediaType(e){return this.streams.find((t=>{var i;return(null===(i=t.codecpar)||void 0===i?void 0:i.codecType)===e&&!(1024&t.disposition)}))}getStreamGroupByGroupType(e){return this.streamGroups.find((t=>t.type===e))}getAttachmentPicture(){return this.streams.find((e=>{var t;return 0===(null===(t=e.codecpar)||void 0===t?void 0:t.codecType)&&1024&e.disposition}))}createStream(){const e=new s.Ay;return e.index=this.streamIndex++,e.id=(0,o.A)(),this.removeStreamByIndex(e.index),this.streams.push(e),e}createStreamGroup(e){const t=new s.Tr;return t.index=this.streamGroupIndex++,t.type=e,t.id=(0,o.A)(),this.removeStreamGroupByIndex(t.index),this.streamGroups.push(t),t}addStream(e){this.removeStreamByIndex(e.index),this.streams.push(e)}addStreamGroup(e){this.removeStreamGroupByIndex(e.index),this.streamGroups.push(e)}addStreamToStreamGroup(e,t){e.streams.some((e=>e===t))||e.streams.push(t)}removeStream(e){this.removeStreamByIndex(e.index)}removeStreamGroup(e){this.removeStreamGroupByIndex(e.index)}removeStreamById(e){const t=this.streams.findIndex((t=>t.id===e));if(t>-1){const e=this.streams.splice(t,1);e[0]&&e[0].destroy()}}removeStreamGroupById(e){const t=this.streamGroups.findIndex((t=>t.id===e));if(t>-1){const e=this.streamGroups.splice(t,1);e[0]&&e[0].destroy()}}removeStreamByIndex(e){const t=this.streams.findIndex((t=>t.index===e));if(t>-1){const e=this.streams.splice(t,1);e[0]&&e[0].destroy()}}removeStreamGroupByIndex(e){const t=this.streamGroups.findIndex((t=>t.index===e));if(t>-1){const e=this.streamGroups.splice(t,1);e[0]&&e[0].destroy()}}async destroy(){this.oformat&&this.oformat.destroy(this),this.iformat&&await this.iformat.destroy(this),this.interval.packetBuffer.length&&this.interval.packetBuffer.forEach((e=>{(0,a.Qe)(e)})),this.streams.forEach((e=>{e.destroy()})),this.streams=[],this.interval=null,this.ioReader=this.ioWriter=null,this.oformat=this.iformat=null}}function d(){return new h}function c(){return new h}},74585:(e,t,i)=>{i.d(t,{V:()=>s,v:()=>r});const r=256e3,s=BigInt(5e3)},33272:(e,t,i)=>{i.d(t,{Cj:()=>B,Ib:()=>S,ho:()=>M,jF:()=>D});var r=i(75354),s=i(42524),a=i(77389),o=i(3912),n=i(75589),h=i(45e3),d=i(65052),c=i(74585),l=i(46942),u=i(85601),f=i(15119),p=i(41863),m=i(1818),g=i(91278),A=i(30027),v=i(42365),y=i(47378),b=i(25092),k=i(87339),w=i(17630),x=i(84804),T=i(59451);const I="packages/avformat/src/demux.ts",_=16,P={fastOpen:!1,maxAnalyzeDuration:15e3};async function M(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=b.X$({},P,t);return e.ioReader||k.h2("need IOReader",I,117),e.iformat||k.h2("need iformat",I,120),2===e.iformat.type&&(i.maxAnalyzeDuration=Math.max(i.maxAnalyzeDuration,2e3)),e.iformat.init(e),e.options=i,e.iformat.readHeader(e)}async function S(e){const t={},i={},p={},y={},k={},I={},P={},M=e.iformat.getAnalyzeStreamsCount();let S=0;const C=[];let R=0;function D(){if(!e.getDecoderResource)return!0;for(let t=0;t<e.streams.length;t++)if(I[e.streams[t].index]&&!P[e.streams[t].index])return!1;return!0}function E(e,t){let r=i[e.index];const o=p[e.index];let n=e.codecpar.videoDelay;if(null!=o&&o.length&&(n=Math.min(Math.max((0,u.A)(o),e.codecpar.videoDelay),16),t&&(e.codecpar.videoDelay=n)),!r&&null!=o&&o.length){r=n?(0,f.A)(n,o):o.slice();const t={delay:n,dtsQueue:r};r=[],k[e.index]=t;for(let i=0;i<C.length;i++)if(e.index===s.f[15](C[i]+32)){const o=t.dtsQueue.shift();a.M[17](C[i]+16,o),r.push(o);const n=e.sampleIndexes.find((e=>e.pts===s.f[17](C[i]+8)));n&&(n.dts=s.f[17](C[i]+16))}}if(r&&r.length>1){let t=BigInt(0);for(let e=1;e<r.length;e++)t+=r[e]-r[e-1];if(1===e.codecpar.codecType&&e.codecpar.sampleRate>0&&!e.codecpar.frameSize){let i=Number(t)/(r.length-1);e.codecpar.frameSize=Math.round(i/e.timeBase.den*e.timeBase.num*e.codecpar.sampleRate)}else if(0===e.codecpar.codecType){const i=(0,A.j2)(e.timeBase.den*(r.length-1)/(Number(t)*e.timeBase.num),g.go);e.codecpar.framerate.num=i.num,e.codecpar.framerate.den=i.den,(0,l.A)(e.codecpar.framerate)}const i=Number(r[r.length-1]-e.startTime)*e.timeBase.num/e.timeBase.den;i&&(e.codecpar.bitrate=BigInt(Math.floor(8*y[e.index]/i)))}}async function U(){for(let t=0;t<e.streams.length;t++){const i=e.streams[t];if(1024&i.disposition){if(i.attachedPic&&e.getDecoderResource){const t=await e.getDecoderResource(i.codecpar.codecType,i.codecpar.codecId);if(!t)continue;t.threadModule&&delete t.threadModule;const a=new x.A({resource:t,onReceiveAVFrame:e=>{i.codecpar.format=s.f[15](e+80),i.codecpar.colorRange=s.f[15](e+208),i.codecpar.colorSpace=s.f[15](e+220),i.codecpar.colorPrimaries=s.f[15](e+212),i.codecpar.colorTrc=s.f[15](e+216),i.codecpar.chromaLocation=s.f[15](e+224),s.f[15](e+92)&&s.f[15](e+96)&&(i.codecpar.sampleAspectRatio=(0,n.A)(e+92,o.Q)),i.codecpar.width=s.f[15](e+68),i.codecpar.height=s.f[15](e+72),(0,v.xj)(e)}});await a.open(i.codecpar[r.o9])||(a.decode(i.attachedPic),await a.flush()),a.close()}}else E(i,!0),1===i.codecpar.codecType&&(1===i.codecpar.chLayout.nbChannels?(i.codecpar.chLayout.u.mask=BigInt(4),i.codecpar.chLayout.order=1):2===i.codecpar.chLayout.nbChannels&&(i.codecpar.chLayout.u.mask=BigInt(3),i.codecpar.chLayout.order=1))}}for(;;){if(e.streams.length>=M&&e.options.fastOpen&&(0,d.$)(e)){await U();break}S||(S=(0,m._5)());let a=!1;if(R=await B(e,S),0!==R){await U();break}const c=e.getStreamByIndex(s.f[15](S+32));let l=s.f[17](S+8);if(l===g.Dh&&(l=s.f[17](S+16)),s.f[15](S+28)&&(a=!0,C.push(S),t[c.index]?l<c.startTime&&(c.startTime=l):(c.firstDTS=s.f[17](S+16),c.startTime=l,t[c.index]=!0),s.f[17](S+16)!==g.Dh&&(i[c.index]?i[c.index].push(s.f[17](S+16)):i[c.index]=[s.f[17](S+16)]),p[c.index]?p[c.index].push(l):p[c.index]=[l],y[c.index]?y[c.index]+=s.f[15](S+28):y[c.index]=s.f[15](S+28),!P[c.index]&&e.getDecoderResource&&!e.options.fastOpen&&!c.metadata.encryption)){let t=I[c.index];if(!t){const i=await e.getDecoderResource(c.codecpar.codecType,c.codecpar.codecId);i&&(1===c.codecpar.codecType?t=new T.A({resource:i,onReceiveAVFrame:e=>{c.codecpar.format=s.f[15](e+80),c.codecpar.frameSize=s.f[15](e+76),c.codecpar.sampleRate=s.f[15](e+152),c.codecpar.chLayout=(0,n.A)(e+288,h.r),(0,v.xj)(e),P[c.index]=!0}}):0===c.codecpar.codecType&&(i.threadModule&&delete i.threadModule,t=new x.A({resource:i,onReceiveAVFrame:e=>{c.codecpar.format=s.f[15](e+80),c.codecpar.colorRange=s.f[15](e+208),c.codecpar.colorSpace=s.f[15](e+220),c.codecpar.colorPrimaries=s.f[15](e+212),c.codecpar.colorTrc=s.f[15](e+216),c.codecpar.chromaLocation=s.f[15](e+224),s.f[15](e+92)&&s.f[15](e+96)&&(c.codecpar.sampleAspectRatio=(0,n.A)(e+92,o.Q)),c.codecpar.width=s.f[15](e+68),c.codecpar.height=s.f[15](e+72),(0,v.xj)(e),P[c.index]=!0}})),await t.open(c.codecpar[r.o9])?(t.close(),P[c.index]=!0):I[c.index]=t)}t&&t.decode(S)&&(P[c.index]=!0)}if(p[c.index]&&p[c.index].length===_&&E(c,!1),c.startTime!==g.Dh&&l-c.startTime>(0,A.k)(BigInt(Math.floor(e.options.maxAnalyzeDuration)),g.i0,c.timeBase)&&(e.streams.length>=M&&(0,d.$)(e)||l-c.startTime>(0,A.k)(BigInt(15e3),g.i0,c.timeBase)&&(!p[c.index]||p[c.index].length>450))&&D()){await U(),a&&(S=0);break}a&&(S=0)}return S&&(0,m.Qe)(S),C.length&&(e.interval.packetBuffer=C.concat(e.interval.packetBuffer)),b.__(I,(e=>{e&&e.close()})),b.__(k,((t,i)=>{const r=e.getStreamByIndex(+i);r.privateData2?b.X$(r.privateData2,t):r.privateData2=t})),-1048576===R||-1048572===R?0:0!==R?R:(2===e.iformat.type&&1&e.ioReader.flags&&!(2&e.ioReader.flags)&&await async function(e){const t=await e.ioReader.fileSize();if(t<=BigInt(0))return;const i=e.interval.packetBuffer;e.interval.packetBuffer=[];let r=e.ioReader.getPos(),a=0;for(;a<4;){const i=t-BigInt(Math.floor(c.v<<a)),o=await e.iformat.seek(e,null,i,2);if(o<0)break;!a&&o>0&&(r=o);const n={},h=(0,m._5)();for(;!(await B(e,h)<0);){let t=s.f[17](h+8);t===g.Dh&&(t=s.f[17](h+16));const i=e.getStreamByIndex(s.f[15](h+32));i.startTime!==g.Dh?t-=i.startTime:t-=i.firstDTS,t>BigInt(0)&&((i.duration===g.Dh||!n[s.f[15](h+32)]||i.duration<t&&Math.abs(Number(t-i.duration))<60*i.timeBase.den/i.timeBase.num)&&(i.duration=t),n[h.streamIndex]=t)}(0,m.Qe)(h);let d=!0;if(w.__(e.streams,(e=>{if(e.duration===g.Dh)return d=!1,!1})),d)break;a++}w.__(e.interval.packetBuffer,(e=>{(0,m.Qe)(e)})),e.interval.packetBuffer=i.filter((e=>!(s.f[17](e+56)>=r&&((0,m.Qe)(e),1)))),await e.iformat.seek(e,null,r,2)}(e),0)}function C(e,t){let i=s.f[17](t+8);i===g.Dh&&(i=s.f[17](t+16));const r=w.El(e.sampleIndexes,(e=>e.pts<i?1:-1)),a={dts:s.f[17](t+16),pts:i,pos:s.f[17](t+56),size:s.f[15](t+28),duration:s.f[17](t+48),flags:s.f[15](t+36)};r>-1?(e.sampleIndexesPosMap.set(s.f[17](t+56),r),e.sampleIndexes.splice(r,0,a)):(e.sampleIndexesPosMap.set(s.f[17](t+56),e.sampleIndexes.length),e.sampleIndexes.push(a))}async function R(e,t){const i=e.getStreamByIndex(s.f[15](t+32));if(s.f[17](t+16)===g.Dh){const e=i.privateData2;e&&(e.delay?(w._(e.dtsQueue,s.f[17](t+8),(e=>e<s.f[17](t+8)?1:-1)),e.dtsQueue.length>e.delay&&a.M[17](t+16,e.dtsQueue.shift())):a.M[17](t+16,s.f[17](t+8)))}let r=0;if(i&&(27===i.codecpar.codecId||173===i.codecpar.codecId||196===i.codecpar.codecId||86018===i.codecpar.codecId))if(!s.f[15](t+28)&&(0,m.fQ)(t,1))for(;;){const i=(0,m._5)();if(r=await e.iformat.readAVPacket(e,i),0!==r){if(e.interval.packetBuffer.length){let i=e.interval.packetBuffer.shift();return(0,m.Up)(t),(0,m.rN)(t,i),(0,m.Qe)(i),R(e,t)}return r}if(s.f[15](i+32)!==s.f[15](t+32)){let t=e.interval.packetBuffer.length-1,r=!0;for(;t>=0;t--)if(s.f[15](e.interval.packetBuffer[t]+32)===s.f[15](i+32)){s.f[15](e.interval.packetBuffer[t]+28)||s.f[15](i+28)?!s.f[15](e.interval.packetBuffer[t]+28)&&s.f[15](i+28)&&((0,m.Zx)(e.interval.packetBuffer[t],i),(0,m.Qe)(i),r=!1):((0,m.Qe)(e.interval.packetBuffer[t]),e.interval.packetBuffer.splice(t,1,i),r=!1);break}r&&e.interval.packetBuffer.push(i)}else{if(s.f[15](i+28))return(0,m.Zx)(t,i),a.M[17](t+16,s.f[17](i+16)),a.M[17](t+8,s.f[17](i+8)),(0,m.Qe)(i),0;(0,m.Up)(t),(0,m.rN)(t,i),(0,m.Qe)(i)}}else if(32&s.f[15](t+36))return B(e,t);if(1&e.ioReader.flags&&!i.sampleIndexesPosMap.has(s.f[17](t+56)))if(0===i.codecpar.codecType)1&s.f[15](t+36)&&C(i,t);else if(1===i.codecpar.codecType){const e=w.El(i.sampleIndexes,(e=>e.pts<s.f[17](t+8)?1:-1));(!i.sampleIndexes.length||e<0&&(0,A.Mr)(s.f[17](t+8)-i.sampleIndexes[i.sampleIndexes.length-1].pts,t+72,g.i0)>=c.V||e>0&&e<i.sampleIndexes.length-1&&(0,A.Mr)(s.f[17](t+8)-i.sampleIndexes[e-1].pts,t+72,g.i0)>=c.V||0===e&&(0,A.Mr)(i.sampleIndexes[0].pts-s.f[17](t+8),t+72,g.i0)>=c.V)&&C(i,t)}return 0}async function B(e,t){let i=0;if((0,m.Up)(t),e.interval.packetBuffer.length){const i=e.interval.packetBuffer.shift();return(0,m.rN)(t,i),(0,m.Qe)(i),R(e,t)}return i=await e.iformat.readAVPacket(e,t),0!==i?((0,m.Up)(t),i):R(e,t)}async function D(e,t,i,r){let o=t>-1?e.streams.find((e=>e.index===t)):null;if(o||(o=e.getStreamByMediaType(0),o||(o=e.getStreamByMediaType(1)),o||(o=e.getStreamByMediaType(3))),!o)return k.z3(`not found any stream to seek, streamIndex: ${o.index}`,I,803),BigInt(y.LR);k.Yz(`seek in ${0===o.codecpar.codecType?"video":"audio"} stream, streamIndex: ${o.index}, timestamp: ${i}, flags: ${r}`,I,807),i=(0,A.k)(i,g.i0,o.timeBase);const n=await e.iformat.seek(e,o,i,r);if(n>=BigInt(0)){w.__(e.interval.packetBuffer,(t=>{if(2&e.ioReader.flags){const i=(0,m.rU)(t,1),r=e.streams[s.f[15](t+32)];!r.sideData[1]&&i&&(r.sideData[1]=(0,p.s3)(s.f[20](i),s.f[25](i+4)).slice())}(0,m.Qe)(t)})),e.interval.packetBuffer.length=0;const t={};e.streams.forEach((e=>{const i=e.privateData2;null!=i&&i.dtsQueue&&(i.dtsQueue.length=0,i.delay&&(t[e.index]=i.delay,i.delay=_))}));const i=[];for(;e.streams.some((e=>{const t=e.privateData2;return t&&t.dtsQueue&&t.dtsQueue.length<t.delay}));){const t=(0,m._5)();if(await B(e,t)){(0,m.Qe)(t);break}i.push(t)}return e.streams.forEach((e=>{const r=e.privateData2;if(null!=r&&r.delay){r.delay=t[e.index],r.dtsQueue=(0,f.A)(r.delay,r.dtsQueue);for(let t=0;t<i.length;t++)if(e.index===s.f[15](i[t]+32)){a.M[17](i[t]+16,r.dtsQueue.shift());const o=e.sampleIndexes.find((e=>e.pts===s.f[17](i[t]+8)));o&&(o.dts=s.f[17](i[t]+16))}}})),e.interval.packetBuffer=i.concat(e.interval.packetBuffer),BigInt(0)}return n}},62765:(e,t,i)=>{i.d(t,{Ay:()=>D,L_:()=>P,eG:()=>_,yl:()=>I});var r=i(75354),s=i(42524),a=i(45e3),o=i(75589),n=i(3912),h=i(20352),d=i(91390),c=i(91278),l=i(5015),u=i(30027),f=i(54829),p=i(69048),m=i(61556),g=i(73872),A=i(44980),v=i(93535),y=i(67094),b=i(73575),k=i(25092),w=i(81819);function x(e){e<0&&(e=BigInt(0));const t=Number(BigInt.asIntN(32,e%BigInt(1e3))),i=Number(BigInt.asIntN(32,e/BigInt(1e3)%BigInt(60))),r=Number(BigInt.asIntN(32,e/BigInt(1e3)/BigInt(60)%BigInt(60))),s=Number(BigInt.asIntN(32,e/BigInt(1e3)/BigInt(3600)));return y.GP("%02d:%02d:%02d.%03d",s,r,i,t)}function T(e){return e<BigInt(1e4)?(0,b.A)(Number(BigInt.asIntN(32,e)))+" bps/s":Number(BigInt.asIntN(32,e/BigInt(1e3)))+" kbps/s"}function I(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";return k.__(e,((e,r)=>{if(t===e)return i=r,!1})),i}function _(e,t){return 1===e?I(d.n1,t):0===e?I(d._R,t):3===e?I(d.Xp,t):"unknown"}function P(e){return I(d.iW,e)}function M(e,t){switch(e){case 86018:return f.uF[t]||"LC";case 86017:return p.He[t]||"Layer3";case 27:return m.tZ[t]||"High";case 173:return g.dT[t]||"Main";case 225:return A.zk[t]||"Main";case 167:return v.wN[t]||"Profile0"}}function S(e){let t="";return e&&(t=" ",1&e&&(t+=`(${I(d.Ki,1)}) `),2&e&&(t+=`(${I(d.Ki,2)}) `),4&e&&(t+=`(${I(d.Ki,4)}) `),8&e&&(t+=`(${I(d.Ki,8)}) `),16&e&&(t+=`(${I(d.Ki,16)}) `),32&e&&(t+=`(${I(d.Ki,32)}) `),64&e&&(t+=`(${I(d.Ki,64)}) `),128&e&&(t+=`(${I(d.Ki,128)}) `),256&e&&(t+=`(${I(d.Ki,256)}) `),512&e&&(t+=`(${I(d.Ki,512)}) `),1024&e&&(t+=`(${I(d.Ki,1024)}) `),2048&e&&(t+=`(${I(d.Ki,2048)}) `),65536&e&&(t+=`(${I(d.Ki,65536)}) `),131072&e&&(t+=`(${I(d.Ki,131072)}) `),262144&e&&(t+=`(${I(d.Ki,262144)}) `),524288&e&&(t+=`(${I(d.Ki,524288)}) `),1048576&e&&(t+=`(${I(d.Ki,1048576)}) `),8192&e&&(t+=`(${I(d.Ki,8192)}) `)),t}function C(e,t){const i=M(s.f[15](e.codecpar+4),s.f[15](e.codecpar+48)),r=I(d._R,s.f[15](e.codecpar+4));if(t.push(`${r}${i?` (${i})`:""}`),s.f[15](e.codecpar+28)!==c.N_){const i=I(d.qO,s.f[15](e.codecpar+28),`unknown(${s.f[15](e.codecpar+28)})`),r=I(d.mX,s.f[15](e.codecpar+84),"tv"),a=I(d._m,s.f[15](e.codecpar+96)),o=I(d.Eh,s.f[15](e.codecpar+88)),n=I(d.d8,s.f[15](e.codecpar+92)),h=(0,l.A)(e.codecpar);a===o&&o===n?t.push(`${i}(${r}, ${a}, ${h?"HDR":"SDR"})`):t.push(`${i}(${r}, ${a}/${o}/${n}, ${h?"HDR":"SDR"})`);const c={num:s.f[15](e.codecpar+56)*s.f[15](e.codecpar+64),den:s.f[15](e.codecpar+60)*s.f[15](e.codecpar+68)};(0,u.iU)(c),t.push(`${s.f[15](e.codecpar+56)}x${s.f[15](e.codecpar+60)} [SAR: ${s.f[15](e.codecpar+64)}:${s.f[15](e.codecpar+68)} DAR ${c.num}:${c.den}]`)}}function R(e,t){const i=M(s.f[15](e.codecpar+4),s.f[15](e.codecpar+48)),r=I(d.n1,s.f[15](e.codecpar+4));t.push(`${r}${i?` (${i})`:""}`),t.push(`${s.f[15](e.codecpar+136)} Hz`);let n=`${s.f[15](e.codecpar+116)} channels`;if(1===s.f[15](e.codecpar+112)){const t=I(d.IY,Number((0,o.A)(e.codecpar+120,a.r,"u").mask),"");t&&(n=t)}t.push(n),t.push(I(d.Sz,s.f[15](e.codecpar+28)))}function B(e,t,i){const r=I(d.Mb,s.f[15](e.codecpar)),a=[];if(1===s.f[15](e.codecpar))R(e,a),s.f[17](e.codecpar+32)>BigInt(0)&&e.nbFrames!==BigInt(1)&&a.push(`${T(s.f[17](e.codecpar+32))}`);else if(0===s.f[15](e.codecpar))C(e,a),s.f[17](e.codecpar+32)>BigInt(0)&&e.nbFrames!==BigInt(1)&&a.push(`${T(s.f[17](e.codecpar+32))}`),(0,u.lb)((0,o.A)(e.codecpar+72,n.Q))>0&&(a.push(`${(0,u.lb)((0,o.A)(e.codecpar+72,n.Q)).toFixed(2)} fps`),a.push(`${(0,u.lb)((0,o.A)(e.codecpar+72,n.Q)).toFixed(2)} tbr`)),a.push(`${h=BigInt(Math.floor((0,u.lb)({num:e.timeBase.den,den:e.timeBase.num}))),h<BigInt(1e4)?(0,b.A)(Number(BigInt.asIntN(32,h))):Number(BigInt.asIntN(32,h/BigInt(1e3)))+"k"} tbn`);else if(3===s.f[15](e.codecpar)){const t=I(d.Xp,s.f[15](e.codecpar+4));a.push(t),s.f[17](e.codecpar+32)>BigInt(0)&&a.push(`${T(s.f[17](e.codecpar+32))}`)}else{const t=I(d.Ld,s.f[15](e.codecpar+4));a.push(t),s.f[17](e.codecpar+32)>BigInt(0)&&a.push(`${T(s.f[17](e.codecpar+32))}`)}var h;let c=`${i}Stream #${t}:${e.index}[0x${y.GP("%02x",e.id)}] ${r}: ${a.join(", ")}${S(e.disposition)}\n`;return Object.keys(e.metadata).length&&(c+=`${i}  Metadata:\n`,k.__(e.metadata,((t,r)=>{w.Ik(t)||w.YO(t)||w.sv(t)||ArrayBuffer.isView(t)?"matrix"===r&&0===s.f[15](e.codecpar)&&(c+=`${i}    ${r}: [${t.toString()}]\n`):(w.Yj(t)&&(t=y.yh(t,"\n","\n"+" ".repeat(6+r.length))),c+=`${i}    ${r}: ${t}\n`)}))),c}function D(e,t){let i="";return e.forEach(((e,a)=>{if(e instanceof h.oD){const t=[],i=[];for(let i=0;i<e.streams.length;i++){const s=e.streams[i];t.push({index:s.index,id:s.id,codecpar:s.codecpar[r.o9],nbFrames:s.nbFrames,metadata:s.metadata,duration:s.duration,startTime:s.startTime,disposition:s.disposition,timeBase:s.timeBase,attachedPic:s.attachedPic})}for(let r=0;r<e.streamGroups.length;r++){const s=e.streamGroups[r];i.push({index:s.index,id:s.id,type:s.type,params:s.params,metadata:s.metadata,disposition:s.disposition,streams:s.streams.map((e=>t.find((t=>t.id===e.id))))})}e={metadata:e.metadata,format:e.format,chapters:e.chapters,streams:t,streamGroups:i}}i+=function(e,t,i){var r;let a=`${i.tag} #${t}, ${i.isLive?"live":"vod"}, ${I(d.iW,e.format)}, from '${i.from}':\n`;Object.keys(e.metadata).length&&(a+="  Metadata:\n",k.__(e.metadata,((e,t)=>{w.Ik(e)||w.YO(e)||w.sv(e)||ArrayBuffer.isView(e)||(w.Yj(e)&&(e=y.yh(e,"\n","\n"+" ".repeat(6+t.length))),a+=`    ${t}: ${e}\n`)})));let o=c.Dh,n=BigInt(0),h=c.Dh;e.streams.forEach((e=>{const t=e.duration!==c.Dh?(0,u.k)(e.duration,e.timeBase,c.i0):c.Dh,i=e.startTime!==c.Dh?(0,u.k)(e.startTime,e.timeBase,c.i0):c.Dh;t>o&&(o=t),(i!==c.Dh&&i<h||h===c.Dh)&&(h=i),n+=s.f[17](e.codecpar+32)})),a+=`  Duration: ${o!==c.Dh?x(o):"N/A"}, start: ${h!==c.Dh?x(h):"N/A"}, bitrate: ${n?T(n):"N/A"}\n`,null!==(r=e.chapters)&&void 0!==r&&r.length&&(a+="  Chapters:\n",e.chapters.forEach(((e,i)=>{a+=function(e,t,i,r){let s="N/A",a="N/A";e.start!==c.Dh&&(s=x((0,u.k)(e.start,e.timeBase,c.i0))),e.end!==c.Dh&&(a=x((0,u.k)(e.end,e.timeBase,c.i0)));let o=`${r}Chapter #${t}:${i} start: ${s}, end: ${a}\n`;return Object.keys(e.metadata).length&&(o+=`${r}  Metadata:\n`,k.__(e.metadata,((e,t)=>{w.Ik(e)||w.YO(e)||w.sv(e)||ArrayBuffer.isView(e)||(w.Yj(e)&&(e=y.yh(e,"\n","\n"+" ".repeat(6+t.length))),o+=`${r}    ${t}: ${e}\n`)}))),o}(e,t,i,"    ")})));const l={};return e.streamGroups.forEach((e=>{a+=function(e,t,i,r){const a=I(d.u6,e.type),o=[];if(3===e.type){const t=e.streams[0];t&&(1===s.f[15](t.codecpar)?R(t,o):0===s.f[15](t.codecpar)&&(C(t,o),o.push(`${e.params.width}x${e.params.height}`)))}let n=`  Stream Group #${t}:${e.index} ${a}: ${o.join(", ")}${S(e.disposition)}\n`;return e.streams.length&&e.streams.forEach((e=>{n+=B(e,t,"    "),r[e.id]=!0})),n}(e,t,0,l)})),e.streams.forEach((e=>{l[e.id]||(a+=B(e,t,"  "))})),a}(e,a,t[a])})),i}},65052:(e,t,i)=>{i.d(t,{$:()=>o});var r=i(17630),s=i(91278),a=i(30027);function o(e){let t=!0;return r.__(e.streams,(e=>{switch(e.codecpar.codecType){case 1:e.codecpar.chLayout.nbChannels!==s.N_&&e.codecpar.sampleRate!==s.N_&&e.codecpar.frameSize!==s.N_&&e.codecpar.bitrate!==BigInt(0)||(t=!1);break;case 0:0!==(0,a.lb)(e.codecpar.framerate)&&e.codecpar.width!==s.N_&&e.codecpar.height!==s.N_&&e.codecpar.bitrate!==BigInt(0)||(t=!1),27!==e.codecpar.codecId&&173!==e.codecpar.codecId&&196!==e.codecpar.codecId&&12!==e.codecpar.codecId||e.codecpar.profile!==s.N_&&e.codecpar.level!==s.N_||(t=!1)}})),t}},30018:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(81819);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,i="";for(let s=0;s<t;s++)r.ai(e)?(i=String.fromCharCode(255&e)+i,e>>>=8):(i=String.fromCharCode(Number(e&BigInt(255)))+i,e>>=BigInt(8));return i}},85601:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(17630);function s(e){if(e.length<2)return 0;const t=e.slice().sort(((e,t)=>e>t?1:-1));let i=0,s=0,a=[];for(let o=0;o<e.length;o++){for(r._(a,e[o],(t=>t<e[o]?1:-1));a.length&&a[0]===t[s];)a.shift(),s++;i=Math.max(i,a.length)}return i}},15119:(e,t,i)=>{function r(e,t){if(t.length<e)return t.slice().sort(((e,t)=>e>t?1:-1));const i=[],r=t.slice().sort(((e,t)=>e>t?1:-1));if(e){const t=r[r.length-1]-r[r.length-2];for(let s=e;s>0;s--)i.push((i.length?i[i.length-1]:BigInt(0))+(s>=r.length?t:r[s]-r[s-1]));i.reverse()}const s=[];for(let t=0;t<e;t++)s.push(r[0]-i[t]);return s.concat(r)}i.d(t,{A:()=>r})},46942:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(30027);const s=399;function a(e){return e<360?1001*(e+1):(e-=360)<30?1001*(e+31)*12:(e-=30)<3?1001*[80,120,240][e]*12:1e3*[24,30,60,12,15,48][e-=3]*12}function o(e){let t=0,i=.01;for(let o=0;o<s;o++){const s=Math.abs((0,r.lb)(e)/(0,r.lb)({num:a(o),den:12012})-1);s<i&&(i=s,t=a(o))}if(t){const i={num:t,den:12012};(0,r.iU)(i),e.num=i.num,e.den=i.den}}},18164:(e,t,i)=>{i.d(t,{A:()=>r});class r{constructor(){}get ext(){throw new Error("need implemented ext getter")}get flags(){return 0}get name(){return"CustomIOLoader."+Math.random()}get minBuffer(){return 4}write(e){throw new Error("need implemented write function")}}},39989:(e,t,i)=>{i.d(t,{A:()=>l});var r=i(19371),s=i(88583),a=i(47378),o=i(25092),n=i(16563),h=i(87339),d=i(59435);const c="packages/avnetwork/src/ioLoader/FetchIOLoader.ts";class l extends d.A{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),(0,r.A)(this,"contentLength",void 0),(0,r.A)(this,"receivedLength",void 0),(0,r.A)(this,"info",void 0),(0,r.A)(this,"range",void 0),(0,r.A)(this,"startBytes",void 0),(0,r.A)(this,"endBytes",void 0),(0,r.A)(this,"eofIndex",void 0),(0,r.A)(this,"abortController",void 0),(0,r.A)(this,"reader",void 0),(0,r.A)(this,"buffers",void 0),(0,r.A)(this,"supportRange",void 0),(0,r.A)(this,"abortSleep_",void 0),(0,r.A)(this,"aborted",void 0),(0,r.A)(this,"bandwidth",void 0),(0,r.A)(this,"delay",void 0)}async getTotalSize(e){var t,i,r;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a={method:e,headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};null!==(t=this.info.httpOptions)&&void 0!==t&&t.headers&&o.__(this.info.httpOptions.headers,((e,t)=>{a.headers[t]=e})),o.__(s,((e,t)=>{a.headers[t]=e})),null!==(i=this.info.httpOptions)&&void 0!==i&&i.credentials&&(a.credentials=this.info.httpOptions.credentials),null!==(r=this.info.httpOptions)&&void 0!==r&&r.referrerPolicy&&(a.referrerPolicy=this.info.httpOptions.referrerPolicy),"function"==typeof AbortController&&(this.abortController=new AbortController,a.signal=this.abortController.signal);try{const e=await fetch(this.info.url,a);if(e.ok&&e.status>=200&&e.status<=299){this.abortController&&(this.abortController.abort(),this.abortController=null);const t=e.headers.get("Accept-Ranges");t&&-1===t.indexOf("bytes")&&(this.supportRange=!1);const i=e.headers.get("Content-Range");if(i){const e=i.split("/")[1];if(e)return parseInt(e)}const r=e.headers.get("X-Content-Length")||e.headers.get("Content-Length");if(null!=r)return parseInt(r)}}catch(e){}return 0}async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{from:0,to:-1};var i;if(this.info=e,this.range=t,this.range.to||(this.range.to=-1),this.range.from=Math.max(this.range.from,0),this.startBytes=0,this.endBytes=-1,this.eofIndex=-1,this.receivedLength=0,this.buffers=[],this.supportRange=!0,this.aborted=!1,this.bandwidth=0,this.range.to>0&&(this.eofIndex=t.to),this.range&&!this.options.isLive&&(this.startBytes=null!==(i=this.range.from)&&void 0!==i?i:0),this.status=1,!this.options.isLive&&!this.options.disableSegment){let e=await this.getTotalSize("HEAD");e||(e=await this.getTotalSize("Get",{range:"bytes=0-1"})),e<=2&&(e=0),e?(this.contentLength=e,this.range.to<0&&(this.eofIndex=this.contentLength+this.range.to),this.supportRange&&(this.endBytes=Math.min(this.startBytes+this.options.preload-1,this.eofIndex))):this.endBytes=-1}return this.status=2,0}getBandwidthReader(e,t){const i=[];let r,s=!1,a=0;const o=this;return new ReadableStream({async start(h){for(;;){const{value:h,done:d}=await e.read();if(d){s=!0;const e=((0,n.A)()-t)/1e3;o.bandwidth=8*a/e,r&&(r(),r=null);break}i.push(h),a+=h.length,r&&(r(),r=null)}},async pull(e){for(;;){if(i.length)return void e.enqueue(i.shift());if(s&&!i.length)return void e.close();await new Promise((e=>{r=e}))}}}).getReader()}async openReader(){var e,t,i;const r={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};null!==(e=this.info.httpOptions)&&void 0!==e&&e.headers&&o.__(this.info.httpOptions.headers,((e,t)=>{r.headers[t]=e})),this.options.isLive||this.options.disableSegment||(r.headers.range=`bytes=${this.startBytes}-${this.endBytes>0?this.endBytes:""}`),null!==(t=this.info.httpOptions)&&void 0!==t&&t.credentials&&(r.credentials=this.info.httpOptions.credentials),null!==(i=this.info.httpOptions)&&void 0!==i&&i.referrerPolicy&&(r.referrerPolicy=this.info.httpOptions.referrerPolicy),this.abortController&&this.abortController.abort(),"function"==typeof AbortController&&(this.abortController=new AbortController,r.signal=this.abortController.signal);try{const e=(0,n.A)(),t=await fetch(this.info.url,r),i=(0,n.A)();this.delay=i-e,t.ok&&t.status>=200&&t.status<=299?this.reader=this.options.enableBandwidthReader?this.getBandwidthReader(t.body.getReader(),i):t.body.getReader():(this.status=3,h.h2(`FetchStreamLoader: Http code invalid, ${t.status} ${t.statusText}`,c,297))}catch(e){if(this.retryCount<this.options.retryCount&&(!this.options.isLive||!this.receivedLength)){if(this.retryCount++,this.status=1,this.abortSleep_=new s.A(this.options.retryInterval),await this.abortSleep_,this.abortSleep_=null,this.aborted)return;return this.openReader()}h.h2(`FetchStreamLoader: exception ${e.message}`,c,314)}}async readInterval(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;for(;this.buffers.length&&i<e.length;){const t=this.buffers.shift();t.length>e.length-i?(e.set(t.subarray(0,e.length-i),i),this.buffers.unshift(t.subarray(e.length-i)),i=e.length):(e.set(t,i),i+=t.length)}if(i>=e.length)return e.length+t;if(4===this.status)return i>0?i+t:t>0?t:-1048576;if(!this.reader&&(await this.openReader(),this.aborted))return-1048576;const{value:r,done:s}=await this.reader.read();return s?void 0!==this.contentLength&&this.receivedLength+this.range.from<this.endBytes+1?(this.status=3,void h.h2("Fetch stream meet Early-EOF",c,356)):this.options.isLive||this.options.disableSegment||this.receivedLength+this.range.from>=this.eofIndex?(this.status=4,this.startBytes=0,i>0?i+t:t>0?t:-1048576):(await this.reader.cancel(),this.abortController&&(this.abortController.abort(),this.abortController=null),this.reader=null,this.startBytes=this.endBytes+1,this.endBytes=Math.min(this.startBytes+this.options.preload-1,this.eofIndex),this.readInterval(e.subarray(i,void 0,!0),i)):(this.receivedLength+=r.length,r.length>e.length-i?(e.set(r.subarray(0,e.length-i),i),this.buffers.push(r.subarray(e.length-i)),e.length+t):(e.set(r,i),i+=r.length,i+t))}async read(e){return this.readInterval(e)}async seek(e){return this.supportRange?this.eofIndex>0&&Number(e)>this.eofIndex?a.nr:(await this.abort(),this.aborted=!1,this.receivedLength=Number(e)-this.range.from,this.startBytes=Number(e),this.options.disableSegment||(this.endBytes=Math.min(this.startBytes+this.options.preload,this.eofIndex)),this.buffers.length=0,4===this.status&&(this.status=2),0):a.NU}async size(){return this.options.isLive?BigInt(0):BigInt(Math.floor(this.contentLength||0))}abortSleep(){this.aborted=!0,this.abortSleep_&&(this.abortSleep_.stop(),this.abortSleep_=null)}async abort(){this.abortSleep(),this.reader&&(await this.reader.cancel(),this.abortController&&(this.abortController.abort(),this.abortController=null),this.reader=null)}async stop(){this.status=0,await this.abort()}getUrl(){var e;return null===(e=this.info)||void 0===e?void 0:e.url}}},44397:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(19371),s=i(81819),a=i(59435);const o=s.Pc(Blob.prototype.arrayBuffer),n="function"==typeof FileReaderSync;class h extends a.A{constructor(){super(...arguments),(0,r.A)(this,"info",void 0),(0,r.A)(this,"range",void 0),(0,r.A)(this,"readPos",void 0),(0,r.A)(this,"endPos",void 0),(0,r.A)(this,"reader",void 0),(0,r.A)(this,"readerResolve",void 0)}async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{from:0,to:-1};return this.info=e,this.range=t,this.readPos=0,this.endPos=this.info.file.size,t.from>0&&(this.readPos=t.from),t.to>0&&(this.endPos=t.to),this.status=2,0}readBufferByReaderSync(e){return this.reader||(this.reader=new FileReaderSync),this.reader.readAsArrayBuffer(this.info.file.slice(this.readPos,this.readPos+e))}async readBufferByReader(e){return this.reader||(this.reader=new FileReader,this.reader.onloadend=e=>{this.readerResolve&&this.readerResolve(e.target.result)}),new Promise((t=>{this.readerResolve=t,this.reader.readAsArrayBuffer(this.info.file.slice(this.readPos,this.readPos+e))}))}async read(e){if(this.readPos>=this.endPos)return this.status=4,-1048576;const t=Math.min(e.length,this.endPos-this.readPos);return n?e.set(new Uint8Array(this.readBufferByReaderSync(t)),0):o?e.set(new Uint8Array(await this.info.file.slice(this.readPos,this.readPos+t).arrayBuffer()),0):e.set(new Uint8Array(await this.readBufferByReader(t)),0),this.readPos+=t,this.readPos>=this.endPos&&(this.status=4),t}async seek(e){return this.readPos=Number(e),4===this.status&&(this.status=2),0}async size(){return BigInt(Math.floor(this.info.file.size))}async stop(){this.status=0}}},59435:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(19371),s=i(25092);const a={isLive:!1,preload:5242880,retryCount:20,retryInterval:1};class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.A)(this,"options",void 0),(0,r.A)(this,"status",void 0),(0,r.A)(this,"retryCount",void 0),(0,r.A)(this,"retryTimeout",void 0),this.options=e,this.status=0,this.retryCount=0,this.options=s.X$({},a),s.X$(this.options,e)}write(e){throw new Error("need implemented write function")}}},28430:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(59435);class a extends s.A{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),(0,r.A)(this,"readQueue",void 0),(0,r.A)(this,"consume",void 0),this.readQueue=[]}async readInterval(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;for(;this.readQueue.length&&i<e.length;){const t=this.readQueue.shift();t.length>e.length-i?(e.set(t.subarray(0,e.length-i),i),this.readQueue.unshift(t.subarray(e.length-i)),i=e.length):(e.set(t,i),i+=t.length)}return i>0||t?i+t:4===this.status||0===this.status?i>0?i+t:t>0?t:-1048576:3===this.status?i>0?i+t:t>0?t:-1048573:(await new Promise((e=>{this.consume=e})),this.consume=null,this.readInterval(e,t))}async read(e){return this.readInterval(e)}async write(e){return this.send(e)}}},70178:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(28430);class a extends s.A{constructor(){super(...arguments),(0,r.A)(this,"info",void 0),(0,r.A)(this,"socket",void 0)}async send(e){return this.socket?(this.socket.send(e.slice()),0):-1048574}open(e){return this.info=e,this.status=1,new Promise((t=>{var i;this.socket=new WebSocket(e.url,null===(i=e.websocketOptions)||void 0===i?void 0:i.protocols),this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{this.status=2,t(0)},this.socket.onerror=()=>{this.status=3,t(-1048573),this.consume&&this.consume()},this.socket.onclose=()=>{this.status=4,t(-1048576),this.consume&&this.consume()},this.socket.onmessage=e=>{let t=e.data;this.readQueue.push(new Uint8Array(t)),this.consume&&this.consume()}}))}seek(e,t){throw new Error("Method not implemented.")}size(){throw new Error("Method not implemented.")}async stop(){this.socket&&(this.socket.close(),this.socket=null),this.status=4,this.consume&&this.consume()}}},84220:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(28430);class a extends s.A{constructor(){super(...arguments),(0,r.A)(this,"info",void 0),(0,r.A)(this,"transport",void 0),(0,r.A)(this,"datagramReader",void 0),(0,r.A)(this,"reader",void 0),(0,r.A)(this,"datagramWriter",void 0),(0,r.A)(this,"writer",void 0),(0,r.A)(this,"stream",void 0),(0,r.A)(this,"readPacketQueue",void 0),(0,r.A)(this,"consumePacket",void 0)}async send(e){return this.writer?(this.writer.write(e.slice()),0):-1048574}async handleRead(){let e=!1;for(;;)try{const{value:t,done:i}=await this.reader.read();if(i){e=i,this.status=4,this.consume&&this.consume();break}this.readQueue.push(t)}catch(t){e||(this.status=3,this.consume&&this.consume());break}}async readDatagram(){let e=!1;for(;;)try{const{value:t,done:i}=await this.datagramReader.read();if(i){e=!0,this.status=4,this.consumePacket&&this.consumePacket();break}this.readPacketQueue.push(t)}catch(t){e||(this.status=3,this.consumePacket&&this.consumePacket());break}}async open(e){return this.info=e,this.transport=new WebTransport(e.url,e.webtransportOptions),this.readPacketQueue=[],this.status=1,await this.transport.ready,this.transport.closed.then((()=>{this.transport?this.status=3:this.status=4})),this.status=2,this.stream=await this.transport.createBidirectionalStream(),this.reader=this.stream.readable.getReader(),this.writer=this.stream.writable.getWriter(),this.datagramReader=this.transport.datagrams.readable.getReader(),this.datagramWriter=this.transport.datagrams.writable.getWriter(),this.handleRead(),this.readDatagram(),0}async readPacket(e){for(;;){if(this.readPacketQueue.length){const t=this.readPacketQueue.shift();return e.set(t,0),t.length}if(4===this.status||0===this.status)return-1048576;if(3===this.status)return-1048573;await new Promise((e=>{this.consumePacket=e})),this.consumePacket=null}}async writePacket(e){return this.datagramWriter?(this.datagramWriter.write(e.slice()),0):-1048574}seek(e,t){throw new Error("Method not implemented.")}size(){throw new Error("Method not implemented.")}async stop(){this.transport&&(this.transport.close(),this.transport=null),this.status=4,this.consume&&this.consume()}}},35688:(e,t,i)=>{i.d(t,{A:()=>I});var r=i(42524),s=i(77389),a=i(54911),o=i(75589),n=i(85266),h=i(58081),d=i(10567),c=i(62394),l=i(83496),u=i(7615),f=i(31184),p=i(62787),m=i(47378),g=i(2198),A=i(87339),v=i(16563),y=i(81819),b=i(17630),k=i(16427),w=i(59451),x=i(57470);const T="packages/avpipeline/src/AudioDecodePipeline.ts";class I extends x.A{constructor(){super()}createWebcodecDecoder(e){return new k.A({onError:t=>{A.z3(`audio decode error, taskId: ${e.taskId}, error: ${t}`,T,115)},onReceiveAudioData(t){const i=(0,h.t)(t,e.avframePool.alloc());e.frameCaches.push(i),s.M[17](e.stats+56,r.f[17](e.stats+56)+BigInt(1)),s.M[15](e.stats+248,Math.max((0,v.A)()-e.lastDecodeTimestamp,r.f[15](e.stats+248))),t.close()}})}createWasmcodecDecoder(e,t){return new w.A({resource:t,onReceiveAVFrame(t){e.frameCaches.push(t),s.M[17](e.stats+56,r.f[17](e.stats+56)+BigInt(1)),s.M[15](e.stats+248,Math.max((0,v.A)()-e.lastDecodeTimestamp,r.f[15](e.stats+248)))},avframePool:e.avframePool})}async pullAVPacketInternal(e,t){const i=await t.request("pull");if(y.ai(i)||(0,g.A)(i))return i;{const t=e.avpacketPool.alloc();return(0,d.r0)(i,t),t}}async createTask(e){const t=new n.Ay(e.leftPort),i=new n.Ay(e.rightPort),h=[],d=new c.A((0,o.A)(e.avframeList,a.A),e.avframeListMutex),f={...e,resource:await(0,l.A)(e.resource),frameCaches:h,inputEnd:!1,decoder:null,parameters:0,lastDecodeTimestamp:0,avframePool:d,avpacketPool:new u.A((0,o.A)(e.avpacketList,a.A),e.avpacketListMutex)};return f.resource?f.decoder=this.createWasmcodecDecoder(f,f.resource):f.decoder=this.createWebcodecDecoder(f),this.tasks.set(e.taskId,f),i.on(n.S3,(async a=>{switch(a.method){case"pull":if(h.length){const e=h.shift();i.reply(a,e);break}if(!f.inputEnd){for(;;){if(h.length){const e=h.shift();i.reply(a,e);break}f.pending&&await f.pending,f.lastDecodeTimestamp=(0,v.A)();const o=await this.pullAVPacketInternal(f,t);if(-1048576===o){if(await f.decoder.flush(),f.inputEnd=!0,h.length){const e=h.shift();i.reply(a,e);break}A.pq(`audio decoder ended, taskId: ${f.taskId}`,T,222),i.reply(a,-1048576);break}if(!(o>0)){A.z3(`audio decode pull avpacket error, taskId: ${e.taskId}, ret: ${o}`,T,240),i.reply(a,o);break}{const t=f.decoder.decode(o);f.avpacketPool.release(o),t<0&&(s.M[15](f.stats+48,r.f[15](f.stats+48)+1),A.z3(`audio decode error, taskId: ${e.taskId}, ret: ${t}`,T,235))}}break}i.reply(a,-1048576)}})),0}async open(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=this.tasks.get(e);if(r){r.wasmDecoderOptions=i;const e=(0,f.Gy)(168);return(0,g.A)(t)?(0,p.Yi)(e,t):(0,d.T8)(t,e),r.parameters&&(0,p.dn)(r.parameters),r.parameters=e,new Promise((async(t,i)=>{const s=await r.decoder.open(e,r.wasmDecoderOptions);if(s)return A.z3(`open audio decoder failed, error: ${s}`,T,274),void t(m.r8);t(0)}))}A.h2("task not found",T,281)}async beforeReopenDecoder(e){const t=this.tasks.get(e);t?t.pending=new Promise((e=>{t.pendingResolve=e})):A.h2("task not found",T,292)}async reopenDecoder(e,t,i,r){const s=this.tasks.get(e);if(s){r&&(s.wasmDecoderOptions=r);const e=(0,f.Gy)(168);let a;return(0,g.A)(t)?(0,p.Yi)(e,t):(0,d.T8)(t,e),s.parameters&&(0,p.dn)(s.parameters),s.parameters=e,i?(i=await(0,l.A)(i),a=this.createWasmcodecDecoder(s,i)):a=this.createWebcodecDecoder(s),new Promise((async(t,r)=>{const o=await a.open(e);if(o)return A.z3(`reopen audio decoder failed, error: ${o}`,T,329),void t(m.r8);i&&(s.resource=i),s.decoder.close(),s.decoder=a,A.Yz(`reopen audio decoder, taskId: ${s.taskId}`,T,339),t(0),s.pendingResolve&&(s.pendingResolve(),s.pending=null)}))}A.h2("task not found",T,347)}async resetTask(e){const t=this.tasks.get(e);t&&(t.decoder&&await t.decoder.flush(),b.__(t.frameCaches,(e=>{t.avframePool.release(e)})),t.frameCaches.length=0,t.inputEnd=!1,t.lastDecodeTimestamp=(0,v.A)(),A.pq(`reset audio decoder, taskId: ${t.taskId}`,T,363))}async registerTask(e){return this.tasks.has(e.taskId)?m.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(t.rightPort.close(),t.leftPort.close(),t.decoder.close(),t.frameCaches.forEach((e=>{t.avframePool.release(e)})),t.parameters&&(0,p.dn)(t.parameters),this.tasks.delete(e),A.Yz(`unregisterTask task, taskId: ${e}`,T,387))}}},31370:(e,t,i)=>{i.d(t,{A:()=>E});var r=i(19371),s=i(75354),a=i(54911),o=i(11846),n=i(59502),h=i(75589),d=i(42524),c=i(77389),l=i(93793),u=i(44867),f=i(85266),p=i(50605),m=i(83496),g=i(91278),A=i(62394),v=i(30027),y=i(31184),b=i(47378),k=i(41863),w=i(87339),x=i(16563),T=i(29592),I=i(47845),_=i(10063),P=i(88583),M=i(7475),S=i(11201),C=i(91728),R=i(57470);const B="packages/avpipeline/src/AudioRenderPipeline.ts",D=BigInt(400);class E extends R.A{constructor(){super(),(0,r.A)(this,"avPCMBufferPool",void 0),(0,r.A)(this,"avPCMBufferList",void 0),(0,r.A)(this,"avPCMBufferListMutex",void 0),this.avPCMBufferList=(0,o.A)(a.A),this.avPCMBufferListMutex=(0,o.A)(n.eu),this.avPCMBufferPool=new p.A(this.avPCMBufferList,this.avPCMBufferListMutex[s.o9])}async createTask(e){const t=new f.Ay(e.leftPort),i=new f.Ay(e.rightPort),r=new f.Ay(e.controlPort),n={...e,leftIPCPort:t,rightIPCPort:i,controlIPCPort:r,resamplerResource:await(0,m.A)(e.resamplerResource),stretchpitcherResource:await(0,m.A)(e.stretchpitcherResource),resampler:null,stretchpitcher:new Map,outPCMBuffer:null,waitPCMBuffer:0,waitAVFrame:0,waitPCMBufferPos:0,ended:!1,stretchpitcherEnded:!1,playRate:1,playTempo:1,playPitch:1,useStretchpitcher:!1,lastNotifyPTS:BigInt(0),currentPTS:g.Dh,lastMasterPts:g.Dh,masterTimer:new _.A,firstPlayed:!1,seeking:!1,pausing:!1,stopping:!1,seekSync:null,receivePCMSync:null,paddingAVFrame:0,fakePlayStartTimestamp:0,fakePlaySamples:BigInt(0),fakePlayTimer:null,fakePlayWorkerTimer:null,fakePlay:!1,lastRenderTimestamp:0,avframePool:new A.A((0,h.A)(e.avframeList,a.A),e.avframeListMutex)};for(let t=0;t<e.playChannels;t++){const i=new C.A({resource:n.stretchpitcherResource});n.stretchpitcher.set(t,i),await i.open({sampleRate:e.playSampleRate,channels:1}),i.setTempo(n.playTempo),i.setPitch(n.playPitch),i.setRate(n.playRate)}const p=async()=>{let e;if(n.paddingAVFrame?(e=n.paddingAVFrame,n.paddingAVFrame=0):e=await n.leftIPCPort.request("pull"),-1048576===e){for(let e=0;e<n.playChannels;e++)n.stretchpitcher.get(e).flush();return w.pq(`audio render ended, taskId: ${n.taskId}`,B,252),-1048576}if(e<0)return w.z3(`pull audio frame failed, taskId: ${n.taskId}`,B,256),e;{if(1!==n.playRate||1!==n.playTempo||1!==n.playPitch||n.enableJitterBuffer?n.useStretchpitcher=!0:n.useStretchpitcher=!1,!n.firstPlayed){const t=(0,v.Mr)(d.f[17](e+104),e+120,g.i0);n.firstPlayed=!0,w.Yz(`got first audio frame, pts: ${d.f[17](e+104)}(${t}ms), taskId: ${n.taskId}`,B,278)}const t=(0,v.Mr)(d.f[17](e+104),e+120,g.i0);(t>BigInt(0)&&n.masterTimer.getMasterTime()-t>D||n.isLive&&t-n.currentPTS>BigInt(4e3))&&n.masterTimer.setMasterTime(t),n.currentPTS=t,c.M[17](n.stats+72,d.f[17](n.stats+72)+BigInt(1)),c.M[17](n.stats+344,t),n.lastRenderTimestamp&&c.M[15](n.stats+252,Math.max((0,x.A)()-n.lastRenderTimestamp,d.f[15](n.stats+252))),n.lastRenderTimestamp=(0,x.A)();let i=!0;if(d.f[15](e+152)!==n.playSampleRate||d.f[15](e+80)!==n.playFormat||d.f[15](e+292)!==n.playChannels){if(n.resampler){const t=n.resampler.getInputPCMParameters();t.format===d.f[15](e+80)&&t.sampleRate===d.f[15](e+152)&&t.channels===d.f[15](e+292)||(n.resampler.close(),n.resampler=null)}n.resampler||(n.resampler=new S.A({resource:n.resamplerResource}),await n.resampler.open({sampleRate:d.f[15](e+152),format:d.f[15](e+80),channels:d.f[15](e+292)},{sampleRate:n.playSampleRate,format:n.playFormat,channels:n.playChannels}));let t=this.avPCMBufferPool.alloc(),i=n.resampler.resample(d.f[20](e+64),t,d.f[15](e+76));if(i<0)return w.z3(`resample error, ret: ${i}, taskId: ${n.taskId}`,B,338),this.avPCMBufferPool.release(t),i;if(n.useStretchpitcher){for(let e=0;e<n.playChannels;e++)n.stretchpitcher.get(e).sendSamples(d.f[20](d.f[20](t)+4*e),d.f[15](t+8));this.avPCMBufferPool.release(t)}else n.waitPCMBuffer=t,n.waitPCMBufferPos=0}else if(n.useStretchpitcher)for(let t=0;t<n.playChannels;t++)n.stretchpitcher.get(t).sendSamples(d.f[20](d.f[20](e+64)+4*t),d.f[15](e+76));else{let t=this.avPCMBufferPool.alloc();d.f[20](t)&&((0,y.aI)(d.f[20](t)),(0,y.aI)(t)),c.M[15](t+8,d.f[15](e+76)),c.M[15](t+12,d.f[15](e+76)),c.M[15](t+20,d.f[15](e+152)),c.M[15](t+16,d.f[15](e+292)),c.M[20](t,d.f[20](e+64)),n.waitAVFrame=e,n.waitPCMBuffer=t,n.waitPCMBufferPos=0,i=!1}c.M[15](n.stats+4,d.f[15](e+152)),c.M[15](n.stats,d.f[15](e+292)),c.M[15](n.stats+8,d.f[15](e+76)),i&&n.avframePool.release(e)}return 0},b=async e=>{let t=0;if(n.seeking&&(await new Promise((e=>{n.receivePCMSync=e})),n.stopping))return-1048576;if(n.enableJitterBuffer&&d.f[15](n.stats+32)/d.f[15](n.stats+244)*1e3<=d.f[15](n.stats+280)&&this.setPlayRate(n.taskId,1),n.ended&&n.useStretchpitcher){let i=0;for(let r=0;r<n.playChannels;r++){const s=n.stretchpitcher.get(r);d.f[20](d.f[20](e)+4*r)&&(i=s.receiveSamples(d.f[20](d.f[20](e)+4*r)+4*t,d.f[15](e+12)-t))}if(t+i<d.f[15](e+12)){n.stretchpitcherEnded=!0;for(let i=0;i<n.playChannels;i++)(0,k.sO)(d.f[20](d.f[20](e)+4*i)+t,0,4*(d.f[15](e+12)-t))}return c.M[15](e+8,t),0}for(;t<d.f[15](e+12);){let i=0;if(n.useStretchpitcher)for(let r=0;r<n.playChannels;r++){const s=n.stretchpitcher.get(r);d.f[20](d.f[20](e)+4*r)&&(i=s.receiveSamples(d.f[20](d.f[20](e)+4*r)+4*t,d.f[15](e+12)-t))}else if(n.waitPCMBuffer){if(i=Math.min(d.f[15](n.waitPCMBuffer+8)-n.waitPCMBufferPos,d.f[15](e+12)-t),i){for(let r=0;r<n.playChannels;r++)(0,k.Mr)(d.f[20](d.f[20](e)+4*r)+4*t,d.f[20](d.f[20](n.waitPCMBuffer)+4*r)+4*n.waitPCMBufferPos,4*i);n.waitPCMBufferPos+=i}d.f[15](n.waitPCMBuffer+8)===n.waitPCMBufferPos&&(n.waitAVFrame&&(c.M[20](n.waitPCMBuffer,0),c.M[15](n.waitPCMBuffer+12,0),n.avframePool.release(n.waitAVFrame),n.waitAVFrame=0),this.avPCMBufferPool.release(n.waitPCMBuffer),n.waitPCMBuffer=0)}if(t+=i,t<d.f[15](e+12)){let i=await p();if(-1048576===i){if(n.ended=!0,n.useStretchpitcher){for(let r=0;r<n.playChannels;r++){const s=n.stretchpitcher.get(r);d.f[20](d.f[20](e)+4*r)&&(s.flush(),i=s.receiveSamples(d.f[20](d.f[20](e)+4*r)+4*t,d.f[15](e+12)-t))}if(t+i<d.f[15](e+12)){n.stretchpitcherEnded=!0;for(let i=0;i<n.playChannels;i++)(0,k.sO)(d.f[20](d.f[20](e)+4*i)+t,0,4*(d.f[15](e+12)-t))}t+=i}break}if(i<0)return i}}return c.M[15](e+8,t),n.seekSync&&(n.seekSync(),n.seekSync=null),0};return i.on(f.S3,(async e=>{switch(e.method){case"pull":{if(n.fakePlay&&(n.fakePlay=!1,this.clearFakePlayTimer(n),n.fakePlaySamples=BigInt(0),n.fakePlayStartTimestamp=0),n.ended&&(n.stretchpitcherEnded||!n.useStretchpitcher))return void i.reply(e,-1048576);const t=e.params.buffer;if(!n.firstPlayed){n.masterTimer.setMasterTime(n.lastMasterPts===g.Dh?n.startPTS:n.lastMasterPts),n.lastMasterPts=g.Dh;let t=await p();if(t<0){i.reply(e,t);break}}if(n.currentPTS-n.masterTimer.getMasterTime()>D&&!n.audioMasterForce){(0,k.sO)(d.f[20](d.f[20](t)),0,4*d.f[15](t+12)*d.f[15](t+16)),i.reply(e,0),this.fakeSyncPts(n);break}this.syncPts(n,d.f[15](t+12));const r=await b(t);i.reply(e,r);break}case"pullBuffer":{if(n.fakePlay&&(n.fakePlay=!1,this.clearFakePlayTimer(n),n.fakePlaySamples=BigInt(0),n.fakePlayStartTimestamp=0),n.ended&&(n.stretchpitcherEnded||!n.useStretchpitcher))return void i.reply(e,-1048576);const t=e.params.nbSamples;if(!n.outPCMBuffer||n.outPCMBuffer.maxnbSamples!==t){n.outPCMBuffer&&((0,y.aI)(n.outPCMBuffer.data),(0,y.aI)(n.outPCMBuffer[s.o9]),(0,l.A)(n.outPCMBuffer)),n.outPCMBuffer=(0,o.A)(u.A),n.outPCMBuffer.data=(0,y.sY)(4*n.playChannels);const e=(0,y.Gy)(4*t*n.playChannels);for(let i=0;i<n.playChannels;i++)c.M[20](n.outPCMBuffer.data+4*i,e+4*t*i);n.outPCMBuffer.maxnbSamples=t}if(!n.firstPlayed){n.masterTimer.setMasterTime(n.lastMasterPts===g.Dh?n.startPTS:n.lastMasterPts),n.lastMasterPts=g.Dh;let t=await p();if(t<0){i.reply(e,t);break}}if(n.currentPTS-n.masterTimer.getMasterTime()>D&&!n.audioMasterForce){const t=new Uint8Array(4*n.outPCMBuffer.nbSamples*n.playChannels);i.reply(e,t.buffer,null,[t.buffer]),this.fakeSyncPts(n);break}this.syncPts(n,n.outPCMBuffer.maxnbSamples);const r=await b(n.outPCMBuffer[s.o9]);if(r<0)return void i.reply(e,r);const a=(0,k.s3)(d.f[20](n.outPCMBuffer.data),4*n.outPCMBuffer.nbSamples*n.playChannels).slice();i.reply(e,a.buffer,null,[a.buffer]);break}}})),this.tasks.set(e.taskId,n),0}checkUseStretchpitcher(e){const t=1!==e.playRate||1!==e.playTempo||1!==e.playPitch||e.enableJitterBuffer;if(e.useStretchpitcher&&!t)for(let t=0;t<e.playChannels;t++)e.stretchpitcher.get(t).flush()}setPlayRate(e,t){const i=this.tasks.get(e);if(i){i.enableJitterBuffer&&d.f[15](i.stats+32)/d.f[15](i.stats+244)*1e3<=d.f[15](i.stats+280)&&(t=1),i.playRate=t;for(let e=0;e<i.playChannels;e++)i.stretchpitcher.get(e).setRate(t);this.checkUseStretchpitcher(i),i.masterTimer.setRate(i.playRate*i.playTempo),i.fakePlay&&(i.fakePlayStartTimestamp=(0,x.A)(),i.fakePlaySamples=BigInt(0))}}async setPlayTempo(e,t){const i=this.tasks.get(e);if(i){i.playTempo=t;for(let e=0;e<i.playChannels;e++)i.stretchpitcher.get(e).setTempo(t);this.checkUseStretchpitcher(i),i.masterTimer.setRate(i.playRate*i.playTempo),i.fakePlay&&(i.fakePlayStartTimestamp=(0,x.A)(),i.fakePlaySamples=BigInt(0))}}setPlayPitch(e,t){const i=this.tasks.get(e);if(i){i.playPitch=t;for(let e=0;e<i.playChannels;e++)i.stretchpitcher.get(e).setPitch(t);this.checkUseStretchpitcher(i)}}async beforeSeek(e){const t=this.tasks.get(e);if(t){if(t.fakePlay||t.pausing?this.clearFakePlayTimer(t):(w.Yz(`wait current pull front frame before seek, taskId: ${t.taskId}`,B,714),await new Promise((e=>{t.seekSync=e}))),t.seeking=!0,t.stretchpitcher.size)for(const e of t.stretchpitcher.keys())t.stretchpitcher.get(e).clear();t.waitPCMBuffer&&(t.waitAVFrame&&(c.M[20](t.waitPCMBuffer,0),c.M[15](t.waitPCMBuffer+12,0),t.avframePool.release(t.waitAVFrame),t.waitAVFrame=0),this.avPCMBufferPool.release(t.waitPCMBuffer),t.waitPCMBuffer=0),w.Yz(`before seek end, taskId: ${t.taskId}`,B,742)}}async syncSeekTime(e,t,i){const r=this.tasks.get(e);if(r){let s=!1;for(;;){if(!r.leftIPCPort)return r.ended=!0,void w.R8(`pull audio frame end after unregisterTask, taskId: ${e}`,B,756);let a=(0,x.A)(),o=d.f[15](r.stats+120);for(;!s&&i&&d.f[15](r.stats+120)>i;)await new P.A(0),(0,x.A)()-a>200&&o===d.f[15](r.stats+120)&&(s=!0),o!==d.f[15](r.stats+120)&&(o=d.f[15](r.stats+120),a=(0,x.A)());let n=await r.leftIPCPort.request("pull");if(n<0){w.R8(`pull audio frame end after seek, taskId: ${e}`,B,778),r.ended=!0;break}if(t<BigInt(0)){w.pq(`use the first audio frame because of the seek time${t} < 0`,B,784);break}const h=(0,v.Mr)(d.f[17](n+104),n+120,g.i0);if(h>=t){r.paddingAVFrame=n,r.ended=!1,r.lastNotifyPTS=h,c.M[17](r.stats+328,h),r.currentPTS=h,r.masterTimer.setMasterTime(t),r.lastMasterPts=t;break}r.avframePool.release(n)}w.Yz(`sync seek time end, taskId: ${r.taskId}`,B,812)}}async isEnd(e){const t=this.tasks.get(e);if(t)return t.ended}async afterSeek(e,t){const i=this.tasks.get(e);i&&(i.seeking=!1,i.receivePCMSync&&(i.receivePCMSync(),i.receivePCMSync=null),i.pausing||(i.fakePlay&&(i.fakePlayStartTimestamp=(0,x.A)(),i.fakePlaySamples=BigInt(0),this.fakePlayNext(i)),i.lastRenderTimestamp=(0,x.A)()),w.Yz(`after seek end, taskId: ${i.taskId}`,B,841))}async restart(e){const t=this.tasks.get(e);if(t){var i;if(t.lastNotifyPTS=BigInt(0),t.ended=!1,t.firstPlayed=!1,t.stretchpitcherEnded=!1,null!==(i=t.stretchpitcher)&&void 0!==i&&i.size)for(let e=0;e<t.playChannels;e++){var r;null===(r=t.stretchpitcher.get(e))||void 0===r||r.clear()}this.clearFakePlayTimer(t),t.fakePlaySamples=BigInt(0),t.fakePlayStartTimestamp=0,t.lastRenderTimestamp=(0,x.A)(),t.masterTimer.setMasterTime(t.startPTS),w.Yz(`restart task, taskId: ${t.taskId}`,B,863)}}async setMasterTime(e,t){const i=this.tasks.get(e);i&&i.masterTimer.setMasterTime(t)}fakeSyncPts(e){const t=e.masterTimer.getMasterTime();t-e.lastNotifyPTS>=BigInt(1e3)&&(e.lastNotifyPTS=t,c.M[17](e.stats+328,t),e.controlIPCPort.notify("syncPts",{pts:t}))}syncPts(e,t){const i=((e.useStretchpitcher?e.stretchpitcher.get(0).getLatency():0)+(3*t>>>1))/e.playSampleRate*1e3>>>0,r=T.T9(e.currentPTS-BigInt(Math.floor(i)),BigInt(0));c.M[17](e.stats+328,r),e.currentPTS-e.lastNotifyPTS>=BigInt(1e3)&&(e.lastNotifyPTS=e.currentPTS,e.controlIPCPort.notify("syncPts",{pts:r}))}clearFakePlayTimer(e){e.fakePlayTimer&&(e.fakePlayWorkerTimer?(e.fakePlayWorkerTimer.clearTimeout(e.fakePlayTimer),e.fakePlayWorkerTimer.destroy(),e.fakePlayWorkerTimer=null):clearTimeout(e.fakePlayTimer),e.fakePlayTimer=null)}setFakePlayTimer(e,t,i){return(0,I.A)()?setTimeout(t,i):(e.fakePlayWorkerTimer||(e.fakePlayWorkerTimer=new M.A),e.fakePlayWorkerTimer.setTimeout(t,i))}async fakePlayNext(e){const t=e.paddingAVFrame||await e.leftIPCPort.request("pull");if(e.paddingAVFrame=0,t<0)return e.ended=!0,w.pq(`audio fake render ended, taskId: ${e.taskId}`,B,934),void e.controlIPCPort.notify("ended");if(!e.fakePlay||e.pausing)return void e.avframePool.release(t);let i=d.f[15](t+76)/d.f[15](t+152)*1e3>>>0;i/=e.playRate*e.playTempo;const r=(0,v.Mr)(d.f[17](t+104),t+120,g.i0);if((r>BigInt(0)&&e.masterTimer.getMasterTime()-r>D||e.isLive&&r-e.currentPTS>BigInt(4e3))&&e.masterTimer.setMasterTime(r),e.currentPTS-e.masterTimer.getMasterTime()>D)return e.paddingAVFrame=t,this.fakeSyncPts(e),void(e.fakePlayTimer=this.setFakePlayTimer(e,(()=>{e.fakePlayTimer=null,this.fakePlayNext(e)}),i));this.syncPts(e,0);let s=BigInt(Math.floor((0,x.A)()-e.fakePlayStartTimestamp))*BigInt(0|d.f[15](t+152))/BigInt(1e3);s=s*BigInt(Math.floor(e.playRate*e.playTempo*100))/BigInt(100),i-=Number(s-e.fakePlaySamples)/d.f[15](t+152)*1e3>>>0,e.fakePlaySamples+=BigInt(0|d.f[15](t+76)),e.avframePool.release(t),e.currentPTS=r,c.M[15](e.stats+80,d.f[15](e.stats+80)+1),c.M[17](e.stats+344,r),e.lastRenderTimestamp&&c.M[15](e.stats+252,Math.max((0,x.A)()-e.lastRenderTimestamp,d.f[15](e.stats+252))),e.lastRenderTimestamp=(0,x.A)(),e.currentPTS-e.lastNotifyPTS>=BigInt(1e3)&&(e.lastNotifyPTS=e.currentPTS,c.M[17](e.stats+328,e.currentPTS),e.controlIPCPort.notify("syncPts",{pts:e.currentPTS})),e.fakePlayTimer=this.setFakePlayTimer(e,(()=>{e.fakePlayTimer=null,this.fakePlayNext(e)}),i)}async fakePlay(e){const t=this.tasks.get(e);t&&(t.fakePlayStartTimestamp=(0,x.A)(),t.fakePlay=!0,t.fakePlaySamples=BigInt(0),this.fakePlayNext(t),w.pq(`start fake play, taskId: ${t.taskId}`,B,1015))}async pause(e){const t=this.tasks.get(e);t&&(t.pausing=!0,t.lastMasterPts=t.masterTimer.getMasterTime(),t.fakePlay&&this.clearFakePlayTimer(t),w.pq(`task paused, taskId: ${t.taskId}`,B,1028))}async unpause(e){const t=this.tasks.get(e);t&&(t.pausing=!1,t.masterTimer.setMasterTime(t.lastMasterPts),t.lastMasterPts=g.Dh,t.fakePlay&&(t.fakePlayStartTimestamp=(0,x.A)(),t.fakePlaySamples=BigInt(0),t.lastRenderTimestamp=(0,x.A)(),this.fakePlayNext(t)),w.pq(`task unpaused, taskId: ${t.taskId}`,B,1045))}async stop(e){const t=this.tasks.get(e);t&&(t.stopping=!0,t.receivePCMSync&&(t.receivePCMSync(),t.receivePCMSync=null),w.pq(`task stopping, taskId: ${t.taskId}`,B,1057))}async registerTask(e){return this.tasks.has(e.taskId)?b.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);if(t){if(this.clearFakePlayTimer(t),t.resampler&&t.resampler.close(),t.stretchpitcher.size){for(const e of t.stretchpitcher.keys())t.stretchpitcher.get(e).close();t.stretchpitcher.clear()}t.outPCMBuffer&&((0,y.aI)(t.outPCMBuffer.data),(0,y.aI)(t.outPCMBuffer[s.o9]),(0,l.A)(t.outPCMBuffer)),t.waitPCMBuffer&&(t.waitAVFrame&&(c.M[20](t.waitPCMBuffer,0),c.M[15](t.waitPCMBuffer+12,0),t.avframePool.release(t.waitAVFrame),t.waitAVFrame=0),this.avPCMBufferPool.release(t.waitPCMBuffer),t.waitPCMBuffer=0),t.paddingAVFrame&&t.avframePool.release(t.paddingAVFrame),t.leftIPCPort&&(t.leftIPCPort.destroy(),t.leftIPCPort=null),t.rightIPCPort&&(t.rightIPCPort.destroy(),t.rightIPCPort=null),t.controlIPCPort&&(t.controlIPCPort.destroy(),t.controlIPCPort=null),this.tasks.delete(e),w.Yz(`unregisterTask task, taskId: ${e}`,B,1114)}}async clear(){await super.clear(),this.avPCMBufferList.clear((e=>{d.f[20](e)&&((0,y.aI)(d.f[20](e)),(0,y.aI)(e))}),20),(0,l.A)(this.avPCMBufferList),(0,l.A)(this.avPCMBufferListMutex)}}},30131:(e,t,i)=>{i.d(t,{A:()=>V});var r=i(75354),s=i(54911),a=i(75589),o=i(42524),n=i(77389),h=i(31184),d=i(47378),c=i(83496),l=i(7615),u=i(93393),f=i(10567),p=i(30027),m=i(1818),g=i(91278),A=i(61556),v=i(73872),y=i(17635),b=i(53773),k=i(41863),w=i(75176),x=i(2198),T=i(81819),I=i(24788),_=i(87339),P=i(47845),M=i(17630),S=i(29592),C=i(31616),R=i(28032),B=i(39753),D=i(85266),E=i(20352),U=i(33272),L=i(57470);const $="packages/avpipeline/src/DemuxPipeline.ts",F=-1;class V extends L.A{constructor(){super()}createTask(e){let t,i;if(e.mainTaskId){const r=this.tasks.get(e.mainTaskId);t=r.leftIPCPort,i=r.controlIPCPort}else t=new D.Ay(e.leftPort),e.controlPort&&(i=new D.Ay(e.controlPort));const r=e.bufferLength||1048576,o=(0,h.sY)(r);if(!o)return d.gR;const n=(0,h.sY)(r);if(!n)return d.gR;const u=new b.A(o,r),f=new C.A(r,!0,u),p=new b.A(n,r),m=new R.A(r,!0,p);e.isLive||(f.flags|=1),e.flags&&(f.flags|=e.flags),f.onFlush=async i=>{const r={pointer:i.byteOffset,length:i.length};e.ioloaderOptions&&(r.ioloaderOptions=e.ioloaderOptions);try{const e=await t.request("read",r);return T.ai(e)?e:((0,k.lW)(r.pointer,e.length,e),e.length)}catch(e){return-1048574}},f.onSeek=async i=>{try{const r={pos:i};return e.ioloaderOptions&&(r.ioloaderOptions=e.ioloaderOptions),t.request("seek",r)}catch(e){return-1048574}},f.onSize=async()=>{try{return t.request("size")}catch(e){return BigInt(-1048574)}},m.onFlush=async e=>{const i={pointer:e.byteOffset,length:e.length};try{return await t.request("write",i)}catch(e){return-1048574}};const g=(0,E.Xv)();return g.ioReader=f,g.ioWriter=m,I.A.wasmBaseSupported&&(g.getDecoderResource=async(e,t)=>{if(!i)return;const r=await i.request("getDecoderResource",{codecId:t,mediaType:e});return(0,c.A)(r,0===e)}),this.tasks.set(e.taskId,{...e,leftIPCPort:t,rightIPCPorts:new Map,controlIPCPort:i,formatContext:g,ioReader:f,iBuffer:o,oBuffer:n,cacheAVPackets:new Map,cacheRequests:new Map,streamIndexFlush:new Map,pendingAVPackets:new Map,realFormat:-1,demuxEnded:!1,loop:null,gopCounter:0,lastKeyFramePts:BigInt(0),lastAudioDts:BigInt(0),lastVideoDts:BigInt(0),avpacketPool:new l.A((0,a.A)(e.avpacketList,s.A),e.avpacketListMutex)}),0}async openStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;const r=this.tasks.get(e);if(r){let e,s,a=await r.leftIPCPort.request("open");if(a<0)return _.z3(`open ioloader failed, ret: ${a}`,$,344),a;try{6!==r.format?(e=await(0,u.A)(r.ioReader,r.format),r.format=e):e=r.format}catch(e){return d.LR}switch(e){case 0:s=new((await Promise.all([i.e(475),i.e(535)]).then(i.bind(i,66584))).default)(r.formatOptions);break;case 1:s=new((await Promise.all([i.e(945),i.e(171)]).then(i.bind(i,73012))).default)(r.formatOptions);break;case 2:s=new((await Promise.all([i.e(274),i.e(240)]).then(i.bind(i,63240))).default);break;case 3:s=new((await Promise.all([i.e(274),i.e(628)]).then(i.bind(i,68628))).default);break;case 5:s=new((await i.e(567).then(i.bind(i,89567))).default);break;case 4:s=new((await Promise.all([i.e(559),i.e(259)]).then(i.bind(i,67259))).default);break;case 14:s=new((await i.e(620).then(i.bind(i,25014))).default);break;case 8:case 9:s=new((await i.e(153).then(i.bind(i,13474))).default);break;case 15:s=new((await i.e(473).then(i.bind(i,37607))).default);break;case 17:s=new((await Promise.all([i.e(559),i.e(976)]).then(i.bind(i,22634))).default);break;case 16:s=new((await Promise.all([i.e(965),i.e(964)]).then(i.bind(i,21358))).default);break;case 18:s=new((await i.e(820).then(i.bind(i,97820))).default);break;case 19:s=new((await i.e(961).then(i.bind(i,64961))).default);break;case 20:s=new((await i.e(41).then(i.bind(i,69041))).default);break;case 21:s=new((await i.e(653).then(i.bind(i,12653))).default);break;case 11:s=new((await i.e(4).then(i.bind(i,91004))).default)(r.formatOptions);break;case 12:s=new((await i.e(296).then(i.bind(i,10296))).default)(r.formatOptions);break;case 13:s=new((await i.e(105).then(i.bind(i,91105))).default)(r.formatOptions);break;case 6:s=new((await i.e(953).then(i.bind(i,13953))).default)(r.formatOptions);break;case 10:s=new((await Promise.all([i.e(965),i.e(405)]).then(i.bind(i,61094))).default)(r.formatOptions);break;default:return _.z3("format not support",$,547),d.E$}return r.realFormat=e,r.formatContext.iformat=s,U.ho(r.formatContext,{maxAnalyzeDuration:t,fastOpen:r.isLive})}_.h2("task not found",$,562)}async getFormat(e){const t=this.tasks.get(e);if(t)return t.realFormat;_.h2("task not found",$,572)}async analyzeStreams(e){const t=this.tasks.get(e);if(t){let e=await U.Ib(t.formatContext);if(e)return e;const i=[],s=[];for(let e=0;e<t.formatContext.streams.length;e++){const s=t.formatContext.streams[e];i.push({index:s.index,id:s.id,codecpar:s.codecpar[r.o9],nbFrames:s.nbFrames,metadata:s.metadata,duration:s.duration,startTime:s.startTime,disposition:s.disposition,timeBase:{den:s.timeBase.den,num:s.timeBase.num},attachedPic:s.attachedPic})}for(let e=0;e<t.formatContext.streamGroups.length;e++){const r=t.formatContext.streamGroups[e];s.push({index:r.index,id:r.id,type:r.type,params:r.params,metadata:r.metadata,disposition:r.disposition,streams:r.streams.map((e=>i.find((t=>t.id===e.id))))})}return{metadata:t.formatContext.metadata,format:t.realFormat,chapters:t.formatContext.chapters,streams:i,streamGroups:s}}_.h2("task not found",$,629)}replyAVPacket(e,t,i,r){if((0,P.A)()&&!w.USE_THREADS&&(0,x.A)(r)){const s=(0,f.wm)(r),a=[s.data.buffer];return s.sideData.length&&s.sideData.forEach((e=>{a.push(e.data.buffer)})),t.reply(i,s,null,a),void e.avpacketPool.release(r)}t.reply(i,r)}async connectStreamTask(e,t,i){const r=this.tasks.get(e);if(r){const e=new D.Ay(i);r.cacheAVPackets.set(t,[]),e.streamIndex=t,e.on(D.S3,(async t=>{switch(t.method){case"pull":{const i=r.cacheAVPackets.get(e.streamIndex);if(i.length){const s=i.shift();0!==r.stats&&s>0&&(1===r.formatContext.streams[o.f[15](s+32)].codecpar.codecType?n.M[15](r.stats+32,o.f[15](r.stats+32)-1):0===r.formatContext.streams[o.f[15](s+32)].codecpar.codecType&&n.M[15](r.stats+120,o.f[15](r.stats+120)-1)),this.replyAVPacket(r,e,t,s)}else r.demuxEnded?e.reply(t,-1048576):(r.cacheRequests.set(e.streamIndex,t),r.loop&&r.loop.isStarted()&&r.loop.resetInterval());break}}})),r.rightIPCPorts.set(t,e),_.Yz(`connect stream ${t}, taskId: ${r.taskId}`,$,690)}else _.h2("task not found",$,693)}async addPendingStream(e,t){const i=this.tasks.get(e);i?i.pendingAVPackets.set(t,[]):_.h2("task not found",$,703)}async changeConnectStream(e,t,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=this.tasks.get(e);if(a){if(t===i)return;let e=a.cacheAVPackets.get(i);const o=a.rightIPCPorts.get(i),h=a.cacheRequests.get(i);e||_.R8(`oldStreamIndex ${i} not found`,$,720),await a.loop.stopBeforeNextTick(),r?a.pendingAVPackets.has(t)||(M.__(e,(e=>{a.avpacketPool.release(e)})),e.length=0):a.streamIndexFlush.set(t,!0),a.pendingAVPackets.has(t)&&(a.pendingAVPackets.set(i,e),e=a.pendingAVPackets.get(t),a.pendingAVPackets.delete(t)),1===a.formatContext.streams[t].codecpar.codecType?n.M[15](a.stats+32,e.length):0===a.formatContext.streams[t].codecpar.codecType&&n.M[15](a.stats+120,e.length),o.streamIndex=t,a.cacheAVPackets.set(t,e),a.rightIPCPorts.set(t,o),a.cacheAVPackets.delete(i),a.rightIPCPorts.delete(i),h&&(a.cacheRequests.set(t,h),a.cacheRequests.delete(i)),r&&!s||a.loop.start(),_.Yz(`changed connect stream, new ${t}, old: ${i}, force: ${r}, taskId: ${a.taskId}`,$,766)}else _.h2("task not found",$,769)}async doDemux(e,t){const i=e.avpacketPool.alloc();let r=await U.Cj(e.formatContext,i);if(r){e.avpacketPool.release(i),-1048576!==r&&-1048572!==r&&(e.controlIPCPort.notify("demuxError",{code:r}),_.z3(`demux error, ret: ${r}, taskId: ${e.taskId}`,$,929));for(let t of e.cacheRequests.keys())e.cacheAVPackets.get(t).length||(e.rightIPCPorts.get(t).reply(e.cacheRequests.get(t),-1048576),e.cacheRequests.delete(t))}else{const r=o.f[15](i+32);if(0!==e.stats)if(1===e.formatContext.streams[r].codecpar.codecType&&e.cacheAVPackets.has(r)){if(n.M[17](e.stats+24,o.f[17](e.stats+24)+BigInt(1)),n.M[17](e.stats+16,o.f[17](e.stats+16)+BigInt(0|o.f[15](i+28))),o.f[17](e.stats+24)>1&&o.f[17](i+16)>e.lastAudioDts){const t=e.cacheAVPackets.get(r);t&&t.length?n.M[15](e.stats+244,Math.round(o.f[15](i+76)/o.f[15](i+72)/(Number(BigInt.asIntN(32,o.f[17](i+16)-o.f[17](t[0]+16)))/t.length))):n.M[15](e.stats+244,Math.round(o.f[15](i+76)/o.f[15](i+72)/Number(BigInt.asIntN(32,o.f[17](i+16)-e.lastAudioDts))))}e.lastAudioDts=o.f[17](i+16)}else if(0===e.formatContext.streams[r].codecpar.codecType&&e.cacheAVPackets.has(r)){if(n.M[17](e.stats+112,o.f[17](e.stats+112)+BigInt(1)),n.M[17](e.stats+104,o.f[17](e.stats+104)+BigInt(0|o.f[15](i+28))),1&o.f[15](i+36)?(n.M[17](e.stats+176,o.f[17](e.stats+176)+BigInt(1)),o.f[17](e.stats+176)>1&&o.f[17](i+8)>e.lastKeyFramePts&&(n.M[15](e.stats+96,e.gopCounter),e.gopCounter=1,n.M[15](e.stats+92,Number(BigInt.asIntN(32,(0,p.Mr)(o.f[17](i+8)-e.lastKeyFramePts,i+72,g.i0))))),e.lastKeyFramePts=o.f[17](i+8)):e.gopCounter++,o.f[17](e.stats+112)>1&&o.f[17](i+16)>e.lastVideoDts){const t=e.cacheAVPackets.get(r);t&&t.length?n.M[15](e.stats+232,Math.round(o.f[15](i+76)/o.f[15](i+72)/(Number(BigInt.asIntN(32,o.f[17](i+16)-o.f[17](t[0]+16)))/t.length))):n.M[15](e.stats+232,Math.round(o.f[15](i+76)/o.f[15](i+72)/Number(BigInt.asIntN(32,o.f[17](i+16)-e.lastVideoDts))))}e.lastVideoDts=o.f[17](i+16)}if(e.streamIndexFlush.get(r)){const t=e.formatContext.streams.find((e=>e.index===r));if(!(0,m.rU)(i,1)&&t&&t.codecpar.extradataSize){const e=(0,h.sY)(t.codecpar.extradataSize);(0,k.Mr)(e,t.codecpar.extradata,t.codecpar.extradataSize),(0,m.Ow)(i,1,e,t.codecpar.extradataSize)}e.streamIndexFlush.set(r,!1)}if(e.cacheRequests.has(r))this.replyAVPacket(e,e.rightIPCPorts.get(r),e.cacheRequests.get(r),i),e.cacheRequests.delete(r);else if(e.cacheAVPackets.has(r))e.cacheAVPackets.get(r).push(i),0!==e.stats&&(1===e.formatContext.streams[r].codecpar.codecType?n.M[15](e.stats+32,o.f[15](e.stats+32)+1):0===e.formatContext.streams[r].codecpar.codecType&&n.M[15](e.stats+120,o.f[15](e.stats+120)+1)),3===e.formatContext.streams[r].codecpar.codecType&&e.cacheAVPackets.get(r).length>t&&e.avpacketPool.release(e.cacheAVPackets.get(r).shift());else if(e.pendingAVPackets.has(r)){const s=e.pendingAVPackets.get(r);if(s.push(i),0!==e.stats){const i=e.formatContext.streams[r].codecpar.codecType;for(;s.length;){const r=s[0],a=(0,p.Mr)(o.f[17](r+8),r+72,g.i0),n=S.T9(o.f[17](e.stats+328),o.f[17](e.stats+336));if(1===i&&a>=n||0===i&&a>=n||1!==i&&0!==i&&s.length<=t)break;e.avpacketPool.release(s.shift())}}else s.length>t&&e.avpacketPool.release(s.shift())}else e.rightIPCPorts.has(F)?e.cacheRequests.has(F)?(this.replyAVPacket(e,e.rightIPCPorts.get(F),e.cacheRequests.get(F),i),e.cacheRequests.delete(F)):e.cacheAVPackets.get(F).push(i):e.avpacketPool.release(i)}return r}doAttachedPicture(e){e.cacheAVPackets.forEach(((t,i)=>{const r=e.formatContext.streams.find((e=>e.index===i));if(1024&r.disposition&&r.attachedPic){const i=e.avpacketPool.alloc();(0,m.rN)(i,r.attachedPic),t.push(i),t.push(-1048576),0!==e.stats&&n.M[15](e.stats+120,1)}}))}async startDemux(e,t,i){const r=this.tasks.get(e);if(r){if(i=Math.max(i,2===r.format?20:10),r.loop&&r.loop.destroy(),r.loop=new B.A((async()=>{if(!t){let e=!1,t=!1;if(r.cacheAVPackets.forEach(((s,a)=>{const o=r.formatContext.streams.find((e=>e.index===a));s.length<i&&(3!==o.codecpar.codecType&&!(1024&o.disposition)||1===r.cacheAVPackets.size)&&(e=!0),s.length>Math.max(2*i,5e3)&&(t=!0)})),!e||t)return void r.loop.emptyTask()}await this.doDemux(r,i)&&(r.demuxEnded=!0,_.pq(`demuxer ended, taskId: ${r.taskId}`,$,998),r.loop.stop())}),0,0,!0,!1),t&&r.cacheAVPackets.size)for(;;){let e=!1;if(r.cacheAVPackets.forEach(((t,r)=>{t.length>=i&&(e=!0)})),e)break;if(await this.doDemux(r,i))return void(r.demuxEnded=!0)}this.doAttachedPicture(r),r.loop.start(),_.Yz(`start demux loop, taskId: ${r.taskId}`,$,1028)}else _.h2("task not found",$,1031)}async seek(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;const s=this.tasks.get(e);if(s){if(s.loop){await s.loop.stopBeforeNextTick();let a=await U.jF(s.formatContext,r,t,i);if(a>=BigInt(0)){function h(e){M.__(e,(e=>{if(2&s.formatContext.ioReader.flags){const t=(0,m.rU)(e,1),i=s.formatContext.streams[o.f[15](e+32)];!i.sideData[1]&&t&&(i.sideData[1]=(0,k.s3)(o.f[20](t),o.f[25](t+4)).slice())}s.avpacketPool.release(e)})),e.length=0}s.cacheAVPackets.forEach(h),s.pendingAVPackets.forEach(h),0!==s.stats&&s.cacheAVPackets.forEach(((e,t)=>{const i=s.formatContext.streams.find((e=>e.index===t));1===i.codecpar.codecType?n.M[15](s.stats+32,0):0===i.codecpar.codecType&&n.M[15](s.stats+120,0)}));const d=s.avpacketPool.alloc();for(;a=await U.Cj(s.formatContext,d),!(a<0||s.cacheAVPackets.has(o.f[15](d+32))););if(a>=0){s.demuxEnded=!1;const c=o.f[15](d+32);return s.cacheAVPackets.get(c).push(d),0!==s.stats&&(1===s.formatContext.streams[o.f[15](d+32)].codecpar.codecType?n.M[15](s.stats+32,o.f[15](s.stats+32)+1):0===s.formatContext.streams[o.f[15](d+32)].codecpar.codecType&&n.M[15](s.stats+120,o.f[15](s.stats+120)+1)),this.doAttachedPicture(s),s.loop.start(),(0,p.Mr)(S.T9(o.f[17](d+8),BigInt(0)),d+72,g.i0)}return _.R8(`got first packet failed after seek, taskId: ${s.taskId}`,$,1102),s.avpacketPool.release(d),s.demuxEnded=!0,t}return s.loop.start(),a}{_.pq("seek before demux loop start",$,1116);let l=await U.jF(s.formatContext,-1,t,i);return l<0?l:t}}}async croppingAVPacketQueue(e,t){const i=this.tasks.get(e);if(i){let r=t;const s=new Map;function a(e,t){if(!(1&o.f[15](e+36)))return!1;let i=0!==(0,m.rU)(e,1);return!i&&64&o.f[15](e+36)&&(27===t?i=!!A.sL((0,m.iI)(e)):173===t?i=!!v.sL((0,m.iI)(e)):196===t&&(i=!!y.sL((0,m.iI)(e)))),i}const h=new Map;i.cacheAVPackets.forEach(((e,t)=>{h.set(t,e)})),i.pendingAVPackets.forEach(((e,t)=>{h.set(t,e)})),h.forEach(((e,n)=>{const h=i.formatContext.streams[n].codecpar.codecType,d=i.formatContext.streams[n].codecpar.codecId;if(0===h){const i=o.f[17](e[e.length-1]+16);let h=e.length-2;for(h=e.length-2;h>=0;h--)if(1&o.f[15](e[h]+36)&&(0,p.Mr)(i-o.f[17](e[h]+16),e[h]+72,g.i0)>=t){r=S.T9(r,(0,p.Mr)(i-o.f[17](e[h]+16),e[h]+72,g.i0));break}if((27===d||173===d||196===d)&&h>0&&!a(e[h],d))for(let t=h-1;t>0;t--)if(1&o.f[15](e[t]+36)&&a(e[t],d)){r=S.T9(r,(0,p.Mr)(i-o.f[17](e[t]+16),e[t]+72,g.i0)),h=t;break}h>0&&s.set(n,h)}})),h.forEach(((e,t)=>{if(0!==i.formatContext.streams[t].codecpar.codecType){const i=o.f[17](e[e.length-1]+16);let a=e.length-2;for(a=e.length-2;a>=0&&!((0,p.Mr)(i-o.f[17](e[a]+16),e[a]+72,g.i0)>=r);a--);a>=0&&s.set(t,a)}})),s.size===h.size&&s.forEach(((e,t)=>{const r=h.get(t);r.splice(0,e).forEach((e=>{i.avpacketPool.release(e)}));const s=i.formatContext.streams[t].codecpar.codecType;0!==i.stats&&(1===s?n.M[15](i.stats+32,r.length):0===s&&n.M[15](i.stats+120,r.length))}))}}async setAVStreamDiscard(e,t,i){const r=this.tasks.get(e);if(r){const e=r.formatContext.getStreamByIndex(t);e&&(e.discard=i)}}async stop(e){const t=this.tasks.get(e);t&&(t.formatContext.ioReader.flags|=8)}async registerTask(e){return this.tasks.has(e.taskId)?d.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(t.ioReader&&4&t.ioReader.flags&&t.ioReader.abort(),t.loop&&(await t.loop.stopBeforeNextTick(),t.loop.destroy()),t.cacheAVPackets.forEach((e=>{e.forEach((e=>{t.avpacketPool.release(e)}))})),t.pendingAVPackets.forEach((e=>{e.forEach((e=>{t.avpacketPool.release(e)}))})),t.cacheRequests.forEach(((e,i)=>{t.rightIPCPorts.get(i).reply(e,-1048576)})),t.cacheRequests.clear(),await t.formatContext.destroy(),t.mainTaskId||(t.leftIPCPort.destroy(),t.controlIPCPort&&t.controlIPCPort.destroy()),t.rightIPCPorts.forEach((e=>{e.destroy()})),t.rightIPCPorts.clear(),t.iBuffer&&((0,h.Eb)(t.iBuffer),t.iBuffer=0),t.oBuffer&&((0,h.Eb)(t.oBuffer),t.oBuffer=0),this.tasks.delete(e),_.Yz(`unregisterTask task, taskId: ${e}`,$,1320))}}},24482:(e,t,i)=>{i.d(t,{A:()=>m});var r=i(42524),s=i(77389),a=i(41863),o=i(87339),n=i(85266),h=i(39989),d=i(44397),c=i(70178),l=i(84220),u=i(47378),f=i(57470);const p="packages/avpipeline/src/IOPipeline.ts";class m extends f.A{constructor(){super()}async createTask(e){let t;switch(e.type){case 0:t=new h.A(e.options);break;case 1:t=new d.A(e.options);break;case 2:t=new c.A(e.options);break;case 3:t=new l.A(e.options);break;case 4:t=new((await i.e(716).then(i.bind(i,90508))).default)(e.options);break;case 5:t=new((await i.e(427).then(i.bind(i,29427))).default)(e.options);break;case 6:t=new((await Promise.all([i.e(475),i.e(981)]).then(i.bind(i,61028))).default)(e.options)}if(!t)return u.UY;const f=new n.Ay(e.rightPort),m={...e,ioLoader:t,ipcPort:f};return f.on(n.S3,(async i=>{switch(i.method){case"open":try{const r=await t.open(e.info,e.range);if(r<0){o.z3(`loader open error, ${r}, taskId: ${e.taskId}`,p,148),f.reply(i,null,r);break}f.reply(i,r)}catch(t){o.z3(`loader open error, ${t}, taskId: ${e.taskId}`,p,155),f.reply(i,null,t)}break;case"read":{const n=i.params.pointer,h=i.params.length,d=i.params.ioloaderOptions,c=(0,a.JW)(n,h);try{const e=await t.read(c,d);s.M[17](m.stats+192,r.f[17](m.stats+192)+BigInt(0|e)),f.reply(i,e)}catch(t){if(!this.tasks.has(e.taskId))return;o.z3(`loader read error, ${t}, taskId: ${e.taskId}`,p,179),f.reply(i,u.LR)}break}case"write":{const n=i.params.pointer,h=i.params.length,d=(0,a.JW)(n,h);try{const e=await t.write(d);s.M[17](m.stats+200,r.f[17](m.stats+200)+BigInt(0|h)),f.reply(i,e)}catch(t){o.z3(`loader write error, ${t}, taskId: ${e.taskId}`,p,201),f.reply(i,u.LR)}break}case"seek":{const r=i.params.pos,s=i.params.ioloaderOptions;try{const a=await t.seek(r,s);if(a<0){o.z3(`loader seek error, ${a}, taskId: ${e.taskId}`,p,217),f.reply(i,null,a);break}f.reply(i,a)}catch(t){o.z3(`loader seek error, ${t}, taskId: ${e.taskId}`,p,224),f.reply(i,null,t)}break}case"size":f.reply(i,await t.size())}})),this.tasks.set(e.taskId,m),0}async open(e){const t=this.tasks.get(e);if(t)return await t.ioLoader.open(t.info,t.range),0}async getDuration(e){const t=this.tasks.get(e);if(t)return 4===t.type||5===t.type?t.ioLoader.getDuration():0}async hasAudio(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.hasAudio();if(4===t.type)return t.ioLoader.hasAudio()}return!1}async hasVideo(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.hasVideo();if(4===t.type)return t.ioLoader.hasVideo()}return!1}async hasSubtitle(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.hasSubtitle();if(4===t.type)return t.ioLoader.hasSubtitle()}return!1}async getVideoList(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.getVideoList();if(4===t.type)return t.ioLoader.getVideoList()}return{list:[],selectedIndex:0}}async getAudioList(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.getAudioList();if(4===t.type)return t.ioLoader.getAudioList()}return{list:[],selectedIndex:0}}async getSubtitleList(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.getSubtitleList();if(4===t.type)return t.ioLoader.getSubtitleList()}return{list:[],selectedIndex:0}}async selectVideo(e,t){const i=this.tasks.get(e);if(i){if(5===i.type)return i.ioLoader.selectVideo(t);if(4===i.type)return i.ioLoader.selectVideo(t)}}async selectAudio(e,t){const i=this.tasks.get(e);if(i){if(5===i.type)return i.ioLoader.selectAudio(t);if(4===i.type)return i.ioLoader.selectAudio(t)}}async selectSubtitle(e,t){const i=this.tasks.get(e);if(i){if(5===i.type)return i.ioLoader.selectSubtitle(t);if(4===i.type)return i.ioLoader.selectSubtitle(t)}}async getCurrentProtection(e,t){const i=this.tasks.get(e);if(i&&5===i.type)return i.ioLoader.getCurrentProtection(t)}async getMinBuffer(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.getMinBuffer();if(4===t.type)return t.ioLoader.getMinBuffer()}return 0}async setStart(e,t){const i=this.tasks.get(e);return i&&4===i.type?i.ioLoader.setStart(t):0}async registerTask(e){return this.tasks.has(e.taskId)?u.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(await t.ioLoader.stop().catch((e=>{o.R8(`stop ioloader error: ${e}, we will ignore it`,p,454)})),t.ipcPort.destroy(),this.tasks.delete(e),o.Yz(`unregisterTask task, taskId: ${e}`,p,458))}}},57470:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(87339);class a{constructor(){(0,r.A)(this,"tasks",void 0),this.tasks=new Map}async clear(){if(this.tasks.size)for(const e of this.tasks.keys())await this.unregisterTask(e)}async setLogLevel(e){s.V$(e)}async getTaskCount(){return this.tasks.size}}},79893:(e,t,i)=>{i.d(t,{A:()=>$});var r=i(42524),s=i(77389),a=i(54911),o=i(75589),n=i(3912),h=i(85266),d=i(91278),c=i(10567),l=i(62394),u=i(83496),f=i(7615),p=i(47378),m=i(43776),g=i(1818),A=i(31184),v=i(30027),y=i(62787),b=i(61556),k=i(73872),w=i(17635),x=i(2198),T=i(41863),I=i(87339),_=i(16563),P=i(81819),M=i(24788),S=i(47845),C=i(17630),R=i(88583),B=i(40852),D=i(84804),E=i(57470),U=i(13900);const L="packages/avpipeline/src/VideoDecodePipeline.ts";class $ extends E.A{constructor(){super()}createWebCodecDecoder(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new B.A({onError:t=>{e.hardwareRetryCount>3||!e.firstDecoded?e.targetDecoder===e.hardwareDecoder?(e.targetDecoder=e.softwareDecoder,e.hardwareDecoder.close(),e.hardwareDecoder=null,e.decoderFallbackReady=this.openSoftwareDecoder(e),I.R8(`video decode error by hardware decoder(${e.hardwareRetryCount}), taskId: ${e.taskId}, error: ${t}, try to fallback to software decoder`,L,176)):e.targetDecoder===e.softwareDecoder&&(e.softwareDecoder.close(),e.softwareDecoder=this.createWasmcodecDecoder(e,e.resource),e.softwareDecoderOpened=!1,e.decoderFallbackReady=this.openSoftwareDecoder(e),I.R8(`video decode error by software(webcodecs) decoder(${e.hardwareRetryCount}), taskId: ${e.taskId}, error: ${t}, try to fallback to software(wasm) decoder`,L,183)):(e.hardwareRetryCount++,e.targetDecoder===e.hardwareDecoder?(I.pq(`retry open hardware decoder(${e.hardwareRetryCount}), taskId: ${e.taskId}`,L,189),e.decoderFallbackReady=e.hardwareDecoder.open(e.parameters)):e.targetDecoder===e.softwareDecoder&&(I.pq(`retry open software(webcodecs) decoder(${e.hardwareRetryCount}), taskId: ${e.taskId}`,L,193),e.decoderFallbackReady=e.softwareDecoder.open(e.parameters))),e.needKeyFrame=!0,e.leftIPCPort.request("requestKeyframe")},onReceiveVideoFrame(t,i){i&&(t.alpha=i),e.firstDecoded=!0,e.frameCaches.push(t),s.M[17](e.stats+144,r.f[17](e.stats+144)+BigInt(1)),e.lastDecodeTimestamp!==d.N_&&(s.M[15](e.stats+256,Math.max((0,_.A)()-e.lastDecodeTimestamp,r.f[15](e.stats+256))),e.lastDecodeTimestamp=d.N_)},enableHardwareAcceleration:t,optimizeForLatency:e.preferLatency,alpha:e.keepAlpha?"keep":"discard"})}createWasmcodecDecoder(e,t){return new D.A({resource:t,onReceiveAVFrame(t){e.firstDecoded=!0,e.frameCaches.push(t),s.M[17](e.stats+144,r.f[17](e.stats+144)+BigInt(1)),e.lastDecodeTimestamp!==d.N_&&(s.M[15](e.stats+256,Math.max((0,_.A)()-e.lastDecodeTimestamp,r.f[15](e.stats+256))),e.lastDecodeTimestamp=d.N_)},avframePool:e.avframePool})}async pullAVPacketInternal(e,t){const i=await t.request("pull");if(P.ai(i)||(0,x.A)(i))return i;{const t=e.avpacketPool.alloc();return(0,c.r0)(i,t),t}}async createTask(e){const t=new h.Ay(e.leftPort),i=new h.Ay(e.rightPort),n=[],c=new l.A((0,o.A)(e.avframeList,a.A),e.avframeListMutex),v={...e,resource:await(0,u.A)(e.resource,!0),leftIPCPort:t,rightIPCPort:i,softwareDecoder:null,hardwareDecoder:null,frameCaches:n,inputEnd:!1,targetDecoder:null,needKeyFrame:!0,parameters:0,hardwareRetryCount:0,lastDecodeTimestamp:0,firstDecoded:!1,decoderFallbackReady:null,softwareDecoderOpened:!1,discard:0,playRate:1,avframePool:c,avpacketPool:new f.A((0,o.A)(e.avpacketList,a.A),e.avpacketListMutex)};if(v.softwareDecoder=v.resource?this.createWasmcodecDecoder(v,v.resource):M.A.videoDecoder?this.createWebCodecDecoder(v,!1):null,!v.softwareDecoder)return I.z3("software decoder not support",L,292),p.lh;function y(e,t){P.ai(t)||(0,x.A)(t)?i.reply(e,t):(0,U.z)(t)?i.reply(e,{ref:t,alpha:t.alpha},null,[t,t.alpha]):i.reply(e,t,null,[t])}return M.A.videoDecoder&&e.enableHardware&&(v.hardwareDecoder=this.createWebCodecDecoder(v)),v.targetDecoder=v.hardwareDecoder||v.softwareDecoder,this.tasks.set(e.taskId,v),i.on(h.S3,(async a=>{switch(a.method){case"pull":if(n.length){y(a,n.shift());break}if(!v.inputEnd){for(;;){if(n.length){y(a,n.shift());break}if(v.decoderFallbackReady){let e=await v.decoderFallbackReady;if(e&&(v.targetDecoder===v.hardwareDecoder&&(v.targetDecoder=v.softwareDecoder,v.hardwareDecoder.close(),v.hardwareDecoder=null,I.R8(`video decode error by hardware decoder(${v.hardwareRetryCount}), taskId: ${v.taskId}, error: ${e}, try to fallback to software decoder`,L,337),e=await this.openSoftwareDecoder(v)),e)){I.pq(`video decoder open error, taskId: ${v.taskId}`,L,341),i.reply(a,p.r8);break}v.decoderFallbackReady=null}v.lastDecodeTimestamp===d.N_&&(v.lastDecodeTimestamp=(0,_.A)());const o=await this.pullAVPacketInternal(v,t);if(-1048576===o){if(v.targetDecoder===v.hardwareDecoder?await Promise.race([new R.A(2),v.targetDecoder.flush()])&&I.R8(`video hardware decoder flush failed, ignore it, taskId: ${v.taskId}`,L,361):await v.targetDecoder.flush(),v.inputEnd=!0,v.targetDecoder===v.hardwareDecoder&&await new R.A(0),n.length){y(a,n.shift());break}I.pq(`video decoder ended, taskId: ${v.taskId}`,L,377),i.reply(a,-1048576);break}if(!(o>0)){I.z3(`video decode pull avpacket error, taskId: ${e.taskId}, ret: ${o}`,L,522),i.reply(a,o);break}{if(v.needKeyFrame){if(!(1&r.f[15](o+36)&&27!==r.f[15](v.parameters+4)||27===r.f[15](v.parameters+4)&&b.mW(o,r.f[20](v.parameters+12)?1+(3&m.r8(r.f[20](v.parameters+12)+4)):4)||173===r.f[15](v.parameters+4)&&k.mW(o,r.f[20](v.parameters+12)?1+(3&m.r8(r.f[20](v.parameters+12)+21)):4)||196===r.f[15](v.parameters+4)&&w.mW(o,r.f[20](v.parameters+12)?1+(m.r8(r.f[20](v.parameters+12))>>>1&3):4))){v.avpacketPool.release(o);continue}v.needKeyFrame=!1,s.M[15](o+36,1|r.f[15](o+36))}let t=v.targetDecoder.decode(o);if(1&r.f[15](o+36)){const e=(0,g.rU)(o,1);0!==e&&(r.f[20](v.parameters+12)&&(0,A.Eb)(r.f[20](v.parameters+12)),s.M[15](v.parameters+16,0|r.f[25](e+4)),s.M[20](v.parameters+12,(0,A.sY)(r.f[25](e+4))),(0,T.Mr)(r.f[20](v.parameters+12),r.f[20](e),r.f[25](e+4)))}if(t<0){if(s.M[15](v.stats+136,r.f[15](v.stats+136)+1),v.targetDecoder instanceof B.A&&v.softwareDecoder){if(I.R8(`video decode error from hardware, taskId: ${v.taskId}, error: ${t}, try to fallback to software decoder`,L,443),v.targetDecoder===v.hardwareDecoder)v.hardwareDecoder.close(),v.hardwareDecoder=null;else{if(!v.resource){I.z3(`cannot fallback to wasm video decoder because of resource not found , taskId: ${e.taskId}`,L,455),i.reply(a,p.r8);break}v.softwareDecoder.close(),v.softwareDecoder=this.createWasmcodecDecoder(v,v.resource),v.softwareDecoderOpened=!1}try{await this.openSoftwareDecoder(v),v.targetDecoder=v.softwareDecoder}catch(t){I.z3(`video software decoder open error, taskId: ${e.taskId}`,L,465),i.reply(a,p.r8);break}if(!(1&r.f[15](o+36))){v.avpacketPool.release(o),v.needKeyFrame=!0,v.leftIPCPort.request("requestKeyframe");continue}if(t=v.targetDecoder.decode(o),t>=0){v.avpacketPool.release(o);continue}if(v.targetDecoder instanceof B.A&&v.resource){I.R8(`video decode error by webcodecs soft decoder, taskId: ${v.taskId}, error: ${t}, try to fallback to wasm software decoder`,L,479),v.softwareDecoder.close(),v.softwareDecoder=this.createWasmcodecDecoder(v,v.resource),v.softwareDecoderOpened=!1;try{await this.openSoftwareDecoder(v),v.targetDecoder=v.softwareDecoder}catch(t){I.z3(`video wasm software decoder open error, taskId: ${e.taskId}`,L,489),i.reply(a,p.r8);break}if(t=v.targetDecoder.decode(o),t>=0){v.avpacketPool.release(o);continue}}}v.avpacketPool.release(o),I.z3(`video decode error, taskId: ${e.taskId}, ret: ${t}`,L,508),i.reply(a,t);break}for(v.avpacketPool.release(o);v.targetDecoder instanceof B.A&&v.targetDecoder.getQueueLength()>20;)await new R.A(0)}}break}I.pq(`video decoder ended, taskId: ${v.taskId}`,L,529),i.reply(a,-1048576)}})),0}async openSoftwareDecoder(e){if(e.softwareDecoder&&!e.softwareDecoderOpened){const t=e.parameters;let i=1;if((0,S.A)()){let e=r.f[15](t+56)*r.f[15](t+60),s=(0,v.lb)((0,o.A)(t+72,n.Q));e>=2073600&&e<=2211840?(173!==r.f[15](t+4)&&196!==r.f[15](t+4)&&225!==r.f[15](t+4)||(i=2),s>30?(i=2,173!==r.f[15](t+4)&&196!==r.f[15](t+4)&&225!==r.f[15](t+4)||(i=4)):s>60&&(i=4,173!==r.f[15](t+4)&&196!==r.f[15](t+4)&&225!==r.f[15](t+4)||(i=6))):e>2211840&&e<=8294400?(i=4,173!==r.f[15](t+4)&&196!==r.f[15](t+4)&&225!==r.f[15](t+4)||(i=6)):e>8294400&&(i=6,173!==r.f[15](t+4)&&196!==r.f[15](t+4)&&225!==r.f[15](t+4)||(i=8)),i=Math.min(i,navigator.hardwareConcurrency)}I.Yz(`open software(${e.softwareDecoder instanceof B.A?"webcodecs":"wasm"}) decoder`,L,594);let s=await e.softwareDecoder.open(t,i,e.wasmDecoderOptions);if(s){if(!(e.softwareDecoder instanceof B.A&&e.resource))return s;if(I.R8(`webcodecs software decoder open failed, ${s}, try to fallback to wasm software decoder`,L,600),e.softwareDecoder.close(),e.softwareDecoder=this.createWasmcodecDecoder(e,e.resource),s=await e.softwareDecoder.open(t,i),s)return s;e.targetDecoder=e.softwareDecoder}e.softwareDecoderOpened=!0}return 0}async reopenDecoder(e,t,i,r){const s=this.tasks.get(e);if(s){const e=(0,A.Gy)(168);let a;(0,x.A)(t)?(0,y.Yi)(e,t):(0,c.T8)(t,e),s.parameters&&(0,y.dn)(s.parameters),s.parameters=e,r&&(s.wasmDecoderOptions=r),i&&(i=await(0,u.A)(i,!0)),a=s.preferWebCodecs&&M.A.videoDecoder&&B.A.isSupported(e,!1)?this.createWebCodecDecoder(s,!1):i?this.createWasmcodecDecoder(s,i):M.A.videoDecoder?this.createWebCodecDecoder(s,!1):null;let o=M.A.videoDecoder&&s.enableHardware?this.createWebCodecDecoder(s,!0):null;return new Promise((async(t,r)=>{if(s.softwareDecoder&&s.softwareDecoder.close(),s.hardwareDecoder&&s.hardwareDecoder.close(),s.softwareDecoder=a,s.hardwareDecoder=o,s.targetDecoder=s.hardwareDecoder||s.softwareDecoder,s.hardwareRetryCount=0,s.hardwareDecoder){const t=await s.hardwareDecoder.open(e);t?(I.z3(`cannot reopen hardware decoder, ${t}, taskId: ${s.taskId}`,L,676),s.hardwareDecoder.close(),s.hardwareDecoder=null,s.targetDecoder=s.softwareDecoder):I.Yz(`reopen video hardware decoder, taskId: ${s.taskId}`,L,682)}if(i&&(s.resource=i),s.targetDecoder===s.softwareDecoder){const e=await this.openSoftwareDecoder(s);if(e){if(I.z3(`reopen video software decoder failed, error: ${e}`,L,693),!s.hardwareDecoder)return void t(p.r8)}else I.Yz(`reopen video soft decoder, taskId: ${s.taskId}`,L,700)}t(0)}))}I.h2("task not found",L,706)}async open(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=this.tasks.get(e);if(r){r.wasmDecoderOptions=i;const e=(0,A.Gy)(168);if((0,x.A)(t)?(0,y.Yi)(e,t):(0,c.T8)(t,e),r.parameters&&(0,y.dn)(r.parameters),r.parameters=e,r.preferWebCodecs&&M.A.videoDecoder&&B.A.isSupported(e,!1)&&r.softwareDecoder instanceof D.A){r.softwareDecoder.close();const e=this.createWebCodecDecoder(r,!1);r.softwareDecoder===r.targetDecoder&&(r.targetDecoder=e),r.softwareDecoder=e}return new Promise((async(t,i)=>{if(r.hardwareDecoder){I.Yz("open hardware decoder",L,741);const t=await r.hardwareDecoder.open(e);t&&(I.R8(`cannot open hardware decoder, ${t}, try to open software decoder`,L,744),r.hardwareDecoder.close(),r.hardwareDecoder=null,r.targetDecoder=r.softwareDecoder)}if(r.targetDecoder===r.softwareDecoder){const e=await this.openSoftwareDecoder(r);if(e&&(I.z3(`open video software decoder failed, error: ${e}`,L,754),!r.hardwareDecoder))return void t(p.r8)}t(0)}))}I.h2("task not found",L,764)}async setPlayRate(e,t){const i=this.tasks.get(e);if(i&&i.softwareDecoder){let e=0,r=(0,v.lb)((0,o.A)(i.parameters+72,n.Q));e=r>=120?t<=1?0:t<1.5||t<3?8:32:r>=60?t<1.5?0:t<3?8:t<8?24:32:t>=8?32:t>=4?24:0,i.softwareDecoder.setSkipFrameDiscard(e),i.playRate<t?i.discard=e:i.discard=Math.max(i.discard,e),i.playRate=t}}async setNextDiscard(e){const t=this.tasks.get(e);t&&t.softwareDecoder&&t.discard<32&&(t.discard+=8,t.softwareDecoder.setSkipFrameDiscard(t.discard),I.pq(`set next discard, taskId: ${t.taskId}, discard: ${t.discard}`,L,831))}async setPrevDiscard(e){const t=this.tasks.get(e);t&&t.softwareDecoder&&t.discard>0&&(t.discard-=8,t.softwareDecoder.setSkipFrameDiscard(t.discard),I.pq(`set prev discard, taskId: ${t.taskId}, discard: ${t.discard}`,L,843))}async resetTask(e){const t=this.tasks.get(e);t&&(t.targetDecoder===t.softwareDecoder?await t.targetDecoder.flush():t.targetDecoder===t.hardwareDecoder&&(t.hardwareDecoder.close(),t.hardwareDecoder=this.createWebCodecDecoder(t),await t.hardwareDecoder.open(t.parameters)&&I.h2("reopen hardware decoder failed",L,860),t.targetDecoder=t.hardwareDecoder),C.__(t.frameCaches,(e=>{(0,x.A)(e)?t.avframePool.release(e):(e.close(),(0,U.z)(e)&&e.alpha.close())})),t.frameCaches.length=0,t.needKeyFrame=!0,t.inputEnd=!1,t.lastDecodeTimestamp=(0,_.A)(),I.pq(`reset video decoder, taskId: ${t.taskId}`,L,880))}async registerTask(e){return this.tasks.has(e.taskId)?p.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(t.rightPort.close(),t.leftPort.close(),t.softwareDecoder&&t.softwareDecoder.close(),t.hardwareDecoder&&t.hardwareDecoder.close(),t.frameCaches.forEach((e=>{(0,x.A)(e)?t.avframePool.release(e):(e.close(),(0,U.z)(e)&&e.alpha.close())})),t.parameters&&(0,y.dn)(t.parameters),this.tasks.delete(e),I.Yz(`unregisterTask task, taskId: ${e}`,L,917))}async getTasksInfo(){const e=[];return this.tasks.forEach((t=>{e.push({codecId:r.f[15](t.parameters+4),width:r.f[15](t.parameters+56),height:r.f[15](t.parameters+60),framerate:(0,v.lb)((0,o.A)(t.parameters+72,n.Q)),hardware:t.targetDecoder===t.hardwareDecoder})})),e}}},57599:(e,t,i)=>{i.d(t,{A:()=>O});var r=i(54911),s=i(75589),a=i(42524),o=i(77389),n=i(85266),h=i(91278),d=i(62394),c=i(30027),l=i(47378),u=i(2198),f=i(17630),p=i(87339),m=i(81819),g=i(24788),A=i(71195),v=i(77969),y=i(47845),b=i(16563),k=i(29592),w=i(32347),x=i(10063),T=i(39753),I=i(63155),_=i(13700),P=i(30860),M=i(79053),S=i(92088),C=i(16115),R=i(6978),B=i(25e3),D=i(57470),E=i(13900);const U="packages/avpipeline/src/VideoRenderPipeline.ts",L=[I.A];L.push(_.A);const $=[P.A];var F;$.push(M.A),function(e){e[e.None=0]="None",e[e.Accelerate=1]="Accelerate",e[e.Decelerate=2]="Decelerate"}(F||(F={}));let V=!1;const N=["bt2020","bt2100","st2048","p3-dcl","hlg"];class O extends D.A{constructor(){super()}async createTask(e){const t=new n.Ay(e.leftPort),i=new n.Ay(e.controlPort),a={...e,leftIPCPort:t,controlIPCPort:i,render:null,frontFrame:null,backFrame:null,renderFrame:null,renderFrameCount:BigInt(0),loop:null,renderRedyed:!1,currentPTS:h.Dh,adjust:F.None,adjustDiff:BigInt(0),lastAdjustTimestamp:BigInt(0),lastMasterPts:h.Dh,masterTimer:new x.A,lastNotifyPTS:BigInt(0),playRate:BigInt(100),firstRendered:!1,canvasUpdated:!1,renderCreating:!1,renderRecreateCount:0,skipRender:!1,isSupport:()=>!1,frontBuffered:!1,ended:!1,seeking:!1,seekSync:null,afterPullResolver:null,pausing:!1,lastRenderTimestamp:0,avframePool:new d.A((0,s.A)(e.avframeList,r.A),e.avframeListMutex)};return i.on(n.Wo,(async e=>{switch(e.method){case"syncPts":{const t=e.params.pts,i=a.masterTimer.getMasterTime(),r=Math.abs(Number(t-i));r>100&&a.currentPTS>BigInt(0)&&(t>i?(a.adjust=F.Accelerate,p.Yz(`video render sync master time accelerate, targetMaster: ${t}, currentMaster: ${i}, diff: ${r}, taskId: ${a.taskId}`,U,252)):(a.adjust=F.Decelerate,p.Yz(`video render sync master time decelerate, targetMaster: ${t}, currentMaster: ${i}, diff: ${r} taskId: ${a.taskId}`,U,256)),a.adjustDiff=BigInt(Math.floor(r)));break}case"skipRender":a.skipRender=e.params.skipRender}})),this.tasks.set(e.taskId,a),0}async pullFrame(e){const t=await e.leftIPCPort.request("pull");return m.ai(t)||(0,u.A)(t)||t instanceof VideoFrame?t:(t.ref.alpha=t.alpha,t.ref)}swap(e){if(!e.seeking){if(e.backFrame&&((0,u.A)(e.backFrame)?e.avframePool.release(e.backFrame):(e.backFrame.close(),(0,E.z)(e.backFrame)&&e.backFrame.alpha.close())),e.backFrame=null,!e.frontBuffered)return!1;if(e.backFrame=e.frontFrame,e.frontFrame=null,o.M[17](e.stats+352,(0,u.A)(e.backFrame)?(0,c.Mr)(a.f[17](e.backFrame+104),e.backFrame+120,h.i0):(0,c.k)(BigInt(e.backFrame.timestamp),h.KR,h.i0)),!e.ended)return e.frontBuffered=!1,this.pullFrame(e).then((t=>(e.afterPullResolver&&e.afterPullResolver(),m.ai(t)&&t<0?(e.ended=!0,void(e.frontFrame=null)):(e.frontFrame=t,e.frontBuffered=!0,e.seekSync?(e.seekSync(),void(e.seekSync=null)):void(e.backFrame||this.swap(e)))))),!0}}fakeSyncPts(e){const t=e.masterTimer.getMasterTime();t-e.lastNotifyPTS>=BigInt(1e3)&&(e.lastNotifyPTS=t,o.M[17](e.stats+336,t),e.controlIPCPort.notify("syncPts",{pts:t}))}async createRender(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e.renderCreating){var r;if(e.renderCreating=!0,e.renderRedyed=!1,e.render&&(e.render.destroy(),e.render=null),"function"==typeof WritableStream&&e.canvas instanceof WritableStream?(e.render=new S.A(e.canvas),e.isSupport=S.A.isSupport):(0,u.A)(t)?(e.enableWebGPU&&g.A.webgpu&&!V&&f.__(L,(i=>{if(i.isSupport(t))return e.render=new i(e.canvas,{sar:e.sar,devicePixelRatio:e.devicePixelRatio,renderMode:e.renderMode,onRenderContextLost:()=>{e.canvasUpdated=!1,e.renderRedyed=!1,p.R8("render context lost",U,437),e.controlIPCPort.notify("updateCanvas")}}),e.isSupport=i.isSupport,!1})),e.render||f.__($,(i=>{if(i.isSupport(t))return e.render=new i(e.canvas,{sar:e.sar,devicePixelRatio:e.devicePixelRatio,renderMode:e.renderMode,onRenderContextLost:()=>{e.canvasUpdated=!1,e.renderRedyed=!1,p.R8("render context lost",U,456),e.controlIPCPort.notify("updateCanvas")}}),e.isSupport=i.isSupport,!1}))):e.enableWebGPU&&g.A.webgpu&&!V&&((A.A.chrome||A.A.newEdge)&&A.A.checkVersion(A.A.majorVersion,"116",!0)||A.A.safari&&A.A.checkVersion(A.A.majorVersion,"17.4",!0)||v.A.ios&&A.A.checkVersion(v.A.version,"17.4",!0)||A.A.firefox&&A.A.checkVersion(A.A.majorVersion,"129",!0))&&(r=t.colorSpace.primaries,!f.zy(N,r))?(e.render=new C.A(e.canvas,{sar:e.sar,devicePixelRatio:e.devicePixelRatio,renderMode:e.renderMode,onRenderContextLost:()=>{e.canvasUpdated=!1,e.renderRedyed=!1,p.R8("render context lost",U,397),e.controlIPCPort.notify("updateCanvas")}}),e.isSupport=C.A.isSupport):(e.render=new R.A(e.canvas,{sar:e.sar,devicePixelRatio:e.devicePixelRatio,renderMode:e.renderMode,colorSpace:"pq"===t.colorSpace.transfer?"rec2100-pq":"hlg"===t.colorSpace.transfer?"rec2100-hlg":void 0}),e.isSupport=R.A.isSupport),!e.render)return p.z3(`not found format ${t.format} render`,U,468),void(e.renderCreating=!1);try{var s,a,o;await e.render.init(),e.render.viewport(e.viewportWidth,e.viewportHeight),e.render.setRotate(null!==(s=e.renderRotate)&&void 0!==s?s:0,!1),e.render.enableHorizontalFlip(null!==(a=e.flipHorizontal)&&void 0!==a&&a),e.render.enableVerticalFlip(null!==(o=e.flipVertical)&&void 0!==o&&o),e.render.render(t,t.alpha),e.render.clear()}catch(r){if(e.render instanceof B.A&&!i)return V=!0,e.renderCreating=!1,p.R8("not support webgpu render, try to fallback to webgl render",U,487),this.createRender(e,t,!0);if(i){if(e.renderCreating=!1,p.R8("canvas context lost after fallback, wait for recreate canvas",U,492),e.renderRecreateCount<3)return e.renderRecreateCount++,void e.controlIPCPort.notify("updateCanvas");throw r}}e.renderRedyed=!0,e.renderCreating=!1,e.renderRecreateCount=0}}async play(e){const t=this.tasks.get(e);if(t){if(t.loop&&p.h2("task has already call play",U,514),(0,u.A)(t.backFrame)||m.Ik(t.backFrame)||(t.backFrame=await this.pullFrame(t)),m.ai(t.backFrame)&&t.backFrame<0)return t.backFrame=0,p.pq(`video render ended, taskId: ${t.taskId}`,U,523),void t.controlIPCPort.notify("ended");(0,u.A)(t.frontFrame)||m.Ik(t.frontFrame)||(t.frontFrame=await this.pullFrame(t)),t.frontBuffered=!0,t.ended=!1,m.ai(t.frontFrame)&&t.frontFrame<0&&(t.ended=!0,t.frontBuffered=!1,t.frontFrame=0),await this.createRender(t,t.backFrame),t.currentPTS=(0,u.A)(t.backFrame)?(0,c.Mr)(a.f[17](t.backFrame+104),t.backFrame+120,h.i0):(0,c.k)(BigInt(t.backFrame.timestamp),h.KR,h.i0),p.Yz(`got first video frame, pts: ${(0,u.A)(t.backFrame)?a.f[17](t.backFrame+104):BigInt(t.backFrame.timestamp)}(${t.currentPTS}ms), taskId: ${t.taskId}`,U,555),t.masterTimer.setMasterTime(t.lastMasterPts===h.Dh?t.startPTS:t.lastMasterPts),t.lastMasterPts=h.Dh,o.M[17](t.stats+352,t.currentPTS);const e=(0,y.A)(),i=e&&g.A.shareArrayBuffer?0:10;t.loop=new T.A((()=>{if(!t.backFrame)return void(t.ended?(t.loop.stop(),t.adjust=F.None,p.pq(`video render ended, taskId: ${t.taskId}`,U,576),t.controlIPCPort.notify("ended")):t.loop.emptyTask());if(!t.isSupport(t.backFrame)){if(t.render){if(!t.renderRedyed)return;return t.renderRedyed=!1,t.renderFrame=t.backFrame,void t.controlIPCPort.notify("updateCanvas")}this.createRender(t,t.backFrame)}const i=(0,u.A)(t.backFrame)?(0,c.Mr)(a.f[17](t.backFrame+104),t.backFrame+120,h.i0):(0,c.k)(BigInt(t.backFrame.timestamp),h.KR,h.i0);if(i<t.currentPTS){if(!(t.currentPTS-i>BigInt(5e3)))return p.R8(`dropping frame with pts ${i}, which is earlier then the last rendered frame(${t.currentPTS}), taskId: ${t.taskId}`,U,615),void this.swap(t);t.masterTimer.setMasterTime(i)}else i-t.currentPTS>BigInt(4e3)&&t.isLive&&t.masterTimer.setMasterTime(i);if(t.adjust===F.Accelerate){if(t.adjustDiff<=0)t.adjust=F.None,t.lastAdjustTimestamp=BigInt(0);else if(BigInt(Math.floor((0,b.A)()))-t.lastAdjustTimestamp>=BigInt(100)){const e=k.jk(t.adjustDiff,BigInt(100));t.masterTimer.setMasterTime(t.masterTimer.getMasterTime()+e),t.adjustDiff-=e,p.Yz(`video render accelerate master time add: ${e}, taskId: ${t.taskId}`,U,637),t.lastAdjustTimestamp=BigInt(Math.floor((0,b.A)()))}}else if(t.adjust===F.Decelerate)if(t.adjustDiff<=0)t.adjust=F.None,t.lastAdjustTimestamp=BigInt(0);else if(BigInt(Math.floor((0,b.A)()))-t.lastAdjustTimestamp>=BigInt(300)){const e=k.jk(t.adjustDiff,BigInt(50));t.masterTimer.setMasterTime(t.masterTimer.getMasterTime()-e),t.adjustDiff-=e,p.Yz(`video render decelerate master time sub: ${e}, taskId: ${t.taskId}`,U,655),t.lastAdjustTimestamp=BigInt(Math.floor((0,b.A)()))}t.enableJitterBuffer&&a.f[15](t.stats+120)/a.f[15](t.stats+232)*1e3<=a.f[15](t.stats+280)&&this.setPlayRate(t.taskId,1);const r=i-t.masterTimer.getMasterTime();r<=0?(t.renderRedyed&&!t.skipRender&&(e||-r<BigInt(100)||t.renderFrameCount&BigInt(1))?(t.render.render(t.backFrame,t.backFrame.alpha),o.M[17](t.stats+160,a.f[17](t.stats+160)+BigInt(1)),t.lastRenderTimestamp&&o.M[15](t.stats+260,Math.max((0,b.A)()-t.lastRenderTimestamp,a.f[15](t.stats+260))),t.lastRenderTimestamp=(0,b.A)()):o.M[15](t.stats+168,a.f[15](t.stats+168)+1),o.M[17](t.stats+336,i),t.renderFrameCount++,(0,u.A)(t.backFrame)?(o.M[15](t.stats+84,a.f[15](t.backFrame+68)),o.M[15](t.stats+88,a.f[15](t.backFrame+72))):(o.M[15](t.stats+84,t.backFrame.displayWidth),o.M[15](t.stats+88,t.backFrame.displayHeight)),t.firstRendered||(t.controlIPCPort.notify(t.canvasUpdated?"firstRenderedAfterUpdateCanvas":"firstRendered"),t.firstRendered=!0,t.canvasUpdated=!1),t.currentPTS=i,i-t.lastNotifyPTS>=BigInt(1e3)&&(t.lastNotifyPTS=i,t.controlIPCPort.notify("syncPts",{pts:i})),this.swap(t),t.masterTimer.getMasterTime()-i>=BigInt(2e3)&&t.masterTimer.setMasterTime(i)):(this.fakeSyncPts(t),t.loop.emptyTask())}),0,i),t.loop.start()}else p.h2("task not found",U,727)}async restart(e){const t=this.tasks.get(e);if(t){if(t.loop||p.h2("task has not played",U,735),t.loop.isStarted()&&p.h2("task has already run",U,739),t.backFrame||(t.backFrame=await this.pullFrame(t)),t.frontFrame||(t.frontFrame=await this.pullFrame(t)),t.frontBuffered=!0,t.ended=!1,t.adjust=F.None,t.lastNotifyPTS=h.Dh,t.firstRendered=!1,t.pausing=!1,t.seeking=!1,(!t.frontFrame||m.ai(t.frontFrame)&&t.frontFrame<0)&&(t.frontFrame=null,t.frontBuffered=!1,t.ended=!0),!t.backFrame||m.ai(t.backFrame)&&t.backFrame<0)return void(t.backFrame=null);t.currentPTS=(0,u.A)(t.backFrame)?(0,c.Mr)(a.f[17](t.backFrame+104),t.backFrame+120,h.i0):(0,c.k)(BigInt(t.backFrame.timestamp),h.KR,h.i0),t.masterTimer.setMasterTime(k.T9(t.startPTS,t.currentPTS)),t.loop.start()}}async pause(e){const t=this.tasks.get(e);t&&(t.loop||p.h2("task has not played",U,790),t.loop.stop(),t.pausing=!0,t.lastMasterPts=t.masterTimer.getMasterTime(),p.pq(`task paused, taskId: ${t.taskId}`,U,796))}async unpause(e){const t=this.tasks.get(e);if(t){if(t.seeking)return;t.loop||p.h2("task has not played",U,807),t.masterTimer.setMasterTime(t.lastMasterPts),t.lastMasterPts=h.Dh,t.seeking||t.loop.start(),t.pausing=!1,t.lastRenderTimestamp=(0,b.A)(),p.pq(`task unpaused, taskId: ${t.taskId}`,U,817)}}async updateCanvas(e,t){const i=this.tasks.get(e);i?(i.canvas=t,i.render&&(i.render.destroy(),i.render=null),i.isSupport=()=>!1,i.canvasUpdated=!0,i.firstRendered=!1,i.renderRedyed=!1):p.h2("task not found",U,835)}async setPlayRate(e,t){const i=this.tasks.get(e);i&&(i.enableJitterBuffer&&a.f[15](i.stats+120)/a.f[15](i.stats+232)*1e3<=a.f[15](i.stats+280)&&(t=1),i.masterTimer.setRate(t),i.playRate=BigInt(Math.floor(Math.floor(100*t))))}async setRenderMode(e,t){const i=this.tasks.get(e);i&&i.render&&(i.renderMode=t,i.render.setRenderMode(t),(0,w.A)((()=>{i.pausing&&i.backFrame&&i.render&&i.render.render(i.backFrame,i.backFrame.alpha)})))}async setRenderRotate(e,t){const i=this.tasks.get(e);i&&i.render&&(i.renderRotate=t,i.render.setRotate(t),(0,w.A)((()=>{i.pausing&&i.backFrame&&i.render&&i.render.render(i.backFrame,i.backFrame.alpha)})))}async enableHorizontalFlip(e,t){const i=this.tasks.get(e);i&&i.render&&(i.flipHorizontal=t,i.render.enableHorizontalFlip(t),(0,w.A)((()=>{i.pausing&&i.backFrame&&i.render&&i.render.render(i.backFrame,i.backFrame.alpha)})))}async enableVerticalFlip(e,t){const i=this.tasks.get(e);i&&i.render&&(i.flipVertical=t,i.render.enableVerticalFlip(t),(0,w.A)((()=>{i.pausing&&i.backFrame&&i.render&&i.render.render(i.backFrame,i.backFrame.alpha)})))}async resize(e,t,i){const r=this.tasks.get(e);r&&r.render&&(r.render.viewport(t,i),(0,w.A)((()=>{r.pausing&&r.backFrame&&r.render&&r.render.render(r.backFrame,r.backFrame.alpha)})))}async setSkipRender(e,t){const i=this.tasks.get(e);i&&(i.skipRender=t,o.M[15](i.stats+260,0),i.lastRenderTimestamp=(0,b.A)())}async setMasterTime(e,t){const i=this.tasks.get(e);i&&i.masterTimer.setMasterTime(t)}async beforeSeek(e){const t=this.tasks.get(e);t&&(t.ended||t.frontBuffered||(p.Yz(`wait current pull front frame before seek, taskId: ${t.taskId}`,U,948),await new Promise((e=>{t.seekSync=e}))),t.seeking=!0,t.loop.stop(),t.backFrame&&((0,u.A)(t.backFrame)?t.avframePool.release(t.backFrame):(t.backFrame.close(),(0,E.z)(t.backFrame)&&t.backFrame.alpha.close())),t.frontFrame&&((0,u.A)(t.frontFrame)?t.avframePool.release(t.frontFrame):(t.frontFrame.close(),(0,E.z)(t.frontFrame)&&t.frontFrame.alpha.close())),t.frontFrame=null,t.backFrame=null,t.currentPTS=h.Dh,p.Yz(`before seek end, taskId: ${t.taskId}`,U,982))}async syncSeekTime(e,t,i){const r=this.tasks.get(e);if(r){for(;;){if(r.afterPullResolver)return r.ended=!0,r.adjust=F.None,r.backFrame=null,void p.R8(`pull video frame end after unregisterTask, taskId: ${e}`,U,995);if(r.backFrame=await this.pullFrame(r),m.ai(r.backFrame)&&r.backFrame<0)return r.ended=!0,r.adjust=F.None,r.backFrame=null,void p.R8(`pull video frame end after seek, taskId: ${e}`,U,1005);if(t<BigInt(0)){p.pq(`use the first video frame because of the seek time${t} < 0`,U,1010);break}const i=(0,u.A)(r.backFrame)?(0,c.Mr)(a.f[17](r.backFrame+104),r.backFrame+120,h.i0):(0,c.k)(BigInt(r.backFrame.timestamp),h.KR,h.i0);if(i>=t){r.ended=!1,o.M[17](r.stats+336,i),r.lastNotifyPTS=i,r.currentPTS=i,r.masterTimer.setMasterTime(t),r.lastMasterPts=t,p.Yz(`got first video frame after syncSeekTime, pts: ${(0,u.A)(r.backFrame)?a.f[17](r.backFrame+104):BigInt(r.backFrame.timestamp)}(${r.currentPTS}ms), taskId: ${r.taskId}`,U,1033);break}(0,u.A)(r.backFrame)?r.avframePool.release(r.backFrame):(r.backFrame.close(),(0,E.z)(r.backFrame)&&r.backFrame.alpha.close())}p.Yz(`sync seek time end, taskId: ${r.taskId}`,U,1056)}}async isEnd(e){const t=this.tasks.get(e);if(t)return t.ended}async afterSeek(e,t){const i=this.tasks.get(e);if(i){if(i.ended)return i.seeking=!1,i.controlIPCPort.notify("ended"),i.afterPullResolver&&(i.afterPullResolver(),i.afterPullResolver=null),void p.Yz(`after seek end with task ended, taskId: ${i.taskId}`,U,1078);if(i.frontFrame=await this.pullFrame(i),m.ai(i.frontFrame)&&i.frontFrame<0?(i.frontFrame=null,i.frontBuffered=!1,i.ended=!0):(i.frontBuffered=!0,i.ended=!1),i.afterPullResolver)return i.backFrame&&((0,u.A)(i.backFrame)?i.avframePool.release(i.backFrame):(i.backFrame.close(),(0,E.z)(i.backFrame)&&i.backFrame.alpha.close()),i.backFrame=null),i.frontFrame&&((0,u.A)(i.frontFrame)?i.avframePool.release(i.frontFrame):(i.frontFrame.close(),(0,E.z)(i.frontFrame)&&i.frontFrame.alpha.close()),i.frontFrame=null),i.seeking=!1,i.ended=!0,i.afterPullResolver(),i.afterPullResolver=null,void p.Yz(`after seek end with unregisterTask call, taskId: ${i.taskId}`,U,1123);i.adjust=F.None,i.lastRenderTimestamp=(0,b.A)(),i.currentPTS=(0,u.A)(i.backFrame)?(0,c.Mr)(a.f[17](i.backFrame+104),i.backFrame+120,h.i0):(0,c.k)(BigInt(i.backFrame.timestamp),h.KR,h.i0),o.M[17](i.stats+336,i.currentPTS),i.seeking=!1,i.pausing?i.backFrame&&i.render.render(i.backFrame,i.backFrame.alpha):i.loop.start(),p.Yz(`after seek end, taskId: ${i.taskId}`,U,1151)}}async renderNextFrame(e){const t=this.tasks.get(e);if(t&&t.backFrame){const e=(0,u.A)(t.backFrame)?(0,c.Mr)(a.f[17](t.backFrame+104),t.backFrame+120,h.i0):(0,c.k)(BigInt(t.backFrame.timestamp),h.KR,h.i0);t.render.render(t.backFrame,t.backFrame.alpha),o.M[17](t.stats+336,e),o.M[17](t.stats+160,a.f[17](t.stats+160)+BigInt(1)),t.currentPTS=e,t.lastMasterPts=e,this.swap(t)}}async registerTask(e){return this.tasks.has(e.taskId)?l.lh:await this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);if(t){const i=!!t.loop;t.loop&&(await t.loop.stopBeforeNextTick(),t.loop.destroy(),t.loop=null),!i||t.ended||t.frontFrame||await new Promise((e=>{t.afterPullResolver=e})),t.render&&(t.renderRedyed&&t.render.clear(),t.render.destroy(),t.render=null),t.backFrame&&((0,u.A)(t.backFrame)?t.backFrame>0&&t.avframePool.release(t.backFrame):(t.backFrame.close(),(0,E.z)(t.backFrame)&&t.backFrame.alpha.close()),t.backFrame=null),t.frontFrame&&((0,u.A)(t.frontFrame)?t.frontFrame>0&&t.avframePool.release(t.frontFrame):(t.frontFrame.close(),(0,E.z)(t.frontFrame)&&t.frontFrame.alpha.close()),t.frontFrame=null),t.leftIPCPort.destroy(),t.controlIPCPort.destroy(),this.tasks.delete(e),p.Yz(`unregisterTask task, taskId: ${e}`,U,1240)}}}},43801:(e,t,i)=>{i.d(t,{A:()=>d});var r,s,a=i(19371),o=i(75354),n=i(86220);class h{constructor(){(0,a.A)(this,"min",void 0),(0,a.A)(this,"max",void 0)}}r=h,(()=>{const e=r.prototype,t=new Map;t.set("min",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("max",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,4),(0,n.A)(e,o.g7,8),(0,n.A)(e,o.JY,t)})();class d{constructor(){(0,a.A)(this,"channels",void 0),(0,a.A)(this,"sampleRate",void 0),(0,a.A)(this,"audioFrameSize",void 0),(0,a.A)(this,"audioPacketBytes",void 0),(0,a.A)(this,"audioPacketCount",void 0),(0,a.A)(this,"audioPacketQueueLength",void 0),(0,a.A)(this,"audioDropPacketCount",void 0),(0,a.A)(this,"audioDecodeErrorPacketCount",void 0),(0,a.A)(this,"audioEncodeErrorFrameCount",void 0),(0,a.A)(this,"audioFrameDecodeCount",void 0),(0,a.A)(this,"audioPacketEncodeCount",void 0),(0,a.A)(this,"audioFrameRenderCount",void 0),(0,a.A)(this,"audioFrameDropCount",void 0),(0,a.A)(this,"width",void 0),(0,a.A)(this,"height",void 0),(0,a.A)(this,"keyFrameInterval",void 0),(0,a.A)(this,"gop",void 0),(0,a.A)(this,"videoPacketBytes",void 0),(0,a.A)(this,"videoPacketCount",void 0),(0,a.A)(this,"videoPacketQueueLength",void 0),(0,a.A)(this,"videoDropPacketCount",void 0),(0,a.A)(this,"videoDecodeErrorPacketCount",void 0),(0,a.A)(this,"videoEncodeErrorFrameCount",void 0),(0,a.A)(this,"videoFrameDecodeCount",void 0),(0,a.A)(this,"videoPacketEncodeCount",void 0),(0,a.A)(this,"videoFrameRenderCount",void 0),(0,a.A)(this,"videoFrameDropCount",void 0),(0,a.A)(this,"keyFrameCount",void 0),(0,a.A)(this,"bufferDropBytes",void 0),(0,a.A)(this,"bufferReceiveBytes",void 0),(0,a.A)(this,"bufferSendBytes",void 0),(0,a.A)(this,"bufferOutputBytes",void 0),(0,a.A)(this,"audioBitrate",void 0),(0,a.A)(this,"videoBitrate",void 0),(0,a.A)(this,"videoDecodeFramerate",void 0),(0,a.A)(this,"videoRenderFramerate",void 0),(0,a.A)(this,"videoEncodeFramerate",void 0),(0,a.A)(this,"audioDecodeFramerate",void 0),(0,a.A)(this,"audioRenderFramerate",void 0),(0,a.A)(this,"audioEncodeFramerate",void 0),(0,a.A)(this,"audioFrameDecodeIntervalMax",void 0),(0,a.A)(this,"audioFrameRenderIntervalMax",void 0),(0,a.A)(this,"videoFrameDecodeIntervalMax",void 0),(0,a.A)(this,"videoFrameRenderIntervalMax",void 0),(0,a.A)(this,"bandwidth",void 0),(0,a.A)(this,"jitter",void 0),(0,a.A)(this,"jitterBuffer",void 0),(0,a.A)(this,"audioStutter",void 0),(0,a.A)(this,"videoStutter",void 0),(0,a.A)(this,"audiocodec",void 0),(0,a.A)(this,"videocodec",void 0),(0,a.A)(this,"firstAudioMuxDts",void 0),(0,a.A)(this,"lastAudioMuxDts",void 0),(0,a.A)(this,"firstVideoMuxDts",void 0),(0,a.A)(this,"lastVideoMuxDts",void 0),(0,a.A)(this,"audioCurrentTime",void 0),(0,a.A)(this,"videoCurrentTime",void 0),(0,a.A)(this,"audioNextTime",void 0),(0,a.A)(this,"videoNextTime",void 0)}}s=d,(()=>{const e=s.prototype,t=new Map;t.set("channels",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("sampleRate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("audioFrameSize",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("audioPacketBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("audioPacketCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("audioPacketQueueLength",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:32,8:0}),t.set("audioDropPacketCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:40,8:0}),t.set("audioDecodeErrorPacketCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:48,8:0}),t.set("audioEncodeErrorFrameCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:52,8:0}),t.set("audioFrameDecodeCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:56,8:0}),t.set("audioPacketEncodeCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:64,8:0}),t.set("audioFrameRenderCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:72,8:0}),t.set("audioFrameDropCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:80,8:0}),t.set("width",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:84,8:0}),t.set("height",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:88,8:0}),t.set("keyFrameInterval",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:92,8:0}),t.set("gop",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:96,8:0}),t.set("videoPacketBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:104,8:0}),t.set("videoPacketCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:112,8:0}),t.set("videoPacketQueueLength",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:120,8:0}),t.set("videoDropPacketCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:128,8:0}),t.set("videoDecodeErrorPacketCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:136,8:0}),t.set("videoEncodeErrorFrameCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:140,8:0}),t.set("videoFrameDecodeCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:144,8:0}),t.set("videoPacketEncodeCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:152,8:0}),t.set("videoFrameRenderCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:160,8:0}),t.set("videoFrameDropCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:168,8:0}),t.set("keyFrameCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:176,8:0}),t.set("bufferDropBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:184,8:0}),t.set("bufferReceiveBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:192,8:0}),t.set("bufferSendBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:200,8:0}),t.set("bufferOutputBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:208,8:0}),t.set("audioBitrate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:216,8:0}),t.set("videoBitrate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:220,8:0}),t.set("videoDecodeFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:224,8:0}),t.set("videoRenderFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:228,8:0}),t.set("videoEncodeFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:232,8:0}),t.set("audioDecodeFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:236,8:0}),t.set("audioRenderFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:240,8:0}),t.set("audioEncodeFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:244,8:0}),t.set("audioFrameDecodeIntervalMax",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:248,8:0}),t.set("audioFrameRenderIntervalMax",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:252,8:0}),t.set("videoFrameDecodeIntervalMax",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:256,8:0}),t.set("videoFrameRenderIntervalMax",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:260,8:0}),t.set("bandwidth",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:264,8:0}),t.set("jitter",{0:19,1:0,2:0,3:0,4:0,5:0,6:0,7:272,8:0}),t.set("jitterBuffer",{0:h,1:0,2:0,3:0,4:0,5:0,6:0,7:280,8:0}),t.set("audioStutter",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:288,8:0}),t.set("videoStutter",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:292,8:0}),t.set("firstAudioMuxDts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:296,8:0}),t.set("lastAudioMuxDts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:304,8:0}),t.set("firstVideoMuxDts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:312,8:0}),t.set("lastVideoMuxDts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:320,8:0}),t.set("audioCurrentTime",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:328,8:0}),t.set("videoCurrentTime",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:336,8:0}),t.set("audioNextTime",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:344,8:0}),t.set("videoNextTime",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:352,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,8),(0,n.A)(e,o.g7,360),(0,n.A)(e,o.JY,t)})()},13900:(e,t,i)=>{function r(e){return e.alpha&&e.alpha instanceof VideoFrame}i.d(t,{z:()=>r})},55019:(e,t,i)=>{i.d(t,{default:()=>Ue});var r=i(19371),s=i(75354),a=i(83684),o=i(11846),n=i(42524),h=i(3912),d=i(75589),c=i(36271),l=i(93793),u=i(79893),f=i(24482),p=i(30131),m=i(35688),g=i(31370),A=i(57599),v=i(47691),y=i(25092),b=i(58999),k=i(24788),w=i(87339),x=i(29592),T=i(17630),I=i(71195),_=i(77969),P=i(4068),M=i(81819),S=i(97494),C=i(54579),R=i(88897),B=i(88583),D=i(85266),E=i(75176),U=i(59502),L=i(41863),$=i(33740),F=i(51477),V=i(15860),N=i(91278),O=i(81498),z=i(28579),G=i(5015),W=i(20770),H=i(30027),q=i(16408),j=i(83496),Y=i(43523),Q=i(47378),K=i(92957),X=i(1818),J=i(95704),Z=i(31184),ee=i(10567),te=i(97194),ie=i(42365),re=i(90332),se=i(91390),ae=i(28776),oe=i(25334),ne=i(62765),he=i(30018),de=i(18164),ce=i(39989),le=i(44397),ue=i(70178),fe=i(28430),pe=i(84220),me=i(43011),ge=i(51405),Ae=i(17373),ve=i(64208),ye=i(18186),be=i(26930),ke=i(65833),we=i(98277),xe=i(42281),Te=i(33370),Ie=i(42997),_e=i(35409),Pe=i(78553),Me=i(6398),Se=i(76002);const Ce="packages/avplayer/src/AVPlayer.ts",Re={1:"cover",0:"contain"},Be=[27,173,12,196,225,139,167,30,2,1,3,4,20,19,14,15,16,5,6,68,69,17,18,71,7,61,171,97,96,78,86018,86017,86076,86028,86051,86021,86019,86056,86020,86023,86024,86052,86054,86053,86036,86057,86073,94226,94225,94230,94212,94232,94213,94210],De=[27,173,225,139,167,86018,86017,86076,86028,86021],Ee={enableHardware:!0,enableWebGPU:!0,enableWorker:!0,enableWebCodecs:!0,enableAudioWorklet:!0,loop:!1,enableJitterBuffer:!0,jitterBufferMax:4,jitterBufferMin:1,lowLatency:!1,preLoadTime:4};class Ue extends v.A{constructor(e){super(!0),(0,r.A)(this,"VideoDecoderThread",void 0),(0,r.A)(this,"VideoRenderThread",void 0),(0,r.A)(this,"VideoPipelineProxy",void 0),(0,r.A)(this,"GlobalData",void 0),(0,r.A)(this,"taskId",void 0),(0,r.A)(this,"subTaskId",void 0),(0,r.A)(this,"subtitleTaskId",void 0),(0,r.A)(this,"ext",void 0),(0,r.A)(this,"source",void 0),(0,r.A)(this,"ioIPCPort",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"ioloader2DemuxerChannel",void 0),(0,r.A)(this,"demuxer2VideoDecoderChannel",void 0),(0,r.A)(this,"demuxer2AudioDecoderChannel",void 0),(0,r.A)(this,"videoDecoder2VideoRenderChannel",void 0),(0,r.A)(this,"audioDecoder2AudioRenderChannel",void 0),(0,r.A)(this,"audioRender2AudioWorkletChannel",void 0),(0,r.A)(this,"audioSourceNode",void 0),(0,r.A)(this,"gainNode",void 0),(0,r.A)(this,"formatContext",void 0),(0,r.A)(this,"canvas",void 0),(0,r.A)(this,"updateCanvas",void 0),(0,r.A)(this,"video",void 0),(0,r.A)(this,"audio",void 0),(0,r.A)(this,"controller",void 0),(0,r.A)(this,"volume",void 0),(0,r.A)(this,"playRate",void 0),(0,r.A)(this,"renderMode",void 0),(0,r.A)(this,"renderRotate",void 0),(0,r.A)(this,"flipHorizontal",void 0),(0,r.A)(this,"flipVertical",void 0),(0,r.A)(this,"useMSE",void 0),(0,r.A)(this,"audioEnded",void 0),(0,r.A)(this,"videoEnded",void 0),(0,r.A)(this,"status",void 0),(0,r.A)(this,"lastStatus",void 0),(0,r.A)(this,"playChannels",void 0),(0,r.A)(this,"seekedTimestamp",void 0),(0,r.A)(this,"isLive_",void 0),(0,r.A)(this,"drmSystemKey",void 0),(0,r.A)(this,"drmSession",void 0),(0,r.A)(this,"stopPending",void 0),(0,r.A)(this,"statsController",void 0),(0,r.A)(this,"jitterBufferController",void 0),(0,r.A)(this,"selectedVideoStream",void 0),(0,r.A)(this,"selectedAudioStream",void 0),(0,r.A)(this,"selectedSubtitleStream",void 0),(0,r.A)(this,"lastSelectedInnerSubtitleStreamIndex",void 0),(0,r.A)(this,"subtitleRender",void 0),(0,r.A)(this,"externalSubtitleTasks",void 0),(0,r.A)(this,"changingStreamPending",void 0),(0,r.A)(this,"handleChangingStreamPendingTimer",void 0),this.options=y.X$({},Ee,e),this.taskId=(0,b.A)(),this.status=0,this.volume=1,this.playRate=1,this.renderMode=0,this.renderRotate=0,this.flipHorizontal=!1,this.flipVertical=!1,this.seekedTimestamp=N.Dh,this.isLive_=!!e.isLive,this.GlobalData=(0,o.A)(a.M),this.statsController=new be.A(this.GlobalData[s.o9]+32,!(E.USE_THREADS||!k.A.worker||!this.options.enableWorker),this),this.externalSubtitleTasks=[],this.lastSelectedInnerSubtitleStreamIndex=-1,this.changingStreamPending=[],this.handleChangingStreamPendingTimer=new R.A((()=>{this.handleChangingStreamPending()}),200,200),U.Ts(this.GlobalData[s.o9]+24),U.Ts(this.GlobalData[s.o9]+28),Ue.Instances.push(this),w.pq(`create player, taskId: ${this.taskId}`,Ce,717)}get currentTime(){var e;return this.useMSE?BigInt(Math.floor(1e3*((null===(e=this.video||this.audio)||void 0===e?void 0:e.currentTime)||0))):this.selectedAudioStream&&this.selectedVideoStream?x.T9(this.GlobalData.stats.audioCurrentTime,this.GlobalData.stats.videoCurrentTime):this.selectedAudioStream?this.GlobalData.stats.audioCurrentTime:this.selectedVideoStream?this.GlobalData.stats.videoCurrentTime:BigInt(0)}isCodecIdSupported(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e>=65536&&e<=65572||e>=69632&&e<=69683||T.zy(!i||1!==t&&0!==t?Be:De,e)}isAttachmentPicture(e){return 0===n.f[15](e.codecpar)&&1024&e.disposition}findBestStream(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.options.findBestStream)return this.options.findBestStream(e,t);const r=e.filter((e=>n.f[15](e.codecpar)===t));if(r.length){if(1===r.length)return i&&this.isAttachmentPicture(r[0])?void 0:r[0];const e=r.filter((e=>!!(1&e.disposition)&&this.isCodecIdSupported(n.f[15](e.codecpar+4),n.f[15](e.codecpar),i)));if(e.length){if(1===e.length||0!==t)return e[0];const i=e.find((e=>e.nbFrames!==BigInt(1)));return i||e[0]}let s=r.find((e=>this.isCodecIdSupported(n.f[15](e.codecpar+4),n.f[15](e.codecpar),i)&&!this.isAttachmentPicture(e)));if(s)return s;if(s=r.find((e=>!this.isAttachmentPicture(e))),s)return s;if(!i||!this.isAttachmentPicture(r[0]))return r[0]}}async checkUseMSE(e){{if(!k.A.mse)return w.R8("disable mse because of not support mse",Ce,816),!1;if(!k.A.wasmPlayerSupported)return w.R8("use mse because of not support wasm",Ce,822),!0;const t=this.findBestStream(this.formatContext.streams,0,!0),i=this.findBestStream(this.formatContext.streams,1,!0);if(e.video&&t&&!(0,ke.A)().isTypeSupported((0,O.A)(t.codecpar)))return w.R8(`can not support mse for codec: ${(0,O.A)(t.codecpar)}, taskId: ${this.taskId}`,Ce,831),!1;if(e.audio&&i&&!(0,ke.A)().isTypeSupported((0,z.A)(i.codecpar)))return w.R8(`can not support mse for codec: ${(0,z.A)(i.codecpar)}, taskId: ${this.taskId}`,Ce,835),!1;if(e.video&&t&&t.metadata.encryption||e.audio&&i&&i.metadata.encryption)return!0;if(10===this.formatContext.format)return!1;if(this.options.checkUseMES)return this.options.checkUseMES(this.formatContext.streams);if(t&&e.video){if((0,G.A)(t.codecpar))return w.R8("use mse because of hdr",Ce,859),!0;if(this.isMediaStreamMode()&&!k.A.trackGenerator){if(I.A.firefox&&(0,ve.A)()&&(E.USE_THREADS||k.A.worker&&this.options.enableWorker))return w.R8("use mse because of cannot use captureStream in OffscreenCanvas on firefox",Ce,874),!0;if(I.A.safari||_.A.ios)return w.R8("disable mse because of cannot use captureStream in HTMLMediaElement on safari",Ce,879),!1}if(n.f[15](t.codecpar+56)*n.f[15](t.codecpar+60)>2073600){if(!k.A.videoDecoder)return w.R8("use mse because of cannot use webcodec VideoDecoder with resolution more then 1080p",Ce,888),!0;if(this.isMediaStreamMode()&&!k.A.trackGenerator)return w.R8("use mse because of cannot use MediaStreamTrackGenerator with resolution more then 1080p in MediaStream mode",Ce,893),!0;let e=null;0!==n.f[20](t.codecpar+12)&&(e=(0,L.s3)(n.f[20](t.codecpar+12),n.f[15](t.codecpar+16)));try{const i={codec:(0,W.A)(t.codecpar),codedWidth:n.f[15](t.codecpar+56),codedHeight:n.f[15](t.codecpar+60),description:1&n.f[15](t.codecpar+160)?void 0:e,hardwareAcceleration:(0,re.C)(!0)};if(i.description||delete i.description,!(await VideoDecoder.isConfigSupported(i)).supported)return w.R8("use mse because of cannot use webcodec hardwareAcceleration VideoDecoder with resolution more then 1080p",Ce,917),!0}catch(e){}}else if(n.f[15](t.codecpar+56)*n.f[15](t.codecpar+60)==2073600&&(I.A.safari&&!I.A.checkVersion(I.A.version,"16.1",!0)||_.A.ios&&!I.A.checkVersion(_.A.version,"16.1",!0))&&(0,H.lb)((0,d.A)(t.codecpar+72,h.Q))>30)return!0}}return!1}createCanvas(){const e=document.createElement("canvas");return e.id="avplayer-canvas-"+(0,b.A)(),e.className="avplayer-canvas",e.style.cssText="\n      width: 100%;\n      height: 100%;\n    ",e.ondragstart=()=>!1,Object.defineProperty(e,"currentTime",{enumerable:!0,configurable:!1,get:()=>Number(this.currentTime)/1e3,set:e=>{this.seek(BigInt(Math.floor(Math.floor(1e3*e))))}}),e}createVideo(){this.video&&!this.isMediaStreamMode()&&this.options.container.removeChild(this.video);const e=document.createElement("video");e.autoplay=!0,e.playsInline=!0,e.className="avplayer-video",e.style.cssText="\n      width: 100%;\n      height: 100%;\n    ",this.isMediaStreamMode()||this.options.container.appendChild(e),this.video=e}createAudio(){this.audio&&!this.isMediaStreamMode()&&this.options.container.removeChild(this.audio);const e=document.createElement("audio");e.autoplay=!0,e.className="avplayer-audio",this.isMediaStreamMode()||this.options.container.appendChild(e),this.audio=e}handleChangingStreamPending(){const e=Number(this.currentTime)/1e3,t=[];this.changingStreamPending.forEach((i=>{i.start<=e?i.pending.resolve():t.push(i)})),this.changingStreamPending=t,this.changingStreamPending.length||this.handleChangingStreamPendingTimer.stop()}handleTimeupdate(e){let t=0;e.ontimeupdate=()=>{const i=e.currentTime;Math.abs(i-t)>=1&&(6===this.status&&(this.fire(Ae.TIME,[this.currentTime]),Ue.MSEThread.setCurrentTime(this.taskId,i)),t=i)},e.onended=()=>{this.audioEnded=!0,this.videoEnded=!0,this.handleEnded()},e.onwaiting=()=>{this.audio===e?this.GlobalData.stats.audioStutter++:(this.GlobalData.stats.audioStutter++,this.GlobalData.stats.videoStutter++)},e.oncanplay=()=>{6===this.status&&e.play()},e.onencrypted=async t=>{if(this.drmSession)return;this.drmSession=e.mediaKeys.createSession(),this.drmSession.onmessage=async e=>{var t;let i,r;if(this.isDash()){if(this.hasVideo()){const e=await Ue.IOThread.getCurrentProtection(this.taskId,0);null!=e&&e.url&&(i=e.url)}if(!i&&this.hasAudio()){const e=await Ue.IOThread.getCurrentProtection(this.taskId,1);null!=e&&e.url&&(i=e.url)}}if(null!==(t=this.options.drmSystemOptions)&&void 0!==t&&t.onRequest)r=await this.options.drmSystemOptions.onRequest(this.drmSystemKey,e.messageType,e.message,i);else if(this.options.drmSystemOptions.requestUrl){var s,a,o;r=await fetch(this.options.drmSystemOptions.requestUrl,{method:null!==(s=null===(a=this.options.drmSystemOptions)||void 0===a?void 0:a.method)&&void 0!==s?s:"POST",headers:null===(o=this.options.drmSystemOptions)||void 0===o?void 0:o.header,body:e.message}).then((e=>e.arrayBuffer()))}else if(i){var n,h,d,c;r=await fetch(i,{method:null!==(n=null===(h=this.options.drmSystemOptions)||void 0===h?void 0:h.method)&&void 0!==n?n:"POST",headers:null!==(d=null===(c=this.options.drmSystemOptions)||void 0===c?void 0:c.header)&&void 0!==d?d:{"Content-Type":"application/json"},body:e.message}).then((e=>e.arrayBuffer()))}r&&await this.drmSession.update(r)};let i=t.initDataType,r=t.initData;if(this.drmSystemKey===Me.s.CLEARKEY){const e=[];if(this.selectedAudioStream){const t=this.selectedAudioStream.metadata.encryption;null!=t&&t.kid&&e.push((0,Se.A)(t.kid))}if(this.selectedVideoStream){const t=this.selectedVideoStream.metadata.encryption;if(null!=t&&t.kid){const i=(0,Se.A)(t.kid);i!==e[0]&&e.push(i)}}i="keyids",r=P.encode(JSON.stringify({kids:e})).buffer}await this.drmSession.generateRequest(i,r)},e instanceof HTMLVideoElement&&(e.onresize=()=>{this.GlobalData.stats.width=e.videoWidth,this.GlobalData.stats.height=e.videoHeight})}async replayTo(e){let t=N.Dh;if(this.isDash()||this.isHls()){if(this.subTaskId&&!this.selectedAudioStream||(t=await Ue.DemuxerThread.seek(this.taskId,e,16)),this.subTaskId&&this.selectedVideoStream){const i=await Ue.DemuxerThread.seek(this.subTaskId,e,16);t===N.Dh&&(t=i)}this.subtitleTaskId&&this.selectedSubtitleStream&&await Ue.DemuxerThread.seek(this.subtitleTaskId,e,16)}else t=await Ue.DemuxerThread.seek(this.taskId,e,8);if(this.subtitleRender)for(let t=0;t<this.externalSubtitleTasks.length;t++)await Ue.DemuxerThread.seek(this.externalSubtitleTasks[0].taskId,e,8);if(this.fire(Ae.TIME,[e]),this.useMSE){var i;null!==(i=this.video||this.audio)&&void 0!==i&&i.src&&URL.revokeObjectURL((this.video||this.audio).src),await Ue.MSEThread.restart(this.taskId);const t=await Ue.MSEThread.getMediaSource(this.taskId);var r,s;t&&(k.A.workerMSE&&t instanceof MediaSourceHandle?(this.video||this.audio).srcObject=t:(this.video||this.audio).src=URL.createObjectURL(t),this.video?(this.video.currentTime=Number(e)/1e3,this.video.playbackRate=this.playRate):this.audio&&(this.audio.currentTime=Number(e)/1e3,this.audio.playbackRate=this.playRate),await Promise.all([null===(r=this.video)||void 0===r?void 0:r.play(),null===(s=this.audio)||void 0===s?void 0:s.play()]))}else{let i=20;this.formatContext.streams.forEach((e=>{0===n.f[15](e.codecpar)&&(i=Math.max(Math.ceil((0,H.lb)((0,d.A)(e.codecpar+72,h.Q))),i))})),this.audioDecoder2AudioRenderChannel&&(await Ue.AudioDecoderThread.resetTask(this.taskId),await Ue.AudioRenderThread.syncSeekTime(this.taskId,t>=0?t>e?t:e:N.Dh,i),this.audioEnded=await Ue.AudioRenderThread.isEnd(this.taskId),this.audioEnded||(await Ue.AudioRenderThread.restart(this.taskId),this.controller.setTimeUpdateListenType(1))),this.audioSourceNode&&!this.audioEnded&&(await this.audioSourceNode.request("restart"),"suspended"!==Ue.audioContext.state&&"interrupted"!==Ue.audioContext.state||await Ue.AudioRenderThread.fakePlay(this.taskId)),this.videoDecoder2VideoRenderChannel&&(await this.VideoDecoderThread.resetTask(this.taskId),await this.VideoRenderThread.beforeSeek(this.taskId),await this.VideoRenderThread.syncSeekTime(this.taskId,t>=0?t>e?t:e:N.Dh,i),this.videoEnded=await this.VideoRenderThread.isEnd(this.taskId),this.videoEnded||await this.VideoRenderThread.restart(this.taskId))}this.subtitleRender&&(this.subtitleRender.reset(),this.subtitleRender.start())}async handleEnded(){this.audioEnded&&this.videoEnded&&(w.pq(`player ended, taskId: ${this.taskId}`,Ce,1242),this.options.loop&&!this.isLive_?(w.pq(`loop play, taskId: ${this.taskId}`,Ce,1246),await this.replayTo(BigInt(0))):(this.status=7,this.fire(Ae.ENDED),this.changingStreamPending.length=0))}isHls(){return"m3u8"===this.ext||"m3u"===this.ext}isDash(){return"mpd"===this.ext}getMinStartPTS(){let e=N.Dh;for(const t of this.formatContext.streams)t.startTime!==N.Dh&&(e=e===N.Dh?(0,H.k)(t.startTime,t.timeBase,N.i0):x.jk(e,(0,H.k)(t.startTime,t.timeBase,N.i0)));return e<BigInt(1e3)?BigInt(0):e}async getResource(e,t,i){var r;const s=null!=t?`${e}-${t}`:e;if(Ue.Resource.has(s))return Ue.Resource.get(s);const a=this.options.getWasm?this.options.getWasm(e,t,i):(0,q.A)(null!==(r=this.options.wasmBaseUrl)&&void 0!==r?r:`https://cdn.jsdelivr.net/gh/zhaohappy/libmedia@${"v1.2.0-6-g24645bb9".split("-")[0].replace(/^[v|n]/,"")}/dist`,e,t);if(a){let e;if((I.A.safari&&!I.A.checkVersion(I.A.version,"16.4",!0)||_.A.ios&&!I.A.checkVersion(_.A.version,"16.4",!0))&&(M.Yj(a)||M.sv(a)))if(M.Yj(a)){const t={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"},i=await fetch(a,t);e=await i.arrayBuffer()}else e=a;else e=await(0,j.A)(a,0===i);return Ue.Resource.set(s,e),e}}async createSubtitleRender(e,t){var r,a,o,h;this.isMediaStreamMode()||(this.subtitleRender=new((await Promise.all([i.e(384),i.e(168)]).then(i.bind(i,98168))).default)({dom:this.canvas||this.video||this.options.container,getCurrentTime:()=>this.currentTime,avpacketList:this.GlobalData[s.o9],avpacketListMutex:this.GlobalData[s.o9]+24,codecpar:e.codecpar,container:this.options.container,videoWidth:null!==(r=n.f[15]((null===(a=this.selectedVideoStream)||void 0===a?void 0:a.codecpar)+56))&&void 0!==r?r:0,videoHeight:null!==(o=n.f[15]((null===(h=this.selectedVideoStream)||void 0===h?void 0:h.codecpar)+60))&&void 0!==o?o:0}),this.subtitleRender.setDemuxTask(t),this.selectedSubtitleStream=e,t===this.taskId&&(this.lastSelectedInnerSubtitleStreamIndex=e.index),Ue.DemuxerThread.connectStreamTask.transfer(this.subtitleRender.getDemuxerPort(t)).invoke(t,e.index,this.subtitleRender.getDemuxerPort(t)))}async loadExternalSubtitle(e){if(1!==this.status&&2!==this.status||w.h2("player has already destroyed",Ce,1390),e.source||w.h2("external subtitle must has source",Ce,1394),this.externalSubtitleTasks.some((t=>t.source===e.source)))return void w.R8("external subtitle has already loaded",Ce,1398);const t=(0,b.A)(),i=(0,ye.A)(this.options.enableWorker),r=y.X$({taskId:t,streamId:-1,ioloader2DemuxerChannel:i},e);let a="",o=0,n=0;M.Yj(e.source)?(n|=4,a=S.qg(e.source).file.split(".").pop(),o=await Ue.IOThread.registerTask.transfer(i.port1).invoke({type:0,info:{url:e.source},range:{from:-1,to:-1},taskId:t,options:{isLive:this.isLive_},rightPort:i.port1,stats:this.GlobalData[s.o9]+32})):(a=e.source.name.split(".").pop(),o=await Ue.IOThread.registerTask.transfer(i.port1).invoke({type:1,info:{file:e.source},range:{from:-1,to:-1},taskId:t,options:{isLive:this.isLive_},rightPort:i.port1,stats:this.GlobalData[s.o9]+32})),o<0&&w.h2(`register io task failed, ret: ${o}, taskId: ${this.taskId}`,Ce,1462),await Ue.DemuxerThread.registerTask.transfer(i.port2).invoke({taskId:t,leftPort:i.port2,format:se.HR[a],stats:0,isLive:!1,flags:n,avpacketList:this.GlobalData[s.o9],avpacketListMutex:this.GlobalData[s.o9]+24}),o=await Ue.DemuxerThread.openStream(t),o<0&&w.h2(`open external subtitle failed, ret: ${o}, taskId: ${t}`,Ce,1479);let h=await Ue.DemuxerThread.analyzeStreams(t);if(M.ai(h))return void w.h2(`analyze stream failed, ret: ${h}`,Ce,1483);h.streams.length||w.h2("not found any stream",Ce,1487);const d=h.streams[0];this.formatContext.streams.push(d),r.streamId=d.id,e.lang&&(d.metadata.language=e.lang),e.title&&(d.metadata.title=e.title);const c=8===this.status||6===this.status||9===this.status||10===this.status;return c&&await Ue.DemuxerThread.seek(t,this.currentTime,8),c&&!this.subtitleRender?(await this.createSubtitleRender(d,t),this.subtitleRender.start()):this.subtitleRender&&await Ue.DemuxerThread.connectStreamTask.transfer(this.subtitleRender.getDemuxerPort(t)).invoke(t,d.index,this.subtitleRender.getDemuxerPort(t)),await Ue.DemuxerThread.startDemux(t,!1,10),this.externalSubtitleTasks.push(r),this.fire(Ae.STREAM_UPDATE),0}async load(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};0!==this.status&&7!==this.status&&8!==this.status&&6!==this.status&&4!==this.status&&w.h2("cannot call load on player status without (stopped, ended, paused, played, loaded)",Ce,1545),7!==this.status&&8!==this.status&&6!==this.status&&4!==this.status||(w.pq(`call stop before load because of player status ${this.status}`,Ce,1553),await this.stop(!0)),w.pq(`call load, taskId: ${this.taskId}`,Ce,1557),this.status=3,this.fire(Ae.LOADING),M.zM(t.isLive)?this.isLive_=t.isLive:this.isLive_=!!this.options.isLive,this.controller=new ge.A(this,this.options.enableWorker),this.ioloader2DemuxerChannel=(0,ye.A)(this.options.enableWorker),(0,L.sO)(this.GlobalData[s.o9]+32,0,360),this.externalSubtitleTasks.length=0,await Ue.startDemuxPipeline(this.options.enableWorker);let i=0,r=0;if(M.Yj(e)){i|=4;let{info:a,type:o,ext:n}=await(0,Y.A)(e,t.ext,t.http);this.ext=n,r=await Ue.IOThread.registerTask.transfer(this.ioloader2DemuxerChannel.port1).invoke({type:o,info:{...a,httpOptions:t.http,webtransportOptions:t.webtransport,websocketOptions:t.websocket,uri:t.uri},range:{from:-1,to:-1},taskId:this.taskId,options:y.X$({},t.ioLoaderOptions||{},{isLive:this.isLive_}),rightPort:this.ioloader2DemuxerChannel.port1,stats:this.GlobalData[s.o9]+32})}else e instanceof File?(this.isLive_=!1,this.ext=e.name.split(".").pop(),r=await Ue.IOThread.registerTask.transfer(this.ioloader2DemuxerChannel.port1).invoke({type:1,info:{file:e},range:{from:-1,to:-1},taskId:this.taskId,options:y.X$({},t.ioLoaderOptions||{},{isLive:!1}),rightPort:this.ioloader2DemuxerChannel.port1,stats:this.GlobalData[s.o9]+32})):e instanceof de.A?(i|=e.flags||0,this.ext=e.ext,this.ioIPCPort=new D.Ay(this.ioloader2DemuxerChannel.port1),this.ioIPCPort.on(D.S3,(async t=>{switch(t.method){case"open":try{const i=await e.open();if(i<0){w.z3(`custom loader open error, ${i}, taskId: ${this.taskId}`,Ce,1642),this.ioIPCPort.reply(t,null,i);break}this.ioIPCPort.reply(t,i)}catch(e){w.z3(`loader open error, ${e}, taskId: ${this.taskId}`,Ce,1649),this.ioIPCPort.reply(t,null,e)}break;case"read":{const i=t.params.pointer,r=t.params.length,s=t.params.ioloaderOptions,a=Ue.IODemuxProxy?new Uint8Array(r):(0,L.JW)(i,r);try{const i=await e.read(a,s);i<0?this.ioIPCPort.reply(t,i,null):(this.GlobalData.stats.bufferReceiveBytes+=BigInt(0|i),this.ioIPCPort.reply(t,Ue.IODemuxProxy?a.subarray(0,i):i,null,Ue.IODemuxProxy?[a.buffer]:null))}catch(e){w.z3(`loader read error, ${e}, taskId: ${this.taskId}`,Ce,1672),this.ioIPCPort.reply(t,Q.LR)}break}case"write":{const i=t.params.pointer,r=t.params.length,s=(0,L.JW)(i,r);try{const i=await e.write(s);this.GlobalData.stats.bufferSendBytes+=r,this.ioIPCPort.reply(t,i)}catch(e){w.z3(`loader write error, ${e}, taskId: ${this.taskId}`,Ce,1694),this.ioIPCPort.reply(t,Q.LR)}break}case"seek":{const i=t.params.pos,r=t.params.ioloaderOptions;try{const s=await e.seek(i,r);if(s<0){w.z3(`custom loader seek error, ${s}, taskId: ${this.taskId}`,Ce,1710),this.ioIPCPort.reply(t,null,s);break}this.ioIPCPort.reply(t,s)}catch(e){w.z3(`loader seek error, ${e}, taskId: ${this.taskId}`,Ce,1717),this.ioIPCPort.reply(t,null,e)}break}case"size":this.ioIPCPort.reply(t,await e.size())}}))):w.h2("invalid source",Ce,1731);r<0&&w.h2(`register io task failed, ret: ${r}, taskId: ${this.taskId}`,Ce,1735),(this.isDash()||this.isHls())&&(i|=2);const a=y.X$({},t.formatOptions||{});if(this.isDash()||this.isHls()){await Ue.IOThread.open(this.taskId);const e=await Ue.IOThread.hasAudio(this.taskId),t=await Ue.IOThread.hasVideo(this.taskId);e&&t?(this.subTaskId=(0,b.A)(),await Ue.DemuxerThread.registerTask.transfer(this.ioloader2DemuxerChannel.port2,this.controller.getDemuxerControlPort()).invoke({taskId:this.taskId,leftPort:this.ioloader2DemuxerChannel.port2,controlPort:this.controller.getDemuxerControlPort(),format:se.HR[this.ext],stats:this.GlobalData[s.o9]+32,isLive:this.isLive_,flags:i,ioloaderOptions:{mediaType:1},formatOptions:a,avpacketList:this.GlobalData[s.o9],avpacketListMutex:this.GlobalData[s.o9]+24}),await Ue.DemuxerThread.registerTask({taskId:this.subTaskId,mainTaskId:this.taskId,flags:i,format:se.HR[this.ext],stats:this.GlobalData[s.o9]+32,isLive:this.isLive_,ioloaderOptions:{mediaType:0},formatOptions:a,avpacketList:this.GlobalData[s.o9],avpacketListMutex:this.GlobalData[s.o9]+24})):(e||t)&&await Ue.DemuxerThread.registerTask.transfer(this.ioloader2DemuxerChannel.port2,this.controller.getDemuxerControlPort()).invoke({taskId:this.taskId,leftPort:this.ioloader2DemuxerChannel.port2,controlPort:this.controller.getDemuxerControlPort(),format:se.HR[this.ext],stats:this.GlobalData[s.o9]+32,isLive:this.isLive_,flags:i,ioloaderOptions:{mediaType:e?1:0},formatOptions:a,avpacketList:this.GlobalData[s.o9],avpacketListMutex:this.GlobalData[s.o9]+24})}else"rtsp"!==this.ext&&"rtmp"!==this.ext||(a.uri=t.uri||e.replace(/^\S+:\/\//,this.ext+"://")),await Ue.DemuxerThread.registerTask.transfer(this.ioloader2DemuxerChannel.port2,this.controller.getDemuxerControlPort()).invoke({taskId:this.taskId,leftPort:this.ioloader2DemuxerChannel.port2,controlPort:this.controller.getDemuxerControlPort(),format:se.HR[this.ext],formatOptions:a,stats:this.GlobalData[s.o9]+32,isLive:this.isLive_,flags:i,avpacketList:this.GlobalData[s.o9],avpacketListMutex:this.GlobalData[s.o9]+24});(this.isDash()||this.isHls())&&await Ue.IOThread.hasSubtitle(this.taskId)&&(this.subtitleTaskId=(0,b.A)(),await Ue.DemuxerThread.registerTask({taskId:this.subtitleTaskId,mainTaskId:this.taskId,flags:i,format:se.HR[this.ext],stats:this.GlobalData[s.o9]+32,isLive:this.isLive_,ioloaderOptions:{mediaType:3},avpacketList:this.GlobalData[s.o9],avpacketListMutex:this.GlobalData[s.o9]+24})),this.fire(Ae.PROGRESS,[0]);let o=3e3;t.maxProbeDuration&&(o=Math.floor(1e3*t.maxProbeDuration)),r=await Ue.DemuxerThread.openStream(this.taskId,o),r<0&&w.h2(`open stream failed, ret: ${r}, taskId: ${this.taskId}`,Ce,1858),this.fire(Ae.PROGRESS,[1,this.ext]);let h=await Ue.DemuxerThread.analyzeStreams(this.taskId);if(M.ai(h))w.h2(`analyze stream failed, ret: ${h}`,Ce,1865);else{if(h.streams.length||w.h2("not found any stream",Ce,1869),this.subTaskId){r=await Ue.DemuxerThread.openStream(this.subTaskId,o),r<0&&w.h2(`open stream failed, ret: ${r}, taskId: ${this.subTaskId}`,Ce,1875);const e=await Ue.DemuxerThread.analyzeStreams(this.subTaskId);if(M.ai(e))return void w.h2(`analyze stream failed, ret: ${e}`,Ce,1879);e.streams.length||w.h2("not found any stream",Ce,1883),h.streams=h.streams.concat(e.streams)}if(this.subtitleTaskId){r=await Ue.DemuxerThread.openStream(this.subtitleTaskId,o),r<0&&w.h2(`open subtitle stream failed, ret: ${r}, taskId: ${this.subtitleTaskId}`,Ce,1891);const e=await Ue.DemuxerThread.analyzeStreams(this.subtitleTaskId);if(M.ai(e))return void w.h2(`analyze subtitle stream failed, ret: ${e}`,Ce,1895);e.streams.length||w.h2("not found any stream",Ce,1899),h.streams=h.streams.concat(e.streams)}if(this.formatContext=h,this.source=e,t.externalSubtitles)for(let e=0;e<t.externalSubtitles.length;e++)await this.loadExternalSubtitle(t.externalSubtitles[e]);if(h.streams.forEach((e=>{1===n.f[15](e.codecpar)?this.GlobalData.stats.audiocodec=(0,K.A)(e.codecpar):0===n.f[15](e.codecpar)&&(this.GlobalData.stats.videocodec=(0,W.A)(e.codecpar))})),this.isHls()||this.isDash()){const e=1e3*await Ue.IOThread.getDuration(this.taskId);if(e>0)for(let t=0;t<this.formatContext.streams.length;t++)this.formatContext.streams[t].duration=(0,H.k)(BigInt(Math.floor(e)),N.i0,this.formatContext.streams[t].timeBase)}if(this.isLive_&&this.options.enableJitterBuffer){const e=Math.max(this.source instanceof de.A?this.source.minBuffer:await Ue.IOThread.getMinBuffer(this.taskId),this.options.jitterBufferMin);let t=this.options.jitterBufferMax;t<=e&&(t=e+(this.isHls()||this.isDash()?e:1)),this.jitterBufferController=new we.A({stats:this.GlobalData[s.o9]+32,jitterBuffer:this.GlobalData.stats[s.o9]+280,lowLatencyStart:!(this.isHls()||this.isDash()),lowLatency:this.options.lowLatency,useMse:this.useMSE,max:t,min:e,observer:{onCroppingBuffer:e=>{var t;w.Yz(`cropping buffer by jitter buffer, max: ${e}, taskId: ${this.taskId}`,Ce,1959),null===(t=Ue.DemuxerThread)||void 0===t||t.croppingAVPacketQueue(this.taskId,BigInt(0|e))},onSetPlayRate:e=>{w.Yz(`set play rate by jitter buffer, rate: ${e}, taskId: ${this.taskId}`,Ce,1963),this.useMSE?(Ue.MSEThread.setPlayRate(this.taskId,e),this.video?this.video.playbackRate=e:this.audio&&(this.audio.playbackRate=e)):(this.audioDecoder2AudioRenderChannel&&Ue.AudioRenderThread.setPlayTempo(this.taskId,e),this.videoDecoder2VideoRenderChannel&&this.VideoRenderThread.setPlayRate(this.taskId,e))}}})}if(w.pq(`taskId: ${this.taskId}\nAVPlayer version v1.2.0-6-g24645bb9 Copyright (c) 2024-present the libmedia developers\n`+(0,ne.Ay)([h],[{from:M.Yj(e)?e:e.name,tag:"Input",isLive:this.isLive_}]),Ce,1986),!this.isLive_){let e=N.Dh;h.streams.forEach((t=>{if(t.startTime!==N.Dh){const i=(0,H.k)(t.startTime,t.timeBase,N.i0);1!==n.f[15](t.codecpar)&&0!==n.f[15](t.codecpar)||(i<e||e===-BigInt(1))&&(e=i)}})),e<BigInt(0)&&e!==N.Dh?await this.seek(BigInt(0)):e>0&&this.isHls()&&await Ue.IOThread.setStart(this.taskId,Number(e)/1e3)}this.changingStreamPending.length=0,this.status=4,this.fire(Ae.LOADED)}}async playUseMSE(e){{await Ue.startMSEPipeline(this.options.enableWorker);const i=this.findBestStream(this.formatContext.streams,0,!0),r=this.findBestStream(this.formatContext.streams,1,!0);let a=!1,o="",h=[];const d=async e=>{const t=(0,X.Un)(e.codecpar+20,e.codecpar+24,24);let i;if(t)i=(0,J.ZK)((0,L.s3)(n.f[20](t),n.f[25](t+4)));else if(this.isDash()){const t=await Ue.IOThread.getCurrentProtection(this.taskId,n.f[15](e.codecpar));if(t){i=[{systemId:t.systemId,keyIds:[t.kid],data:new Uint8Array(0)}];const r=(0,J.bE)(i),s=(0,Z.sY)(r.length);(0,L.lW)(s,r.length,r),(0,X.$W)(e.codecpar+20,e.codecpar+24,24,s,r.length)}}const r=e.metadata.encryption;if(i&&r){for(let t=0;t<i.length;t++){const h=(0,Pe.A)(i[t].systemId);if((!o||o===h)&&h)try{const t=[{initDataTypes:["keyids","cenc"]}];var s;if(0===n.f[15](e.codecpar))t[0].videoCapabilities=[{contentType:(0,O.A)(e.codecpar),encryptionScheme:(0,he.A)(r.schemeType),robustness:null===(s=this.options.drmSystemOptions)||void 0===s?void 0:s.videoRobustness}];else if(1===n.f[15](e.codecpar)){var a;t[0].audioCapabilities=[{contentType:(0,z.A)(e.codecpar),robustness:null===(a=this.options.drmSystemOptions)||void 0===a?void 0:a.audioRobustness}]}return await navigator.requestMediaKeySystemAccess(h,t),{key:h,config:t}}catch(e){w.R8(`drm system ${h} error ${e}`,Ce,2096)}}o&&w.h2("audio and video has different drm system key",Ce,2101)}};if(await Ue.MSEThread.registerTask.transfer(this.controller.getMuxerControlPort()).invoke({taskId:this.taskId,stats:this.GlobalData[s.o9]+32,controlPort:this.controller.getMuxerControlPort(),isLive:this.isLive_,avpacketList:this.GlobalData[s.o9],avpacketListMutex:this.GlobalData[s.o9]+24,enableJitterBuffer:!!this.jitterBufferController},this.seekedTimestamp>=BigInt(0)?this.seekedTimestamp:N.Dh),i&&e.video){this.fire(Ae.PROGRESS,[3,i]),a=!0,this.selectedVideoStream=i,this.videoEnded=!1,this.demuxer2VideoDecoderChannel=(0,ye.A)(this.options.enableWorker);const e=await d(i);e&&(o=e.key,h.push(...e.config)),await Ue.DemuxerThread.connectStreamTask.transfer(this.demuxer2VideoDecoderChannel.port1).invoke(this.subTaskId||this.taskId,i.index,this.demuxer2VideoDecoderChannel.port1),await Ue.MSEThread.addStream.transfer(this.demuxer2VideoDecoderChannel.port2).invoke(this.taskId,i.index,(0,ee.Wu)(i.codecpar),i.timeBase,i.metadata,i.startTime,this.demuxer2VideoDecoderChannel.port2)}if(r&&e.audio){this.fire(Ae.PROGRESS,[2,r]),this.selectedAudioStream=r,this.audioEnded=!1,this.demuxer2AudioDecoderChannel=(0,ye.A)(this.options.enableWorker);const e=await d(r);e&&(o=e.key,h.push(...e.config)),await Ue.DemuxerThread.connectStreamTask.transfer(this.demuxer2AudioDecoderChannel.port1).invoke(this.taskId,r.index,this.demuxer2AudioDecoderChannel.port1),await Ue.MSEThread.addStream.transfer(this.demuxer2AudioDecoderChannel.port2).invoke(this.taskId,r.index,(0,ee.Wu)(r.codecpar),r.timeBase,r.metadata,r.startTime,this.demuxer2AudioDecoderChannel.port2)}if(a?this.createVideo():this.createAudio(),o){var t;const e=await navigator.requestMediaKeySystemAccess(o,h),i=await e.createMediaKeys();null!==(t=this.options.drmSystemOptions)&&void 0!==t&&t.certificate&&await i.setServerCertificate(this.options.drmSystemOptions.certificate).catch((e=>{w.z3(`setServerCertificate failed, ${e}`,Ce,2184)})),await(this.video||this.audio).setMediaKeys(i),this.drmSystemKey=o}Ue.MSEThread.setPlayRate(this.taskId,this.playRate);const c=await Ue.MSEThread.getMediaSource(this.taskId);c&&(I.A.safari&&await Ue.MSEThread.isManagedMediaSource(this.taskId)&&((this.video||this.audio).disableRemotePlayback=!0),k.A.workerMSE&&c instanceof MediaSourceHandle?(this.video||this.audio).srcObject=c:(this.video||this.audio).src=URL.createObjectURL(c),this.handleTimeupdate(this.video||this.audio)),this.video&&!this.selectedAudioStream&&(this.video.muted=!0),(this.video||this.audio).playbackRate=this.playRate}}async playUseDecoder(e){let t=BigInt(0),i=BigInt(0),r=this.findBestStream(this.formatContext.streams,0),a=this.findBestStream(this.formatContext.streams,1);if(r||a||w.h2("not has any stream to play",Ce,2224),r&&!this.isCodecIdSupported(n.f[15](r.codecpar+4),0)&&(r=null,w.R8("video codec not support",Ce,2229)),a&&!this.isCodecIdSupported(n.f[15](a.codecpar+4),1)&&(a=null,w.R8("audio codec not support",Ce,2233)),a||r||w.h2("not has any supported stream to play",Ce,2236),r&&e.video){this.fire(Ae.PROGRESS,[3,r]),this.selectedVideoStream=r,await Ue.startVideoRenderPipeline(this.options.enableWorker),await this.createVideoDecoderThread(this.options.enableWorker),i=(0,H.k)(r.startTime,r.timeBase,N.i0),this.demuxer2VideoDecoderChannel=(0,ye.A)(this.options.enableWorker),this.videoDecoder2VideoRenderChannel=(0,ye.A)(this.options.enableWorker);let e=await this.getResource("decoder",n.f[15](r.codecpar+4),n.f[15](r.codecpar));e||(k.A.videoDecoder?(await VideoDecoder.isConfigSupported({codec:(0,W.A)(r.codecpar)})).supported||w.h2(`${ne.eG(n.f[15](r.codecpar),n.f[15](r.codecpar+4))} codecId ${n.f[15](r.codecpar+4)} not support`,Ce,2258):w.h2(`${ne.eG(n.f[15](r.codecpar),n.f[15](r.codecpar+4))} codecId ${n.f[15](r.codecpar+4)} not support`,Ce,2262)),await this.VideoDecoderThread.registerTask.transfer(this.demuxer2VideoDecoderChannel.port2,this.videoDecoder2VideoRenderChannel.port1).invoke({taskId:this.taskId,resource:e,leftPort:this.demuxer2VideoDecoderChannel.port2,rightPort:this.videoDecoder2VideoRenderChannel.port1,stats:this.GlobalData[s.o9]+32,enableHardware:this.options.enableHardware&&this.options.enableWebCodecs&&!(1024&r.disposition),avpacketList:this.GlobalData[s.o9],avpacketListMutex:this.GlobalData[s.o9]+24,avframeList:this.GlobalData[s.o9]+12,avframeListMutex:this.GlobalData[s.o9]+28,preferWebCodecs:!((0,G.A)(r.codecpar)||(0,te.A)(r.codecpar)&&139!==n.f[15](r.codecpar+4)&&167!==n.f[15](r.codecpar+4)&&225!==n.f[15](r.codecpar+4)||!this.options.enableWebCodecs||1024&r.disposition),preferLatency:this.isLive(),keepAlpha:!0}),await this.VideoDecoderThread.open(this.taskId,(0,ee.Wu)(r.codecpar))<0&&w.h2(`cannot open video ${ne.eG(n.f[15](r.codecpar),n.f[15](r.codecpar+4))} decoder`,Ce,2296),await Ue.DemuxerThread.connectStreamTask.transfer(this.demuxer2VideoDecoderChannel.port1).invoke(this.subTaskId||this.taskId,r.index,this.demuxer2VideoDecoderChannel.port1),this.VideoDecoderThread.setPlayRate(this.taskId,this.playRate)}if(a&&e.audio){this.fire(Ae.PROGRESS,[2,a]),this.selectedAudioStream=a,await Ue.startAudioPipeline(this.options.enableWorker),"suspended"!==Ue.audioContext.state&&"interrupted"!==Ue.audioContext.state||await Promise.race([Ue.audioContext.resume(),new B.A(.1)]),t=(0,H.k)(a.startTime,a.timeBase,N.i0),this.demuxer2AudioDecoderChannel=(0,ye.A)(this.options.enableWorker),this.audioDecoder2AudioRenderChannel=(0,ye.A)(this.options.enableWorker);let e=await this.getResource("decoder",n.f[15](a.codecpar+4),n.f[15](a.codecpar));if(!e)if(k.A.audioDecoder){const e={codec:(0,K.A)(a.codecpar),sampleRate:n.f[15](a.codecpar+136),numberOfChannels:n.f[15](a.codecpar+116)};n.f[20](a.codecpar+12)&&(e.description=(0,L.s3)(n.f[20](a.codecpar+12),n.f[15](a.codecpar+16)).slice()),(await AudioDecoder.isConfigSupported(e)).supported||w.h2(`${ne.eG(n.f[15](a.codecpar),n.f[15](a.codecpar+4))} codecId ${n.f[15](a.codecpar+4)} not support`,Ce,2339)}else w.h2(`${ne.eG(n.f[15](a.codecpar),n.f[15](a.codecpar+4))} codecId ${n.f[15](a.codecpar+4)} not support`,Ce,2343);await Ue.AudioDecoderThread.registerTask.transfer(this.demuxer2AudioDecoderChannel.port2,this.audioDecoder2AudioRenderChannel.port1).invoke({taskId:this.taskId,resource:e,leftPort:this.demuxer2AudioDecoderChannel.port2,rightPort:this.audioDecoder2AudioRenderChannel.port1,stats:this.GlobalData[s.o9]+32,avpacketList:this.GlobalData[s.o9],avpacketListMutex:this.GlobalData[s.o9]+24,avframeList:this.GlobalData[s.o9]+12,avframeListMutex:this.GlobalData[s.o9]+28}),await Ue.AudioDecoderThread.open(this.taskId,(0,ee.Wu)(a.codecpar))<0&&w.h2(`cannot open audio ${ne.eG(n.f[15](a.codecpar),n.f[15](a.codecpar+4))} decoder`,Ce,2364),await Ue.DemuxerThread.connectStreamTask.transfer(this.demuxer2AudioDecoderChannel.port1).invoke(this.taskId,a.index,this.demuxer2AudioDecoderChannel.port1);const i=this.formatContext.streams.filter((e=>1===n.f[15](e.codecpar)));if(i.length>1)for(let e=0;e<i.length;e++)i[e]!==a&&await Ue.DemuxerThread.addPendingStream(this.taskId,i[e].index)}if(this.videoDecoder2VideoRenderChannel){let e;if(this.isMediaStreamMode())if(k.A.trackGenerator){const t=new MediaStreamTrackGenerator({kind:"video"});e=t.writable;const i=this.options.container,r=i.getVideoTracks()[0];r&&i.removeTrack(r),i.addTrack(t)}else{this.canvas=this.createCanvas(),this.canvas.width=n.f[15](r.codecpar+56),this.canvas.height=n.f[15](r.codecpar+60),e=(0,ve.A)()&&(E.USE_THREADS||k.A.worker&&this.options.enableWorker)?this.canvas.transferControlToOffscreen():this.canvas;const t=this.canvas.captureStream(),i=this.options.container,s=i.getVideoTracks()[0];s&&i.removeTrack(s),i.addTrack(t.getVideoTracks()[0])}else this.canvas=this.createCanvas(),this.canvas.width=this.options.container.offsetWidth*devicePixelRatio,this.canvas.height=this.options.container.offsetHeight*devicePixelRatio,this.options.container.appendChild(this.canvas),e=(0,ve.A)()&&(E.USE_THREADS||k.A.worker&&this.options.enableWorker)?this.canvas.transferControlToOffscreen():this.canvas;r.metadata.matrix&&!this.useMSE&&(this.renderRotate=-Math.atan2(r.metadata.matrix[3],r.metadata.matrix[0])*(180/Math.PI)),await this.VideoRenderThread.registerTask.transfer(this.videoDecoder2VideoRenderChannel.port2,this.controller.getVideoRenderControlPort(),e).invoke({taskId:this.taskId,isLive:this.isLive_,leftPort:this.videoDecoder2VideoRenderChannel.port2,controlPort:this.controller.getVideoRenderControlPort(),canvas:e,renderMode:this.renderMode,renderRotate:this.renderRotate,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,viewportWidth:this.isMediaStreamMode()?n.f[15](r.codecpar+56):this.options.container.offsetWidth,viewportHeight:this.isMediaStreamMode()?n.f[15](r.codecpar+60):this.options.container.offsetHeight,devicePixelRatio:this.isMediaStreamMode()?1:devicePixelRatio,stats:this.GlobalData[s.o9]+32,enableWebGPU:this.options.enableWebGPU,startPTS:this.isLive_?(0,H.k)(r.startTime<BigInt(1e3)?BigInt(0):r.startTime,r.timeBase,N.i0):this.getMinStartPTS(),avframeList:this.GlobalData[s.o9]+12,avframeListMutex:this.GlobalData[s.o9]+28,enableJitterBuffer:!!this.jitterBufferController&&!this.audioDecoder2AudioRenderChannel,sar:(0,H.lb)((0,d.A)(r.codecpar+64,h.Q))}),this.videoEnded=!1,this.VideoRenderThread.setPlayRate(this.taskId,this.playRate)}if(this.audioDecoder2AudioRenderChannel){this.audioRender2AudioWorkletChannel=new MessageChannel,this.isMediaStreamMode()?this.playChannels=2:this.playChannels=Math.min(n.f[15](a.codecpar+116),Ue.audioContext.destination.maxChannelCount||2);let t,i=await this.getResource("resampler"),r=await this.getResource("stretchpitcher");if(i||w.h2("resampler not found",Ce,2492),r||w.h2("stretch pitcher not found",Ce,2495),await Ue.AudioRenderThread.registerTask.transfer(this.audioDecoder2AudioRenderChannel.port2,this.audioRender2AudioWorkletChannel.port1,this.controller.getAudioRenderControlPort()).invoke({taskId:this.taskId,isLive:this.isLive_,leftPort:this.audioDecoder2AudioRenderChannel.port2,rightPort:this.audioRender2AudioWorkletChannel.port1,controlPort:this.controller.getAudioRenderControlPort(),playFormat:8,playSampleRate:Ue.audioContext.sampleRate,playChannels:this.playChannels,resamplerResource:i,stretchpitcherResource:r,stats:this.GlobalData[s.o9]+32,startPTS:this.isLive_?(0,H.k)(a.startTime<BigInt(1e3)?BigInt(0):a.startTime,a.timeBase,N.i0):this.getMinStartPTS(),avframeList:this.GlobalData[s.o9]+12,avframeListMutex:this.GlobalData[s.o9]+28,enableJitterBuffer:!!this.jitterBufferController,audioMasterForce:e.audioMasterForce}),t=k.A.audioWorklet&&this.options.enableAudioWorklet?ae.A:oe.A,this.audioSourceNode=new t(Ue.audioContext,{onEnded:()=>{this.onAudioEnded()},onFirstRendered:()=>{this.onFirstAudioRendered()},onStutter:()=>{this.onAudioStutter()}},{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[this.playChannels],isMainWorker:!!Ue.AudioPipelineProxy}),await this.audioSourceNode.request("init",{memory:!E.USE_THREADS||I.A.safari&&!I.A.checkVersion(I.A.version,"16.1",!0)||_.A.ios&&!I.A.checkVersion(_.A.version,"16.1",!0)?null:$.ce,bufferLength:this.options.audioWorkletBufferLength}),Ue.AudioRenderThread.setPlayTempo(this.taskId,this.playRate),this.gainNode=Ue.audioContext.createGain(),this.audioSourceNode.connect(this.gainNode),this.isMediaStreamMode()){const e=Ue.audioContext.createMediaStreamDestination();this.gainNode.connect(e);const t=this.options.container,i=t.getAudioTracks()[0];i&&t.removeTrack(i),t.addTrack(e.stream.getAudioTracks()[0])}else this.gainNode.connect(Ue.audioContext.destination);this.setVolume(this.volume),this.audioEnded=!1}this.audioDecoder2AudioRenderChannel?this.controller.setTimeUpdateListenType(1):this.videoDecoder2VideoRenderChannel&&this.controller.setTimeUpdateListenType(0),this.videoDecoder2VideoRenderChannel&&this.audioDecoder2AudioRenderChannel&&x.tn(i-t)>BigInt(1e4)&&this.controller.setEnableAudioVideoSync(!1)}async play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0,subtitle:!0};if(w.pq(`call play, options: ${JSON.stringify(e)}, status: ${this.status} taskId: ${this.taskId}`,Ce,2617),6===this.status)return void w.R8("ignored call play because of player status is played",Ce,2620);if(7===this.status)return this.isLive()?void w.R8("ignored call play because of player status is ended with live mode",Ce,2625):(w.pq("replay to 0n because of player status is ended",Ce,2628),await this.replayTo(BigInt(0)),this.status=6,void this.fire(Ae.PLAYED));4!==this.status&&8!==this.status&&w.h2("player status is not loaded, please call load method first",Ce,2635),e.audio||e.video||(w.R8(`video and audio must play one, ignore options, we will try to play video and audio, taskId: ${this.taskId}`,Ce,2639),e.audio=!0,e.video=!0);const t=[];if(8===this.status)return this.useMSE?(t.push(Ue.MSEThread.unpause(this.taskId)),this.audio?this.audio.play():this.video&&this.video.play()):(this.selectedAudioStream&&this.selectedVideoStream&&this.GlobalData.stats.videoCurrentTime-this.GlobalData.stats.audioCurrentTime>BigInt(400)&&await Ue.AudioRenderThread.syncSeekTime(this.taskId,this.GlobalData.stats.videoCurrentTime),this.audioSourceNode&&(t.push(this.audioSourceNode.request("unpause")),t.push(Ue.AudioRenderThread.unpause(this.taskId))),this.videoDecoder2VideoRenderChannel&&t.push(this.VideoRenderThread.unpause(this.taskId))),Promise.all(t).then((()=>{this.status=6,this.fire(Ae.PLAYED),this.jitterBufferController&&this.jitterBufferController.start(),this.subtitleRender&&this.subtitleRender.start()}));this.status=5,this.fire(Ae.PLAYING),this.useMSE=await this.checkUseMSE(e),this.audioEnded=!0,this.videoEnded=!0,this.useMSE?await this.playUseMSE(e):await this.playUseDecoder(e);{const t=this.findBestStream(this.formatContext.streams,3);if(t&&e.subtitle&&this.isCodecIdSupported(n.f[15](t.codecpar+4),n.f[15](t.codecpar))){const e=this.externalSubtitleTasks.find((e=>e.streamId===t.id));await this.createSubtitleRender(t,e?e.taskId:this.subtitleTaskId||this.taskId)}if(this.subtitleRender&&this.externalSubtitleTasks.length)for(let e=0;e<this.externalSubtitleTasks.length;e++){const i=this.formatContext.streams.find((t=>t.id===this.externalSubtitleTasks[e].streamId));i!==t&&await Ue.DemuxerThread.connectStreamTask.transfer(this.subtitleRender.getDemuxerPort(this.externalSubtitleTasks[e].taskId)).invoke(this.externalSubtitleTasks[e].taskId,i.index,this.subtitleRender.getDemuxerPort(this.externalSubtitleTasks[e].taskId))}}let i=10;if(M.Yj(this.source)||this.source instanceof de.A){let e=this.isLive_?this.options.jitterBufferMin:this.options.preLoadTime;this.source instanceof de.A&&(e=Math.max(e,this.source.minBuffer)),this.formatContext.streams.forEach((t=>{0===n.f[15](t.codecpar)?i=Math.max(Math.ceil((0,H.lb)((0,d.A)(t.codecpar+72,h.Q))*e),i):1===n.f[15](t.codecpar)&&n.f[15](t.codecpar+144)&&(i=Math.max(Math.ceil(n.f[15](t.codecpar+136)/n.f[15](t.codecpar+144)*e),i))}))}if(this.subTaskId&&!this.selectedAudioStream||t.push(Ue.DemuxerThread.startDemux(this.taskId,this.isLive_,i)),this.subTaskId&&this.selectedVideoStream&&t.push(Ue.DemuxerThread.startDemux(this.subTaskId,this.isLive_,i)),this.subtitleTaskId&&this.selectedSubtitleStream&&t.push(Ue.DemuxerThread.startDemux(this.subtitleTaskId,this.isLive_,10)),this.seekedTimestamp>=BigInt(0)){let e=20;this.formatContext.streams.forEach((t=>{0===n.f[15](t.codecpar)&&(e=Math.max(Math.ceil((0,H.lb)((0,d.A)(t.codecpar+72,h.Q))),e))})),this.videoDecoder2VideoRenderChannel&&t.push(this.VideoRenderThread.syncSeekTime(this.taskId,this.seekedTimestamp,e)),this.audioDecoder2AudioRenderChannel&&t.push(Ue.AudioRenderThread.syncSeekTime(this.taskId,this.seekedTimestamp,e)),this.seekedTimestamp=N.Dh}return Promise.all(t).then((async()=>{if(this.useMSE){var e,t;if(await Promise.all([null===(e=this.video)||void 0===e?void 0:e.play(),null===(t=this.audio)||void 0===t?void 0:t.play()]).catch((e=>{if(this.fire(Ae.RESUME),w.R8("the audioContext was not started. It must be resumed after a user gesture",Ce,2765),this.video)return this.video.muted=!0,this.video.play()})),this.isMediaStreamMode()){I.A.firefox||((this.video||this.audio).muted=!0);const e=this.options.container,t=((this.video||this.audio).captureStream||(this.video||this.audio).mozCaptureStream).bind(this.video||this.audio)(),i=e.getAudioTracks()[0],r=e.getVideoTracks()[0];i&&e.removeTrack(i),r&&e.removeTrack(r);const s=t.getAudioTracks()[0],a=t.getVideoTracks()[0];s&&e.addTrack(s),a&&e.addTrack(a)}}else{const e=[];this.videoDecoder2VideoRenderChannel&&e.push(this.VideoRenderThread.play(this.taskId)),this.audioDecoder2AudioRenderChannel&&e.push(this.audioSourceNode.request("start",{port:this.audioRender2AudioWorkletChannel.port2,channels:this.playChannels},[this.audioRender2AudioWorkletChannel.port2])),await Promise.all(e),!this.audioSourceNode||"suspended"!==Ue.audioContext.state&&"interrupted"!==Ue.audioContext.state||("suspended"!==Ue.audioContext.state&&"interrupted"!==Ue.audioContext.state||(this.fire(Ae.RESUME),w.R8("the audioContext was not started. It must be resumed after a user gesture",Ce,2820)),this.videoDecoder2VideoRenderChannel&&(await Ue.AudioRenderThread.fakePlay(this.taskId),this.controller.setTimeUpdateListenType(0)))}this.status=6,this.fire(Ae.PLAYED),this.statsController.start(),this.jitterBufferController&&this.jitterBufferController.start(),this.subtitleRender&&this.subtitleRender.start()}))}async pause(){if(w.pq(`call pause, taskId: ${this.taskId}`,Ce,2845),!this.isLive_){const e=[];return this.useMSE?(this.audio&&this.audio.pause(),this.video&&this.video.pause(),e.push(Ue.MSEThread.pause(this.taskId))):(this.audioSourceNode&&(e.push(this.audioSourceNode.request("pause")),e.push(Ue.AudioRenderThread.pause(this.taskId))),this.videoDecoder2VideoRenderChannel&&e.push(this.VideoRenderThread.pause(this.taskId))),Promise.all(e).then((()=>{9===this.status?this.lastStatus=8:this.status=8,this.fire(Ae.PAUSED),this.jitterBufferController&&this.jitterBufferController.stop(),this.subtitleRender&&this.subtitleRender.pause()}))}w.R8(`pause can only used in vod, taskId: ${this.taskId}`,Ce,2885)}async doSeek(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var r,s;this.useMSE?await Ue.MSEThread.beforeSeek(this.taskId):await Promise.all([null===(r=Ue.AudioRenderThread)||void 0===r?void 0:r.beforeSeek(this.taskId),null===(s=this.VideoRenderThread)||void 0===s?void 0:s.beforeSeek(this.taskId)]),i.onBeforeSeek&&await i.onBeforeSeek();let a=N.Dh;if(this.isDash()||this.isHls()){if(this.subTaskId&&!this.selectedAudioStream||(a=await Ue.DemuxerThread.seek(this.taskId,e,16)),this.subTaskId&&this.selectedVideoStream){let t=await Ue.DemuxerThread.seek(this.subTaskId,e,16);a===N.Dh&&(a=t)}}else a=await Ue.DemuxerThread.seek(this.taskId,e,8,t);if(this.subtitleTaskId&&this.selectedSubtitleStream&&await Ue.DemuxerThread.seek(this.subtitleTaskId,e,16),a>=BigInt(0)?w.Yz(`seeked to packet timestamp: ${a}, taskId: ${this.taskId}`,Ce,2931):w.z3(`demuxer seek failed, code: ${a}, taskId: ${this.taskId}`,Ce,2934),this.useMSE)if(a>=BigInt(0)){const t=await Ue.MSEThread.afterSeek(this.taskId,a>e?a:e);this.video?this.video.currentTime=t:this.audio&&(this.audio.currentTime=t)}else await Ue.MSEThread.afterSeek(this.taskId,N.Dh);else{let t=20;var o,c,l,u,f,p,m,g,A,v;this.formatContext.streams.forEach((e=>{0===n.f[15](e.codecpar)&&(t=Math.max(Math.ceil((0,H.lb)((0,d.A)(e.codecpar+72,h.Q))),t))})),a>=BigInt(0)?(await Promise.all([null===(o=Ue.AudioDecoderThread)||void 0===o?void 0:o.resetTask(this.taskId),null===(c=this.VideoDecoderThread)||void 0===c?void 0:c.resetTask(this.taskId)]),await Promise.all([null===(l=Ue.AudioRenderThread)||void 0===l?void 0:l.syncSeekTime(this.taskId,a>e?a:e,t),null===(u=this.VideoRenderThread)||void 0===u?void 0:u.syncSeekTime(this.taskId,a>e?a:e,t)]),await Promise.all([null===(f=Ue.AudioRenderThread)||void 0===f?void 0:f.afterSeek(this.taskId,a>e?a:e),null===(p=this.VideoRenderThread)||void 0===p?void 0:p.afterSeek(this.taskId,a>e?a:e)])):(await Promise.all([null===(m=Ue.AudioRenderThread)||void 0===m?void 0:m.syncSeekTime(this.taskId,N.Dh,t),null===(g=this.VideoRenderThread)||void 0===g?void 0:g.syncSeekTime(this.taskId,N.Dh,t)]),await Promise.all([null===(A=Ue.AudioRenderThread)||void 0===A?void 0:A.afterSeek(this.taskId,N.Dh),null===(v=this.VideoRenderThread)||void 0===v?void 0:v.afterSeek(this.taskId,N.Dh)])),this.jitterBufferController&&this.jitterBufferController.reset()}if((4===this.lastStatus||3===this.lastStatus)&&a>=BigInt(0)&&(this.seekedTimestamp=a>e?a:e),this.subtitleRender)for(let e=0;e<this.externalSubtitleTasks.length;e++)await Ue.DemuxerThread.seek(this.externalSubtitleTasks[e].taskId,this.currentTime,8);this.subtitleRender&&(this.subtitleRender.reset(),this.subtitleRender.start())}async seek(e){if(w.pq(`call seek, timestamp: ${e}, taskId: ${this.taskId}`,Ce,3020),this.formatContext.streams.length)if(9!==this.status)if(this.isLive_)w.R8(`seek can only used in vod, taskId: ${this.taskId}`,Ce,3059);else{this.lastStatus=this.status,this.status=9,this.fire(Ae.SEEKING);let t=-1;this.selectedVideoStream&&!this.isAttachmentPicture(this.selectedVideoStream)?t=this.selectedVideoStream.index:this.selectedAudioStream&&(t=this.selectedAudioStream.index),7===this.lastStatus?(await this.replayTo(e),this.status=6,this.fire(Ae.SEEKED),this.fire(Ae.PLAYED)):(await this.doSeek(e,t),this.status=this.lastStatus,this.fire(Ae.SEEKED))}else w.R8(`player is seeking now, taskId: ${this.taskId}`,Ce,3028);else w.z3(`cannot found any stream to seek, taskId: ${this.taskId}`,Ce,3023)}getStreams(){return this.formatContext.streams.map((e=>({...e,mediaType:ne.yl(se.Mb,n.f[15](e.codecpar)),codecparProxy:(0,d.A)(e.codecpar,c.A)})))}getSelectedVideoStreamId(){return this.selectedVideoStream?this.selectedVideoStream.id:-1}getSelectedAudioStreamId(){return this.selectedAudioStream?this.selectedAudioStream.id:-1}getSelectedSubtitleStreamId(){return this.selectedSubtitleStream?this.selectedSubtitleStream.id:-1}getChapters(){return this.formatContext.chapters}getDuration(){if(!this.isLive_){let e=BigInt(0);return this.formatContext.streams.forEach((t=>{if(1===n.f[15](t.codecpar)||0===n.f[15](t.codecpar)){const i=(0,H.k)(t.duration,{den:t.timeBase.den,num:t.timeBase.num},N.i0);i>e&&(e=i)}})),e}return BigInt(0)}async stop(){var e;let t,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(w.pq(`call stop, taskId: ${this.taskId}`,Ce,3163),0!==this.status){if(this.stopPending)return this.stopPending;this.stopPending=new Promise((e=>{t=e})),this.audioSourceNode&&(9===this.status&&await Ue.AudioRenderThread.stop(this.taskId),await this.audioSourceNode.request("stop"),this.audioSourceNode.disconnect(),this.audioSourceNode=null),9===this.status&&Ue.DemuxerThread&&(await Ue.DemuxerThread.stop(this.taskId),this.subTaskId&&await Ue.DemuxerThread.stop(this.subTaskId),this.subtitleTaskId&&await Ue.DemuxerThread.stop(this.subtitleTaskId)),this.VideoRenderThread&&await this.VideoRenderThread.unregisterTask(this.taskId),Ue.AudioRenderThread&&await Ue.AudioRenderThread.unregisterTask(this.taskId),this.VideoDecoderThread&&await this.VideoDecoderThread.unregisterTask(this.taskId),Ue.AudioDecoderThread&&await Ue.AudioDecoderThread.unregisterTask(this.taskId),Ue.MSEThread&&await Ue.MSEThread.unregisterTask(this.taskId),Ue.DemuxerThread&&(this.subTaskId&&await Ue.DemuxerThread.unregisterTask(this.subTaskId),this.subtitleTaskId&&await Ue.DemuxerThread.unregisterTask(this.subtitleTaskId),await Ue.DemuxerThread.unregisterTask(this.taskId)),Ue.IOThread&&await Ue.IOThread.unregisterTask(this.taskId),this.ioIPCPort&&(await this.source.stop().catch((e=>{w.z3(`stop custom ioloader error, ${e}`,Ce,3228)})),this.ioIPCPort.destroy(),this.ioIPCPort=null);for(let e=0;e<this.externalSubtitleTasks.length;e++)await Ue.DemuxerThread.unregisterTask(this.externalSubtitleTasks[e].taskId),await Ue.IOThread.unregisterTask(this.externalSubtitleTasks[e].taskId);if(this.subtitleRender&&(this.subtitleRender.destroy(),this.subtitleRender=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.controller&&this.controller.destroy(),this.drmSession&&(await this.drmSession.close(),this.drmSession=null),null!==(e=this.video||this.audio)&&void 0!==e&&e.src&&URL.revokeObjectURL((this.video||this.audio).src),!this.isMediaStreamMode()){const e=this.options.container;this.video&&(e.removeChild(this.video),this.video=null),this.audio&&(e.removeChild(this.audio),this.audio=null),this.canvas&&(e.removeChild(this.canvas),this.canvas=null)}this.ioloader2DemuxerChannel=null,this.demuxer2VideoDecoderChannel=null,this.demuxer2AudioDecoderChannel=null,this.videoDecoder2VideoRenderChannel=null,this.audioDecoder2AudioRenderChannel=null,this.audioRender2AudioWorkletChannel=null,this.selectedAudioStream=null,this.selectedVideoStream=null,this.selectedSubtitleStream=null,this.lastSelectedInnerSubtitleStreamIndex=-1,this.source=null,this.ext="",this.subTaskId="",this.subtitleTaskId="",this.seekedTimestamp=N.Dh,this.statsController.stop(),this.jitterBufferController&&(this.jitterBufferController.stop(),this.jitterBufferController=null),this.changingStreamPending.length=0,this.status=0,t(),this.stopPending=null,i||this.fire(Ae.STOPPED),w.pq(`avplayer stopped, task: ${this.taskId}`,Ce,3308)}else w.pq(`player has already stopped, taskId: ${this.taskId}`,Ce,3166)}setPlaybackRate(e){var t,i,r,s;this.isLive_?w.R8(`setPlaybackRate can only used in playback, taskId: ${this.taskId}`,Ce,3336):(this.playRate=(0,C.A)(e,.5,2),this.useMSE?(null===(t=Ue.MSEThread)||void 0===t||t.setPlayRate(this.taskId,this.playRate),this.video?this.video.playbackRate=this.playRate:this.audio&&(this.audio.playbackRate=this.playRate)):(null===(i=Ue.AudioRenderThread)||void 0===i||i.setPlayTempo(this.taskId,this.playRate),null===(r=this.VideoRenderThread)||void 0===r||r.setPlayRate(this.taskId,this.playRate),null===(s=this.VideoDecoderThread)||void 0===s||s.setPlayRate(this.taskId,this.playRate)),w.pq(`player call setPlaybackRate, set ${this.playRate}, taskId: ${this.taskId}`,Ce,3333))}getPlaybackRate(){return this.playRate}async resume(){var e,t;"suspended"!==(null===(e=Ue.audioContext)||void 0===e?void 0:e.state)&&"interrupted"!==(null===(t=Ue.audioContext)||void 0===t?void 0:t.state)||(await Promise.race([Ue.audioContext.resume(),new B.A(.1)]),"suspended"===Ue.audioContext.state||"interrupted"===Ue.audioContext.state?w.R8("the audioContext was not allowed to start. It must be resumed after a user gesture",Ce,3365):(this.audioSourceNode&&this.controller.setTimeUpdateListenType(1),this.fire(Ae.AUDIO_CONTEXT_RUNNING))),this.video?(this.video.muted=!1,this.video.paused&&await this.video.play()):this.audio&&(this.audio.muted=!1,this.audio.paused&&await this.audio.play()),w.pq(`call resume, taskId: ${this.taskId}`,Ce,3387)}isSuspended(){var e,t;return"suspended"===(null===(e=Ue.audioContext)||void 0===e?void 0:e.state)||"interrupted"===(null===(t=Ue.audioContext)||void 0===t?void 0:t.state)}getVolume(){return this.volume}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.volume=this.useMSE?(0,C.A)(e,0,1):(0,C.A)(e,0,3),this.gainNode&&Ue.audioContext?(this.gainNode.gain.cancelScheduledValues(Ue.audioContext.currentTime),I.A.firefox&&!t?this.gainNode.gain.setValueAtTime(this.volume,Ue.audioContext.currentTime+1):0===this.gainNode.gain.value||0===this.volume||t?this.gainNode.gain.value=this.volume:this.gainNode.gain.exponentialRampToValueAtTime(this.volume,Ue.audioContext.currentTime+1)):this.video?this.video.volume=this.volume:this.audio&&(this.audio.volume=this.volume),this.fire(Ae.VOLUME_CHANGE,[this.volume]),w.pq(`player call setVolume, set ${e}, used ${this.volume}, taskId: ${this.taskId}`,Ce,3439)}getRenderMode(){return this.renderMode}setRenderMode(e){var t;this.renderMode=e,this.useMSE&&this.video?this.video.style["object-fit"]=Re[this.renderMode]:null===(t=this.VideoRenderThread)||void 0===t||t.setRenderMode(this.taskId,e),w.pq(`player call setRenderMode, mode: ${e}, taskId: ${this.taskId}`,Ce,3469)}getVideoTransformContext(){let e="";return 0!==this.renderRotate&&(e+=`rotateZ(${this.renderRotate}deg)`),this.flipHorizontal&&(e+=(e.length?" ":"")+"scaleX(-1)"),this.flipVertical&&(e+=(e.length?" ":"")+"scaleY(-1)"),e}setRotate(e){var t;this.renderRotate=e,this.useMSE&&this.video?this.video.style.transform=this.getVideoTransformContext():null===(t=this.VideoRenderThread)||void 0===t||t.setRenderRotate(this.taskId,e),w.pq(`player call setRotate, angle: ${e}, taskId: ${this.taskId}`,Ce,3499)}enableHorizontalFlip(e){var t;this.flipHorizontal=e,this.useMSE&&this.video?this.video.style.transform=this.getVideoTransformContext():null===(t=this.VideoRenderThread)||void 0===t||t.enableHorizontalFlip(this.taskId,e),w.pq(`player call enableHorizontalFlip, enable: ${e}, taskId: ${this.taskId}`,Ce,3510)}enableVerticalFlip(e){var t;this.flipVertical=e,this.useMSE&&this.video?this.video.style.transform=this.getVideoTransformContext():null===(t=this.VideoRenderThread)||void 0===t||t.enableVerticalFlip(this.taskId,e),w.pq(`player call enableVerticalFlip, enable: ${e}, taskId: ${this.taskId}`,Ce,3521)}setLoop(e){this.options.loop=e,w.pq(`call setLoop, enable: ${e}, taskId: ${this.taskId}`,Ce,3533)}setSubtitleDelay(e){this.subtitleRender&&this.getSubtitleDelay()!==e&&(this.subtitleRender.setDelay(BigInt(0|e)),w.pq(`set subtitle delay ${e}`,Ce,3546),this.fire(Ae.SUBTITLE_DELAY_CHANGE,[e]))}getSubtitleDelay(){return this.subtitleRender?Number(BigInt.asIntN(32,this.subtitleRender.getDelay())):0}setSubtitleEnable(e){if(this.subtitleRender&&this.selectedSubtitleStream)if(e){const e=this.externalSubtitleTasks.find((e=>e.streamId===this.selectedSubtitleStream.id));e&&Ue.DemuxerThread.seek(e.taskId,this.currentTime,8),this.subtitleRender.reset(),this.subtitleRender.start()}else this.subtitleRender.stop()}resize(e,t){var i;this.useMSE||null===(i=this.VideoRenderThread)||void 0===i||i.resize(this.taskId,e,t),w.pq(`player call resize, width: ${e}, height: ${t}, taskId: ${this.taskId}`,Ce,3597)}isMSE(){return this.useMSE}isMediaStreamMode(){return"function"==typeof MediaStream&&this.options.container instanceof MediaStream}isLive(){return this.isLive_}async getVideoList(){var e;return null===(e=Ue.IOThread)||void 0===e?void 0:e.getVideoList(this.taskId)}async getAudioList(){var e;return null===(e=Ue.IOThread)||void 0===e?void 0:e.getAudioList(this.taskId)}async getSubtitleList(){var e;return null===(e=Ue.IOThread)||void 0===e?void 0:e.getSubtitleList(this.taskId)}getStatus(){return this.status}hasAudio(){return!!this.selectedAudioStream}hasVideo(){return!!this.selectedVideoStream}hasSubtitle(){return!!this.selectedSubtitleStream}getSource(){return this.source}getFormatContext(){return this.formatContext}getExternalSubtitle(){return this.externalSubtitleTasks.map((e=>({source:e.source,lang:e.lang,title:e.title})))}getOptions(){return this.options}getAudioOutputNode(){return this.gainNode}isPictureInPicture(){return this.useMSE?this.video&&document.pictureInPictureElement===this.video:!(!this.canvas||"object"!=typeof documentPictureInPicture)&&documentPictureInPicture.window&&documentPictureInPicture.window.document.body.querySelector("#"+this.canvas.id)===this.canvas}async selectVideo(e,t){if(this.isHls()||this.isDash()){if(w.pq(`call IOThread selectVideo, index: ${e}, taskId: ${this.taskId}`,Ce,3762),10===this.status)return void w.R8(`player is changing now, taskId: ${this.taskId}`,Ce,3765);const{selectedIndex:i}=await Ue.IOThread.getVideoList(this.taskId);if(this.lastStatus=this.status,this.status=10,this.fire(Ae.CHANGING,[0,e,i]),t||this.isLive()){const t=await Ue.IOThread.selectVideo(this.taskId,e);if(this.status=this.lastStatus,t>=0){const e=this.changingStreamPending.find((e=>0===e.mediaType&&e.start===t));await new Promise((i=>{e?e.pending.resolve=i:(this.changingStreamPending.push({pending:{resolve:i},mediaType:0,start:t}),this.handleChangingStreamPendingTimer.isStarted()||this.handleChangingStreamPendingTimer.start())}))}}else{let t=this.currentTime,i=-1;this.selectedVideoStream?i=this.selectedVideoStream.index:this.selectedAudioStream&&(i=this.selectedAudioStream.index),await this.doSeek(t,i,{onBeforeSeek:async()=>{await Ue.IOThread.selectVideo(this.taskId,e)}}),this.status=this.lastStatus}this.fire(Ae.CHANGED,[0,e,i])}else{const t=this.formatContext.streams.find((t=>t.id===e));if(this.selectedVideoStream&&t&&0===n.f[15](t.codecpar)&&t!==this.selectedVideoStream&&!(1024&t.disposition)){if(10===this.status)return void w.R8(`player is changing now, taskId: ${this.taskId}`,Ce,3829);const e=this.selectedVideoStream.id;this.lastStatus=this.status,this.status=10,this.fire(Ae.CHANGING,[0,t.id,e]),this.useMSE?(I.A.safari&&(this.status=this.lastStatus,w.h2("safari not support switch stream in mse, please use chrome",Ce,3840)),(0,ke.A)().isTypeSupported((0,O.A)(t.codecpar))||(this.status=this.lastStatus,w.h2(`select video stream(${t.index}) not support mse`,Ce,3844)),await this.doSeek(this.currentTime,t.index,{onBeforeSeek:async()=>{await Ue.DemuxerThread.changeConnectStream(this.taskId,t.index,this.selectedVideoStream.index),await Ue.MSEThread.reAddStream(this.taskId,t.index,(0,ee.Wu)(t.codecpar),t.timeBase,t.metadata,t.startTime)}})):(T.zy(Be,n.f[15](t.codecpar+4))||(this.status=this.lastStatus,w.h2(`select video stream(${t.index}) not support`,Ce,3863)),await this.doSeek(this.currentTime,t.index,{onBeforeSeek:async()=>{await Ue.DemuxerThread.changeConnectStream(this.taskId,t.index,this.selectedVideoStream.index),await this.VideoDecoderThread.reopenDecoder(this.taskId,(0,ee.Wu)(t.codecpar),await this.getResource("decoder",n.f[15](t.codecpar+4),0))}})),w.pq(`changed selected video stream, from ${this.selectedVideoStream.id} to ${t.id}, taskId: ${this.taskId}`,Ce,3877),this.selectedVideoStream=t,this.subtitleRender&&this.subtitleRender.updateVideoResolution(n.f[15](t.codecpar+56),n.f[15](t.codecpar+60)),this.status=this.lastStatus,this.fire(Ae.CHANGED,[0,t.id,e])}}}async selectAudio(e,t){if(this.isHls()||this.isDash()){if(w.pq(`call IOThread selectAudio, index: ${e}, taskId: ${this.taskId}`,Ce,3899),10===this.status)return void w.R8(`player is changing now, taskId: ${this.taskId}`,Ce,3902);const{selectedIndex:i}=await Ue.IOThread.getAudioList(this.taskId);if(this.lastStatus=this.status,this.status=10,this.fire(Ae.CHANGING,[1,e,i]),t||this.isLive()){const t=await Ue.IOThread.selectAudio(this.taskId,e);if(this.status=this.lastStatus,t>=0){const e=this.changingStreamPending.find((e=>1===e.mediaType&&e.start===t));await new Promise(((i,r)=>{e?e.pending.resolve=i:(this.changingStreamPending.push({pending:{resolve:i},mediaType:1,start:t}),this.handleChangingStreamPendingTimer.isStarted()||this.handleChangingStreamPendingTimer.start())}))}}else{let t=this.currentTime,i=-1;this.selectedVideoStream?i=this.selectedVideoStream.index:this.selectedAudioStream&&(i=this.selectedAudioStream.index),await this.doSeek(t,i,{onBeforeSeek:async()=>{await Ue.IOThread.selectAudio(this.taskId,e)}}),this.status=this.lastStatus}this.fire(Ae.CHANGED,[1,e,i])}else{const t=this.formatContext.streams.find((t=>t.id===e));if(this.selectedAudioStream&&t&&1===n.f[15](t.codecpar)&&t!==this.selectedAudioStream){if(10===this.status)return void w.R8(`player is changing now, taskId: ${this.taskId}`,Ce,3960);const e=this.selectedAudioStream.id;if(this.lastStatus=this.status,this.status=10,this.fire(Ae.CHANGING,[1,t.id,e]),n.f[15](t.codecpar+4)!==n.f[15](this.selectedAudioStream.codecpar+4)||n.f[15](t.codecpar+136)!==n.f[15](this.selectedAudioStream.codecpar+136)||n.f[15](t.codecpar+116)!==n.f[15](this.selectedAudioStream.codecpar+116)||n.f[15](t.codecpar+48)!==n.f[15](this.selectedAudioStream.codecpar+48))if(this.useMSE){I.A.safari&&(this.status=this.lastStatus,w.h2("safari not support switch stream in mse, please use chrome",Ce,3976));let e=t.index;this.selectedVideoStream&&(e=this.selectedVideoStream.index),(0,ke.A)().isTypeSupported((0,z.A)(t.codecpar))||(this.status=this.lastStatus,w.h2(`select audio stream(${t.index}) not support mse`,Ce,3984)),await this.doSeek(this.currentTime,e,{onBeforeSeek:async()=>{await Ue.DemuxerThread.changeConnectStream(this.taskId,t.index,this.selectedAudioStream.index),await Ue.MSEThread.reAddStream(this.taskId,t.index,(0,ee.Wu)(t.codecpar),t.timeBase,t.metadata,t.startTime)}})}else T.zy(Be,n.f[15](t.codecpar+4))||(this.status=this.lastStatus,w.h2(`select audio stream(${t.index}) not support`,Ce,3996)),await Ue.AudioDecoderThread.beforeReopenDecoder(this.taskId),await Ue.DemuxerThread.changeConnectStream(this.taskId,t.index,this.selectedAudioStream.index,!0,!0),await Ue.AudioDecoderThread.reopenDecoder(this.taskId,(0,ee.Wu)(t.codecpar),await this.getResource("decoder",n.f[15](t.codecpar+4),1)),this.audioEnded&&(this.audioDecoder2AudioRenderChannel&&(await Ue.AudioDecoderThread.resetTask(this.taskId),await Ue.AudioRenderThread.restart(this.taskId),await Ue.AudioRenderThread.syncSeekTime(this.taskId,this.currentTime),this.controller.setTimeUpdateListenType(1)),this.audioSourceNode&&(await this.audioSourceNode.request("restart"),"suspended"!==Ue.audioContext.state&&"interrupted"!==Ue.audioContext.state||await Ue.AudioRenderThread.fakePlay(this.taskId)),this.audioEnded=!1);else await Ue.DemuxerThread.changeConnectStream(this.taskId,t.index,this.selectedAudioStream.index,!1);w.pq(`changed selected audio stream, from ${this.selectedAudioStream.id} to ${t.id}, taskId: ${this.taskId}`,Ce,4029),this.selectedAudioStream=t,this.status=this.lastStatus,this.fire(Ae.CHANGED,[1,t.id,e])}}}async selectSubtitle(e){if(this.isHls()||this.isDash()){if(w.pq(`call IOThread selectSubtitle, index: ${e}, taskId: ${this.taskId}`,Ce,4048),10===this.status)return void w.R8(`player is changing now, taskId: ${this.taskId}`,Ce,4051);const{selectedIndex:t}=await Ue.IOThread.getSubtitleList(this.taskId);this.lastStatus=this.status,this.status=10,this.fire(Ae.CHANGING,[3,e,t]),await Ue.IOThread.selectSubtitle(this.taskId,e),this.subtitleTaskId&&await Ue.DemuxerThread.seek(this.subtitleTaskId,this.currentTime,16),this.subtitleRender&&(this.subtitleRender.reset(),this.subtitleRender.start()),this.status=this.lastStatus,this.fire(Ae.CHANGED,[3,e,t])}else{const t=this.formatContext.streams.find((t=>t.id===e));if(this.selectedSubtitleStream&&t&&3===n.f[15](t.codecpar)&&t!==this.selectedSubtitleStream){if(10===this.status)return void w.R8(`player is changing now, taskId: ${this.taskId}`,Ce,4075);const e=this.selectedSubtitleStream.id;this.lastStatus=this.status,this.status=10,this.fire(Ae.CHANGING,[3,t.id,e]),this.subtitleRender.reopenDecoder(t.codecpar);const i=this.externalSubtitleTasks.find((e=>e.streamId===t.id));i?(this.subtitleRender.setDemuxTask(i.taskId),this.subtitleRender.reset(),await Ue.DemuxerThread.seek(i.taskId,this.currentTime,8,t.index)):(this.subtitleRender.setDemuxTask(this.taskId),-1===this.lastSelectedInnerSubtitleStreamIndex?await Ue.DemuxerThread.connectStreamTask.transfer(this.subtitleRender.getDemuxerPort(this.taskId)).invoke(this.taskId,t.index,this.subtitleRender.getDemuxerPort(this.taskId)):await Ue.DemuxerThread.changeConnectStream(this.taskId,t.index,this.lastSelectedInnerSubtitleStreamIndex,!1),this.externalSubtitleTasks.find((e=>e.streamId===this.selectedSubtitleStream.id))&&this.subtitleRender.reset(),this.lastSelectedInnerSubtitleStreamIndex=t.index),this.subtitleRender&&this.subtitleRender.start(),w.pq(`changed selected subtitle stream, from ${this.selectedSubtitleStream.id} to ${t.id}, taskId: ${this.taskId}`,Ce,4115),this.selectedSubtitleStream=t,this.status=this.lastStatus,this.fire(Ae.CHANGED,[3,t.id,e])}else w.z3(`call selectSubtitle failed, id: ${e}, taskId: ${this.taskId}`,Ce,4123)}}async playNextFrame(){!this.useMSE&&8===this.status&&this.selectedVideoStream&&await this.VideoRenderThread.renderNextFrame(this.taskId)}enterFullscreen(){if(this.isMediaStreamMode())return;const e=this.options.container;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),w.pq(`player call enterFullscreen, taskId: ${this.taskId}`,Ce,4158)}exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozExitFullScreen?document.mozExitFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),w.pq(`player call exitFullscreen, taskId: ${this.taskId}`,Ce,4174)}snapshot(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.useMSE&&this.video){const i=document.createElement("canvas");return i.width=this.video.videoWidth,i.height=this.video.videoHeight,i.getContext("2d").drawImage(this.video,0,0),i.toDataURL(`image/${e}`,t)}if(this.canvas)return this.canvas.toDataURL(`image/${e}`,t)}getStats(){return this.GlobalData.stats}async destroy(){w.pq(`call destroy, taskId: ${this.taskId}`,Ce,4213),2!==this.status?(await this.stop(),this.VideoPipelineProxy&&(await this.VideoDecoderThread.clear(),await this.VideoRenderThread.clear(),await this.VideoPipelineProxy.destroy(),this.VideoDecoderThread=null,this.VideoPipelineProxy=null),this.VideoDecoderThread&&(await this.VideoDecoderThread.clear(),(0,F.nE)(this.VideoDecoderThread),this.VideoDecoderThread=null),this.VideoRenderThread=null,this.GlobalData&&(this.GlobalData.avframeList.clear((e=>{(0,ie.to)(e)}),20),this.GlobalData.avpacketList.clear((e=>{(0,X.Up)(e)}),20),U.zr(this.GlobalData[s.o9]+24),U.zr(this.GlobalData[s.o9]+28),(0,l.A)(this.GlobalData),this.GlobalData=null),T.TF(Ue.Instances,this),this.status=2):w.R8(`player has already destroyed, taskId: ${this.taskId}`,Ce,4216)}onVideoEnded(){this.videoEnded=!0,this.handleEnded()}onAudioEnded(){this.audioEnded=!0,this.selectedVideoStream&&this.controller.setTimeUpdateListenType(0),this.handleEnded()}onCanvasUpdated(){this.updateCanvas=this.createCanvas(),this.updateCanvas.width=this.options.container.offsetWidth*devicePixelRatio,this.updateCanvas.height=this.options.container.offsetHeight*devicePixelRatio;const e=(0,ve.A)()&&(E.USE_THREADS||k.A.worker&&this.options.enableWorker)?this.updateCanvas.transferControlToOffscreen():this.updateCanvas;this.VideoRenderThread.updateCanvas.transfer(e).invoke(this.taskId,e)}async onGetDecoderResource(e,t){return this.getResource("decoder",t,e)}onFirstVideoRendered(){w.pq(`first video frame rendered, taskId: ${this.taskId}`,Ce,4309),this.fire(Ae.FIRST_VIDEO_RENDERED)}onFirstAudioRendered(){w.pq(`first audio frame rendered, taskId: ${this.taskId}`,Ce,4317),this.fire(Ae.FIRST_AUDIO_RENDERED)}onAudioStutter(){6===this.status&&this.GlobalData.stats.audioStutter++}onVideoStutter(){6===this.status&&this.GlobalData.stats.videoStutter++}onVideoDiscard(){6===this.status&&this.VideoDecoderThread.setNextDiscard(this.taskId)}onFirstVideoRenderedAfterUpdateCanvas(){if(this.updateCanvas&&!this.isMediaStreamMode()){const e=this.options.container;this.canvas&&e.removeChild(this.canvas),this.canvas=this.updateCanvas,e.appendChild(this.canvas),this.updateCanvas=null}}onTimeUpdate(e){this.fire(Ae.TIME,[this.currentTime])}onMSESeek(e){const t=this.audio||this.video;t.buffered.length?t.currentTime=e:setTimeout((()=>{t.currentTime=e}),500)}onMasterTimerUpdate(e){var t,i;null===(t=Ue.AudioRenderThread)||void 0===t||t.setMasterTime(this.taskId,e),null===(i=Ue.VideoRenderThread)||void 0===i||i.setMasterTime(this.taskId,e)}onAudioContextStateChange(){"interrupted"!==Ue.audioContext.state&&"suspended"!==Ue.audioContext.state||6!==this.status&&8!==this.status||(w.R8(`the audioContext state changed to ${Ue.audioContext.state}. It may be resumed after a user gesture`,Ce,4399),Ue.AudioRenderThread.fakePlay(this.taskId),this.fire(Ae.RESUME))}onError(e){this.fire(Ae.ERROR,[e])}async createVideoDecoderThread(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.VideoDecoderThread||(!E.USE_THREADS&&k.A.worker&&e&&(0,ve.A)()?(this.VideoPipelineProxy=new Ie.A,await this.VideoPipelineProxy.run(),this.VideoPipelineProxy.setLogLevel(Ue.level),this.VideoDecoderThread=this.VideoPipelineProxy.VideoDecodePipeline,this.VideoRenderThread=this.VideoPipelineProxy.VideoRenderPipeline):(this.VideoDecoderThread=await(0,F.pt)(u.A,{name:"VideoDecoderThread"},79893).run(),this.VideoDecoderThread.setLogLevel(Ue.level),this.VideoRenderThread=Ue.VideoRenderThread))}static async startDemuxPipeline(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Ue.DemuxThreadReady?Ue.DemuxThreadReady:Ue.DemuxThreadReady=new Promise((async t=>{!E.USE_THREADS&&k.A.worker&&e?(Ue.IODemuxProxy=new xe.A,await Ue.IODemuxProxy.run(),Ue.IODemuxProxy.setLogLevel(Ue.level),Ue.IOThread=Ue.IODemuxProxy.IOPipeline,Ue.DemuxerThread=Ue.IODemuxProxy.DemuxPipeline):(Ue.IOThread=await(0,F.pt)(f.A,{name:"IOThread"},24482).run(),Ue.IOThread.setLogLevel(Ue.level),Ue.DemuxerThread=await(0,F.pt)(p.A,{name:"DemuxerThread"},30131).run(),Ue.DemuxerThread.setLogLevel(Ue.level)),t()}))}static async startAudioContext(){Ue.audioContext||(Ue.audioContext=new(AudioContext||webkitAudioContext)),Ue.audioContext.addEventListener("statechange",(()=>{T.__(Ue.Instances,(e=>{e.onAudioContextStateChange()}))})),k.A.audioWorklet&&await(0,me.A)(Ue.audioContext,!E.USE_THREADS||I.A.safari&&!I.A.checkVersion(I.A.version,"16.1",!0)||_.A.ios&&!I.A.checkVersion(_.A.version,"16.1",!0)?46962:34978)}static async startAudioPipeline(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Ue.AudioThreadReady?Ue.AudioThreadReady:Ue.AudioThreadReady=new Promise((async t=>{await Ue.startAudioContext(),!E.USE_THREADS&&k.A.worker&&e?(Ue.AudioPipelineProxy=new Te.A,await Ue.AudioPipelineProxy.run(),Ue.AudioPipelineProxy.setLogLevel(Ue.level),Ue.AudioDecoderThread=Ue.AudioPipelineProxy.AudioDecodePipeline,Ue.AudioRenderThread=Ue.AudioPipelineProxy.AudioRenderPipeline):(Ue.AudioDecoderThread=await(0,F.pt)(m.A,{name:"AudioDecoderThread"},35688).run(),Ue.AudioDecoderThread.setLogLevel(Ue.level),Ue.AudioRenderThread=await(0,F.pt)(g.A,{name:"AudioRenderThread"},31370).run(),Ue.AudioRenderThread.setLogLevel(Ue.level)),t()}))}static async startVideoRenderPipeline(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Ue.VideoThreadReady?Ue.VideoThreadReady:Ue.VideoThreadReady=new Promise((async t=>{!E.USE_THREADS&&k.A.worker&&e&&(0,ve.A)()||(Ue.VideoRenderThread=await(0,F.pt)(A.A,{name:"VideoRenderThread",disableWorker:!(0,ve.A)()},57599).run(),Ue.VideoRenderThread.setLogLevel(Ue.level)),t()}))}static async startMSEPipeline(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Ue.MSEThreadReady?Ue.MSEThreadReady:Ue.MSEThreadReady=new Promise((async t=>{if(!E.USE_THREADS&&k.A.worker&&e&&k.A.workerMSE)await Promise.all([i.e(945),i.e(452)]).then(i.bind(i,75452)),Ue.MSEPipelineProxy=new _e.A,await Ue.MSEPipelineProxy.run(),Ue.MSEPipelineProxy.setLogLevel(Ue.level),Ue.MSEThread=Ue.MSEPipelineProxy.MSEPipeline;else{const e=(await Promise.all([i.e(945),i.e(452)]).then(i.bind(i,75452))).default;Ue.MSEThread=await(0,F.pt)(e,{name:"MSEThread",disableWorker:!k.A.workerMSE},75452).run(),Ue.MSEThread.setLogLevel(Ue.level)}t()}))}static async startPipelines(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];await Ue.startDemuxPipeline(e),await Ue.startAudioPipeline(e),await Ue.startVideoRenderPipeline(e),await Ue.startMSEPipeline(e),w.pq("AVPlayer pipelines started",Ce,4596)}static async stopPipelines(){Ue.VideoRenderThread&&(await Ue.VideoRenderThread.clear(),(0,F.nE)(Ue.VideoRenderThread)),Ue.AudioPipelineProxy&&(await Ue.AudioRenderThread.clear(),await Ue.AudioDecoderThread.clear(),await Ue.AudioPipelineProxy.destroy(),Ue.AudioRenderThread=null,Ue.AudioDecoderThread=null),Ue.AudioRenderThread&&(await Ue.AudioRenderThread.clear(),(0,F.nE)(Ue.AudioRenderThread)),Ue.AudioDecoderThread&&(await Ue.AudioDecoderThread.clear(),(0,F.nE)(Ue.AudioDecoderThread)),Ue.IODemuxProxy&&(await Ue.DemuxerThread.clear(),await Ue.IOThread.clear(),await Ue.IODemuxProxy.destroy(),Ue.DemuxerThread=null,Ue.IOThread=null),Ue.DemuxerThread&&(await Ue.DemuxerThread.clear(),(0,F.nE)(Ue.DemuxerThread)),Ue.IOThread&&(await Ue.IOThread.clear(),(0,F.nE)(Ue.IOThread)),Ue.MSEPipelineProxy&&(await Ue.MSEThread.clear(),Ue.MSEPipelineProxy.destroy(),Ue.MSEThread=null),Ue.MSEThread&&(await Ue.MSEThread.clear(),(0,F.nE)(Ue.MSEThread)),Ue.AudioPipelineProxy=null,Ue.AudioDecoderThread=null,Ue.IODemuxProxy=null,Ue.DemuxerThread=null,Ue.IOThread=null,Ue.audioContext=null,Ue.MSEThread=null,Ue.MSEPipelineProxy=null,Ue.DemuxThreadReady=null,Ue.VideoThreadReady=null,Ue.AudioThreadReady=null,Ue.MSEThreadReady=null,w.pq("AVPlayer pipelines stopped",Ce,4666)}static setLogLevel(e){Ue.level=e,w.V$(e),Ue.IOThread&&Ue.IOThread.setLogLevel(e),Ue.DemuxerThread&&Ue.DemuxerThread.setLogLevel(e),Ue.AudioDecoderThread&&Ue.AudioDecoderThread.setLogLevel(e),Ue.AudioRenderThread&&Ue.AudioRenderThread.setLogLevel(e),Ue.VideoRenderThread&&Ue.VideoRenderThread.setLogLevel(e),Ue.MSEThread&&Ue.MSEThread.setLogLevel(e),w.pq(`set log level: ${e}`,Ce,4698)}on(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.on(e,y.X$({fn:t},i)),this}one(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return super.on(e,y.X$({fn:t,max:1},i)),this}}(0,r.A)(Ue,"Instances",[]),(0,r.A)(Ue,"Util",{compile:V.A,browser:I.A,os:_.A}),(0,r.A)(Ue,"Events",Ae),(0,r.A)(Ue,"IOLoader",{CustomIOLoader:de.A,FetchIOLoader:ce.A,FileIOLoader:le.A,WebSocketIOLoader:ue.A,SocketIOLoader:fe.A,WebTransportIOLoader:pe.A}),(0,r.A)(Ue,"level",w.rD),(0,r.A)(Ue,"DemuxThreadReady",void 0),(0,r.A)(Ue,"AudioThreadReady",void 0),(0,r.A)(Ue,"VideoThreadReady",void 0),(0,r.A)(Ue,"MSEThreadReady",void 0),(0,r.A)(Ue,"IODemuxProxy",void 0),(0,r.A)(Ue,"AudioPipelineProxy",void 0),(0,r.A)(Ue,"MSEPipelineProxy",void 0),(0,r.A)(Ue,"IOThread",void 0),(0,r.A)(Ue,"DemuxerThread",void 0),(0,r.A)(Ue,"AudioDecoderThread",void 0),(0,r.A)(Ue,"AudioRenderThread",void 0),(0,r.A)(Ue,"VideoRenderThread",void 0),(0,r.A)(Ue,"MSEThread",void 0),(0,r.A)(Ue,"audioContext",void 0),(0,r.A)(Ue,"Resource",new Map)},51405:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(19371),s=i(18186),a=i(85266);class o{constructor(e,t){(0,r.A)(this,"videoRenderControlChannel",void 0),(0,r.A)(this,"audioRenderControlChannel",void 0),(0,r.A)(this,"muxerControlChannel",void 0),(0,r.A)(this,"demuxerControlChannel",void 0),(0,r.A)(this,"videoRenderControlIPCPort",void 0),(0,r.A)(this,"audioRenderControlIPCPort",void 0),(0,r.A)(this,"muxerControlIPCPort",void 0),(0,r.A)(this,"demuxerControlIPCPort",void 0),(0,r.A)(this,"observer",void 0),(0,r.A)(this,"visibilityHidden",void 0),(0,r.A)(this,"onVisibilityChange",void 0),(0,r.A)(this,"timeUpdateListenType",void 0),(0,r.A)(this,"enableAudioVideoSync",void 0),this.observer=e,this.videoRenderControlChannel=(0,s.A)(t),this.audioRenderControlChannel=(0,s.A)(t),this.muxerControlChannel=(0,s.A)(t),this.demuxerControlChannel=(0,s.A)(t),this.videoRenderControlIPCPort=new a.Ay(this.videoRenderControlChannel.port2),this.audioRenderControlIPCPort=new a.Ay(this.audioRenderControlChannel.port2),this.muxerControlIPCPort=new a.Ay(this.muxerControlChannel.port2),this.demuxerControlIPCPort=new a.Ay(this.demuxerControlChannel.port2),this.enableAudioVideoSync=!0,this.videoRenderControlIPCPort.on(a.Wo,(e=>{switch(e.method){case"ended":this.observer.onVideoEnded();break;case"updateCanvas":this.observer.onCanvasUpdated();break;case"firstRendered":this.observer.onFirstVideoRendered();break;case"firstRenderedAfterUpdateCanvas":this.observer.onFirstVideoRenderedAfterUpdateCanvas();break;case"syncPts":0===this.timeUpdateListenType&&this.observer.onTimeUpdate(e.params.pts)}})),this.audioRenderControlIPCPort.on(a.Wo,(e=>{switch(e.method){case"syncPts":this.enableAudioVideoSync&&this.videoRenderControlIPCPort.notify("syncPts",e.params),1===this.timeUpdateListenType&&this.observer.onTimeUpdate(e.params.pts);break;case"ended":this.observer.onAudioEnded(),this.timeUpdateListenType=0}})),this.muxerControlIPCPort.on(a.Wo,(e=>{"seek"===e.method&&this.observer.onMSESeek(e.params.time)})),this.demuxerControlIPCPort.on(a.S3,(async e=>{"getDecoderResource"===e.method&&this.demuxerControlIPCPort.reply(e,await this.observer.onGetDecoderResource(e.params.mediaType,e.params.codecId))})),this.demuxerControlIPCPort.on(a.Wo,(async e=>{"demuxError"===e.method&&this.observer.onError(new Error(`demux error, code: ${e.params.code}`))})),this.onVisibilityChange=t=>{this.visibilityHidden="hidden"===document.visibilityState&&!this.observer.isPictureInPicture(),e.isMediaStreamMode()||this.videoRenderControlIPCPort.notify("skipRender",{skipRender:this.visibilityHidden}),this.muxerControlIPCPort.notify("visibilitychange",{visibilityHidden:this.visibilityHidden})},this.visibilityHidden="hidden"===document.visibilityState&&!this.observer.isPictureInPicture(),document.addEventListener("visibilitychange",this.onVisibilityChange),this.muxerControlIPCPort.notify("visibilitychange",{visibilityHidden:this.visibilityHidden})}getVideoRenderControlPort(){return this.videoRenderControlChannel.port1}getAudioRenderControlPort(){return this.audioRenderControlChannel.port1}getMuxerControlPort(){return this.muxerControlChannel.port1}getDemuxerControlPort(){return this.demuxerControlChannel.port1}setTimeUpdateListenType(e){this.timeUpdateListenType=e}setEnableAudioVideoSync(e){this.enableAudioVideoSync=e}destroy(){this.videoRenderControlIPCPort&&this.videoRenderControlIPCPort.destroy(),this.audioRenderControlIPCPort&&this.audioRenderControlIPCPort.destroy(),this.muxerControlIPCPort&&this.muxerControlIPCPort.destroy(),this.demuxerControlIPCPort&&this.demuxerControlIPCPort.destroy(),this.onVisibilityChange&&(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.onVisibilityChange=null),this.videoRenderControlIPCPort=this.audioRenderControlIPCPort=this.muxerControlIPCPort=this.videoRenderControlChannel=this.audioRenderControlChannel=this.demuxerControlChannel=this.muxerControlChannel=null}}},98277:(e,t,i)=>{i.d(t,{A:()=>d});var r=i(19371),s=i(42524),a=i(77389),o=i(88897),n=i(48135);const h=500;class d{constructor(e){(0,r.A)(this,"timer",void 0),(0,r.A)(this,"interval",void 0),(0,r.A)(this,"data",void 0),(0,r.A)(this,"lastIncomingPacketCount",void 0),(0,r.A)(this,"shutterCount",void 0),(0,r.A)(this,"lastShutterCount",void 0),(0,r.A)(this,"isFirst",void 0),(0,r.A)(this,"max",void 0),(0,r.A)(this,"min",void 0),(0,r.A)(this,"targetPlaybackRate",void 0),(0,r.A)(this,"currentPlaybackRate",void 0),(0,r.A)(this,"playbackRateTimer",void 0),(0,r.A)(this,"options",void 0),this.options=e,this.interval=1e3,this.isFirst=!0,this.data=[],this.lastIncomingPacketCount=BigInt(0),this.shutterCount=0,this.lastShutterCount=0,this.max=1e3*e.max>>>0,this.min=1e3*e.min>>>0,a.M[15](this.options.jitterBuffer,this.min),a.M[15](this.options.jitterBuffer+4,this.max),e.lowLatencyStart&&a.M[15](this.options.jitterBuffer+4,this.min+h),this.targetPlaybackRate=1,this.currentPlaybackRate=1,this.playbackRateTimer=new o.A((()=>{if(this.currentPlaybackRate>this.targetPlaybackRate){const e=Math.max(this.targetPlaybackRate,this.currentPlaybackRate-.01);this.options.observer.onSetPlayRate(e),this.currentPlaybackRate=e}else if(this.currentPlaybackRate<this.targetPlaybackRate){const e=Math.min(this.targetPlaybackRate,this.currentPlaybackRate+.01);this.options.observer.onSetPlayRate(e),this.currentPlaybackRate=e}else this.playbackRateTimer.stop()}),0,200),this.timer=new n.A(this.onTimer.bind(this),1e3,this.interval)}start(){this.timer.start(),this.isFirst=!0,this.lastIncomingPacketCount=s.f[17](this.options.stats+24)+s.f[17](this.options.stats+112),this.shutterCount=0,this.lastShutterCount=s.f[15](this.options.stats+292)+s.f[15](this.options.stats+288),this.computePlayRate()}stop(){this.timer.stop(),this.data.length=0,this.isFirst=!0,this.playbackRateTimer.isStarted()&&(this.playbackRateTimer.stop(),this.targetPlaybackRate=this.currentPlaybackRate=1,this.options.observer.onSetPlayRate(1))}reset(){this.data.length=0,this.isFirst=!0,this.lastIncomingPacketCount=s.f[17](this.options.stats+24)+s.f[17](this.options.stats+112),this.shutterCount=0,this.lastShutterCount=s.f[15](this.options.stats+292)+s.f[15](this.options.stats+288),this.targetPlaybackRate=this.currentPlaybackRate=1}setPlayRate(e){this.targetPlaybackRate=e,this.options.useMse?(this.options.observer.onSetPlayRate(this.targetPlaybackRate),this.currentPlaybackRate=this.targetPlaybackRate):this.currentPlaybackRate===e||this.playbackRateTimer.isStarted()||this.playbackRateTimer.start()}computePlayRate(){let e=s.f[15](this.options.stats+244)?s.f[15](this.options.stats+32)/s.f[15](this.options.stats+244)*1e3:s.f[15](this.options.stats+232)?s.f[15](this.options.stats+120)/s.f[15](this.options.stats+232)*1e3:s.f[15](this.options.jitterBuffer);const t=(s.f[15](this.options.jitterBuffer)+s.f[15](this.options.jitterBuffer+4))/2;e<s.f[15](this.options.jitterBuffer)>>1&&e<2e3?this.setPlayRate(.9):e<s.f[15](this.options.jitterBuffer)-h&&e<2e3?this.setPlayRate(.95):e>s.f[15](this.options.jitterBuffer+4)+h?this.setPlayRate(1.05):(this.currentPlaybackRate<1&&e>=t||this.currentPlaybackRate>1&&e<=t)&&this.setPlayRate(1),e>2e3&&this.max>2e3&&e>this.max<<1&&this.options.observer.onCroppingBuffer(s.f[15](this.options.jitterBuffer+4))}process(){const e=this.data.reduce(((e,t,i)=>e+t*(i+1)),0)/55,t=this.data.reduce(((t,i)=>t+Math.pow(i-e,2)),0)/this.data.length,i=Math.sqrt(t);if(this.options.lowLatency){const t=Math.round(e/(this.interval/1e3)),r=s.f[15](this.options.stats+232)+s.f[15](this.options.stats+244);t<r>>1||this.shutterCount>3?(a.M[15](this.options.jitterBuffer,Math.min(2*s.f[15](this.options.jitterBuffer),this.max-h)),a.M[15](this.options.jitterBuffer+4,Math.min(2*s.f[15](this.options.jitterBuffer+4),this.max))):t>=r&&i<50?(a.M[15](this.options.jitterBuffer,Math.max(s.f[15](this.options.jitterBuffer)-h,this.min)),a.M[15](this.options.jitterBuffer+4,Math.max(s.f[15](this.options.jitterBuffer+4)-h,this.min+h))):i>100?(a.M[15](this.options.jitterBuffer,Math.min(s.f[15](this.options.jitterBuffer)+h,this.max-h)),a.M[15](this.options.jitterBuffer+4,Math.min(s.f[15](this.options.jitterBuffer+4)+h,this.max))):i<20?s.f[15](this.options.jitterBuffer)===this.min?a.M[15](this.options.jitterBuffer+4,Math.max(s.f[15](this.options.jitterBuffer+4)-h,this.min+h)):a.M[15](this.options.jitterBuffer,Math.max(s.f[15](this.options.jitterBuffer)-h,this.min)):s.f[15](this.options.jitterBuffer+4)===this.max?a.M[15](this.options.jitterBuffer,Math.min(s.f[15](this.options.jitterBuffer)+h,this.max-h)):a.M[15](this.options.jitterBuffer+4,Math.min(s.f[15](this.options.jitterBuffer+4)+h,this.max))}this.computePlayRate(),a.M[19](this.options.stats+272,i)}onTimer(){const e=s.f[17](this.options.stats+24)+s.f[17](this.options.stats+112);this.isFirst?this.isFirst=!1:this.data.push(Number(BigInt.asIntN(32,e-this.lastIncomingPacketCount))),this.lastIncomingPacketCount=e,s.f[15](this.options.stats+292)+s.f[15](this.options.stats+288)>this.lastShutterCount?this.shutterCount++:this.shutterCount=0,this.lastShutterCount=s.f[15](this.options.stats+292)+s.f[15](this.options.stats+288),this.data.length>10&&this.data.shift(),10===this.data.length&&this.process()}}},26930:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(19371),s=i(42524),a=i(77389),o=i(29592),n=i(88897);class h{constructor(e,t,i){(0,r.A)(this,"stats",void 0),(0,r.A)(this,"timer",void 0),(0,r.A)(this,"videoFrameRenderCount",void 0),(0,r.A)(this,"videoFrameDecodeCount",void 0),(0,r.A)(this,"audioFrameRenderCount",void 0),(0,r.A)(this,"audioFrameDecodeCount",void 0),(0,r.A)(this,"videoPacketBytes",void 0),(0,r.A)(this,"audioPacketBytes",void 0),(0,r.A)(this,"bufferReceiveBytes",void 0),(0,r.A)(this,"observer",void 0),(0,r.A)(this,"isWorkerMain",void 0),(0,r.A)(this,"videoDecodeMaxIntervalCounter",void 0),(0,r.A)(this,"lastAudioStutterCount",void 0),(0,r.A)(this,"lastAVDelta",void 0),this.stats=e,this.observer=i,this.isWorkerMain=t,this.timer=new n.A(this.onTimer.bind(this),1e3,1e3)}reset(){this.videoFrameRenderCount=s.f[17](this.stats+160),this.videoFrameDecodeCount=s.f[17](this.stats+144),this.audioFrameRenderCount=s.f[17](this.stats+72),this.audioFrameDecodeCount=s.f[17](this.stats+56),this.videoPacketBytes=s.f[17](this.stats+104),this.audioPacketBytes=s.f[17](this.stats+16),this.bufferReceiveBytes=s.f[17](this.stats+192),this.isWorkerMain||(a.M[15](this.stats+248,0),a.M[15](this.stats+252,0),a.M[15](this.stats+256,0),a.M[15](this.stats+260,0))}start(){this.reset(),this.videoDecodeMaxIntervalCounter=0,this.lastAudioStutterCount=0,this.lastAVDelta=BigInt(0),this.timer.start()}stop(){this.timer.stop()}onTimer(){a.M[15](this.stats+228,Number(BigInt.asIntN(32,s.f[17](this.stats+160)-this.videoFrameRenderCount))),a.M[15](this.stats+224,Number(BigInt.asIntN(32,s.f[17](this.stats+144)-this.videoFrameDecodeCount))),a.M[15](this.stats+240,Number(BigInt.asIntN(32,s.f[17](this.stats+72)-this.audioFrameRenderCount))),a.M[15](this.stats+236,Number(BigInt.asIntN(32,s.f[17](this.stats+56)-this.audioFrameDecodeCount))),a.M[15](this.stats+220,Number(BigInt.asIntN(32,s.f[17](this.stats+104)-this.videoPacketBytes))),a.M[15](this.stats+216,Number(BigInt.asIntN(32,s.f[17](this.stats+16)-this.audioPacketBytes))),a.M[15](this.stats+264,Number(BigInt.asIntN(32,s.f[17](this.stats+192)-this.bufferReceiveBytes))),"visible"===document.visibilityState&&(s.f[15](this.stats+228)<.5*s.f[15](this.stats+232)||s.f[15](this.stats+260)>6e3/s.f[15](this.stats+232))&&this.observer.onVideoStutter(),s.f[15](this.stats+256)>1e3/s.f[15](this.stats+232)&&s.f[15](this.stats+224)<.9*s.f[15](this.stats+232)&&(s.f[17](this.stats+328)>0&&s.f[17](this.stats+336)>0&&s.f[17](this.stats+328)-s.f[17](this.stats+336)>BigInt(1e3)&&s.f[17](this.stats+328)-s.f[17](this.stats+336)>this.lastAVDelta||s.f[15](this.stats+288)>this.lastAudioStutterCount)?this.videoDecodeMaxIntervalCounter++:this.videoDecodeMaxIntervalCounter=0,this.videoDecodeMaxIntervalCounter>5&&(this.observer.onVideoDiscard(),this.videoDecodeMaxIntervalCounter=0),this.lastAudioStutterCount=s.f[15](this.stats+288),this.lastAVDelta=s.f[17](this.stats+328)-s.f[17](this.stats+336),this.reset();const e=s.f[17](this.stats+344),t=s.f[17](this.stats+352),i=s.f[17](this.stats+328),r=s.f[17](this.stats+336);if(e&&t&&e-i>2e3&&t-r>2e3||e&&!t&&e-i>2e3||t&&!e&&t-r>2e3){const i=e&&t?o.jk(e,t):e||t;this.observer.onMasterTimerUpdate(i)}}}},6398:(e,t,i)=>{var r;i.d(t,{s:()=>r}),function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready",e.CLEARKEY="org.w3.clearkey",e.FAIRPLAY="com.apple.fps.1_0"}(r||(r={}))},78553:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(6398);function s(e){const t={edef8ba979d64acea3c827dcd51d21ed:r.s.WIDEVINE,"9a04f07998404286ab92e65be0885f95":r.s.PLAYREADY,e2719d58a985b3c9781ab030af78d30e:r.s.CLEARKEY,"94ce86fb07ff4f43adb893d2fa968ca2":r.s.FAIRPLAY};let i="";return e.forEach((e=>{let t=e.toString(16);1===t.length&&(t="0"+t),i+=t})),t[i]}},76002:(e,t,i)=>{function r(e){let t="";return e.forEach((e=>{t+=String.fromCharCode(e)})),t=btoa(t),t.replace(/=/g,"").replace(/\//g,"_").replace(/\+/g,"-")}i.d(t,{A:()=>r})},17373:(e,t,i)=>{i.r(t),i.d(t,{AUDIO_CONTEXT_RUNNING:()=>v,CHANGED:()=>f,CHANGING:()=>u,ENDED:()=>d,ERROR:()=>m,FIRST_AUDIO_RENDERED:()=>y,FIRST_VIDEO_RENDERED:()=>b,LOADED:()=>s,LOADING:()=>r,PAUSED:()=>n,PLAYED:()=>o,PLAYING:()=>a,PROGRESS:()=>w,RESUME:()=>A,SEEKED:()=>l,SEEKING:()=>c,STOPPED:()=>h,STREAM_UPDATE:()=>k,SUBTITLE_DELAY_CHANGE:()=>T,TIME:()=>g,TIMEOUT:()=>p,VOLUME_CHANGE:()=>x});const r="loading",s="loaded",a="playing",o="played",n="paused",h="stopped",d="ended",c="seeking",l="seeked",u="changing",f="changed",p="timeout",m="error",g="time",A="resume",v="audioContextRunning",y="firstAudioRendered",b="firstVideoRendered",k="streamUpdate",w="progress",x="volumeChange",T="subtitleDelayChange"},18186:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(75176),s=i(80564),a=i(24788);function o(e){return r.USE_THREADS||a.A.worker&&e?new MessageChannel:new s.A}},65833:(e,t,i)=>{function r(){if("function"==typeof MediaSource)return MediaSource;if("function"==typeof ManagedMediaSource)return ManagedMediaSource;throw new Error("not support mse")}i.d(t,{A:()=>r})},64208:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(24788),s=i(71195),a=i(77969);function o(){let e=r.A.offscreenCanvas;return(s.A.safari&&!s.A.checkVersion(s.A.version,"17",!0)||a.A.ios&&!s.A.checkVersion(a.A.version,"17",!0))&&(e=!1),e}},83684:(e,t,i)=>{i.d(t,{M:()=>c});var r,s=i(19371),a=i(75354),o=i(86220),n=i(54911),h=i(59502),d=i(43801);class c{constructor(){(0,s.A)(this,"avpacketList",void 0),(0,s.A)(this,"avframeList",void 0),(0,s.A)(this,"avpacketListMutex",void 0),(0,s.A)(this,"avframeListMutex",void 0),(0,s.A)(this,"stats",void 0)}}r=c,(()=>{const e=r.prototype,t=new Map;t.set("avpacketList",{0:n.A,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("avframeList",{0:n.A,1:0,2:0,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("avpacketListMutex",{0:h.eu,1:0,2:0,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("avframeListMutex",{0:h.eu,1:0,2:0,3:0,4:0,5:0,6:0,7:28,8:0}),t.set("stats",{0:d.A,1:0,2:0,3:0,4:0,5:0,6:0,7:32,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,8),(0,o.A)(e,a.g7,392),(0,o.A)(e,a.JY,t)})()},68:(e,t,i)=>{i.d(t,{A:()=>y});var r=i(19371),s=i(75354),a=i(83684),o=i(11846),n=i(93793),h=i(35688),d=i(31370),c=i(25092),l=i(81819),u=i(87339),f=i(88897),p=i(85266),m=i(59502),g=i(42365),A=i(1818);const v="packages/avplayer/src/worker/AudioPipeline.ts";class y{constructor(){(0,r.A)(this,"decoder",void 0),(0,r.A)(this,"render",void 0),(0,r.A)(this,"globalDataMap",void 0),(0,r.A)(this,"controlPort",void 0),(0,r.A)(this,"timer",void 0),this.decoder=new h.A,this.render=new d.A,this.globalDataMap=new Map}createGlobalData(e){const t=(0,o.A)(a.M);return m.Ts(t[s.o9]+24),m.Ts(t[s.o9]+28),this.globalDataMap.set(e,t),t}releaseGlobalData(e){e.avframeList.clear((e=>{(0,g.to)(e)}),20),e.avpacketList.clear((e=>{(0,A.Up)(e)}),20),m.zr(e[s.o9]+24),m.zr(e[s.o9]+28),(0,n.A)(e)}async init(e){this.controlPort=new p.Ay(e);let t=0;this.timer=new f.A((()=>{t++;const e=[];this.globalDataMap.forEach(((i,r)=>{const s=i.stats;e.push({taskId:r,stats:{audioFrameDecodeCount:s.audioFrameDecodeCount,audioFrameDecodeIntervalMax:s.audioFrameDecodeIntervalMax,audioDecodeErrorPacketCount:s.audioDecodeErrorPacketCount,audioFrameRenderCount:s.audioFrameRenderCount,audioFrameRenderIntervalMax:s.audioFrameRenderIntervalMax,sampleRate:s.sampleRate,channels:s.channels,audioFrameSize:s.audioFrameSize,audioCurrentTime:s.audioCurrentTime}}),2===t&&(s.audioFrameDecodeIntervalMax=0,s.audioFrameRenderIntervalMax=0)})),this.controlPort.notify("stats",{data:e}),2===t&&(t=0)}),0,500),this.controlPort.on(p.Wo,(e=>{if("stats"===e.method){const t=e.params.data;for(let e=0;e<t.length;e++){const i=this.globalDataMap.get(t[e].taskId).stats;i&&(c.__(t[e].stats,((e,t)=>{i[t]=e})),i.jitterBuffer.min=t[e].jitterBuffer.min,i.jitterBuffer.max=t[e].jitterBuffer.max)}}})),this.timer.start()}async invoke(e,t,i){const r=this;function a(e,t,i){if("unregisterTask"===e){const e=r.globalDataMap.get(t[0]);e&&(r.releaseGlobalData(e),r.globalDataMap.delete(t[0]))}else if("clear"===e)r.globalDataMap.forEach((e=>{r.releaseGlobalData(e)})),r.globalDataMap.clear();else if("syncSeekTime"===e){const e=r.globalDataMap.get(t[0]);if(e)return e.stats.audioCurrentTime}return i}if("decoder"===e){if("registerTask"===t){const e=this.globalDataMap.get(i[0].taskId)||this.createGlobalData(i[0].taskId);i[0].stats=e[s.o9]+32,i[0].avpacketList=e[s.o9],i[0].avpacketListMutex=e[s.o9]+24,i[0].avframeList=e[s.o9]+12,i[0].avframeListMutex=e[s.o9]+28}if(l.Pc(this.decoder[t]))return this.decoder[t](...i).then((e=>a(t,i,e)));u.h2(`method ${t} not found`,v,196)}else{if("registerTask"===t){const e=this.globalDataMap.get(i[0].taskId)||this.createGlobalData(i[0].taskId);i[0].stats=e[s.o9]+32,i[0].avframeList=e[s.o9]+12,i[0].avframeListMutex=e[s.o9]+28}if(l.Pc(this.render[t]))return this.render[t](...i).then((e=>a(t,i,e)));u.h2(`method ${t} not found`,v,214)}}async setLogLevel(e){u.V$(e)}}},33370:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(19371),s=i(43801),a=i(75589),o=i(68),n=i(25092),h=i(85266),d=i(51477);class c{constructor(){(0,r.A)(this,"thread",void 0),(0,r.A)(this,"controlMessageChannel",void 0),(0,r.A)(this,"controlPort",void 0),(0,r.A)(this,"statsMap",void 0),this.statsMap=new Map}async run(){this.thread=await(0,d.pt)(o.A,{name:"AudioPipeline",dispatchToWorker:!0},68).run(),this.controlMessageChannel=new MessageChannel,this.controlPort=new h.Ay(this.controlMessageChannel.port1),this.controlPort.on(h.Wo,(e=>{if("stats"===e.method){const t=e.params.data,i=[];for(let e=0;e<t.length;e++){const r=this.statsMap.get(t[e].taskId);r&&(n.__(t[e].stats,((e,t)=>{r[t]=e})),i.push({taskId:t[e].taskId,stats:{audioPacketQueueLength:r.audioPacketQueueLength,audioEncodeFramerate:r.audioEncodeFramerate,videoPacketQueueLength:r.videoPacketQueueLength},jitterBuffer:{min:r.jitterBuffer.min,max:r.jitterBuffer.max}}))}this.controlPort.notify("stats",{data:{stats:i}})}})),await this.thread.init.transfer(this.controlMessageChannel.port2).invoke(this.controlMessageChannel.port2)}async destroy(){await(0,d.nx)(this.thread),this.thread=null}setLogLevel(e){this.thread.setLogLevel(e)}transformResult(e,t,i){if("unregisterTask"===e)this.statsMap.delete(t[0]);else if("clear"===e)this.statsMap.clear();else if("registerTask"===e)this.statsMap.set(t[0].taskId,(0,a.A)(t[0].stats,s.A));else if("syncSeekTime"===e){const e=this.statsMap.get(t[0]);if(e)return void(e.audioCurrentTime=i)}return i}get AudioDecodePipeline(){const e=this;return new Proxy({},{get(t,i,r){if(t[i])return t[i];const s=async function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.thread.invoke("decoder",i,r).then((t=>e.transformResult(i,r,t)))};return s.transfer=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return{invoke:async function(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return e.thread.invoke.transfer(...r).invoke("decoder",i,s).then((t=>e.transformResult(i,s,t)))}}},t[i]=s,t[i]}})}get AudioRenderPipeline(){const e=this;return new Proxy({},{get(t,i,r){if(t[i])return t[i];const s=async function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.thread.invoke("render",i,r).then((t=>e.transformResult(i,r,t)))};return s.transfer=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return{invoke:async function(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return e.thread.invoke.transfer(...r).invoke("render",i,s).then((t=>e.transformResult(i,s,t)))}}},t[i]=s,t[i]}})}}},8025:(e,t,i)=>{i.d(t,{A:()=>y});var r=i(19371),s=i(75354),a=i(83684),o=i(11846),n=i(93793),h=i(24482),d=i(30131),c=i(81819),l=i(87339),u=i(88897),f=i(85266),p=i(59502),m=i(42365),g=i(1818),A=i(10567);const v="packages/avplayer/src/worker/IODemuxPipeline.ts";class y{constructor(){(0,r.A)(this,"ioThread",void 0),(0,r.A)(this,"demuxPipeline",void 0),(0,r.A)(this,"globalDataMap",void 0),(0,r.A)(this,"controlPort",void 0),(0,r.A)(this,"timer",void 0),this.ioThread=new h.A,this.demuxPipeline=new d.A,this.globalDataMap=new Map}createGlobalData(e){const t=(0,o.A)(a.M);return p.Ts(t[s.o9]+24),p.Ts(t[s.o9]+28),this.globalDataMap.set(e,t),t}releaseGlobalData(e){e.avframeList.clear((e=>{(0,m.to)(e)}),20),e.avpacketList.clear((e=>{(0,g.Up)(e)}),20),p.zr(e[s.o9]+24),p.zr(e[s.o9]+28),(0,n.A)(e)}async init(e){this.controlPort=new f.Ay(e),this.timer=new u.A((()=>{const e=[];this.globalDataMap.forEach(((t,i)=>{const r=t.stats,s={bufferReceiveBytes:r.bufferReceiveBytes},a=this.demuxPipeline.tasks.get(i);a&&(a.formatContext.getStreamByMediaType(1)&&(s.audioPacketQueueLength=r.audioPacketQueueLength,s.audioPacketCount=r.audioPacketCount,s.audioPacketBytes=r.audioPacketBytes,s.audioEncodeFramerate=r.audioEncodeFramerate),a.formatContext.getStreamByMediaType(0)&&(s.videoPacketQueueLength=r.videoPacketQueueLength,s.videoPacketCount=r.videoPacketCount,s.videoPacketBytes=r.videoPacketBytes,s.keyFrameCount=r.keyFrameCount,s.gop=r.gop,s.keyFrameInterval=r.keyFrameInterval,s.videoEncodeFramerate=r.videoEncodeFramerate),e.push({taskId:i,stats:s}))})),this.controlPort.notify("stats",{data:e})}),0,500),this.timer.start()}async invoke(e,t,i){const r=this;function a(e,t,i){if("unregisterTask"===e){const e=r.globalDataMap.get(t[0]);e&&(r.releaseGlobalData(e),r.globalDataMap.delete(t[0]))}else"clear"===e?(r.globalDataMap.forEach((e=>{r.releaseGlobalData(e)})),r.globalDataMap.clear()):"analyzeStreams"!==e||c.ai(i)||i.streams.forEach((e=>{e.codecpar=(0,A.Wu)(e.codecpar)}))}if("io"===e){if("registerTask"===t){const e=this.globalDataMap.get(i[0].taskId)||this.createGlobalData(i[0].taskId);i[0].stats=e[s.o9]+32}if(c.Pc(this.ioThread[t]))return this.ioThread[t](...i).then((e=>(a(t,i,e),e)));l.h2(`method ${t} not found`,v,178)}else{if("registerTask"===t){const e=this.globalDataMap.get(i[0].taskId)||this.createGlobalData(i[0].taskId);i[0].stats=e[s.o9]+32,i[0].avpacketList=e[s.o9],i[0].avpacketListMutex=e[s.o9]+24}if(c.Pc(this.demuxPipeline[t]))return this.demuxPipeline[t](...i).then((e=>(a(t,i,e),e)));l.h2(`method ${t} not found`,v,196)}}async setLogLevel(e){l.V$(e)}}},42281:(e,t,i)=>{i.d(t,{A:()=>p});var r=i(19371),s=i(43801),a=i(75589),o=i(8025),n=i(25092),h=i(81819),d=i(85266),c=i(51477),l=i(2198),u=i(10567),f=i(62787);class p{constructor(){(0,r.A)(this,"thread",void 0),(0,r.A)(this,"codecparMap",void 0),(0,r.A)(this,"controlMessageChannel",void 0),(0,r.A)(this,"controlPort",void 0),(0,r.A)(this,"statsMap",void 0),this.codecparMap=new Map,this.statsMap=new Map}async run(){this.thread=await(0,c.pt)(o.A,{name:"IODemuxPipeline",dispatchToWorker:!0},8025).run(),this.controlMessageChannel=new MessageChannel,this.controlPort=new d.Ay(this.controlMessageChannel.port1),this.controlPort.on(d.Wo,(e=>{if("stats"===e.method){const t=e.params.data;for(let e=0;e<t.length;e++){const i=this.statsMap.get(t[e].taskId);i&&n.__(t[e].stats,((e,t)=>{i[t]=e}))}}})),await this.thread.init.transfer(this.controlMessageChannel.port2).invoke(this.controlMessageChannel.port2)}setLogLevel(e){this.thread.setLogLevel(e)}async destroy(){await(0,c.nx)(this.thread),this.thread=null}get IOPipeline(){const e=this;return new Proxy({},{get(t,i,r){if(t[i])return t[i];const s=async function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.thread.invoke("io",i,r)};return s.transfer=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return{invoke:async function(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return e.thread.invoke.transfer(...r).invoke("io",i,s)}}},t[i]=s,t[i]}})}get DemuxPipeline(){const e=this;function t(t,i,r){if("analyzeStreams"!==t||h.ai(r))if("unregisterTask"===t){const t=e.codecparMap.get(i[0]);t&&(t.forEach((e=>{(0,f.dn)(e)})),e.codecparMap.delete(i[0])),e.statsMap.delete(i[0])}else"clear"===t?(e.codecparMap.forEach((e=>{e.forEach((e=>{(0,f.dn)(e)}))})),e.codecparMap.clear(),e.statsMap.clear()):"registerTask"===t&&e.statsMap.set(i[0].taskId,(0,a.A)(i[0].stats,s.A));else{const t=[];r.streams.forEach((r=>{(0,l.A)(r.codecpar)||(r.codecpar=(0,u.T8)(r.codecpar),t.push(r.codecpar)),e.codecparMap.set(i[0],t)}))}}return new Proxy({},{get(i,r,s){if(i[r])return i[r];const a=async function(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return e.thread.invoke("demux",r,s).then((e=>(t(r,s,e),e)))};return a.transfer=function(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return{invoke:async function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e.thread.invoke.transfer(...s).invoke("demux",r,a).then((e=>(t(r,a,e),e)))}}},i[r]=a,i[r]}})}}},36033:(e,t,i)=>{i.d(t,{A:()=>g});var r=i(19371),s=i(75354),a=i(83684),o=i(11846),n=i(93793),h=i(25092),d=i(81819),c=i(87339),l=i(42365),u=i(1818),f=i(88897),p=i(85266),m=i(59502);class g{constructor(){(0,r.A)(this,"mse",void 0),(0,r.A)(this,"globalDataMap",void 0),(0,r.A)(this,"controlPort",void 0),(0,r.A)(this,"timer",void 0),this.globalDataMap=new Map}createGlobalData(e){const t=(0,o.A)(a.M);return m.Ts(t[s.o9]+24),m.Ts(t[s.o9]+28),this.globalDataMap.set(e,t),t}releaseGlobalData(e){e.avframeList.clear((e=>{(0,l.to)(e)}),20),e.avpacketList.clear((e=>{(0,u.Up)(e)}),20),m.zr(e[s.o9]+24),m.zr(e[s.o9]+28),(0,n.A)(e)}async init(e){this.mse=new((await Promise.all([i.e(945),i.e(452)]).then(i.bind(i,75452))).default),this.controlPort=new p.Ay(e),this.timer=new f.A((()=>{const e=[];this.globalDataMap.forEach(((t,i)=>{const r=t.stats;e.push({taskId:i,stats:{audioFrameDecodeCount:r.audioFrameDecodeCount,audioFrameRenderCount:r.audioFrameRenderCount,sampleRate:r.sampleRate,channels:r.channels,videoFrameDecodeCount:r.videoFrameDecodeCount,videoFrameRenderCount:r.videoFrameRenderCount,width:r.width,height:r.height}})})),this.controlPort.notify("stats",{data:e})}),0,500),this.controlPort.on(p.Wo,(e=>{if("stats"===e.method){const t=e.params.data;for(let e=0;e<t.length;e++){const i=this.globalDataMap.get(t[e].taskId).stats;i&&(h.__(t[e].stats,((e,t)=>{i[t]=e})),i.jitterBuffer.min=t[e].jitterBuffer.min,i.jitterBuffer.max=t[e].jitterBuffer.max)}}})),this.timer.start()}async invoke(e,t){const i=this;if("registerTask"===e){const e=this.globalDataMap.get(t[0].taskId)||this.createGlobalData(t[0].taskId);t[0].stats=e[s.o9]+32,t[0].avpacketList=e[s.o9],t[0].avpacketListMutex=e[s.o9]+24}if(d.Pc(this.mse[e]))return this.mse[e].transfer||(this.mse[e].transfer=[]),this.mse[e](...t).then((r=>(this.mse[e].transfer.length&&(this.invoke.transfer=this.mse[e].transfer),r=function(e,t,r){if("unregisterTask"===e){const e=i.globalDataMap.get(t[0]);e&&(i.releaseGlobalData(e),i.globalDataMap.delete(t[0]))}else"clear"===e&&(i.globalDataMap.forEach((e=>{i.releaseGlobalData(e)})),i.globalDataMap.clear());return r}(e,t,r),r)));c.h2(`method ${e} not found`,"packages/avplayer/src/worker/MSEPipeline.ts",179)}async setLogLevel(e){c.V$(e)}}},35409:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(19371),s=i(43801),a=i(75589),o=i(36033),n=i(25092),h=i(85266),d=i(51477);class c{constructor(){(0,r.A)(this,"thread",void 0),(0,r.A)(this,"controlMessageChannel",void 0),(0,r.A)(this,"controlPort",void 0),(0,r.A)(this,"statsMap",void 0),this.statsMap=new Map}async run(){this.thread=await(0,d.pt)(o.A,{name:"MSEPipeline",dispatchToWorker:!0},36033).run(),this.controlMessageChannel=new MessageChannel,this.controlPort=new h.Ay(this.controlMessageChannel.port1),this.controlPort.on(h.Wo,(e=>{if("stats"===e.method){const t=e.params.data,i=[];for(let e=0;e<t.length;e++){const r=this.statsMap.get(t[e].taskId);r&&(n.__(t[e].stats,((e,t)=>{r[t]=e})),i.push({taskId:t[e].taskId,stats:{videoEncodeFramerate:r.videoEncodeFramerate,videoPacketQueueLength:r.videoPacketQueueLength,audioPacketQueueLength:r.audioPacketQueueLength,audioEncodeFramerate:r.audioEncodeFramerate},jitterBuffer:{min:r.jitterBuffer.min,max:r.jitterBuffer.max}}))}this.controlPort.notify("stats",{data:{stats:i}})}})),await this.thread.init.transfer(this.controlMessageChannel.port2).invoke(this.controlMessageChannel.port2)}setLogLevel(e){this.thread.setLogLevel(e)}async destroy(){await(0,d.nx)(this.thread),this.thread=null}transformResult(e,t,i){return"unregisterTask"===e?this.statsMap.delete(t[0]):"clear"===e?this.statsMap.clear():"registerTask"===e&&this.statsMap.set(t[0].taskId,(0,a.A)(t[0].stats,s.A)),i}get MSEPipeline(){const e=this;return new Proxy({},{get(t,i,r){if(t[i])return t[i];const s=async function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.thread.invoke(i,r).then((t=>e.transformResult(i,r,t)))};return s.transfer=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return{invoke:async function(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return e.thread.invoke.transfer(...r).invoke(i,s).then((t=>e.transformResult(i,s,t)))}}},t[i]=s,t[i]}})}}},75717:(e,t,i)=>{i.d(t,{A:()=>y});var r=i(19371),s=i(75354),a=i(83684),o=i(11846),n=i(93793),h=i(79893),d=i(57599),c=i(25092),l=i(81819),u=i(87339),f=i(42365),p=i(1818),m=i(85266),g=i(88897),A=i(59502);const v="packages/avplayer/src/worker/VideoPipeline.ts";class y{constructor(){(0,r.A)(this,"decoder",void 0),(0,r.A)(this,"render",void 0),(0,r.A)(this,"globalDataMap",void 0),(0,r.A)(this,"controlPort",void 0),(0,r.A)(this,"timer",void 0),this.decoder=new h.A,this.render=new d.A,this.globalDataMap=new Map}createGlobalData(e){const t=(0,o.A)(a.M);return A.Ts(t[s.o9]+24),A.Ts(t[s.o9]+28),this.globalDataMap.set(e,t),t}releaseGlobalData(e){e.avframeList.clear((e=>{(0,f.to)(e)}),20),e.avpacketList.clear((e=>{(0,p.Up)(e)}),20),A.zr(e[s.o9]+24),A.zr(e[s.o9]+28),(0,n.A)(e)}async init(e){this.controlPort=new m.Ay(e);let t=0;this.timer=new g.A((()=>{t++;const e=[];this.globalDataMap.forEach(((i,r)=>{const s=i.stats;e.push({taskId:r,stats:{videoFrameDecodeCount:s.videoFrameDecodeCount,videoFrameDecodeIntervalMax:s.videoFrameDecodeIntervalMax,videoDecodeErrorPacketCount:s.videoDecodeErrorPacketCount,videoCurrentTime:s.videoCurrentTime,videoFrameRenderCount:s.videoFrameRenderCount,videoFrameRenderIntervalMax:s.videoFrameRenderIntervalMax,videoFrameDropCount:s.videoFrameDropCount,width:s.width,height:s.height}}),2===t&&(s.videoFrameDecodeIntervalMax=0,s.videoFrameRenderIntervalMax=0)})),this.controlPort.notify("stats",{data:e}),2===t&&(t=0)}),0,500),this.controlPort.on(m.Wo,(e=>{if("stats"===e.method){const t=e.params.data;for(let e=0;e<t.length;e++){const i=this.globalDataMap.get(t[e].taskId).stats;i&&(c.__(t[e].stats,((e,t)=>{i[t]=e})),i.jitterBuffer.min=t[e].jitterBuffer.min,i.jitterBuffer.max=t[e].jitterBuffer.max)}}})),this.timer.start()}async invoke(e,t,i){const r=this;function a(e,t,i){if("unregisterTask"===e){const e=r.globalDataMap.get(t[0]);e&&(r.releaseGlobalData(e),r.globalDataMap.delete(t[0]))}else if("clear"===e)r.globalDataMap.forEach((e=>{r.releaseGlobalData(e)})),r.globalDataMap.clear();else if("syncSeekTime"===e){const e=r.globalDataMap.get(t[0]);if(e)return e.stats.videoCurrentTime}return i}if("decoder"===e){if("registerTask"===t){const e=this.globalDataMap.get(i[0].taskId)||this.createGlobalData(i[0].taskId);i[0].stats=e[s.o9]+32,i[0].avpacketList=e[s.o9],i[0].avpacketListMutex=e[s.o9]+24,i[0].avframeList=e[s.o9]+12,i[0].avframeListMutex=e[s.o9]+28}if(l.Pc(this.decoder[t]))return this.decoder[t](...i).then((e=>a(t,i,e)));u.h2(`method ${t} not found`,v,196)}else{if("registerTask"===t){const e=this.globalDataMap.get(i[0].taskId)||this.createGlobalData(i[0].taskId);i[0].stats=e[s.o9]+32,i[0].avframeList=e[s.o9]+12,i[0].avframeListMutex=e[s.o9]+28}if(l.Pc(this.render[t]))return this.render[t](...i).then((e=>a(t,i,e)));u.h2(`method ${t} not found`,v,214)}}async setLogLevel(e){u.V$(e)}}},42997:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(19371),s=i(43801),a=i(75589),o=i(75717),n=i(25092),h=i(51477),d=i(85266);class c{constructor(){(0,r.A)(this,"thread",void 0),(0,r.A)(this,"controlMessageChannel",void 0),(0,r.A)(this,"controlPort",void 0),(0,r.A)(this,"statsMap",void 0),this.statsMap=new Map}async run(){this.thread=await(0,h.pt)(o.A,{name:"VideoPipeline",dispatchToWorker:!0},75717).run(),this.controlMessageChannel=new MessageChannel,this.controlPort=new d.Ay(this.controlMessageChannel.port1),this.controlPort.on(d.Wo,(e=>{if("stats"===e.method){const t=e.params.data,i=[];for(let e=0;e<t.length;e++){const r=this.statsMap.get(t[e].taskId);r&&(n.__(t[e].stats,((e,t)=>{r[t]=e})),i.push({taskId:t[e].taskId,stats:{videoEncodeFramerate:r.videoEncodeFramerate,videoPacketQueueLength:r.videoPacketQueueLength},jitterBuffer:{min:r.jitterBuffer.min,max:r.jitterBuffer.max}}))}this.controlPort.notify("stats",{data:{stats:i}})}})),await this.thread.init.transfer(this.controlMessageChannel.port2).invoke(this.controlMessageChannel.port2)}setLogLevel(e){this.thread.setLogLevel(e)}async destroy(){await(0,h.nx)(this.thread),this.thread=null}transformResult(e,t,i){if("unregisterTask"===e)this.statsMap.delete(t[0]);else if("clear"===e)this.statsMap.clear();else if("registerTask"===e)this.statsMap.set(t[0].taskId,(0,a.A)(t[0].stats,s.A));else if("syncSeekTime"===e){const e=this.statsMap.get(t[0]);if(e)return void(e.videoCurrentTime=i)}return i}get VideoDecodePipeline(){const e=this;return new Proxy({},{get(t,i,r){if(t[i])return t[i];const s=async function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.thread.invoke("decoder",i,r).then((t=>e.transformResult(i,r,t)))};return s.transfer=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return{invoke:async function(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return e.thread.invoke.transfer(...r).invoke("decoder",i,s).then((t=>e.transformResult(i,s,t)))}}},t[i]=s,t[i]}})}get VideoRenderPipeline(){const e=this;return new Proxy({},{get(t,i,r){if(t[i])return t[i];const s=async function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return e.thread.invoke("render",i,r).then((t=>e.transformResult(i,r,t)))};return s.transfer=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return{invoke:async function(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return e.thread.invoke.transfer(...r).invoke("render",i,s).then((t=>e.transformResult(i,s,t)))}}},t[i]=s,t[i]}})}}},6978:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(19371),s=i(15639),a=i(45120),o=i(87339),n=i(24788);class h extends s.A{constructor(e,t){super(e,t),(0,r.A)(this,"context",void 0),(0,r.A)(this,"paddingLeft",void 0),(0,r.A)(this,"paddingTop",void 0),(0,r.A)(this,"flipX",void 0),(0,r.A)(this,"flipY",void 0),(0,r.A)(this,"hasAlpha",void 0),(0,r.A)(this,"alphaMask",void 0),this.paddingLeft=0,this.paddingTop=0,this.flipX=1,this.flipY=1}async init(){if("rec2100-hlg"===this.options.colorSpace||"rec2100-pq"===this.options.colorSpace)try{this.context=this.canvas.getContext("2d",{colorSpace:this.options.colorSpace,pixelFormat:"float16"})}catch(e){o.R8("cannot got hdr context, video rendering colors may not be correct, please use the latest version of chrome then in chrome://flags, set: Experimental Web Platform features: Enabled","packages/avrender/src/image/Canvas2dRender.ts",75)}this.context||(this.context=this.canvas.getContext("2d"))}clear(){const e=this.canvas.width>>1,t=this.canvas.height>>1;this.rotate&&(this.context.translate(e,t),this.context.rotate(-this.rotate*Math.PI/180),this.context.translate(-e,-t)),this.context.clearRect(0,0,this.canvasWidth*this.options.devicePixelRatio,this.canvasHeight*this.options.devicePixelRatio),this.rotate&&(this.context.translate(e,t),this.context.rotate(this.rotate*Math.PI/180),this.context.translate(-e,-t))}checkFrame(e,t){const i=!!t;e.codedWidth===this.textureWidth&&e.codedHeight===this.videoHeight&&e.codedWidth===this.videoWidth&&this.hasAlpha===i||(this.alphaMask&&(this.alphaMask.destroy(),this.alphaMask=null),this.hasAlpha=i,this.videoWidth=e.codedWidth,this.videoHeight=e.codedHeight,this.textureWidth=e.codedWidth,this.layout(),this.clear(),this.hasAlpha&&n.A.offscreenCanvas&&n.A.webgl&&(this.alphaMask=new a.A(e.codedWidth,e.codedHeight)))}render(e,t){this.lost||(this.checkFrame(e,t),this.clear(),this.context.drawImage(e,this.paddingLeft,this.paddingTop,this.canvasWidth*this.options.devicePixelRatio-2*this.paddingLeft,this.canvasHeight*this.options.devicePixelRatio-2*this.paddingTop),this.alphaMask&&(this.context.globalCompositeOperation="destination-in",this.alphaMask.process(t),this.context.drawImage(this.alphaMask.getTarget(),this.paddingLeft,this.paddingTop,this.canvasWidth*this.options.devicePixelRatio-2*this.paddingLeft,this.canvasHeight*this.options.devicePixelRatio-2*this.paddingTop),this.context.globalCompositeOperation="source-over"))}layout(){let e=this.videoWidth,t=this.videoHeight,i=this.canvasWidth,r=this.canvasHeight;this.options.sar&&1!==this.options.sar&&(e=Math.floor(this.videoWidth*this.options.sar));let s=0,a=0;90!==this.rotate&&270!==this.rotate||(a=Math.floor((r-i)/2),s=Math.floor((i-r)/2),i=this.canvasHeight,r=this.canvasWidth);const o=e/i,n=t/r;let h;if(h=o>1?!(o<n):o>n,1===this.renderMode&&(h=!h),h){const o=(r-t*i/e)/r;this.paddingTop=(Math.floor(o/2*r)+a)*this.options.devicePixelRatio,this.paddingLeft=s*this.options.devicePixelRatio}else{const o=(i-e*r/t)/i;this.paddingLeft=(Math.floor(o/2*i)+s)*this.options.devicePixelRatio,this.paddingTop=a*this.options.devicePixelRatio}if(this.context){let e=1,t=1;this.flipHorizontal&&(e=-1),this.flipVertical&&(t=-1);const i=this.canvas.width>>1,r=this.canvas.height>>1;this.context.translate(i,r),e!==this.flipX&&this.context.scale(-1,1),t!==this.flipY&&this.context.scale(1,-1),this.context.translate(-i,-r),this.flipX=e,this.flipY=t}}setRotate(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if((e%=360)===this.rotate)return;const i=this.canvas.width>>1,r=this.canvas.height>>1;this.rotate&&(this.context.translate(i,r),this.context.rotate(-this.rotate*Math.PI/180),this.context.translate(-i,-r)),t&&this.clear(),this.rotate=e,this.context&&(this.context.translate(i,r),this.context.rotate(this.rotate*Math.PI/180),this.context.translate(-i,-r)),this.layout()}destroy(){this.context=null,this.alphaMask&&(this.alphaMask.destroy(),this.alphaMask=null),super.destroy()}static isSupport(e){return e instanceof VideoFrame||e instanceof ImageBitmap}}},15639:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(17469);class a{constructor(e,t){(0,r.A)(this,"canvas",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"textureWidth",void 0),(0,r.A)(this,"videoWidth",void 0),(0,r.A)(this,"videoHeight",void 0),(0,r.A)(this,"canvasWidth",void 0),(0,r.A)(this,"canvasHeight",void 0),(0,r.A)(this,"rotate",void 0),(0,r.A)(this,"renderMode",void 0),(0,r.A)(this,"format",void 0),(0,r.A)(this,"lost",void 0),(0,r.A)(this,"destroyed",void 0),(0,r.A)(this,"srcColorSpace",void 0),(0,r.A)(this,"dstColorSpace",void 0),(0,r.A)(this,"flipHorizontal",void 0),(0,r.A)(this,"flipVertical",void 0),this.canvas=e,this.options=t,this.canvasWidth=e.width,this.canvasHeight=e.height,this.videoWidth=0,this.videoHeight=0,this.textureWidth=0,this.rotate=0,this.renderMode=t.renderMode,this.flipHorizontal=!1,this.flipVertical=!1,this.lost=!1,this.destroyed=!1,t.dstColorSpace?this.dstColorSpace=t.dstColorSpace:this.dstColorSpace=new s.A(1,1,1,1)}getRotateMatrix(e){e=Math.PI*e/180;const t=Math.sin(e),i=Math.cos(e);return[i,-t,0,0,t,i,0,0,0,0,1,0,0,0,0,1]}setRenderMode(e){this.renderMode!==e&&(this.renderMode=e,this.layout(),this.clear())}enableHorizontalFlip(e){this.flipHorizontal!==e&&(this.flipHorizontal=e,this.layout(),this.clear())}enableVerticalFlip(e){this.flipVertical!==e&&(this.flipVertical=e,this.layout(),this.clear())}viewport(e,t){if(this.canvasWidth!==e||this.canvasHeight!==t){const i=this.options.devicePixelRatio;this.canvasWidth=e,this.canvasHeight=t,this.canvas.width=e*i,this.canvas.height=t*i,this.videoWidth&&this.videoHeight&&this.layout()}}getVideoWidth(){return this.videoWidth}getVideoHeight(){return this.videoHeight}destroy(){this.canvas=null,this.destroyed=!0}setDstColorSpace(e){this.dstColorSpace=e}static isSupport(e){return!1}}},79053:(e,t,i)=>{i.d(t,{A:()=>A});var r=i(19371),s=i(50893),a=i(11846),o=i(42524),n=i(93793),h=i(97682),d=i(51716),c=i(80320),l=i(17469),u=i(26365),f=i(41402),p=i(42365),m=i(41863),g=i(2198);class A extends h.A{constructor(e,t){super(e,t),(0,r.A)(this,"linesize",void 0),(0,r.A)(this,"hdrMetadata",void 0),this.hdrMetadata=(0,a.A)(s.A),this.hdrMetadata.multiplier=1}async init(){if(await super.init(),!(this.gl instanceof WebGL2RenderingContext))throw new Error("not support webgl2")}generateVertexSource(){return"#version 300 es\n      precision highp float;\n      in vec3 point;\n      in vec4 color;\n      out vec4 v_color;\n      uniform mat4 rotateMatrix;\n      void main(void) {\n        gl_Position = rotateMatrix * vec4(point, 1.0);\n        v_color = color;\n      }\n    "}generateFragmentSource(e,t){t.outputRGB=!0;const i=(0,d.A)(this.srcColorSpace,this.dstColorSpace,t),r=["y","u","v","a"],s=["r","g","b","a"],a=[],o=[],n=[];e.comp.forEach(((e,t)=>{a[t]=e.depth+7>>>3,o[t]=e.shift,n[t]=(1<<e.depth)-1}));let h=`texture(${r[e.comp[0].plane]}_Sampler, v_color.xy).${s[e.comp[0].offset/a[0]]}`,c=e.comp[1]?`texture(${r[e.comp[1].plane]}_Sampler, v_color.xy).${s[e.comp[1].offset/a[1]]}`:32&e.flags?"0.0":"0.5",l=e.comp[2]?`texture(${r[e.comp[2].plane]}_Sampler, v_color.xy).${s[e.comp[2].offset/a[2]]}`:32&e.flags?"0.0":"0.5",u="1.0";function f(e){return/^texture/.test(e)}128&e.flags&&(u=`texture(${r[e.comp[e.comp.length-1].plane]}_Sampler, v_color.xy).${s[e.comp[e.comp.length-1].offset/a[e.comp.length-1]]}`,2===e.comp.length&&(c=32&e.flags?"0.0":"0.5")),this.fragmentSource=`#version 300 es\n      precision highp float;\n      precision highp usampler2D;\n      in vec4 v_color;\n      out vec4 outColor;\n      uniform usampler2D y_Sampler;\n      uniform usampler2D u_Sampler;\n      uniform usampler2D v_Sampler;\n      uniform usampler2D a_Sampler;\n      uniform float offset;\n      uniform float multiplier;\n      uniform float pq_tonemap_a;\n      uniform float pq_tonemap_b;\n      uniform float hlg_ootf_gamma_minus_one;\n      uniform float nits_to_sdr_relative_factor;\n      uniform float sdr_relative_to_nits_factor;\n      ${1&e.flags?"\n        uint swap(uint x) {\n          uint l = x & 0xFFu;\n          uint h = (x >> 8u) & 0xFFu;\n          return (l << 8u) | h;\n        }\n      ":""}\n      void main () {\n        float y = ${f(h)?`float(${1&e.flags?`swap(${h})`:h} >> ${o[0]}) / float(${n[0]})`:h};\n        float u = ${f(c)?`float(${1&e.flags?`swap(${c})`:c} >> ${o[1]}) / float(${n[1]})`:c};\n        float v = ${f(l)?`float(${1&e.flags?`swap(${l})`:l} >> ${o[2]}) / float(${n[2]})`:l};\n        float a = ${f(u)?`float(${1&e.flags?`swap(${u})`:u} >> ${o[e.comp.length-1]}) / float(${n[e.comp.length-1]})`:u};\n        vec4 color = vec4(y, u, v, a);\n        if (color.a > 0.0) {\n          color.r /= color.a;\n          color.g /= color.a;\n          color.b /= color.a;\n        }\n        color.r -= offset;\n        color.g -= offset;\n        color.b -= offset;\n        color.r *= multiplier;\n        color.g *= multiplier;\n        color.b *= multiplier;\n        ${i.reduce(((e,t)=>e+t),"")}\n        color.r *= color.a;\n        color.g *= color.a;\n        color.b *= color.a;\n        outColor = color;\n      }\n    `}checkFrame(e){if(o.f[15](e+32)!==this.linesize||o.f[15](e+72)!==this.videoHeight||o.f[15](e+68)!==this.videoWidth||o.f[15](e+80)!==this.format){const t=(0,f.I)(o.f[15](e+80));this.srcColorSpace=new l.A(o.f[15](e+220),o.f[15](e+212),o.f[15](e+216),o.f[15](e+208));const i={type:0,bitDepth:t.comp[0].depth,toneMapPQAndHlgToDst:!0,metadata:this.hdrMetadata,dstSdrMaxLuminanceNits:c.kH,dstMaxLuminanceRelative:1},r=(0,p.aH)(e,14);if(r){const e=o.f[20](r+4);o.f[8](e)>0&&(i.maxContentLightLevel=o.f[8](e))}if(this.generateFragmentSource(t,i),this.program=new u.A(this.fragmentSource,this.generateVertexSource()),this.useProgram(!0),this.program.setMetaData(this.hdrMetadata),this.yTexture.setFormat(this.gl.RED_INTEGER),this.yTexture.setInternalformat(this.gl.R16UI),this.yTexture.setDataType(this.gl.UNSIGNED_SHORT),this.uTexture.setFormat(this.gl.RED_INTEGER),this.uTexture.setInternalformat(this.gl.R16UI),this.uTexture.setDataType(this.gl.UNSIGNED_SHORT),this.vTexture.setFormat(this.gl.RED_INTEGER),this.vTexture.setInternalformat(this.gl.R16UI),this.vTexture.setDataType(this.gl.UNSIGNED_SHORT),this.aTexture.setFormat(this.gl.RED_INTEGER),this.aTexture.setInternalformat(this.gl.R16UI),this.aTexture.setDataType(this.gl.UNSIGNED_SHORT),16&t.flags){let i=0;if(this.yTexture.setSize(o.f[15](e+32+4*i++)>>>1,o.f[15](e+72)),t.comp.length>2){const r=t.comp[1].plane===t.comp[2].plane;this.uTexture.setSize(o.f[15](e+32+4*i++)>>>(r?2:1),o.f[15](e+72)>>>t.log2ChromaH),r||this.vTexture.setSize(o.f[15](e+32+4*i++)>>>1,o.f[15](e+72)>>>t.log2ChromaH),r&&(this.uTexture.setFormat(this.gl.RG_INTEGER),this.uTexture.setInternalformat(this.gl.RG16UI))}128&t.flags&&this.aTexture.setSize(o.f[15](e+32+4*i++)>>>1,o.f[15](e+72)),this.textureWidth=o.f[15](e+32)>>>1}else{const i=t.comp[0].depth+7>>>3;let r=t.comp[0].step/i;const s=[0,this.gl.RED_INTEGER,this.gl.RG_INTEGER,this.gl.RGB_INTEGER,this.gl.RGBA_INTEGER],a=[0,this.gl.R16UI,this.gl.RG16UI,this.gl.RGB16UI,this.gl.RGBA16UI];this.yTexture.setFormat(s[r]),this.yTexture.setInternalformat(a[r]),this.yTexture.setSize(o.f[15](e+32)/r>>>1,o.f[15](e+72)),this.textureWidth=o.f[15](e+32)/r>>>1}this.linesize=o.f[15](e+32),this.videoWidth=o.f[15](e+68),this.videoHeight=o.f[15](e+72),this.format=o.f[15](e+80),this.layout()}}render(e){if(this.lost)return;let t=(0,f.I)(o.f[15](e+80));if(!t)return;this.checkFrame(e);let i=0;this.yTexture.fill((0,m.bg)(o.f[20](e+4*i),(o.f[15](e+32+4*i++)>>>1)*this.yTexture.height)),16&t.flags&&(t.comp.length>2&&(this.uTexture.fill((0,m.bg)(o.f[20](e+4*i),(o.f[15](e+32+4*i++)>>>1)*this.uTexture.height)),t.comp[1].plane!==t.comp[2].plane&&this.vTexture.fill((0,m.bg)(o.f[20](e+4*i),(o.f[15](e+32+4*i++)>>>1)*this.vTexture.height))),128&t.flags&&this.aTexture.fill((0,m.bg)(o.f[20](e+4*i),(o.f[15](e+32+4*i++)>>>1)*this.aTexture.height))),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}destroy(){this.hdrMetadata&&((0,n.A)(this.hdrMetadata),this.hdrMetadata=null),super.destroy()}static isSupport(e){if((0,g.A)(e)){const t=(0,f.I)(o.f[15](e+80));if(t)return t.comp[0].depth+7>>>3==2}return!1}}},30860:(e,t,i)=>{i.d(t,{A:()=>u});var r=i(19371),s=i(42524),a=i(97682),o=i(94884),n=i(51716),h=i(17469),d=i(41402),c=i(41863),l=i(2198);class u extends a.A{constructor(e,t){super(e,t),(0,r.A)(this,"linesize",void 0)}async init(){await super.init()}generateFragmentSource(e){const t=(0,n.A)(this.srcColorSpace,this.dstColorSpace,{bitDepth:8,type:0,outputRGB:!0}),i=["y","u","v","a"],r=16&e.flags&&e.comp.length>2&&e.comp[1].plane===e.comp[2].plane?["r","a"]:["r","g","b","a"];let s=`texture2D(${i[e.comp[0].plane]}_Sampler, v_color.xy).${r[e.comp[0].offset]}`,a=e.comp[1]?`texture2D(${i[e.comp[1].plane]}_Sampler, v_color.xy).${r[e.comp[1].offset]}`:32&e.flags?"0.0":"0.5",o=e.comp[2]?`texture2D(${i[e.comp[2].plane]}_Sampler, v_color.xy).${r[e.comp[2].offset]}`:32&e.flags?"0.0":"0.5",h="1.0";128&e.flags&&(h=`texture2D(${i[e.comp[e.comp.length-1].plane]}_Sampler, v_color.xy).${r[e.comp[e.comp.length-1].offset]}`,2===e.comp.length&&(a=32&e.flags?"0.0":"0.5")),this.fragmentSource=`\n      precision highp float;\n      varying vec4 v_color;\n      uniform sampler2D y_Sampler;\n      uniform sampler2D u_Sampler;\n      uniform sampler2D v_Sampler;\n      uniform sampler2D a_Sampler;\n      void main () {\n        float y = ${s};\n        float u = ${a};\n        float v = ${o};\n        float alpha = ${h};\n        vec4 color = vec4(y, u, v, alpha);\n        ${t.reduce(((e,t)=>e+t),"")}\n        gl_FragColor = color;\n      }\n    `}checkFrame(e){if(s.f[15](e+32)!==this.linesize||s.f[15](e+72)!==this.videoHeight||s.f[15](e+68)!==this.videoWidth){const t=(0,d.I)(s.f[15](e+80));if(this.srcColorSpace=new h.A(s.f[15](e+220),s.f[15](e+212),s.f[15](e+216),s.f[15](e+208)),this.generateFragmentSource(t),this.program=new o.A(this.fragmentSource),this.useProgram(),16&t.flags){let i=0;if(this.yTexture.setSize(s.f[15](e+32+4*i++),s.f[15](e+72)),t.comp.length>2){const r=t.comp[1].plane===t.comp[2].plane;this.uTexture.setSize(s.f[15](e+32+4*i++)>>>(r?1:0),s.f[15](e+72)>>>t.log2ChromaH),r||this.vTexture.setSize(s.f[15](e+32+4*i++),s.f[15](e+72)>>>t.log2ChromaH),r&&(this.uTexture.setFormat(this.gl.LUMINANCE_ALPHA),this.uTexture.setInternalformat(this.gl.LUMINANCE_ALPHA))}128&t.flags&&this.aTexture.setSize(s.f[15](e+32+4*i++),s.f[15](e+72)),this.textureWidth=s.f[15](e+32)}else{const i=t.comp[0].depth+7>>>3;let r=t.comp[0].step/i;const a=[0,this.gl.LUMINANCE,this.gl.LUMINANCE_ALPHA,this.gl.RGB,this.gl.RGBA];this.yTexture.setFormat(a[r]),this.yTexture.setInternalformat(a[r]),this.yTexture.setSize(s.f[15](e+32)/r,s.f[15](e+72)),this.textureWidth=s.f[15](e+32)/r}this.linesize=s.f[15](e+32),this.videoWidth=s.f[15](e+68),this.videoHeight=s.f[15](e+72),this.format=s.f[15](e+80),this.layout()}}render(e){if(this.lost)return;let t=(0,d.I)(s.f[15](e+80));if(!t)return;this.checkFrame(e);let i=0;this.yTexture.fill((0,c.s3)(s.f[20](e+4*i),s.f[15](e+32+4*i++)*this.yTexture.height)),16&t.flags&&(t.comp.length>2&&(this.uTexture.fill((0,c.s3)(s.f[20](e+4*i),s.f[15](e+32+4*i++)*this.uTexture.height)),t.comp[1].plane!==t.comp[2].plane&&this.vTexture.fill((0,c.s3)(s.f[20](e+4*i),s.f[15](e+32+4*i++)*this.vTexture.height))),128&t.flags&&this.aTexture.fill((0,c.s3)(s.f[20](e+4*i),s.f[15](e+32+4*i)*this.aTexture.height))),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}static isSupport(e){if((0,l.A)(e)){const t=(0,d.I)(s.f[15](e+80));if(t)return t.comp[0].depth+7>>>3==1}return!1}}},97682:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(19371),s=i(33320),a=i(11399);class o extends a.A{constructor(e,t){super(e,t),(0,r.A)(this,"yTexture",void 0),(0,r.A)(this,"uTexture",void 0),(0,r.A)(this,"vTexture",void 0),(0,r.A)(this,"aTexture",void 0)}useProgram(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.useProgram(),this.yTexture=new s.A(this.gl),e&&this.yTexture.setFilter(this.gl.NEAREST),this.yTexture.bind(0),this.yTexture.init(),this.program.bindYTexture(0),this.uTexture=new s.A(this.gl),e&&this.uTexture.setFilter(this.gl.NEAREST),this.uTexture.bind(1),this.uTexture.init(),this.program.bindUTexture(1),this.vTexture=new s.A(this.gl),e&&this.vTexture.setFilter(this.gl.NEAREST),this.vTexture.bind(2),this.vTexture.init(),this.program.bindVTexture(2),this.aTexture=new s.A(this.gl),e&&this.aTexture.setFilter(this.gl.NEAREST),this.aTexture.bind(3),this.aTexture.init(),this.program.bindATexture(3)}destroy(){this.yTexture&&(this.yTexture.destroy(),this.yTexture=null),this.uTexture&&(this.uTexture.destroy(),this.uTexture=null),this.vTexture&&(this.vTexture.destroy(),this.vTexture=null),this.aTexture&&(this.aTexture.destroy(),this.aTexture=null),super.destroy()}}},11399:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(19371),s=i(15639),a=i(58106),o=i(87339);const n="packages/avrender/src/image/WebGLRender.ts";class h extends s.A{constructor(e,t){super(e,t),(0,r.A)(this,"gl",void 0),(0,r.A)(this,"vbo",void 0),(0,r.A)(this,"program",void 0),(0,r.A)(this,"vertex",void 0),(0,r.A)(this,"webglContextLostTimer",void 0),(0,r.A)(this,"onWebglContextLost",void 0),(0,r.A)(this,"onWebglContextRestored",void 0),(0,r.A)(this,"fragmentSource",void 0),(0,r.A)(this,"vertexSource",void 0)}async init(){this.gl=this.canvas.getContext("webgl2",{alpha:!0,antialias:!1,preserveDrawingBuffer:this.options.preserveDrawingBuffer}),this.gl||(this.gl=this.canvas.getContext("webgl",{alpha:!0,antialias:!1,preserveDrawingBuffer:this.options.preserveDrawingBuffer})),this.gl||(this.gl=this.canvas.getContext("experimental-webgl",{alpha:!0,antialias:!1,preserveDrawingBuffer:this.options.preserveDrawingBuffer})),this.gl||o.h2("can not support webgl, got WebGLRenderingContext failed",n,103),this.vbo=this.gl.createBuffer(),this.vbo||o.h2("create vao buffer failed",n,108),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.enable(this.gl.BLEND),this.gl.clearColor(0,0,0,0),this.gl.clearDepth(1),this.viewport(this.canvasWidth||this.canvas.width,this.canvasHeight||this.canvas.height),this.onWebglContextLost=e=>{this.destroyed||(this.webglContextLostTimer=setTimeout((()=>{this.lost=!0,this.webglContextLostTimer=null,o.z3("webgl context lost",n,125),this.options.onRenderContextLost&&this.options.onRenderContextLost()}),3e3))},this.onWebglContextRestored=e=>{this.webglContextLostTimer&&(clearTimeout(this.webglContextLostTimer),this.webglContextLostTimer=null)},this.canvas.addEventListener("webglcontextlost",this.onWebglContextLost),this.canvas.addEventListener("webglcontextrestored",this.onWebglContextRestored)}viewport(e,t){this.gl.viewport(0,0,e*this.options.devicePixelRatio,t*this.options.devicePixelRatio),super.viewport(e,t)}useProgram(){this.program.link(this.gl),this.program.bind(),this.program.setRotateMatrix(this.getRotateMatrix(this.rotate))}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}layout(){let e=this.videoWidth,t=this.videoHeight,i=this.canvasWidth,r=this.canvasHeight,s=this.textureWidth;this.options.sar&&1!==this.options.sar&&(e=Math.floor(this.videoWidth*this.options.sar),s=Math.floor(this.textureWidth*this.options.sar)),90!==this.rotate&&270!==this.rotate||(i=this.canvasHeight,r=this.canvasWidth);const o=e/i,n=t/r;let h;h=o>1?!(o<n):o>n,1===this.renderMode&&(h=!h);let d=0;if(s!==e&&(d=(s-e)/s),h){const s=(r-t*i/e)/r;this.vertex=[-1,1-s,0,0,0,0,0,-1,-1+s,0,0,1,0,0,1,1-s,0,1-d,0,0,0,1,-1+s,0,1-d,1,0,0]}else{const s=(i-e*r/t)/i;this.vertex=[-1+s,1,0,0,0,0,0,-1+s,-1,0,0,1,0,0,1-s,1,0,1-d,0,0,0,1-s,-1,0,1-d,1,0,0]}(0,a.A)(this.vertex,this.flipHorizontal,this.flipVertical),this.gl&&this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertex),this.gl.STATIC_DRAW)}setRotate(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(e%=360)!==this.rotate&&(this.rotate=e,this.gl&&this.program.setRotateMatrix(this.getRotateMatrix(this.rotate)),this.layout(),t&&this.clear())}destroy(){this.vbo&&(this.gl.deleteBuffer(this.vbo),this.vbo=null),this.program&&this.program.stop(),this.gl=null,this.vertex=null,this.onWebglContextLost&&(this.canvas.removeEventListener("webglcontextlost",this.onWebglContextLost),this.onWebglContextLost=null),this.onWebglContextRestored&&(this.canvas.removeEventListener("webglcontextrestored",this.onWebglContextRestored),this.onWebglContextRestored=null),super.destroy()}}},13700:(e,t,i)=>{i.d(t,{A:()=>v});var r=i(19371),s=i(75354),a=i(50893),o=i(11846),n=i(42524),h=i(93793),d=i(90823),c=i(17469),l=i(80320),u=i(51716),f=i(41402),p=i(42365),m=i(41863),g=i(2198),A=i(33740);class v extends d.A{constructor(e,t){super(e,t),(0,r.A)(this,"linesize",void 0),(0,r.A)(this,"hdrMetadata",void 0),(0,r.A)(this,"hdrMetadataBuffer",void 0),this.hdrMetadata=(0,o.A)(a.A),this.hdrMetadata.multiplier=1}generateFragmentSource(e,t){t.outputRGB=!0;const i=(0,u.A)(this.srcColorSpace,this.dstColorSpace,t),r=["y","u","v","a"],s=["r","g","b","a"],a=[],o=[],n=[];e.comp.forEach(((e,t)=>{a[t]=e.depth+7>>>3,o[t]=e.shift,n[t]=(1<<e.depth)-1}));let h=`textureLoad(${r[e.comp[0].plane]}Texture,\n      vec2<i32>(coord.xy * vec2<f32>(\n        ${this[`${r[e.comp[0].plane]}Texture`].width}.0,\n        ${this[`${r[e.comp[0].plane]}Texture`].height}.0\n      )), 0).${s[e.comp[0].offset/a[0]]}`,d=e.comp[1]?`textureLoad(${r[e.comp[1].plane]}Texture,\n          vec2<i32>(coord.xy * vec2<f32>(\n            ${this[`${r[e.comp[1].plane]}Texture`].width}.0,\n            ${this[`${r[e.comp[1].plane]}Texture`].height}.0\n          )), 0).${s[e.comp[1].offset/a[1]]}`:32&e.flags?"0.0":"0.5",c=e.comp[2]?`textureLoad(${r[e.comp[2].plane]}Texture,\n          vec2<i32>(coord.xy * vec2<f32>(\n            ${this[`${r[e.comp[2].plane]}Texture`].width}.0,\n            ${this[`${r[e.comp[2].plane]}Texture`].height}.0\n          )), 0).${s[e.comp[2].offset/a[2]]}`:32&e.flags?"0.0":"0.5",l="1.0";function f(e){return/^textureLoad/.test(e)}128&e.flags&&(l=`textureLoad(${r[e.comp[e.comp.length-1].plane]}Texture,\n        vec2<i32>(coord.xy * vec2<f32>(\n          ${this[`${r[e.comp[e.comp.length-1].plane]}Texture`].width}.0,\n          ${this[`${r[e.comp[e.comp.length-1].plane]}Texture`].height}.0\n        )), 0).${s[e.comp[e.comp.length-1].offset/a[e.comp.length-1]]}`,2===e.comp.length&&(d=32&e.flags?"0.0":"0.5")),this.fragmentSource=`\n      struct HdrMetadata {\n        offset: f32,\n        multiplier: f32,\n        pqTonemapA: f32,\n        pqTonemapB: f32,\n        hlgOOTFGammaMinusOne: f32,\n        nitsToSdrRelativeFactor: f32,\n        sdrRelativeToNitsFactor: f32\n      };\n      @group(0) @binding(1) var<uniform> hdrMetadata: HdrMetadata;\n      @group(0) @binding(2) var yTexture: texture_2d<u32>;\n      ${this.uTexture?"@group(0) @binding(3) var uTexture: texture_2d<u32>;":""}\n      ${this.vTexture?"@group(0) @binding(4) var vTexture: texture_2d<u32>;":""}\n      ${this.aTexture?"@group(0) @binding(5) var aTexture: texture_2d<u32>;":""}\n      ${1&e.flags?"\n        fn swap(x: u32) -> u32 {\n          var low = x & 0xff;\n          var high = (x >> 8) & 0xff;\n          return (low << 8) | high;\n        }\n      ":""}\n      @fragment\n      fn main(@location(0) coord: vec4<f32>) -> @location(0) vec4<f32> {\n        let offset = hdrMetadata.offset;\n        let multiplier = hdrMetadata.multiplier;\n        let pq_tonemap_a = hdrMetadata.pqTonemapA;\n        let pq_tonemap_b = hdrMetadata.pqTonemapB;\n        let hlg_ootf_gamma_minus_one = hdrMetadata.hlgOOTFGammaMinusOne;\n        let nits_to_sdr_relative_factor = hdrMetadata.nitsToSdrRelativeFactor;\n        let sdr_relative_to_nits_factor = hdrMetadata.sdrRelativeToNitsFactor;\n        let y = ${f(h)?`f32(${1&e.flags?`swap(${h})`:h} >> ${o[0]}) / f32(${n[0]})`:h};\n        let u = ${f(d)?`f32(${1&e.flags?`swap(${d})`:d} >> ${o[1]}) / f32(${n[1]})`:d};\n        let v = ${f(c)?`f32(${1&e.flags?`swap(${c})`:c} >> ${o[2]}) / f32(${n[2]})`:c};\n        let a = ${f(l)?`f32(${1&e.flags?`swap(${l})`:l} >> ${o[e.comp.length-1]}) / f32(${n[e.comp.length-1]})`:l};\n        var color = vec4(y, u, v, a);\n        if (color.a > 0) {\n          color.r /= color.a;\n          color.g /= color.a;\n          color.b /= color.a;\n        }\n        color.r -= offset;\n        color.g -= offset;\n        color.b -= offset;\n        color.r *= multiplier;\n        color.g *= multiplier;\n        color.b *= multiplier;\n        ${i.reduce(((e,t)=>e+t),"")}\n        color.r *= color.a;\n        color.g *= color.a;\n        color.b *= color.a;\n        return color;\n      }\n    `}async init(){await super.init(),this.hdrMetadataBuffer=this.device.createBuffer({size:32,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}generateBindGroup(){if(!this.yTexture)return;const e=[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"uint"}}];this.uTexture&&e.push({binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"uint"}}),this.vTexture&&e.push({binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"uint"}}),this.aTexture&&e.push({binding:5,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"uint"}}),this.bindGroupLayout=this.device.createBindGroupLayout({entries:e});const t=[{binding:0,resource:{buffer:this.rotateMatrixBuffer,size:16*Float32Array.BYTES_PER_ELEMENT}},{binding:1,resource:{buffer:this.hdrMetadataBuffer,size:this.hdrMetadataBuffer.size}},{binding:2,resource:this.yTexture.createView()}];this.uTexture&&t.push({binding:3,resource:this.uTexture.createView()}),this.vTexture&&t.push({binding:4,resource:this.vTexture.createView()}),this.aTexture&&t.push({binding:5,resource:this.aTexture.createView()}),this.bindGroup=this.device.createBindGroup({layout:this.bindGroupLayout,entries:t})}checkFrame(e){if(n.f[15](e+32)!==this.linesize||n.f[15](e+72)!==this.videoHeight||n.f[15](e+68)!==this.videoWidth||n.f[15](e+80)!==this.format){const t=(0,f.I)(n.f[15](e+80));if(this.yTexture&&(this.yTexture.destroy(),this.yTexture=null),this.uTexture&&(this.uTexture.destroy(),this.uTexture=null),this.vTexture&&(this.vTexture.destroy(),this.vTexture=null),this.aTexture&&(this.aTexture.destroy(),this.aTexture=null),16&t.flags){let i=0;if(this.yTexture=this.device.createTexture({size:[n.f[15](e+32+4*i++)>>>1,n.f[15](e+72)],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,format:"r16uint"}),t.comp.length>2){const r=t.comp[1].plane===t.comp[2].plane;this.uTexture=this.device.createTexture({size:[n.f[15](e+32+4*i++)>>>(r?2:1),n.f[15](e+72)>>>t.log2ChromaH],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,format:r?"rg16uint":"r16uint"}),r||(this.vTexture=this.device.createTexture({size:[n.f[15](e+32+4*i++)>>>1,n.f[15](e+72)>>>t.log2ChromaH],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,format:"r16uint"}))}128&t.flags&&(this.aTexture=this.device.createTexture({size:[n.f[15](e+32+4*i++)>>>1,n.f[15](e+72)],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,format:"r16uint"})),this.textureWidth=n.f[15](e+32)>>>1}else{const i=t.comp[0].depth+7>>>3;let r=t.comp[0].step/i;const s=["","r16uint","rg16uint","","rgba16uint"];this.yTexture=this.device.createTexture({size:[n.f[15](e+32)/r>>>1,n.f[15](e+72)],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,format:s[r]}),this.textureWidth=n.f[15](e+32)/r>>>1}this.linesize=n.f[15](e+32),this.srcColorSpace=new c.A(n.f[15](e+220),n.f[15](e+212),n.f[15](e+216),n.f[15](e+208)),this.videoWidth=n.f[15](e+68),this.videoHeight=n.f[15](e+72),this.format=n.f[15](e+80);const i={type:1,bitDepth:t.comp[0].depth,toneMapPQAndHlgToDst:!0,metadata:this.hdrMetadata,dstSdrMaxLuminanceNits:l.kH,dstMaxLuminanceRelative:1},r=(0,p.aH)(e,14);if(r){const e=n.f[20](r+4);n.f[8](e)>0&&(i.maxContentLightLevel=n.f[8](e))}this.generateFragmentSource(t,i),this.layout(),this.generatePipeline(),this.generateRenderBundleEncoder();const a=(0,m.s3)(this.hdrMetadata[s.o9],28).slice();this.device.queue.writeBuffer(this.hdrMetadataBuffer,0,a.buffer,a.byteOffset,a.byteLength)}}render(e){if(this.lost)return;let t=(0,f.I)(n.f[15](e+80));if(!t)return;this.checkFrame(e);const i=this.device.createCommandEncoder();let r=0;this.device.queue.writeTexture({texture:this.yTexture},(0,A.Lv)(),{offset:n.f[20](e+4*r),bytesPerRow:n.f[15](e+32+4*r++),rowsPerImage:this.yTexture.height},{width:this.yTexture.width,height:this.yTexture.height,depthOrArrayLayers:1}),16&t.flags&&(this.uTexture&&this.device.queue.writeTexture({texture:this.uTexture},(0,A.Lv)(),{offset:n.f[20](e+4*r),bytesPerRow:n.f[15](e+32+4*r++),rowsPerImage:this.uTexture.height},{width:this.uTexture.width,height:this.uTexture.height,depthOrArrayLayers:1}),this.vTexture&&this.device.queue.writeTexture({texture:this.vTexture},(0,A.Lv)(),{offset:n.f[20](e+4*r),bytesPerRow:n.f[15](e+32+4*r++),rowsPerImage:this.vTexture.height},{width:this.vTexture.width,height:this.vTexture.height,depthOrArrayLayers:1}),this.aTexture&&this.device.queue.writeTexture({texture:this.aTexture},(0,A.Lv)(),{offset:n.f[20](e+4*r),bytesPerRow:n.f[15](e+32+4*r++),rowsPerImage:this.aTexture.height},{width:this.aTexture.width,height:this.aTexture.height,depthOrArrayLayers:1}));const s=i.beginRenderPass({colorAttachments:[{view:this.context.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]});s.executeBundles([this.renderBundle]),s.end(),this.device.queue.submit([i.finish()])}destroy(){this.hdrMetadata&&((0,h.A)(this.hdrMetadata),this.hdrMetadata=null),this.hdrMetadataBuffer&&(this.hdrMetadataBuffer.destroy(),this.hdrMetadataBuffer=null),super.destroy()}static isSupport(e){if((0,g.A)(e)){const t=(0,f.I)(n.f[15](e+80));if(t){const e=t.comp[0].depth+7>>>3;if(2!==e)return!1;let i=t.comp[0].step/e;return!!(16&t.flags||3!==i)}}return!1}}},63155:(e,t,i)=>{i.d(t,{A:()=>l});var r=i(19371),s=i(42524),a=i(90823),o=i(17469),n=i(51716),h=i(41402),d=i(2198),c=i(33740);class l extends a.A{constructor(e,t){super(e,t),(0,r.A)(this,"linesize",void 0)}async init(){await super.init()}generateFragmentSource(e){const t=(0,n.A)(this.srcColorSpace,this.dstColorSpace,{bitDepth:8,type:1,outputRGB:!0}),i=["y","u","v","a"],r=["r","g","b","a"];let s=`textureSample(${i[e.comp[0].plane]}Texture, s, in_texcoord.xy).${r[e.comp[0].offset]}`,a=e.comp[1]?`textureSample(${i[e.comp[1].plane]}Texture, s, in_texcoord.xy).${r[e.comp[1].offset]}`:32&e.flags?"0.0":"0.5",o=e.comp[2]?`textureSample(${i[e.comp[2].plane]}Texture, s, in_texcoord.xy).${r[e.comp[2].offset]}`:32&e.flags?"0.0":"0.5",h="1.0";128&e.flags&&(h=`textureSample(${i[e.comp[e.comp.length-1].plane]}Texture, s, in_texcoord.xy).${r[e.comp[e.comp.length-1].offset]}`,2===e.comp.length&&(a=32&e.flags?"0.0":"0.5")),this.fragmentSource=`\n      @group(0) @binding(1) var s: sampler;\n      @group(0) @binding(2) var yTexture: texture_2d<f32>;\n      ${this.uTexture?"@group(0) @binding(3) var uTexture: texture_2d<f32>;":""}\n      ${this.vTexture?"@group(0) @binding(4) var vTexture: texture_2d<f32>;":""}\n      ${this.aTexture?"@group(0) @binding(5) var aTexture: texture_2d<f32>;":""}\n      \n      @fragment\n      fn main(@location(0) in_texcoord: vec4<f32>) -> @location(0) vec4<f32> {\n        let y = ${s};\n        let u = ${a};\n        let v = ${o};\n        let alpha = ${h};\n        var color = vec4(y, u, v, alpha);\n        ${t.reduce(((e,t)=>e+t),"")}\n        return color;\n      }\n    `}checkFrame(e){if(s.f[15](e+32)!==this.linesize||s.f[15](e+72)!==this.videoHeight||s.f[15](e+68)!==this.videoWidth){const t=(0,h.I)(s.f[15](e+80));if(this.yTexture&&(this.yTexture.destroy(),this.yTexture=null),this.uTexture&&(this.uTexture.destroy(),this.uTexture=null),this.vTexture&&(this.vTexture.destroy(),this.vTexture=null),this.aTexture&&(this.aTexture.destroy(),this.aTexture=null),16&t.flags){let i=0;if(this.yTexture=this.device.createTexture({size:[s.f[15](e+32+4*i++),s.f[15](e+72)],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT,format:"r8unorm"}),t.comp.length>2){const r=t.comp[1].plane===t.comp[2].plane;this.uTexture=this.device.createTexture({size:[s.f[15](e+32+4*i++)>>>(r?1:0),s.f[15](e+72)>>>t.log2ChromaH],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT,format:r?"rg8unorm":"r8unorm"}),r||(this.vTexture=this.device.createTexture({size:[s.f[15](e+32+4*i++),s.f[15](e+72)>>>t.log2ChromaH],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT,format:"r8unorm"}))}128&t.flags&&(this.aTexture=this.device.createTexture({size:[s.f[15](e+32+4*i++),s.f[15](e+72)],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT,format:"r8unorm"})),this.textureWidth=s.f[15](e+32)}else{const i=t.comp[0].depth+7>>>3;let r=t.comp[0].step/i;const a=["","r8unorm","rg8unorm","","rgba8unorm"];this.yTexture=this.device.createTexture({size:[s.f[15](e+32)/r,s.f[15](e+72)],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT,format:a[r]}),this.textureWidth=s.f[15](e+32)/r}this.linesize=s.f[15](e+32),this.srcColorSpace=new o.A(s.f[15](e+220),s.f[15](e+212),s.f[15](e+216),s.f[15](e+208)),this.generateFragmentSource(t),this.videoWidth=s.f[15](e+68),this.videoHeight=s.f[15](e+72),this.format=s.f[15](e+80),this.layout(),this.generatePipeline(),this.generateRenderBundleEncoder()}}render(e){if(this.lost)return;let t=(0,h.I)(s.f[15](e+80));if(!t)return;this.checkFrame(e);let i=0;this.device.queue.writeTexture({texture:this.yTexture},(0,c.Lv)(),{offset:s.f[20](e+4*i),bytesPerRow:s.f[15](e+32+4*i++),rowsPerImage:this.yTexture.height},{width:this.yTexture.width,height:this.yTexture.height,depthOrArrayLayers:1}),16&t.flags&&(this.device.queue.writeTexture({texture:this.uTexture},(0,c.Lv)(),{offset:s.f[20](e+4*i),bytesPerRow:s.f[15](e+32+4*i++),rowsPerImage:this.uTexture.height},{width:this.uTexture.width,height:this.uTexture.height,depthOrArrayLayers:1}),this.vTexture&&this.device.queue.writeTexture({texture:this.vTexture},(0,c.Lv)(),{offset:s.f[20](e+4*i),bytesPerRow:s.f[15](e+32+4*i++),rowsPerImage:this.vTexture.height},{width:this.vTexture.width,height:this.vTexture.height,depthOrArrayLayers:1}),this.aTexture&&this.device.queue.writeTexture({texture:this.aTexture},(0,c.Lv)(),{offset:s.f[20](e+4*i),bytesPerRow:s.f[15](e+32+4*i),rowsPerImage:this.aTexture.height},{width:this.aTexture.width,height:this.aTexture.height,depthOrArrayLayers:1}));const r=this.device.createCommandEncoder(),a=r.beginRenderPass({colorAttachments:[{view:this.context.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]});a.executeBundles([this.renderBundle]),a.end(),this.device.queue.submit([r.finish()])}static isSupport(e){if((0,d.A)(e)){const t=(0,h.I)(s.f[15](e+80));if(t){const e=t.comp[0].depth+7>>>3;if(1!==e)return!1;let i=t.comp[0].step/e;return!!(16&t.flags||3!==i)}}return!1}}},90823:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(19371),s=i(13624),a=i(25e3);class o extends a.A{constructor(e,t){super(e,t),(0,r.A)(this,"yTexture",void 0),(0,r.A)(this,"uTexture",void 0),(0,r.A)(this,"vTexture",void 0),(0,r.A)(this,"aTexture",void 0),this.vertexSource=s.A}generateBindGroup(){if(!this.yTexture)return;const e=[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}}];this.uTexture&&e.push({binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}}),this.vTexture&&e.push({binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}}),this.aTexture&&e.push({binding:5,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}}),this.bindGroupLayout=this.device.createBindGroupLayout({entries:e});const t=[{binding:0,resource:{buffer:this.rotateMatrixBuffer,size:16*Float32Array.BYTES_PER_ELEMENT}},{binding:1,resource:this.sampler},{binding:2,resource:this.yTexture.createView()}];this.uTexture&&t.push({binding:3,resource:this.uTexture.createView()}),this.vTexture&&t.push({binding:4,resource:this.vTexture.createView()}),this.aTexture&&t.push({binding:5,resource:this.aTexture.createView()}),this.bindGroup=this.device.createBindGroup({layout:this.bindGroupLayout,entries:t})}destroy(){this.yTexture&&this.yTexture.destroy(),this.uTexture&&this.uTexture.destroy(),this.vTexture&&this.vTexture.destroy(),this.aTexture&&this.aTexture.destroy(),super.destroy()}}},16115:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(19371),s=i(13624),a=i(25e3);const o=["bt2020","bt2100","st2048","p3-dcl","hlg"];class n extends a.A{constructor(e,t){super(e,t),(0,r.A)(this,"hasAlpha",void 0),this.vertexSource=s.A}generateFragmentSource(){this.fragmentSource=`\n      @group(0) @binding(1) var eTexture: texture_external;\n      @group(0) @binding(2) var s: sampler;\n      ${this.hasAlpha?"@group(0) @binding(3) var aTexture: texture_external;":""}\n\n      @fragment\n      fn main(@location(0) in_texcoord: vec4<f32>) -> @location(0) vec4<f32> {\n        let rgb: vec4<f32> = textureSampleBaseClampToEdge(eTexture, s, in_texcoord.xy);\n        let alpha: f32 = ${this.hasAlpha?"textureSampleBaseClampToEdge(aTexture, s, in_texcoord.xy).r":"rgb.a"};\n        return vec4<f32>(rgb.rgb, alpha);\n      }\n    `}checkFrame(e,t){const i=!!t;e.codedWidth===this.textureWidth&&e.codedHeight===this.videoHeight&&e.codedWidth===this.videoWidth&&this.hasAlpha===i||(this.videoWidth=e.codedWidth,this.videoHeight=e.codedHeight,this.textureWidth=e.codedWidth,this.hasAlpha=i,this.layout(),this.generateFragmentSource(),this.generatePipeline())}generateBindGroup(){const e={entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,externalTexture:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}}]};this.hasAlpha&&e.entries.push({binding:3,visibility:GPUShaderStage.FRAGMENT,externalTexture:{}}),this.bindGroupLayout=this.device.createBindGroupLayout(e)}render(e,t){if(this.lost)return;this.checkFrame(e,t);const i={layout:this.renderPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.rotateMatrixBuffer,size:16*Float32Array.BYTES_PER_ELEMENT}},{binding:1,resource:this.device.importExternalTexture({source:e})},{binding:2,resource:this.sampler}]};t&&i.entries.push({binding:3,resource:this.device.importExternalTexture({source:t})});const r=this.device.createBindGroup(i),s=this.device.createCommandEncoder(),a={colorAttachments:[{view:this.context.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]},o=s.beginRenderPass(a);o.setPipeline(this.renderPipeline),o.setBindGroup(0,r),o.setVertexBuffer(0,this.vbo),o.draw(4,4,0,0),o.end(),this.device.queue.submit([s.finish()])}static isSupport(e){return e instanceof VideoFrame&&!o.some((t=>t===e.colorSpace.primaries))}}},25e3:(e,t,i)=>{i.d(t,{A:()=>d});var r=i(19371),s=i(15639),a=i(58106),o=i(87339),n=i(17630);const h="packages/avrender/src/image/WebGPURender.ts";class d extends s.A{constructor(e,t){super(e,t),(0,r.A)(this,"adapter",void 0),(0,r.A)(this,"device",void 0),(0,r.A)(this,"context",void 0),(0,r.A)(this,"vsModule",void 0),(0,r.A)(this,"fsModule",void 0),(0,r.A)(this,"rotateMatrixBuffer",void 0),(0,r.A)(this,"renderPipeline",void 0),(0,r.A)(this,"rotateMatrix",void 0),(0,r.A)(this,"vbo",void 0),(0,r.A)(this,"sampler",void 0),(0,r.A)(this,"vertex",void 0),(0,r.A)(this,"fragmentSource",void 0),(0,r.A)(this,"vertexSource",void 0),(0,r.A)(this,"renderBundleEncoder",void 0),(0,r.A)(this,"renderBundle",void 0),(0,r.A)(this,"bindGroupLayout",void 0),(0,r.A)(this,"bindGroup",void 0),(0,r.A)(this,"pipelineLayout",void 0)}async init(e){var t;this.adapter=await navigator.gpu.requestAdapter({powerPreference:null!==(t=this.options.powerPreference)&&void 0!==t?t:"high-performance"}),this.adapter||o.h2("not support webgpu render",h,90);const i=[];n.__(e,(e=>{this.adapter.features.has(e)&&i.push(e)})),this.device=await this.adapter.requestDevice({requiredFeatures:i.length?i:void 0}),this.device.lost.then((()=>{var e;this.destroyed||(this.lost=!0,o.z3("gpu device lost",h,109),null!==(e=this.options)&&void 0!==e&&e.onRenderContextLost&&this.options.onRenderContextLost())})),this.context=this.canvas.getContext("webgpu"),this.context||o.h2("can not support webgpu, got GPUCanvasContext failed",h,118),this.context.configure({device:this.device,format:navigator.gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),this.sampler=this.device.createSampler({magFilter:"linear",minFilter:"linear"}),this.vbo=this.device.createBuffer({size:28*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),this.rotateMatrixBuffer=this.device.createBuffer({size:16*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.setRotateMatrix(this.getRotateMatrix(0))}generatePipeline(){this.generateBindGroup(),this.pipelineLayout=this.device.createPipelineLayout({bindGroupLayouts:[this.bindGroupLayout]}),this.vsModule=this.device.createShaderModule({code:this.vertexSource}),this.fsModule=this.device.createShaderModule({code:this.fragmentSource}),this.renderPipeline=this.device.createRenderPipeline({layout:this.pipelineLayout,vertex:{module:this.vsModule,entryPoint:"main",buffers:[{arrayStride:28,attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32x4"}]}]},fragment:{module:this.fsModule,entryPoint:"main",targets:[{format:navigator.gpu.getPreferredCanvasFormat()}]},primitive:{topology:"triangle-strip"}})}generateRenderBundleEncoder(){this.renderPipeline&&(this.renderBundleEncoder=this.device.createRenderBundleEncoder({colorFormats:[navigator.gpu.getPreferredCanvasFormat()]}),this.renderBundleEncoder.setPipeline(this.renderPipeline),this.renderBundleEncoder.setBindGroup(0,this.bindGroup),this.renderBundleEncoder.setVertexBuffer(0,this.vbo),this.renderBundleEncoder.draw(4,4,0,0),this.renderBundle=this.renderBundleEncoder.finish())}setRotateMatrix(e){this.rotateMatrix=e;const t=new Float32Array(this.rotateMatrix);this.device.queue.writeBuffer(this.rotateMatrixBuffer,0,t.buffer,t.byteOffset,t.byteLength)}setVertices(){const e=new Float32Array(this.vertex);this.device.queue.writeBuffer(this.vbo,0,e.buffer,e.byteOffset,e.byteLength)}clear(){this.context.getCurrentTexture().destroy()}layout(){let e=this.videoWidth,t=this.videoHeight,i=this.canvasWidth,r=this.canvasHeight,s=this.textureWidth;this.options.sar&&1!==this.options.sar&&(e=Math.floor(this.videoWidth*this.options.sar),s=Math.floor(this.textureWidth*this.options.sar)),90!==this.rotate&&270!==this.rotate||(i=this.canvasHeight,r=this.canvasWidth);const o=e/i,n=t/r;let h;h=o>1?!(o<n):o>n,1===this.renderMode&&(h=!h);let d=0;if(s!==e&&(d=(s-e)/s),h){const s=(r-t*i/e)/r;this.vertex=[-1,1-s,0,0,0,0,0,-1,-1+s,0,0,1,0,0,1,1-s,0,1-d,0,0,0,1,-1+s,0,1-d,1,0,0]}else{const s=(i-e*r/t)/i;this.vertex=[-1+s,1,0,0,0,0,0,-1+s,-1,0,0,1,0,0,1-s,1,0,1-d,0,0,0,1-s,-1,0,1-d,1,0,0]}(0,a.A)(this.vertex,this.flipHorizontal,this.flipVertical),this.setVertices()}viewport(e,t){super.viewport(e,t)}setRotate(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(e%=360)!==this.rotate&&(this.rotate=e,this.setRotateMatrix(this.getRotateMatrix(e)),this.layout(),t&&this.clear())}destroy(){this.sampler=null,this.vbo&&this.vbo.destroy(),this.rotateMatrixBuffer&&this.rotateMatrixBuffer.destroy(),this.bindGroupLayout=null,this.bindGroup=null,this.pipelineLayout=null,this.renderBundle=null,this.renderBundleEncoder=null,this.fsModule=null,this.vsModule=null,this.renderPipeline=null,this.rotateMatrix=null,this.vertex=null,this.context=null,this.options=null,this.destroyed=!0,this.device&&(this.device.destroy(),this.device=null),this.adapter&&(this.adapter=null),super.destroy()}}},92088:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(19371),s=i(15639),a=i(48511),o=i(2198),n=i(16563);class h extends s.A{constructor(e){super({width:0,height:0},{devicePixelRatio:1,renderMode:0}),(0,r.A)(this,"writableStream",void 0),(0,r.A)(this,"writer",void 0),this.writableStream=e}async init(){this.writer=this.writableStream.getWriter()}clear(){}render(e){e=e instanceof VideoFrame?new VideoFrame(e,{timestamp:1e3*(0,n.A)(),rotation:(this.rotate+(this.flipVertical?180:0))%360,flip:(this.flipHorizontal||this.flipVertical)&&!(this.flipHorizontal&&this.flipVertical)}):(0,a.pt)(e,BigInt(1e3*(0,n.A)()),{rotation:(this.rotate+(this.flipVertical?180:0))%360,flip:(this.flipHorizontal||this.flipVertical)&&!(this.flipHorizontal&&this.flipVertical)}),this.writer.write(e)}layout(){}setRotate(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(e%=360)!==this.rotate&&(this.rotate=e,t&&this.clear())}static isSupport(e){return e instanceof VideoFrame||(0,o.A)(e)}}},17469:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(19371),s=i(11202),a=i(46033),o=i(59604),n=i(63210);class h{constructor(e,t,i,s){(0,r.A)(this,"matrixId",void 0),(0,r.A)(this,"primaryId",void 0),(0,r.A)(this,"transferId",void 0),(0,r.A)(this,"rangeId",void 0),this.matrixId=e,this.primaryId=t,this.transferId=i,this.rangeId=s}getMatrixId(){return this.matrixId}getPrimaryId(){return this.primaryId}getTransferId(){return this.transferId}getRangeId(){return this.rangeId}isWide(){return 9===this.primaryId||11===this.primaryId||12===this.primaryId}isHDR(){return 18===this.transferId||16===this.transferId}isToneMappedByDefault(){return 18===this.transferId||16===this.transferId}isAffectedBySDRWhiteLevel(){return 18===this.transferId||16===this.transferId}fullRangeEncodedValues(){return 12===this.transferId||11===this.transferId}getTransformMatrix(e){const t=(1<<e-1)/((1<<e)-1);let i=0,r=0;switch(this.matrixId){case 0:return new s.A;case 1:case 2:i=.2126,r=.0722;break;case 4:i=.3,r=.11;break;case 5:case 6:i=.299,r=.114;break;case 7:i=.212,r=.087;break;case 8:return s.A.RowMajor([.25,.5,.25,0,-.25,.5,-.25,t,.5,0,-.5,t,0,0,0,1]);case 10:return i=.2627,r=.0593,s.A.RowMajor([1,0,0,0,i,1-i-r,r,0,0,0,1,0,0,0,0,1]);case 9:i=.2627,r=.0593;break;case 11:return s.A.RowMajor([0,1,0,0,0,-.5,.493283,.5,.5,-.495951,0,.5,0,0,0,1])}let a=1-i-r,o=.5/(1-r),n=.5/(1-i);return s.A.RowMajor([i,a,r,0,o*-i,o*-a,o*(1-r),.5,n*(1-i),n*-a,n*-r,.5,0,0,0,1])}getRangeAdjustMatrix(e){if(2===this.rangeId)return new s.A;const t=e-8,i=(1<<e)-1,r=i/(219<<t);switch(this.matrixId){case 0:case 8:return(new s.A).setScale(new a.P([r,r,r])).postTranslate(new a.P([-16/219,-16/219,-16/219]));case 1:case 4:case 5:case 6:case 7:case 9:case 10:case 11:case 2:{const e=224<<t,o=i/e,n=(e-i)/(2*e);return(new s.A).setScale(new a.P([r,o,o])).postTranslate(new a.P([-16/219,n,n]))}}return new s.A}getTransferFunction_(){switch(this.transferId){case 8:return o.Hi;case 4:return o.$_;case 5:return o.J7;case 7:return o.q;case 1:case 6:case 14:case 15:return o.aP;case 17:return o.Cr;case 18:case 12:case 9:case 10:case 16:case 2:return null}}getTransferFunction(e){return this.transferId,this.getTransferFunction_()}getInverseTransferFunction(e){const t=this.getTransferFunction(e);if(t){const e={a:0,b:0,c:0,d:0,e:0,f:0,g:0};if(t.a>0&&t.g>0){const i=Math.pow(t.a,t.g);e.a=1/i,e.b=-t.e/i,e.g=1/t.g}return e.d=t.c*t.d+t.f,e.e=-t.b/t.a,0!=t.c&&(e.c=1/t.c,e.f=-t.f/t.c),e}}hasExtendedSkTransferFn(){return 0===this.matrixId}isValid(){return 2!==this.matrixId&&2!==this.primaryId&&2!==this.transferId&&0!==this.rangeId}getColorSpacePrimaries(){const e=n.WO;switch(this.primaryId){case 1:return n.P5;case 4:return n.Wc;case 5:return n.cA;case 7:return n.vi;case 8:return n.cp;case 9:return n.Je;case 10:return n.lf;case 11:return n.Rk;case 12:return n.tR}return e}getPrimaryMatrix(){const e=this.getColorSpacePrimaries(),t=n._O(e);return s.A.RowMajor([t.rc(0,0),t.rc(0,1),t.rc(0,2),0,t.rc(1,0),t.rc(1,1),t.rc(1,2),0,t.rc(2,0),t.rc(2,1),t.rc(2,2),0,0,0,0,1])}}},63210:(e,t,i)=>{i.d(t,{Je:()=>u,P5:()=>n,Rk:()=>p,WO:()=>g,Wc:()=>h,_O:()=>A,cA:()=>d,cp:()=>l,lf:()=>f,tR:()=>m,vi:()=>c});var r=i(46033),s=i(82947),a=i(31434),o=i(50948);const n=[.64,.33,.3,.6,.15,.06,.3127,.329],h=[.67,.33,.21,.71,.14,.08,.31,.316],d=[.64,.33,.29,.6,.15,.06,.3127,.329],c=[.63,.34,.31,.595,.155,.07,.3127,.329],l=[.681,.319,.243,.692,.145,.049,.31,.316],u=[.708,.292,.17,.797,.131,.046,.3127,.329],f=[1,0,0,1,0,0,.3333333333333333,.3333333333333333],p=[.68,.32,.265,.69,.15,.06,.314,.351],m=[.68,.32,.265,.69,.15,.06,.3127,.329],g=[0,0,0,0,0,0,0,0];function A(e){const t=s.A.RowMajor([e[0],e[2],e[4],e[1],e[3],e[5],1-e[0]-e[1],1-e[2]-e[3],1-e[4]-e[5]]),i=t.copy().invert(),n=new r.P([e[6]/e[7],1,(1-e[6]-e[7])/e[7]]),h=a.Y3(i,n);let d=new s.A([h.x,0,0,0,h.y,0,0,0,h.z]);d=o.B(t,d);const c=function(e,t){const i=new r.P([e/t,1,(1-e-t)/t]),n=new r.P([.96422,1,.82521]),h=s.A.RowMajor([.8951,.2664,-.1614,-.7502,1.7135,.0367,.0389,-.0685,1.0296]),d=s.A.RowMajor([.9869929,-.1470543,.1599627,.4323053,.5183603,.0492912,-.0085287,.0400428,.9684867]),c=a.Y3(h,i),l=a.Y3(h,n);let u=new s.A([l.x/c.x,0,0,0,l.y/c.y,0,0,0,l.z/c.z]);return u=o.B(u,h),u=o.B(d,u),u}(e[6],e[7]);return o.B(c,d)}},59604:(e,t,i)=>{i.d(t,{$_:()=>r,Cr:()=>h,Hi:()=>o,J7:()=>s,aP:()=>n,q:()=>a});const r={g:2.2,a:1,b:0,c:0,d:0,e:0,f:0},s={g:2.8,a:1,b:0,c:0,d:0,e:0,f:0},a={g:2.222222222222,a:.899626676224,b:.100373323776,c:.25,d:.091286342118,e:0,f:0},o={g:1,a:1,b:0,c:0,d:0,e:0,f:0},n={g:2.4,a:.9478672985781991,b:.05213270142180095,c:.07739938080495357,d:.04045,e:0,f:0},h={g:2.6,a:1.034080527699,b:0,c:0,d:0,e:0,f:0}},72588:(e,t,i)=>{i.d(t,{A:()=>n,U:()=>o});const r=.2627,s=.678,a=.0593;function o(e){e.metadata.hlgOOTFGammaMinusOne=.2}function n(e){return 0===e.type?`\n      {\n        vec4 luma_vec = vec4(${r}, ${s}, ${a}, 0.0);\n        float L = dot(color, luma_vec);\n        if (L > 0.0) {\n          color.r *= pow(L, hlg_ootf_gamma_minus_one);\n          color.g *= pow(L, hlg_ootf_gamma_minus_one);\n          color.b *= pow(L, hlg_ootf_gamma_minus_one);\n        }\n      }\n    `:1===e.type?`\n      {\n        let luma_vec: vec4<f32> = vec4(${r}, ${s}, ${a}, 0.0);\n        let L: f32 = dot(color, luma_vec);\n        if (L > 0.0) {\n          color.r *= pow(L, hlg_ootf_gamma_minus_one);\n          color.g *= pow(L, hlg_ootf_gamma_minus_one);\n          color.b *= pow(L, hlg_ootf_gamma_minus_one);\n        }\n      }\n    `:""}},2224:(e,t,i)=>{function r(e,t){let i="",r="";if(0===t.type?(i="mat4",r="vec4"):1===t.type&&(i="mat4x4",r="vec4"),!i||!r)return"";let s=`\n      color = ${i}(\n        ${e.rc(0,0)}, ${e.rc(1,0)}, ${e.rc(2,0)}, 0,\n        ${e.rc(0,1)}, ${e.rc(1,1)}, ${e.rc(2,1)}, 0,\n        ${e.rc(0,2)}, ${e.rc(1,2)}, ${e.rc(2,2)}, 0,\n        0, 0, 0, 1\n      ) * color;\n    `;return 0===e.rc(0,3)&&0===e.rc(1,3)&&0===e.rc(2,3)||(s+=`\n        color += ${r}(${e.rc(0,3)}, ${e.rc(1,3)}, ${e.rc(2,3)}, 0);\n      `),s}i.d(t,{A:()=>r})},90428:(e,t,i)=>{function r(e,t){t.metadata.sdrRelativeToNitsFactor=t.dstSdrMaxLuminanceNits/e}function s(e){return"\n    color.r *= sdr_relative_to_nits_factor;\n    color.g *= sdr_relative_to_nits_factor;\n    color.b *= sdr_relative_to_nits_factor;\n "}i.d(t,{A:()=>s,j:()=>r})},95103:(e,t,i)=>{i.d(t,{A:()=>a,n:()=>s});var r=i(80320);function s(e,t,i){let s=i.dstSdrMaxLuminanceNits;t&&(s=r.kH,i.sdrWhiteLevel&&(s=i.sdrWhiteLevel)),i.metadata.nitsToSdrRelativeFactor=e/s}function a(e){return"\n    color.r *= nits_to_sdr_relative_factor;\n    color.g *= nits_to_sdr_relative_factor;\n    color.b *= nits_to_sdr_relative_factor;\n  "}},1897:(e,t,i)=>{i.d(t,{A:()=>a,J:()=>s});var r=i(80320);function s(e,t){const i=function(e,t){let i=r.hD;18!==e.getTransferId()&&t.maxContentLightLevel>0&&(i=t.maxContentLightLevel);let s=r.kH;return t.sdrWhiteLevel&&(s=t.sdrWhiteLevel),i/s}(e,t);i>t.dstMaxLuminanceRelative?(t.metadata.pqTonemapA=t.dstMaxLuminanceRelative/(i*i),t.metadata.pqTonemapB=1/t.dstMaxLuminanceRelative):(t.metadata.pqTonemapA=0,t.metadata.pqTonemapB=0)}function a(e){return`\n    {\n      ${1===e.type?"let maximum: f32":"float maximum"} = max(color.r, max(color.g, color.b));\n      if (maximum > 0.0) {\n        color.r *= (1.0 + pq_tonemap_a * maximum) / (1.0 + pq_tonemap_b * maximum);\n        color.g *= (1.0 + pq_tonemap_a * maximum) / (1.0 + pq_tonemap_b * maximum);\n        color.b *= (1.0 + pq_tonemap_a * maximum) / (1.0 + pq_tonemap_b * maximum);\n      }\n    }\n `}},44491:(e,t,i)=>{function r(e){return e===e>>>0?`${e}.0`:e.toString()}i.d(t,{A:()=>r})},51716:(e,t,i)=>{i.d(t,{A:()=>A});var r=i(17469),s=i(80320),a=i(2224),o=i(69920),n=i(61670),h=i(12501),d=i(23270),c=i(72588),l=i(95103),u=i(1897),f=i(90428),p=i(88199),m=i(14912),g=i(52067);function A(e,t,i){const A=[],v=8===e.getMatrixId(),y=(0,a.A)(e.getRangeAdjustMatrix(i.bitDepth),i);if(v||A.push(y),A.push((0,a.A)(e.getTransformMatrix(i.bitDepth).invert(),i)),v&&A.push(y),t.isValid()){if(e.isHDR()){switch(e.getTransferId()){case 18:A.push((0,o.A)(i));break;case 16:A.push((0,n.A)(i));break;default:const t=e.getTransferFunction();t?A.push((0,h.A)(t,e.hasExtendedSkTransferFn(),i)):A.push((0,d.A)(e.getTransferId(),i))}10===e.getMatrixId()&&A.push((0,a.A)(e.getTransformMatrix(i.bitDepth).invert(),i)),A.push((0,a.A)(e.getPrimaryMatrix(),i));const v=new r.A(0,9,8,2);switch(e.getTransferId()){case 18:A.push((0,a.A)(v.getPrimaryMatrix().invert(),i)),(0,c.U)(i),A.push((0,c.A)(i)),(0,l.n)(s.hD,!0,i),A.push((0,l.A)(i)),i.toneMapPQAndHlgToDst&&((0,u.J)(e,i),A.push((0,u.A)(i))),A.push((0,a.A)(v.getPrimaryMatrix(),i));break;case 16:(0,l.n)(s.th,!0,i),A.push((0,l.A)(i)),i.toneMapPQAndHlgToDst&&(A.push((0,a.A)(v.getPrimaryMatrix().invert(),i)),(0,u.J)(e,i),A.push((0,u.A)(i)),A.push((0,a.A)(v.getPrimaryMatrix(),i)))}switch(A.push((0,a.A)(t.getPrimaryMatrix().invert(),i)),10===t.getMatrixId()&&A.push((0,a.A)(t.getTransformMatrix(i.bitDepth),i)),t.getTransferId()){case 18:(0,f.j)(s.kH,i),A.push((0,f.A)(i)),A.push((0,p.A)(i));break;case 16:(0,f.j)(s.th,i),A.push((0,f.A)(i)),A.push((0,m.A)(i));default:const r=t.getInverseTransferFunction();r?A.push((0,h.A)(r,e.hasExtendedSkTransferFn(),i)):A.push((0,g.A)(e.getTransferId(),i))}}if(!i.outputRGB){const e=8===t.getMatrixId(),r=(0,a.A)(t.getRangeAdjustMatrix(i.bitDepth).invert(),i);e&&A.push(r),A.push((0,a.A)(t.getTransformMatrix(i.bitDepth),i)),e||A.push(r)}}return A}},80320:(e,t,i)=>{i.d(t,{hD:()=>s,kH:()=>r,th:()=>a});const r=203,s=1e3,a=1e4},83218:(e,t,i)=>{function r(e,t,i){return t?`\n      {\n        ${1===i.type?"var v: f32":"float v"} = abs(color.r);\n        ${e()}\n        color.r = sign(color.r) * v;\n      }\n      {\n        ${1===i.type?"var v: f32":"float v"} = abs(color.g);\n        ${e()}\n        color.g = sign(color.g) * v;\n      }\n      {\n        ${1===i.type?"var v: f32":"float v"} = abs(color.b);\n        ${e()}\n        color.b = sign(color.b) * v;\n      }\n    `:`\n      {\n        ${1===i.type?"var v: f32":"float v"} = color.r;\n        ${e()}\n        color.r = v;\n      }\n      {\n        ${1===i.type?"var v: f32":"float v"} = color.g;\n        ${e()}\n        color.g = v;\n      }\n      {\n        ${1===i.type?"var v: f32":"float v"} = color.b;\n        ${e()}\n        color.b = v;\n      }\n    `}i.d(t,{A:()=>r})},52067:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(83218);function s(e,t){return(0,r.A)((function(){switch(e){case 9:return"\n          if (v < 0.0) {\n            v = 0.0;\n          }\n          else {\n            v =  1.0 + log(v) / log(10.0) / 2.0;\n          }\n        ";case 10:return"\n          if (v < sqrt(10.0) / 1000.0)\n            v = 0.0;\n          }\n          else {\n            v = 1.0 + log(v) / log(10.0) / 2.5;\n          }\n        ";case 11:return`\n          ${1===t.type?"let a: f32":"float a"} = 1.099296826809442;\n          ${1===t.type?"let b: f32":"float b"}= 0.018053968510807;\n          if (v < -b) {\n            v = -a * pow(-v, 0.45) + (a - 1.0);\n          }\n          else if (v <= b) {\n            v = 4.5 * v;\n          }\n          else {\n            v = a * pow(v, 0.45) - (a - 1.0);\n          }\n        `;case 12:return`\n          ${1===t.type?"let a: f32":"float a"} = 1.099;\n          ${1===t.type?"let b: f32":"float b"} = 0.018;\n          ${1===t.type?"let l: f32":"float l"} = 0.0045;\n\n          if (v < -l) {\n            v = -(a * pow(-4.0 * v, 0.45) + (a - 1.0)) / 4.0;\n          }\n          else if (v <= b) {\n            v = 4.5 * v;\n          }\n          else {\n            v = a * pow(v, 0.45) - (a - 1.0);\n          }\n        `;default:return""}}),!1,t)}},69920:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(83218);function s(e){return(0,r.A)((function(){return`\n      v = max(0.0, v);\n      ${1===e.type?"let a: f32":"float a"} = 0.17883277;\n      ${1===e.type?"let b: f32":"float b"} = 0.28466892;\n      ${1===e.type?"let c: f32":"float c"} = 0.55991073;\n      if (v <= 0.5) {\n        v = v * v * 4.0;\n      }\n      else {\n        v = exp((v - c) / a) + b;\n      }\n      v = v / 12.0;\n    `}),!1,e)}},88199:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(83218);function s(e){return(0,r.A)((function(){return`\n      v = max(0.0, v);\n      ${1===e.type?"let a: f32":"float a"} = 0.17883277;\n      ${1===e.type?"let b: f32":"float b"} = 0.28466892;\n      ${1===e.type?"let c: f32":"float c"} = 0.55991073;\n      if (v <= 1.0) {\n        v = 0.5 * sqrt(v);\n      }\n      else {\n        v = a * log(v - b) + c;\n      }\n    `}),!1,e)}},61670:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(83218);function s(e){return(0,r.A)((function(){return`\n      v = max(0.0, v);\n      ${1===e.type?"let m1: f32":"float m1"} = (2610.0 / 4096.0) / 4.0;\n      ${1===e.type?"let m2: f32":"float m2"} = (2523.0 / 4096.0) * 128.0;\n      ${1===e.type?"let c1: f32":"float c1"} = 3424.0 / 4096.0;\n      ${1===e.type?"let c2: f32":"float c2"} = (2413.0 / 4096.0) * 32.0;\n      ${1===e.type?"let c3: f32":"float c3"} = (2392.0 / 4096.0) * 32.0;\n      \n      ${0===e.type?"\n        #ifdef GL_FRAGMENT_PRECISION_HIGH\n        highp float v2 = v;\n        #else\n        float v2 = v;\n        #endif\n      ":"var v2: f32 = v;"}\n  \n      v2 = pow(max(pow(v2, 1.0 / m2) - c1, 0.0) / (c2 - c3 * pow(v2, 1.0 / m2)), 1.0 / m1);\n      v = v2;\n    `}),!1,e)}},14912:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(83218);function s(e){return(0,r.A)((function(){return`\n      v = max(0.0, v);\n      ${1===e.type?"let m1: f32":"float m1"} = (2610.0 / 4096.0) / 4.0;\n      ${1===e.type?"let m2: f32":"float m2"} = (2523.0 / 4096.0) * 128.0;\n      ${1===e.type?"let c1: f32":"float c1"} = 3424.0 / 4096.0;\n      ${1===e.type?"let c2: f32":"float c2"} = (2413.0 / 4096.0) * 32.0;\n      ${1===e.type?"let c3: f32":"float c3"} = (2392.0 / 4096.0) * 32.0;\n      v =  pow((c1 + c2 * pow(v, m1)) / (1.0 + c3 * pow(v, m1)), m2);\n    `}),!1,e)}},23270:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(83218);function s(e,t){return(0,r.A)((function(){switch(e){case 9:return"\n          if (v < 0.0) {\n            v = 0.0;\n          }\n          else {\n            v = pow(10.0, (v - 1.0) * 2.0);\n          }\n        ";case 10:return"\n          if (v < 0.0) {\n            v = 0.0;\n          }\n          else {\n            v = pow(10.0, (v - 1.0) * 2.5);\n          }\n        ";case 11:return`\n          ${1===t.type?"let a: f32":"float a"} = 1.099296826809442;\n          ${1===t.type?"let from_linear_neg_a: f32":"float from_linear_neg_a"} = -1.047844;\n          ${1===t.type?"let from_linear_b: f32":"float from_linear_b"} = 0.081243;\n          if (v < from_linear_neg_a) {\n            v = -pow((a - 1.0 - v) / a, 1.0 / 0.45);\n          }\n          else if (v <= from_linear_b) {\n            v = v / 4.5;\n          }\n          else {\n            v = pow((v + a - 1.0) / a, 1.0 / 0.45);\n          }\n        `;case 12:return`\n          ${1===t.type?"let a: f32":"float a"} = 1.099;\n          ${1===t.type?"let from_linear_neg_l: f32":"float from_linear_neg_l"} = -0.020250;\n          ${1===t.type?"let from_linear_b: f32":"float from_linear_b"} = 0.081000;\n          if (v < from_linear_neg_l) {\n            v = -pow((1.0 - a - v * 4.0) / a, 1.0 / 0.45) / 4.0;\n          }\n          else if (v <= from_linear_b) {\n            v = v / 4.5;\n          }\n          else {\n            v = pow((v + a - 1.0) / a, 1.0 / 0.45);\n          }\n        `;default:return""}}),!1,t)}},12501:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(83218),s=i(44491);function a(e,t,i){return(0,r.A)((function(){let t=.0009765625,i="v";Math.abs(e.c-1)>t&&(i=`${(0,s.A)(e.c)} * ${i}`),Math.abs(e.f)>t&&(i=`${i} + ${(0,s.A)(e.f)}`);let r="v";return Math.abs(e.a=1)>t&&(r=`${(0,s.A)(e.a)} * ${r}`),Math.abs(e.b)>t&&(r=`${r} + ${(0,s.A)(e.b)}`),Math.abs(e.g-1)>t&&(r=`pow(${r}, ${(0,s.A)(e.g)})`),Math.abs(e.e)>t&&(r=`${r} + ${(0,s.A)(e.e)}`),`\n      if (v < ${(0,s.A)(e.d)}) {\n        v = ${i};\n      }\n      else {\n        v = ${r};\n      }\n    `}),!1,i)}},58106:(e,t,i)=>{function r(e,t,i){if(t){let t=e[3],i=e[4];e[3]=e[17],e[4]=e[18],e[17]=t,e[18]=i,t=e[10],i=e[11],e[10]=e[24],e[11]=e[25],e[24]=t,e[25]=i}if(i){let t=e[3],i=e[4];e[3]=e[10],e[4]=e[11],e[10]=t,e[11]=i,t=e[17],i=e[18],e[17]=e[24],e[18]=e[25],e[24]=t,e[25]=i}}i.d(t,{A:()=>r})},50893:(e,t,i)=>{i.d(t,{A:()=>n});var r,s=i(19371),a=i(75354),o=i(86220);class n{constructor(){(0,s.A)(this,"offset",void 0),(0,s.A)(this,"multiplier",void 0),(0,s.A)(this,"pqTonemapA",void 0),(0,s.A)(this,"pqTonemapB",void 0),(0,s.A)(this,"hlgOOTFGammaMinusOne",void 0),(0,s.A)(this,"nitsToSdrRelativeFactor",void 0),(0,s.A)(this,"sdrRelativeToNitsFactor",void 0)}}r=n,(()=>{const e=r.prototype,t=new Map;t.set("offset",{0:18,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("multiplier",{0:18,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("pqTonemapA",{0:18,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("pqTonemapB",{0:18,1:0,2:0,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("hlgOOTFGammaMinusOne",{0:18,1:0,2:0,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("nitsToSdrRelativeFactor",{0:18,1:0,2:0,3:0,4:0,5:0,6:0,7:20,8:0}),t.set("sdrRelativeToNitsFactor",{0:18,1:0,2:0,3:0,4:0,5:0,6:0,7:24,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,4),(0,o.A)(e,a.g7,28),(0,o.A)(e,a.JY,t)})()},45120:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(19371);class s{constructor(e,t){(0,r.A)(this,"context",void 0),(0,r.A)(this,"canvas",void 0),(0,r.A)(this,"rgbCanvas",void 0),(0,r.A)(this,"rgbContext",void 0),(0,r.A)(this,"vs",void 0),(0,r.A)(this,"fs",void 0),(0,r.A)(this,"program",void 0),(0,r.A)(this,"posBuffer",void 0),(0,r.A)(this,"texBuffer",void 0),(0,r.A)(this,"texture",void 0),this.canvas=new OffscreenCanvas(e,t),this.context=this.canvas.getContext("webgl"),this.rgbCanvas=new OffscreenCanvas(e,t),this.rgbContext=this.rgbCanvas.getContext("2d"),this.vs=this.context.createShader(this.context.VERTEX_SHADER),this.context.shaderSource(this.vs,"\n      attribute vec2 a_position;\n      attribute vec2 a_texCoord;\n      varying vec2 v_texCoord;\n      void main() {\n        gl_Position = vec4(a_position, 0, 1);\n        v_texCoord = a_texCoord;\n      }\n    "),this.context.compileShader(this.vs),this.fs=this.context.createShader(this.context.FRAGMENT_SHADER),this.context.shaderSource(this.fs,"\n      precision mediump float;\n      uniform sampler2D u_texture;\n      varying vec2 v_texCoord;\n      void main() {\n        vec4 rgb = texture2D(u_texture, v_texCoord);\n        gl_FragColor = vec4(rgb.rgb, rgb.r);\n      }\n    "),this.context.compileShader(this.fs);const i=this.program=this.context.createProgram();this.context.attachShader(i,this.vs),this.context.attachShader(i,this.fs),this.context.linkProgram(i),this.context.useProgram(i),this.posBuffer=this.context.createBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,this.posBuffer),this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array([-1,1,-1,-1,1,1,1,-1]),this.context.STATIC_DRAW);const s=this.context.getAttribLocation(i,"a_position");this.context.enableVertexAttribArray(s),this.context.vertexAttribPointer(s,2,this.context.FLOAT,!1,0,0),this.texBuffer=this.context.createBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,this.texBuffer),this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),this.context.STATIC_DRAW);const a=this.context.getAttribLocation(i,"a_texCoord");this.context.enableVertexAttribArray(a),this.context.vertexAttribPointer(a,2,this.context.FLOAT,!1,0,0),this.texture=this.context.createTexture(),this.context.bindTexture(this.context.TEXTURE_2D,this.texture),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.LINEAR),this.context.clearColor(0,0,0,0),this.context.clearDepth(1),this.setUnpackAlignment(e)}setUnpackAlignment(e){e%8==0?this.context.pixelStorei(this.context.UNPACK_ALIGNMENT,8):e%4==0?this.context.pixelStorei(this.context.UNPACK_ALIGNMENT,4):e%2==0?this.context.pixelStorei(this.context.UNPACK_ALIGNMENT,2):this.context.pixelStorei(this.context.UNPACK_ALIGNMENT,1)}getTarget(){return this.canvas}process(e){this.rgbContext.drawImage(e,0,0,this.rgbCanvas.width,this.rgbCanvas.height),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,this.rgbCanvas),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT),this.context.drawArrays(this.context.TRIANGLE_STRIP,0,4)}destroy(){this.context.deleteTexture(this.texture),this.context.deleteBuffer(this.texBuffer),this.context.deleteBuffer(this.posBuffer),this.context.deleteProgram(this.program),this.context.deleteShader(this.fs),this.context.deleteShader(this.vs)}}},94672:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(1315);class a extends s.A{constructor(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(e,t),(0,r.A)(this,"enableColor",void 0),(0,r.A)(this,"aPoint",void 0),(0,r.A)(this,"aColor",void 0),this.enableColor=i}link(e){super.link(e),this.aPoint=this.gl.getAttribLocation(this.program,"point"),this.aColor=this.gl.getAttribLocation(this.program,"color"),this.enableColor?(this.gl.enableVertexAttribArray(this.aPoint),this.gl.enableVertexAttribArray(this.aColor)):this.gl.enableVertexAttribArray(this.aPoint)}bind(){super.bind(),this.enableColor?(this.gl.vertexAttribPointer(this.aPoint,3,this.gl.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,0),this.gl.vertexAttribPointer(this.aColor,4,this.gl.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT)):this.gl.vertexAttribPointer(this.aPoint,3,this.gl.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,0)}}},1315:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(19371);class s{constructor(e,t){(0,r.A)(this,"gl",void 0),(0,r.A)(this,"_program",void 0),(0,r.A)(this,"vertexShader",void 0),(0,r.A)(this,"fragmentShader",void 0),this.vertexShader=e,this.fragmentShader=t}link(e){this.gl=e,this.vertexShader&&this.vertexShader.compile(this.gl),this.fragmentShader&&this.fragmentShader.compile(this.gl),this._program=this.gl.createProgram(),this.gl.attachShader(this._program,this.vertexShader.shader),this.gl.attachShader(this._program,this.fragmentShader.shader),this.gl.linkProgram(this._program)}stop(){this.vertexShader.stop(this.gl),this.fragmentShader.stop(this.gl),this.gl.deleteProgram(this._program),this.vertexShader=null,this.fragmentShader=null,this._program=null}bind(){this.gl.useProgram(this._program)}get program(){return this._program}}},21390:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(19371),s=i(94672),a=i(7301),o=i(11331),n=i(87936);class h extends s.A{constructor(e,t){super(new a.A(t||n.A),new o.A(e)),(0,r.A)(this,"rotateMatrixLocation",void 0),(0,r.A)(this,"ySamplerLocation",void 0),(0,r.A)(this,"uSamplerLocation",void 0),(0,r.A)(this,"vSamplerLocation",void 0),(0,r.A)(this,"aSamplerLocation",void 0)}link(e){super.link(e),this.rotateMatrixLocation=this.gl.getUniformLocation(this.program,"rotateMatrix"),this.ySamplerLocation=this.gl.getUniformLocation(this.program,"y_Sampler"),this.uSamplerLocation=this.gl.getUniformLocation(this.program,"u_Sampler"),this.vSamplerLocation=this.gl.getUniformLocation(this.program,"v_Sampler"),this.aSamplerLocation=this.gl.getUniformLocation(this.program,"a_Sampler")}setRotateMatrix(e){this.gl.uniformMatrix4fv(this.rotateMatrixLocation,!1,new Float32Array(e))}bindYTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.gl.uniform1i(this.ySamplerLocation,e)}bindUTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.gl.uniform1i(this.uSamplerLocation,e)}bindVTexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.gl.uniform1i(this.vSamplerLocation,e)}bindATexture(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.gl.uniform1i(this.aSamplerLocation,e)}}},26365:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(21390);class a extends s.A{constructor(e,t){super(e,t),(0,r.A)(this,"offsetLocation",void 0),(0,r.A)(this,"multiplierLocation",void 0),(0,r.A)(this,"pqTonemapALocation",void 0),(0,r.A)(this,"pqTonemapBLocation",void 0),(0,r.A)(this,"hlgOOTFGammaMinusOneLocation",void 0),(0,r.A)(this,"hlgDstMaxLuminanceRelativeLocation",void 0),(0,r.A)(this,"nitsToSdrRelativeFactorLocation",void 0),(0,r.A)(this,"sdrRelativeToNitsFactorLocation",void 0)}link(e){super.link(e),this.offsetLocation=this.gl.getUniformLocation(this.program,"offset"),this.multiplierLocation=this.gl.getUniformLocation(this.program,"multiplier"),this.pqTonemapALocation=this.gl.getUniformLocation(this.program,"pq_tonemap_a"),this.pqTonemapBLocation=this.gl.getUniformLocation(this.program,"pq_tonemap_b"),this.hlgOOTFGammaMinusOneLocation=this.gl.getUniformLocation(this.program,"hlg_ootf_gamma_minus_one"),this.nitsToSdrRelativeFactorLocation=this.gl.getUniformLocation(this.program,"nits_to_sdr_relative_factor"),this.sdrRelativeToNitsFactorLocation=this.gl.getUniformLocation(this.program,"sdr_relative_to_nits_factor")}setMetaData(e){this.gl.uniform1f(this.offsetLocation,e.offset),this.gl.uniform1f(this.multiplierLocation,e.multiplier),this.gl.uniform1f(this.pqTonemapALocation,e.pqTonemapA),this.gl.uniform1f(this.pqTonemapBLocation,e.pqTonemapB),this.gl.uniform1f(this.hlgOOTFGammaMinusOneLocation,e.hlgOOTFGammaMinusOne),this.gl.uniform1f(this.nitsToSdrRelativeFactorLocation,e.nitsToSdrRelativeFactor),this.gl.uniform1f(this.sdrRelativeToNitsFactorLocation,e.sdrRelativeToNitsFactor)}}},94884:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(21390);class s extends r.A{constructor(e,t){super(e,t)}}},11331:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(56067);class s extends r.A{constructor(e){super(1,e)}}},56067:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(19371);class s{constructor(e,t){(0,r.A)(this,"type",void 0),(0,r.A)(this,"_shader",void 0),(0,r.A)(this,"_source",void 0),(0,r.A)(this,"compiled",void 0),this.type=e,this._shader=null,this._source=t,this.compiled=!1}compile(e){this.compiled||(this._shader=e.createShader(0===this.type?e.VERTEX_SHADER:e.FRAGMENT_SHADER),e.shaderSource(this._shader,this._source),e.compileShader(this._shader),this.compiled=!0)}stop(e){e.deleteShader(this._shader),this._shader=null}get shader(){return this._shader}}},7301:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(56067);class s extends r.A{constructor(e){super(0,e)}}},21691:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(81819);class a{constructor(e,t,i){(0,r.A)(this,"gl",void 0),(0,r.A)(this,"width",void 0),(0,r.A)(this,"height",void 0),(0,r.A)(this,"texture",void 0),this.gl=e,this.width=t,this.height=i,this.texture=this.gl.createTexture()}getTexture(){return this.texture}bind(e){s.ai(e)&&this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}setSize(e,t){this.width=e,this.height=t}setUnpackAlignment(){this.width%8==0?this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,8):this.width%4==0?this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,4):this.width%2==0?this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,2):this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1)}destroy(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}}},33320:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(19371),s=i(21691),a=i(87339);class o extends s.A{constructor(e,t,i){super(e,t,i),(0,r.A)(this,"filter",void 0),(0,r.A)(this,"format",void 0),(0,r.A)(this,"internalformat",void 0),(0,r.A)(this,"dataType",void 0),(0,r.A)(this,"firstUploaded",void 0),(0,r.A)(this,"pbo",void 0),this.format=this.gl.LUMINANCE,this.filter=this.gl.LINEAR,this.internalformat=this.gl.LUMINANCE,this.dataType=this.gl.UNSIGNED_BYTE}init(){this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.filter),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.firstUploaded=!1}setFormat(e){this.format=e}setInternalformat(e){this.internalformat=e}setDataType(e){this.dataType=e}setFilter(e){this.filter=e}fill(e){if(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.setUnpackAlignment(),this.firstUploaded)if(this.pbo){const t=this.gl;t.bindBuffer(t.PIXEL_UNPACK_BUFFER,this.pbo),t.bufferSubData(t.PIXEL_UNPACK_BUFFER,0,e),t.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.width,this.height,this.format,this.dataType,0)}else this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.width,this.height,this.format,this.dataType,e);else{if("function"==typeof WebGL2RenderingContext&&this.gl instanceof WebGL2RenderingContext)try{this.pbo=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.PIXEL_UNPACK_BUFFER,this.pbo),this.gl.bufferData(this.gl.PIXEL_UNPACK_BUFFER,e,this.gl.STREAM_DRAW),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.internalformat,this.width,this.height,0,this.format,this.dataType,0)}catch(t){this.pbo=null,a.R8("not support pbo","packages/avrender/src/image/webgl/texture/VideoTexture.ts",109),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.internalformat,this.width,this.height,0,this.format,this.dataType,e)}else this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.internalformat,this.width,this.height,0,this.format,this.dataType,e);this.firstUploaded=!0}}destroy(){this.pbo&&this.gl.deleteBuffer(this.pbo),super.destroy()}}},25334:(e,t,i)=>{i.d(t,{A:()=>A});var r=i(19371),s=i(42524),a=i(77389),o=i(77969),n=i(16563),h=i(87339),d=i(81819),c=i(85266),l=i(41863),u=i(75176),f=i(33740),p=i(31184);const m="packages/avrender/src/pcm/AudioSourceBufferNode.ts",g=o.A.windows||o.A.mac||o.A.linux?20:30;class A{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,r.A)(this,"context",void 0),(0,r.A)(this,"observer",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"pullIPC",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"channels",void 0),(0,r.A)(this,"ended",void 0),(0,r.A)(this,"float32",void 0),(0,r.A)(this,"buffered",void 0),(0,r.A)(this,"pause",void 0),(0,r.A)(this,"startTime",void 0),(0,r.A)(this,"dest",void 0),(0,r.A)(this,"queue",void 0),(0,r.A)(this,"firstRendered",void 0),(0,r.A)(this,"lastStutterTimestamp",void 0),this.context=e,this.observer=t,this.options=i}async request(e,t,i){switch(e){case"init":break;case"start":{const{port:e,channels:i}=t;this.channels=i,this.pullIPC=new c.Ay(e),this.buffer=this.allocBuffer(),this.float32=new Float32Array((0,f.eq)().buffer),this.queue=[],this.startTime=0,this.ended=!1,this.pause=!1,this.firstRendered=!1,this.buffered=!0,this.lastStutterTimestamp=(0,n.A)();let r=await this.pullInterval();if(r<0)return this.ended=!0,this.buffered=!1,this.freeBuffer(this.buffer),h.pq("audio source ended",m,114),void this.observer.onEnded();this.buffering(),r=await this.pullInterval(),r<0&&(this.ended=!0,this.buffered=!1),this.process();break}case"restart":{if(!this.ended)return;this.buffer=this.allocBuffer(),this.queue=[],this.startTime=0,this.ended=!1,this.pause=!1,this.firstRendered=!1,this.buffered=!0,this.lastStutterTimestamp=(0,n.A)();let e=await this.pullInterval();if(e<0)return this.ended=!0,this.buffered=!1,this.freeBuffer(this.buffer),h.pq("audio source ended",m,153),void this.observer.onEnded();this.buffering(),e=await this.pullInterval(),e<0&&(this.ended=!0,this.buffered=!1),this.process();break}case"stop":this.freeBuffer(this.buffer),this.buffer=null,this.ended=!0,this.pullIPC.destroy();break;case"clear":this.queue.forEach((e=>{e.disconnect()})),this.queue.length=0;break;case"pause":this.pause=!0;break;case"unpause":this.pause=!1,this.queue.length||this.process()}}allocBuffer(){const e=(0,p.Gy)(48);a.M[20](e,(0,p.Gy)(4*this.channels));const t=(0,p.Gy)(512*g*this.channels);for(let i=0;i<this.channels;i++)a.M[20](s.f[20](e)+4*i,t+128*g*4*i);return a.M[15](e+12,128*g),e}freeBuffer(e){e&&((0,p.aI)(s.f[20](e)),(0,p.aI)(e),(0,p.Eb)(e))}async pullInterval(){let e=0;if(this.options.isMainWorker){const t=await this.pullIPC.request("pullBuffer",{nbSamples:128*g});d.sv(t)?(e=0,(0,l.lW)(s.f[20](s.f[20](this.buffer)),t.byteLength,new Uint8Array(t))):e=t}else e=await this.pullIPC.request("pull",{buffer:this.buffer});return e}async pull(){this.buffered=!1,await this.pullInterval()<0?this.ended=!0:(this.buffered=!0,this.queue.length||this.process())}buffering(){this.float32.length||(this.float32=new Float32Array((0,f.eq)().buffer));const e=this.context.createBuffer(this.channels,128*g,this.context.sampleRate);for(let t=0;t<this.channels;t++)if(s.f[20](s.f[20](this.buffer)+4*t)){let i=s.f[20](s.f[20](this.buffer)+4*t)>>>2;e.copyToChannel&&!u.USE_THREADS?e.copyToChannel(this.float32.subarray(i,i+128*g),t,0):e.getChannelData(t).set(this.float32.subarray(i,i+128*g),0)}const t=this.context.createBufferSource();t.buffer=e,t.onended=()=>{if(this.queue.shift(),this.ended&&!this.queue.length)return this.freeBuffer(this.buffer),h.pq("audio source ended",m,289),void this.observer.onEnded();this.process(),this.queue.length||(0,n.A)()-this.lastStutterTimestamp>1e3&&(this.observer.onStutter(),this.lastStutterTimestamp=(0,n.A)()),this.firstRendered||(this.firstRendered=!0,this.observer.onFirstRendered())},0===this.startTime&&(this.startTime=this.context.currentTime),t.start(this.startTime),this.dest&&t.connect(this.dest),this.startTime+=t.buffer.duration,this.queue.push(t)}connect(e){this.dest=e}disconnect(){for(let e=0;e<this.queue.length;e++)this.queue[e].disconnect();this.dest=null,this.queue.length=0}process(){this.buffer&&!this.pause&&this.buffered&&(this.buffering(),this.pull())}}},28776:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(67639);class s extends r.A{constructor(e,t){super(e,t,"audio-source-processor",arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}}},46962:(e,t,i)=>{var r=i(19371),s=i(49497),a=i(77969),o=i(81819),n=i(87339),h=i(85266);let d=a.A.windows||a.A.mac||a.A.linux?10:20;class c extends s.A{constructor(){super(),(0,r.A)(this,"pullIPC",void 0),(0,r.A)(this,"frontBuffer",void 0),(0,r.A)(this,"backBuffer",void 0),(0,r.A)(this,"channels",void 0),(0,r.A)(this,"backBufferOffset",void 0),(0,r.A)(this,"ended",void 0),(0,r.A)(this,"frontBuffered",void 0),(0,r.A)(this,"pause",void 0),(0,r.A)(this,"firstRendered",void 0),(0,r.A)(this,"stopped",void 0),(0,r.A)(this,"afterPullResolve",void 0),(0,r.A)(this,"lastStutterTimestamp",void 0),this.ended=!1,this.pause=!0,this.ipcPort.on(h.S3,(async e=>{switch(e.method){case"init":e.params&&e.params.bufferLength&&(d=e.params.bufferLength),this.ipcPort.reply(e);break;case"start":{const{port:t,channels:i}=e.params;this.channels=i,this.pullIPC=new h.Ay(t),this.backBufferOffset=0,this.ended=!1,this.frontBuffered=!0,this.pause=!1,this.firstRendered=!1,this.stopped=!1,this.lastStutterTimestamp=currentTime;const r=[],s=[];await this.pull(r),r.length?(await this.pull(s),s.length||(this.ended=!0,this.frontBuffered=!1)):(this.ended=!0,this.frontBuffered=!1,this.backBufferOffset=d),this.frontBuffer=s,this.backBuffer=r,this.ipcPort.reply(e);break}case"restart":{if(!this.ended)return void this.ipcPort.reply(e);this.backBufferOffset=0,this.ended=!1,this.frontBuffered=!0,this.pause=!1,this.firstRendered=!1,this.stopped=!1,this.lastStutterTimestamp=currentTime;const t=[],i=[];await this.pull(t),t.length?(await this.pull(i),i.length||(this.ended=!0,this.frontBuffered=!1)):(this.ended=!0,this.frontBuffered=!1,this.backBufferOffset),this.frontBuffer=i,this.backBuffer=t,this.ipcPort.reply(e);break}case"clear":this.backBufferOffset=d,this.ipcPort.reply(e);break;case"stop":this.ended||this.pause||this.frontBuffered||await new Promise((e=>{this.afterPullResolve=e})),this.stopped=!0,this.pullIPC.destroy(),this.ipcPort.reply(e);break;case"pause":this.pause=!0,this.ipcPort.reply(e);break;case"unpause":this.pause=!1,this.ipcPort.reply(e)}}))}async pull(e){const t=await this.pullIPC.request("pullBuffer",{nbSamples:128*d});if(o.ai(t))this.ended=!0;else{const i=new Float32Array(t);for(let t=0;t<this.channels;t++)e[t]=i.subarray(t*d*128,(t+1)*d*128)}this.afterPullResolve&&this.afterPullResolve()}swapBuffer(){return!!this.frontBuffered&&(this.backBuffer=this.frontBuffer,this.backBufferOffset=0,this.frontBuffer=[],this.frontBuffered=!1,this.pull(this.frontBuffer).then((()=>{this.frontBuffered=!0})),!0)}process(e,t,i){if(this.stopped)return!1;if(this.backBuffer&&!this.pause){if(this.backBufferOffset===d){if(this.ended)return this.backBuffer=null,this.frontBuffer=null,n.pq("audio source ended","packages/avrender/src/pcm/AudioSourceWorkletProcessor.ts",237),this.ipcPort.notify("ended"),!0;if(!this.swapBuffer())return currentTime-this.lastStutterTimestamp>1&&(this.ipcPort.notify("stutter"),this.lastStutterTimestamp=currentTime),!0}const e=t[0];for(let t=0;t<this.channels;t++)e[t].set(this.backBuffer[t].subarray(128*this.backBufferOffset,128*(this.backBufferOffset+1)),0);this.backBufferOffset++,this.firstRendered||(this.firstRendered=!0,this.ipcPort.notify("firstRendered"))}return!0}}registerProcessor("audio-source-processor",c)},34978:(e,t,i)=>{var r=i(19371),s=i(42524),a=i(77389),o=i(49497),n=i(77969),h=i(87339),d=i(85266),c=i(33740),l=i(31184);let u=n.A.windows||n.A.mac||n.A.linux?10:20;class f extends o.A{constructor(){super(),(0,r.A)(this,"pullIPC",void 0),(0,r.A)(this,"frontBuffer",void 0),(0,r.A)(this,"backBuffer",void 0),(0,r.A)(this,"channels",void 0),(0,r.A)(this,"backBufferOffset",void 0),(0,r.A)(this,"ended",void 0),(0,r.A)(this,"frontBuffered",void 0),(0,r.A)(this,"firstRendered",void 0),(0,r.A)(this,"pause",void 0),(0,r.A)(this,"stopped",void 0),(0,r.A)(this,"afterPullResolve",void 0),(0,r.A)(this,"lastStutterTimestamp",void 0),this.ended=!1,this.pause=!0,this.ipcPort.on(d.S3,(async e=>{switch(e.method){case"init":{const{memory:t,bufferLength:i}=e.params;e.params.bufferLength&&(u=i),await(0,c.Tg)({memory:t,disableAsm:!0}),this.ipcPort.reply(e);break}case"start":{const{port:t,channels:i}=e.params;this.channels=i,this.pullIPC=new d.Ay(t),this.backBufferOffset=0,this.ended=!1,this.pause=!1,this.frontBuffered=!0,this.firstRendered=!1,this.stopped=!1,this.lastStutterTimestamp=currentTime;const r=this.allocBuffer(),s=this.allocBuffer();let a=await this.pullIPC.request("pull",{buffer:s});a<0?(this.ended=!0,this.frontBuffered=!1,this.backBufferOffset):(a=await this.pullIPC.request("pull",{buffer:r}),a<0&&(this.ended=!0,this.frontBuffered=!1)),this.frontBuffer=r,this.backBuffer=s,this.ipcPort.reply(e);break}case"restart":{if(!this.ended)return void this.ipcPort.reply(e);this.backBufferOffset=0,this.ended=!1,this.pause=!1,this.frontBuffered=!0,this.firstRendered=!1,this.stopped=!1,this.lastStutterTimestamp=currentTime;const t=this.backBuffer?this.backBuffer:this.allocBuffer(),i=this.frontBuffer?this.frontBuffer:this.allocBuffer();let r=await this.pullIPC.request("pull",{buffer:i});r<0?(this.ended=!0,this.frontBuffered=!1,this.backBufferOffset=u):(r=await this.pullIPC.request("pull",{buffer:t}),r<0&&(this.ended=!0,this.frontBuffered=!1)),this.frontBuffer=t,this.backBuffer=i,this.ipcPort.reply(e);break}case"stop":this.ended||this.pause||this.frontBuffered||await new Promise((e=>{this.afterPullResolve=e})),this.freeBuffer(this.backBuffer),this.freeBuffer(this.frontBuffer),this.backBuffer=0,this.frontBuffer=0,this.stopped=!0,this.pullIPC.destroy(),this.ipcPort.reply(e);break;case"clear":this.backBufferOffset=u,this.ipcPort.reply(e);break;case"pause":this.pause=!0,this.ipcPort.reply(e);break;case"unpause":this.pause=!1,this.ipcPort.reply(e)}}))}allocBuffer(){const e=(0,l.Gy)(48);a.M[20](e,(0,l.Gy)(4*this.channels)),a.M[15](e+16,this.channels);const t=(0,l.Gy)(512*u*this.channels);for(let i=0;i<this.channels;i++)a.M[20](s.f[20](e)+4*i,t+128*u*4*i);return a.M[15](e+12,128*u),e}freeBuffer(e){e&&((0,l.aI)(s.f[20](e)),(0,l.aI)(e),(0,l.Eb)(e))}async pull(){await this.pullIPC.request("pull",{buffer:this.frontBuffer})<0&&(this.ended=!0),this.afterPullResolve&&this.afterPullResolve()}swapBuffer(){if(!this.frontBuffered)return!1;{const e=this.backBuffer;this.backBuffer=this.frontBuffer,this.frontBuffer=e,this.backBufferOffset=0}return this.frontBuffered=!1,this.pull().then((()=>{this.frontBuffered=!0})),!0}process(e,t,i){if(this.stopped)return!1;if(this.backBuffer&&!this.pause){if(this.backBufferOffset===u){if(this.ended)return this.freeBuffer(this.backBuffer),this.freeBuffer(this.frontBuffer),this.backBuffer=0,this.frontBuffer=0,h.pq("audio source ended","packages/avrender/src/pcm/AudioSourceWorkletProcessor2.ts",282),this.ipcPort.notify("ended"),!0;if(!this.swapBuffer())return currentTime-this.lastStutterTimestamp>1&&(this.ipcPort.notify("stutter"),this.lastStutterTimestamp=currentTime),!0}const e=t[0];for(let t=0;t<this.channels;t++)e[t].set(new Float32Array((0,c.Lv)(),s.f[20](s.f[20](this.backBuffer)+4*t)+128*this.backBufferOffset*4,128),0);this.backBufferOffset++,this.firstRendered||(this.firstRendered=!0,this.ipcPort.notify("firstRendered"))}return!0}}registerProcessor("audio-source-processor",f)},67639:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(19371),s=i(81819),a=i(85266);class o{constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,r.A)(this,"audioWorkletNode",void 0),(0,r.A)(this,"ipcPort",void 0),(0,r.A)(this,"observer",void 0),this.observer=t,this.audioWorkletNode=new AudioWorkletNode(e,i,s),this.ipcPort=new a.Ay(this.audioWorkletNode.port),this.ipcPort.on(a.Wo,(e=>{switch(e.method){case"ended":this.observer.onEnded();break;case"firstRendered":this.observer.onFirstRendered();break;case"stutter":this.observer.onStutter()}}))}async request(e,t,i){return this.ipcPort.request(e,t,i)}connect(e){this.audioWorkletNode.connect(e)}getNode(){return this.audioWorkletNode}disconnect(){this.audioWorkletNode.disconnect()}getParameters(e){const t=this.audioWorkletNode.parameters;if(s.Pc(t.get))return t.get(e);t.forEach(((t,i)=>{if(i===e)return t}))}}},49497:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(85266);class a extends AudioWorkletProcessor{constructor(){super(),(0,r.A)(this,"ipcPort",void 0),this.ipcPort=new s.Ay(this.port)}async request(e,t,i){return this.ipcPort.request(e,t,i)}notify(e,t,i){this.ipcPort.notify(e,t,i)}}},43011:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(546);async function s(e,t){const i=(0,r.A)(t,{varName:"processor"}),s=new Blob([i],{type:"text/javascript"}),a=URL.createObjectURL(s),o=e.audioWorkletModule||{};o[t]=a,e.audioWorkletModule=o,await e.audioWorklet.addModule(a)}},95681:(e,t,i)=>{i.d(t,{Ay:()=>c,Tr:()=>u,de:()=>l});var r=i(19371),s=i(36271),a=i(11846),o=i(3912),n=i(93793),h=i(91278),d=i(1818);class c{constructor(){(0,r.A)(this,"index",h.N_),(0,r.A)(this,"id",h.N_),(0,r.A)(this,"privData",null),(0,r.A)(this,"privateData2",null),(0,r.A)(this,"codecpar",(0,a.A)(new s.A,s.A)),(0,r.A)(this,"sideData",{}),(0,r.A)(this,"nbFrames",BigInt(0)),(0,r.A)(this,"metadata",{}),(0,r.A)(this,"duration",h.Dh),(0,r.A)(this,"startTime",h.Dh),(0,r.A)(this,"firstDTS",h.Dh),(0,r.A)(this,"disposition",0),(0,r.A)(this,"discard",-16),(0,r.A)(this,"timeBase",(0,a.A)(o.Q)),(0,r.A)(this,"sampleIndexes",[]),(0,r.A)(this,"sampleIndexesPosMap",new Map),(0,r.A)(this,"attachedPic",0)}destroy(){this.codecpar&&(this.codecpar.destroy(),(0,n.A)(this.codecpar),this.codecpar=null),this.timeBase&&((0,n.A)(this.timeBase),this.timeBase=null),this.attachedPic&&((0,d.Qe)(this.attachedPic),this.attachedPic=0),this.sampleIndexes.length=0,this.sampleIndexesPosMap.clear()}}class l{constructor(){(0,r.A)(this,"codedWidth",0),(0,r.A)(this,"codedHeight",0),(0,r.A)(this,"offsets",[]),(0,r.A)(this,"background",null),(0,r.A)(this,"horizontalOffset",h.N_),(0,r.A)(this,"verticalOffset",h.N_),(0,r.A)(this,"width",0),(0,r.A)(this,"height",0),(0,r.A)(this,"sideData",{})}}class u{constructor(){(0,r.A)(this,"privData",null),(0,r.A)(this,"index",h.N_),(0,r.A)(this,"id",h.N_),(0,r.A)(this,"type",0),(0,r.A)(this,"params",null),(0,r.A)(this,"metadata",{}),(0,r.A)(this,"streams",[]),(0,r.A)(this,"disposition",0)}destroy(){this.streams.length=0,this.params=null}}},54829:(e,t,i)=>{i.d(t,{Bq:()=>l,En:()=>h,Ij:()=>c,XC:()=>d,f7:()=>u,hY:()=>n,uF:()=>a});var r=i(91278),s=i(5043);const a={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},o={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],h=[r.N_,1,2,3,4,5,6,7];function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:i,sampleRate:s,channels:a}=function(e){let t=r.N_,i=r.N_,s=r.N_;return e.length>=2&&(t=e[0]>>3&31,i=n[(7&e[0])<<1|e[1]>>7],s=h[e[1]>>3&15]),{profile:t,sampleRate:i,channels:s}}(t);e.codecpar.profile=i,e.codecpar.sampleRate=s,e.codecpar.chLayout.nbChannels=a,e.codecpar.frameSize=5===i?2048:1024,e.codecpar.format=8}}function c(e){const t=o[e.sampleRate],i=e.chLayout.nbChannels,s=e.profile===r.N_?2:e.profile,a=new Uint8Array(2);return a[0]=(31&s)<<3|(14&t)>>1,a[1]=(1&t)<<7|(15&i)<<3,a}function l(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const i=1&e[1],r=(192&e[2])>>>6,s=(60&e[2])>>>2,a=(1&e[2])<<2|(192&e[3])>>>6,o=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,d=3&e[6];let c=1===i?7:9,l=o-c;return{syncWord:t,profile:r+1,sampleRate:n[s],channels:h[a],aacFrameLength:o,numberOfRawDataBlocksInFrame:d,headerLength:c,framePayloadLength:l}}function u(e,t){function i(){const e=t.readU(2);let i=0;for(let r=0;r<=e;r++)i<<=8,i|=t.readU(8);return i}t||(t=new s.A).appendBuffer(e);const r=t.getPointer(),a={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},o=t.readU(11);if(695!==o)return-1;a.syncWord=o,a.muxLengthBytes=t.readU(13);const d=1===t.readU1();if(a.useSameStreamMux=d,!d){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&i(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let r=e?i():0;const s=t.readU(5);r-=5;const o=t.readU(4);r-=4;const d=t.readU(4);if(r-=4,t.readU(3),r-=3,r>0&&t.readU(r),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)i();else{let e=0;for(;;){e<<=8;const i=1===t.readU1();if(e+=t.readU(8),!i)break}}1===t.readU1()&&t.readU(8),a.profile=s+1,a.sampleRate=n[o],a.channels=h[d]}let c=0;for(;;){const e=t.readU(8);if(c+=e,255!==e)break}return a.framePayloadLength=c,a.headerLength=t.getPointer()-r+(8===t.getBitLeft()?0:1),a}},44980:(e,t,i)=>{i.d(t,{Ui:()=>o,XC:()=>a,zk:()=>s});var r=i(5043);const s={0:"Main",1:"High",2:"Professional"};function a(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=4){const i=o(t);e.codecpar.profile=i.profile,e.codecpar.level=i.level}}function o(e){const t=new r.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(7);const i=t.readU(3),s=t.readU(5),a=t.readU1();let o=t.readU1()?10:8;return t.readU1()&&(o=12),{profile:i,level:s,tier:a,bitDepth:o,monochrome:t.readU1(),chromaSubsamplingX:t.readU1(),chromaSubsamplingY:t.readU1(),chromaSamplePosition:t.readU(2)}}},61556:(e,t,i)=>{i.d(t,{S1:()=>b,XC:()=>T,kM:()=>x,mW:()=>I,oT:()=>w,sL:()=>k,tZ:()=>v,wf:()=>_});var r=i(42524),s=i(5639),a=i(31184),o=i(76658),n=i(43776),h=i(62705),d=i(41863),c=i(87339),l=i(17630),u=i(54570),f=i(21374),p=i(5043);const m="packages/avutil/src/codecs/h264.ts",g=16,A=3,v={66:"Constrained Baseline",77:"Main",100:"High",110:"High10",122:"High422",244:"High444"};function y(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];e.length>32&&(c.R8(`h264 metadata's sps max length is 32, but get ${e.length}`,m,227),e=e.slice(0,32)),e.length>256&&(c.R8(`h264 metadata's pps max length is 256, but get ${e.length}`,m,231),e=e.slice(0,256));let r=7;r=e.reduce(((e,t)=>e+2+t.length),r),r=t.reduce(((e,t)=>e+2+t.length),r);const s=e[0],a=_(s);66!==a.profile&&77!==a.profile&&88!==a.profile&&(r+=4,i.length&&(r=i.reduce(((e,t)=>e+2+t.length),r)));const o=new Uint8Array(r),n=new f.A(o);return n.writeUint8(1),n.writeUint8(s[1]),n.writeUint8(s[2]),n.writeUint8(s[3]),n.writeUint8(252|A),n.writeUint8(224|31&e.length),l.__(e,(e=>{n.writeUint16(e.length),n.writeBuffer(e)})),n.writeUint8(t.length),l.__(t,(e=>{n.writeUint16(e.length),n.writeBuffer(e)})),66!==a.profile&&77!==a.profile&&88!==a.profile&&(n.writeUint8(252|a.chromaFormatIdc),n.writeUint8(248|a.bitDepthLumaMinus8),n.writeUint8(248|a.bitDepthChromaMinus8),i.length&&l.__(i,(e=>{n.writeUint16(e.length),n.writeBuffer(e)}))),o}function b(e){let t=s.py(e);if(t.length>1){const e=[],i=[],r=[];if(t.forEach((t=>{const s=31&t[0];7===s?e.push(t):8===s?i.push(t):13===s&&r.push(t)})),e.length&&i.length)return y(e,i,r)}}function k(e){let t=s.py(e);if(t.length>1){const e=[],i=[],r=[];if(t.forEach((t=>{const s=31&t[0];7===s?e.push(t):8===s?i.push(t):13===s&&r.push(t)})),e.length&&i.length){const t=[e[0],i[0]];return r.length&&t.push(r[0]),s.nW(t,0)}}}function w(e){let t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=s.py(e),o=!1;if(r.length){const e=[],s=[],a=[];r.forEach((t=>{const i=31&t[0];7===i?e.push(t):8===i?s.push(t):13===i?a.push(t):5===i&&(o=!0)})),e.length&&s.length?(t=y(e,s,a),r=r.filter((e=>{const t=31&e[0];return i?9!==t:9!==t&&8!==t&&7!==t&&13!==t}))):r=r.filter((e=>9!=(31&e[0])))}const n=r.reduce(((e,t)=>e+A+1+t.length),0),h=(0,a.sY)(n),c=(0,d.s3)(h,n);return s.S9(r,A,c),{bufferPointer:h,length:n,key:o,extradata:t}}function x(e,t){let i=s.py(e).concat(s.py(t));if(i.length){const e=[],t=[],r=[],o=[],n=[];return i.forEach((i=>{const s=31&i[0];7===s?e.push(i):8===s?t.push(i):13===s?r.push(i):6===s?o.push(i):9!==s&&n.push(i)})),function(e,t,i,r,o){const n=[s.Le(r,0),s.Le(e,0),s.Le(t,0),s.Le(i,0),s.Le(o,2)];let c=n.reduce(((e,t)=>e+t),0);const l=(0,a.sY)(c+6);let u=l;return h.w8((u+=1,u-1),0),h.w8((u+=1,u-1),0),h.w8((u+=1,u-1),0),h.w8((u+=1,u-1),1),h.w8((u+=1,u-1),9),h.w8((u+=1,u-1),240),r.length&&(s.nW(r,0,(0,d.s3)(u,n[0])),u+=n[0]),e.length&&(s.nW(e,0,(0,d.s3)(u,n[1])),u+=n[1]),t.length&&(s.nW(t,0,(0,d.s3)(u,n[2])),u+=n[2]),i.length&&(s.nW(i,0,(0,d.s3)(u,n[3])),u+=n[3]),o.length&&s.nW(o,2,(0,d.s3)(u,n[4])),{bufferPointer:l,length:c+6}}(e,t,r,o,n)}}function T(e,t){let i;if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&s.Bs(t))l.__(s.py(t),(e=>{if(7==(31&e[0]))return i=e,!1}));else if(t&&t.length>=6){const{spss:e}=function(e){const t=new u.A(e);t.skip(5);const i=[],r=[],s=[],a=31&t.readUint8();for(let e=0;e<a;e++){const e=t.readUint16();i.push(t.readBuffer(e))}const o=t.readUint8();for(let e=0;e<o;e++){const e=t.readUint16();r.push(t.readBuffer(e))}if(t.remainingSize()>4){t.skip(3);const e=t.readUint8();if(e>0)for(let i=0;i<e;i++){const e=t.readUint16();s.push(t.readBuffer(e))}}return{spss:i,ppss:r,spsExts:s}}(t);e.length&&(i=e[0])}if(i){const{profile:t,level:r,width:s,height:a,videoDelay:o,chromaFormatIdc:n,bitDepthLumaMinus8:h}=_(i);switch(e.codecpar.profile=t,e.codecpar.level=r,e.codecpar.width=s,e.codecpar.height=a,e.codecpar.videoDelay=o,h){case 0:e.codecpar.format=3===n?5:2===n?4:0;break;case 1:e.codecpar.format=3===n?66:2===n?70:60;break;case 2:e.codecpar.format=3===n?68:2===n?64:62}}}function I(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(64&r.f[15](e+36))return s.py((0,d.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>{const t=31&e[0];return 5===t||6===t&&6===e[1]}));{const i=r.f[15](e+28);let s=0;for(;s<i-t;){const i=31&n.r8(r.f[20](e+24)+(s+t));if(5===i)return!0;if(6===i&&6===n.r8(r.f[20](e+24)+(s+t)+1))return!0;s+=4===t?n.Sg(r.f[20](e+24)+s):3===t?n.ht(r.f[20](e+24)+s):2===t?n.yd(r.f[20](e+24)+s):n.r8(r.f[20](e+24)+s),s+=t}return!1}}function _(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);const i=s.BN(e.subarray(t)),r=new p.A(i.length);r.appendBuffer(i),r.readU1(),r.readU(2),r.readU(5);const a=r.readU(8);r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU(2);const n=r.readU(8);o.xb(r);let h=1,d=0,c=0;if(100==a||110==a||122==a||244==a||44==a||83==a||86==a||118==a||128==a||138==a||139==a||134==a||135==a){function T(e){let t,i=8,s=8;for(let a=0;a<e;a++)0!==s&&(t=o.$x(r),s=(i+t+256)%256),i=0===s?i:s}if(h=o.xb(r),3===h&&r.readU1(),d=o.xb(r),c=o.xb(r),r.readU1(),r.readU1()){const I=new Array(8);for(let _=0;_<(3!=h?8:12);_++)I[_]=r.readU1(),I[_]&&T(_<6?16:64)}}const l=o.xb(r),u=o.xb(r);let f=0,m=0;if(0===u)f=o.xb(r);else if(1===u){m=r.readU1(),o.$x(r),o.$x(r);const P=o.xb(r);for(let M=0;M<P;M++)o.$x(r)}o.xb(r),r.readU1();const A=o.xb(r),v=o.xb(r),y=r.readU1();let b=16*(A+1),k=(2-y)*(v+1)*16;y||r.readU1(),r.readU1();const w=r.readU1();if(w){let S=1,C=2-w;1===h?(S=2,C=2*(2-w)):2===w&&(S=2,C=2-w),b-=S*(o.xb(r)+o.xb(r)),k-=C*(o.xb(r)+o.xb(r))}let x=0;if(r.readU1()){let R=r.readU1();function B(){const e=o.xb(r)+1;r.readU(4),r.readU(4);for(let t=0;t<e;t++)o.xb(r),o.xb(r),r.readU1();r.readU(5),r.readU(5),r.readU(5),r.readU(5)}R&&r.readU(8)>=17&&(r.readU(16),r.readU(16)),R=r.readU1(),R&&r.readU1(),R=r.readU1(),R&&(r.readU(3),r.readU1(),R=r.readU1(),R&&(r.readU(8),r.readU(8),r.readU(8))),R=r.readU1(),R&&(o.xb(r),o.xb(r)),R=r.readU1(),R&&(r.readU(32),r.readU(32),r.readU1());let D=r.readU1();D&&B();let E=r.readU1();E&&B(),(D||E)&&r.readU1(),r.readU1(),R=r.readU1(),R&&(r.readU1(),o.xb(r),o.xb(r),o.xb(r),o.xb(r),x=Math.min(o.xb(r),g))}return{profile:a,level:n,width:b,height:k,chromaFormatIdc:h,bitDepthLumaMinus8:d,bitDepthChromaMinus8:c,frameMbsOnlyFlag:y,picOrderCntType:u,log2MaxPicOrderCntLsbMinus4:f,deltaPicOrderAlwaysZeroFlag:m,log2MaxFrameNumMinus4:l,videoDelay:x}}},73872:(e,t,i)=>{i.d(t,{S1:()=>v,XC:()=>w,ZU:()=>I,dT:()=>m,kM:()=>k,mW:()=>x,oT:()=>b,sL:()=>y,wf:()=>T});var r=i(42524),s=i(5639),a=i(31184),o=i(76658),n=i(43776),h=i(62705),d=i(41863),c=i(17630),l=i(54570),u=i(21374),f=i(5043);const p=16,m={1:"Main",2:"Main10",3:"MainStillPicture",4:"Main444"},g=3;function A(e,t,i){const r=t[0];let s=23;e.length&&(s+=3,s=e.reduce(((e,t)=>e+2+t.length),s)),t.length&&(s+=3,s=t.reduce(((e,t)=>e+2+t.length),s)),i.length&&(s+=3,s=i.reduce(((e,t)=>e+2+t.length),s));const a=new Uint8Array(s),o=new u.A(a,!0),n=T(r);o.writeUint8(1),o.writeUint8(r[1]),o.writeUint8(r[2]),o.writeUint8(r[3]),o.writeUint8(r[4]),o.writeUint8(r[5]),o.writeUint8(r[6]),o.writeUint8(r[7]),o.writeUint8(r[8]),o.writeUint8(r[9]),o.writeUint8(r[10]),o.writeUint8(r[11]),o.writeUint8(n.level),o.writeUint8(1020),o.writeUint8(0),o.writeUint8(16320),o.writeUint8(16320|n.chroma_format_idc),o.writeUint8(8160|n.bit_depth_luma_minus8),o.writeUint8(8160|n.bit_depth_chroma_minus8),o.writeUint16(0),o.writeUint8(8|(1&r[0])<<2|g);let h=0;return e.length&&h++,t.length&&h++,i.length&&h++,o.writeUint8(h),e.length&&(o.writeUint8(160),o.writeUint16(e.length),c.__(e,(e=>{o.writeUint16(e.length),o.writeBuffer(e)}))),t.length&&(o.writeUint8(161),o.writeUint16(t.length),c.__(t,(e=>{o.writeUint16(e.length),o.writeBuffer(e)}))),i.length&&(o.writeUint8(162),o.writeUint16(i.length),c.__(i,(e=>{o.writeUint16(e.length),o.writeBuffer(e)}))),a}function v(e){let t=s.py(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const s=t[0]>>>1&63;32===s?e.push(t):33===s?i.push(t):34===s&&r.push(t)})),i.length&&r.length)return A(e,i,r)}}function y(e){let t=s.py(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const s=t[0]>>>1&63;32===s?e.push(t):33===s?i.push(t):34===s&&r.push(t)})),i.length&&r.length){const t=[i[0],r[0]];return e.length&&t.unshift(e[0]),s.nW(t,0)}}}function b(e){let t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!1,o=s.py(e);if(o.length){const e=[],s=[],a=[];o.forEach((t=>{const i=t[0]>>>1&63;32===i?e.push(t):33===i?s.push(t):34===i&&a.push(t),19!==i&&20!==i&&21!==i||(r=!0)})),s.length&&a.length?(t=A(e,s,a),o=o.filter((e=>{const t=e[0]>>>1&63;return(i||32!==t&&33!==t&&34!==t)&&35!==t}))):o=o.filter((e=>35!=(e[0]>>>1&63)))}const n=o.reduce(((e,t)=>e+g+1+t.length),0),h=(0,a.sY)(n),c=(0,d.s3)(h,n);return s.S9(o,g,c),{bufferPointer:h,length:n,extradata:t,key:r}}function k(e,t){let i=s.py(e).concat(s.py(t));if(i.length){let e=[],t=[],r=[],o=[];return i.forEach((i=>{const s=i[0]>>>1&63;32===s?e.push(i):33===s?t.push(i):34===s?r.push(i):35!==s&&o.push(i)})),function(e,t,i,r){const o=[s.Le(e,0),s.Le(t,0),s.Le(i,0),s.Le(r,2)];let n=o.reduce(((e,t)=>e+t),0);const c=(0,a.sY)(n+7);let l=c;return h.w8((l+=1,l-1),0),h.w8((l+=1,l-1),0),h.w8((l+=1,l-1),0),h.w8((l+=1,l-1),1),h.w8((l+=1,l-1),70),h.w8((l+=1,l-1),1),h.w8((l+=1,l-1),80),e.length&&(s.nW(e,0,(0,d.s3)(l,o[0])),l+=o[0]),t.length&&(s.nW(t,0,(0,d.s3)(l,o[1])),l+=o[1]),i.length&&(s.nW(i,0,(0,d.s3)(l,o[2])),l+=o[2]),r.length&&s.nW(r,2,(0,d.s3)(l,o[3])),{bufferPointer:c,length:n+7}}(e,t,r,o)}}function w(e,t){let i;if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&s.Bs(t))c.__(s.py(t),(e=>{if(33==(e[0]>>>1&63))return i=e,!1}));else if(t&&t.length>=6){const{spss:e}=function(e){const t=new l.A(e,!0);t.skip(22);let i=[],r=[],s=[];const a=t.readUint8();for(let e=0;e<a;e++){const e=63&t.readUint8(),a=t.readUint16(),o=[];for(let e=0;e<a;e++){const e=t.readUint16();o.push(t.readBuffer(e))}32===e?i=o:33===e?r=o:34===e&&(s=o)}return{vpss:i,spss:r,ppss:s}}(t);e.length&&(i=e[0])}if(i){const{profile:t,level:r,width:s,height:a,video_delay:o,chroma_format_idc:n,bit_depth_luma_minus8:h}=T(i);switch(e.codecpar.profile=t,e.codecpar.level=r,e.codecpar.width=s,e.codecpar.height=a,e.codecpar.videoDelay=o,h){case 0:e.codecpar.format=3===n?5:2===n?4:0;break;case 2:e.codecpar.format=3===n?68:2===n?64:62}}}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(64&r.f[15](e+36))return s.py((0,d.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>{const t=e[0]>>>1&63;return 20===t||19===t||21===t}));{const i=r.f[15](e+28);let s=0;for(;s<i-t;){const i=n.r8(r.f[20](e+24)+(s+t))>>>1&63;if(20===i||19===i||21===i)return!0;s+=4===t?n.Sg(r.f[20](e+24)+s):3===t?n.ht(r.f[20](e+24)+s):2===t?n.yd(r.f[20](e+24)+s):n.r8(r.f[20](e+24)+s),s+=t}return!1}}function T(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,r=0,a=0,n=0,h=0,d=0,c=1,l=0,u=0,m=0,g=0;const A=s.BN(e.subarray(t)),v=new f.A(A.length);v.appendBuffer(A),v.readU1(),v.readU(6),v.readU(6),v.readU(3),v.readU(4);const y=v.readU(3);v.readU1();let b=0;if(y<=6){l=v.readU(2),u=v.readU1(),i=v.readU(5),m=v.readU(32),g=v.readU(48),r=v.readU(8);const e=new Array(6),t=new Array(6);for(let i=0;i<y;i++)e[i]=v.readU1(),t[i]=v.readU1();if(y>0)for(let e=y;e<8;e++)v.readU(2);for(let i=0;i<y;i++)e[i]&&(v.readU(2),v.readU(1),v.readU(5),v.readU(32),v.readU(1),v.readU(1),v.readU(1),v.readU(1),v.readU(44)),t[i]&&v.readU(8);o.xb(v),c=o.xb(v),3===c&&(b=v.readU(1)),a=o.xb(v),n=o.xb(v);let s=0,f=0,p=0,A=0;v.readU1()&&(s=o.xb(v),f=o.xb(v),p=o.xb(v),A=o.xb(v)),h=o.xb(v),d=o.xb(v);let k=2,w=2;0===c?k=w=0:2===c?(k=2,w=1):3===c&&(k=w=1),a-=k*(1<<h+1)*(s+f),n-=w*(1<<h+1)*(p+A)}const k=o.xb(v)+4;let w=0;for(let e=v.readU1()?0:y;e<y+1;e++)o.xb(v),w=Math.max(w,Math.min(o.xb(v),p)),o.xb(v);const x=o.xb(v)+3,T=o.xb(v),I=o.xb(v)+2,_=o.xb(v),P=x+T,M=x-1,S=a+(1<<P)-1>>P,C=n+(1<<P)-1>>P;return{profile:i,level:r,width:a,height:n,chroma_format_idc:c,bit_depth_luma_minus8:h,bit_depth_chroma_minus8:d,general_profile_space:l,general_tier_flag:u,general_profile_compatibility_flags:m,constraint_flags:g,separate_colour_plane_flag:b,log2_min_cb_size:x,log2_diff_max_min_coding_block_size:T,log2_min_tb_size:I,log2_diff_max_min_transform_block_size:_,log2_max_trafo_size:_+I,log2_ctb_size:P,log2_min_pu_size:M,ctb_width:S,ctb_height:C,ctb_size:S*C,min_cb_width:a>>x,min_cb_height:n>>x,min_tb_width:a>>I,min_tb_height:n>>I,min_pu_width:a>>M,min_pu_height:n>>M,log2_max_poc_lsb:k,video_delay:w}}function I(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);const i=s.BN(e.subarray(t)),r=new f.A(i.length);return r.appendBuffer(i),{pps_pic_parameter_set_id:o.xb(r),pps_seq_parameter_set_id:o.xb(r),dependent_slice_segment_flag:r.readU1(),output_flag_present_flag:r.readU1(),num_extra_slice_header_bits:r.readU(3)}}},69048:(e,t,i)=>{i.d(t,{Au:()=>v,He:()=>y,XC:()=>b,Y2:()=>m,hG:()=>g,oz:()=>A});var r=i(91278);const s=[44100,48e3,32e3,0],a=[22050,24e3,16e3,0],o=[11025,12e3,8e3,0],n=[0,1152,1152,384],h=[0,576,1152,384],d=[0,576,1152,384],c=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],l=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],u=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],f=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],p=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function m(e,t){switch(e){case 0:return o[t];case 2:return a[t];case 3:return s[t]}return r.N_}function g(e,t){switch(e){case 0:return d[t];case 2:return h[t];case 3:return n[t]}return r.N_}function A(e,t,i){switch(t){case 1:switch(e){case 0:case 2:return p[i];case 3:return u[i]}break;case 2:switch(e){case 0:case 2:return p[i];case 3:return l[i]}case 3:switch(e){case 0:case 2:return f[i];case 3:return c[i]}}return r.N_}function v(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return r.N_}const y={32:"Layer1",33:"Layer2",34:"Layer3"};function b(e,t){if(t&&t.length>=4){const i=t[1]>>>3&3,r=(6&t[1])>>1,s=(12&t[2])>>>2,a=3&~(t[3]>>>6)?2:1,o=v(r),n=m(i,s);e.codecpar.profile=o,e.codecpar.sampleRate=n,e.codecpar.chLayout.nbChannels=a}}},35536:(e,t,i)=>{i.d(t,{Ui:()=>a,XC:()=>s});var r=i(5043);function s(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const i=a(t);e.codecpar.profile=i.profile,e.codecpar.level=i.level}}function a(e){const t=new r.A(e.length);return t.appendBuffer(e.subarray(4)),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},93535:(e,t,i)=>{i.d(t,{Ui:()=>o,XC:()=>a,wN:()=>s});var r=i(5043);const s={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"};function a(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const i=o(t);e.codecpar.profile=i.profile,e.codecpar.level=i.level}}function o(e){const t=new r.A(e.length);return t.appendBuffer(e),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},17635:(e,t,i)=>{i.d(t,{S1:()=>v,Ui:()=>I,XC:()=>w,kM:()=>k,mW:()=>x,oT:()=>b,sL:()=>y,wf:()=>T});var r=i(42524),s=i(5639),a=i(31184),o=i(76658),n=i(43776),h=i(62705),d=i(41863),c=i(17630),l=i(54570),u=i(5043),f=i(56772),p=i(21374);const m=3;function g(e){const t=e.readU(9),i=e.readU(3),r=e.readU(2),s=e.readU(2),a=e.readU(3);e.readU(5),e.readU(2);const o=e.readU(6),n=e.readU(7),h=e.readU(1),d=e.readU(8),c=e.readU(1),l=e.readU(1),u=[],f=[];if(o){for(let t=0;t<o-1;t++)u[t]=e.readU(8);u[o-1]=e.readU(6)}else e.readU(6);if(i>1){let t=0;for(let r=i-2;r>=0;--r)t|=e.readU(1)<<r;for(let t=i;t<=8&&i>1;++t)e.readU(1);for(let r=i-2;r>=0;--r)t&1<<r&&(f[r]=e.readU(8))}const p=e.readU(8),m=[];if(p)for(let t=0;t<p;t++)m.push(e.readU(8));return{olsIdx:t,numSublayers:i,bitDepthMinus8:a,chromaFormatIdc:s,constantFrameRate:r,generalProfileIdc:n,generalTierFlag:h,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:c,ptlMultilayerEnabledFlag:l,generalConstraintInfo:u,sublayerLevelIdc:f,generalSubProfileIdc:m,maxPictureWidth:e.readU(16),maxPictureHeight:e.readU(16),avgFramerate:e.readU(16)}}function A(e,t,i){const r=t[0];let s;if(r){const e=T(r);let t=e.generalConstraintInfo;t.length||(t=new Array(12).fill(0));const i=new f.A;if(i.writeU(9,0),i.writeU(3,e.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,e.chromaFormatIdc),i.writeU(3,e.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,t.length),i.writeU(7,e.profile),i.writeU1(e.tierFlag),i.writeU(8,e.level),i.writeU1(e.ptlFrameOnlyConstraintFlag),i.writeU1(e.ptlMultilayerEnabledFlag),t.length){for(let e=0;e<t.length-1;e++)i.writeU(8,t[e]);i.writeU(6,t[t.length-1])}else i.writeU(6,63);if(e.spsMaxSublayersMinus1+1>1){let t=0;for(let i=e.spsMaxSublayersMinus1-1;i>=0;i--)t=t<<1|e.ptlSublayerLevelPresentFlag[i];i.writeU(e.spsMaxSublayersMinus1,t);for(let t=e.spsMaxSublayersMinus1+1;t<=8&&e.spsMaxSublayersMinus1>0;++t)i.writeU1(0);for(let t=e.spsMaxSublayersMinus1-1;t>=0;t--)e.ptlSublayerLevelPresentFlag[t]&&i.writeU(8,e.sublayerLevelIdc[t])}i.writeU(8,e.generalSubProfileIdc.length);for(let t=0;t<e.generalSubProfileIdc.length;t++)i.writeU(8,e.sublayerLevelIdc[t]);i.writeU(16,e.width),i.writeU(16,e.height),i.writeU(16,0),i.padding(),s=i.getBuffer().subarray(0,i.getPointer())}let a=2+(s?s.length:0);e.length&&(a+=3,a=e.reduce(((e,t)=>e+2+t.length),a)),t.length&&(a+=3,a=t.reduce(((e,t)=>e+2+t.length),a)),i.length&&(a+=3,a=i.reduce(((e,t)=>e+2+t.length),a));const o=new Uint8Array(a),n=new p.A(o,!0);n.writeUint8(m<<1|(s?1:0)|248),s&&n.writeBuffer(s);let h=0;return e.length&&h++,t.length&&h++,i.length&&h++,n.writeUint8(h),e.length&&(n.writeUint8(142),n.writeUint16(e.length),c.__(e,(e=>{n.writeUint16(e.length),n.writeBuffer(e)}))),t.length&&(n.writeUint8(143),n.writeUint16(t.length),c.__(t,(e=>{n.writeUint16(e.length),n.writeBuffer(e)}))),i.length&&(n.writeUint8(144),n.writeUint16(i.length),c.__(i,(e=>{n.writeUint16(e.length),n.writeBuffer(e)}))),o}function v(e){let t=s.py(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const s=t[1]>>>3&31;14===s?e.push(t):15===s?i.push(t):16===s&&r.push(t)})),i.length&&r.length)return A(e,i,r)}}function y(e){let t=s.py(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const s=t[1]>>>3&31;14===s?e.push(t):15===s?i.push(t):16===s&&r.push(t)})),i.length&&r.length){const t=[i[0],r[0]];return e.length&&t.unshift(e[0]),s.nW(t,0)}}}function b(e){let t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!1,o=s.py(e);if(o.length){const e=[],s=[],a=[];o.forEach((t=>{const i=t[1]>>>3&31;14===i?e.push(t):15===i?s.push(t):16===i&&a.push(t),8!==i&&7!==i&&9!==i&&10!==i||(r=!0)})),s.length&&a.length?(t=A(e,s,a),o=o.filter((e=>{const t=e[1]>>>3&31;return(i||14!==t&&15!==t&&16!==t)&&20!==t}))):o=o.filter((e=>20!=(e[1]>>>3&31)))}const n=o.reduce(((e,t)=>e+m+1+t.length),0),h=(0,a.sY)(n),c=(0,d.s3)(h,n);return s.S9(o,m,c),{bufferPointer:h,length:n,extradata:t,key:r}}function k(e,t){let i=s.py(e).concat(s.py(t));if(i.length){let e=[],t=[],r=[],o=[];return i.forEach((i=>{const s=i[1]>>>3&31;14===s?e.push(i):15===s?t.push(i):16===s?r.push(i):20!==s&&o.push(i)})),function(e,t,i,r,o){const n=[s.Le(e,0),s.Le(t,0),s.Le(i,0),s.Le(r,2)];let c=n.reduce(((e,t)=>e+t),0);const l=(0,a.sY)(c+7);let u=l;return h.w8((u+=1,u-1),0),h.w8((u+=1,u-1),0),h.w8((u+=1,u-1),0),h.w8((u+=1,u-1),1),h.w8((u+=1,u-1),0),h.w8((u+=1,u-1),161),h.w8((u+=1,u-1),(o?1:0)<<7|40),e.length&&(s.nW(e,0,(0,d.s3)(u,n[0])),u+=n[0]),t.length&&(s.nW(t,0,(0,d.s3)(u,n[1])),u+=n[1]),i.length&&(s.nW(i,0,(0,d.s3)(u,n[2])),u+=n[2]),r.length&&s.nW(r,2,(0,d.s3)(u,n[3])),{bufferPointer:l,length:c+7}}(e,t,r,o,!0)}}function w(e,t){let i;if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&s.Bs(t))c.__(s.py(t),(e=>{if(15==(e[1]>>>3&31))return i=e,!1}));else if(t&&t.length>=6){const{spss:e}=function(e){const t=new l.A(e,!0);if(1&t.readUint8()){const i=new u.A;i.appendBuffer(e.subarray(1)),g(i),t.skip(i.getPointer())}let i=[],r=[],s=[];const a=t.readUint8();for(let e=0;e<a;e++){const e=31&t.readUint8();let a=1;13!==e&&12!==e&&(a=t.readUint16());const o=[];for(let e=0;e<a;e++){const e=t.readUint16();o.push(t.readBuffer(e))}14===e?i=o:15===e?r=o:16===e&&(s=o)}return{vpss:i,spss:r,ppss:s}}(t);e.length&&(i=e[0])}i&&function(e,t){const{profile:i,level:r,width:s,height:a,videoDelay:o,chromaFormatIdc:n,bitDepthMinus8:h}=T(t);switch(e.codecpar.profile=i,e.codecpar.level=r,e.codecpar.width=s,e.codecpar.height=a,e.codecpar.videoDelay=o,h){case 0:e.codecpar.format=3===n?5:2===n?4:0;break;case 2:e.codecpar.format=3===n?68:2===n?64:62}}(e,i)}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(64&r.f[15](e+36))return s.py((0,d.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>{const t=e[1]>>>3&31;return 8===t||7===t||9===t}));{const i=r.f[15](e+28);let s=0;for(;s<i-t;){const i=n.r8(r.f[20](e+24)+(s+t+1))>>>3&31;if(8===i||7===i||9===i)return!0;s+=4===t?n.Sg(r.f[20](e+24)+s):3===t?n.ht(r.f[20](e+24)+s):2===t?n.yd(r.f[20](e+24)+s):n.r8(r.f[20](e+24)+s),s+=t}return!1}}function T(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,r=0,a=0,n=0,h=0,d=1,c=0,l=0,f=0;const p=[],m=[],g=[],A=[],v=s.BN(e.subarray(t)),y=new u.A(v.length);y.appendBuffer(v),y.readU1(),y.readU1(),y.readU(6),y.readU(5),y.readU(3),y.readU(8);const b=y.readU(3);d=y.readU(2);const k=y.readU(2);if(y.readU(1)){if(i=y.readU(7),c=y.readU(1),r=y.readU(8),l=y.readU(1),f=y.readU(1),y.readU(1)){for(let e=0;e<8;e++)p[e]=y.readU(8);p[8]=y.readU(7);const e=y.readU(8);y.readU(e)}y.skipPadding();for(let e=b-1;e>=0;e--)m[e]=y.readU(1);y.skipPadding();for(let e=b-1;e>=0;e--)m[e]&&(g[e]=y.readU(8));const e=y.readU(8);if(e)for(let t=0;t<e;t++)A[t]=y.readU(32)}y.readU1(),y.readU1()&&y.readU1();const w=a=o.xb(y),x=n=o.xb(y);if(y.readU1()&&(o.xb(y),o.xb(y),o.xb(y),o.xb(y)),y.readU1()){const e=o.xb(y),t=k+5,i=1<<t,r=w/(1<<t),s=x/(1<<t),a=Math.ceil(Math.log2(r)),n=Math.ceil(Math.log2(s));let h=0,d=0,c=0;e>0&&(c=y.readU1(),d=y.readU1());for(let t=0;e>0&&t<=e;t++)d&&0!=t||(t>0&&w>i&&y.readU(a),t>0&&x>i&&y.readU(n),t<e&&w>i&&y.readU(a),t<e&&x>i&&y.readU(n)),c||y.readU(2);if(h=o.xb(y)+1,y.readU(1)&&y.readU(1))for(let t=0;t<=e;t++)y.readU(h)}h=o.xb(y),y.readU(1),y.readU(1);const T=y.readU(4),I=y.readU(1);let _=0;I&&(_=o.xb(y));const P=[],M=y.readU(2);for(let e=0;e<8*M;e++)P[e]=y.readU(1);return{profile:i,level:r,width:a,height:n,videoDelay:b+1>2?2:b,chromaFormatIdc:d,bitDepthMinus8:h,generalProfileSpace:0,tierFlag:c,generalConstraintInfo:p,generalSubProfileIdc:A,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:b,ptlSublayerLevelPresentFlag:m,sublayerLevelIdc:g,sps_log2_max_pic_order_cnt_lsb_minus4:T,sps_poc_msb_cycle_flag:I,sps_poc_msb_cycle_len_minus1:_,sps_num_extra_ph_bytes:M,sps_extra_ph_bit_present_flag:P}}function I(e){s.Bs(e)&&(e=v(e));const t=new u.A;return t.appendBuffer(e),1&t.readU(8)?g(t):{}}},91278:(e,t,i)=>{i.d(t,{Dh:()=>s,FQ:()=>l,H3:()=>h,KR:()=>d,N_:()=>a,SF:()=>o,f7:()=>m,go:()=>u,i0:()=>c,pu:()=>g,qs:()=>n,vh:()=>f,zg:()=>p});var r=i(3912);const s=-BigInt(1),a=-1,o=1e6,n=1e3,h=1e9,d=new r.Q({den:o,num:1}),c=new r.Q({den:n,num:1}),l=new r.Q({den:h,num:1}),u=(new r.Q({den:1,num:1}),2147483647),f=BigInt(0x8000000000000000),p=65535,m=4294967295,g=(BigInt(0x10000000000000000),8)},47378:(e,t,i)=>{i.d(t,{E$:()=>r,LR:()=>s,LT:()=>d,NU:()=>l,OY:()=>h,UY:()=>a,gR:()=>o,lh:()=>n,nr:()=>u,r8:()=>c});const r=-1,s=-2,a=-3,o=-4,n=-5,h=-6,d=-7,c=-8,l=-9,u=-10},93393:(e,t,i)=>{async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=await e.peekString(8);if(/^FLV/.test(i))return 0;if(/^DKIF/.test(i))return 5;if(/^ftyp/.test(i.slice(4,8)))return 1;if(/^OggS/.test(i))return 4;if(/^ID3/.test(i))return 14;if(/^fLaC/.test(i))return 17;if(/^RIFF/.test(i)){const t=(await e.peekString(12)).slice(8);if(/^WAVE/.test(t))return 16;if(/^AVI/.test(t))return 10}else{if(/^ADIF/.test(i))return 15;if(440786851===await e.peekUint32())return 8;if(/^WEBVTT/.test(i))return 18;if(/^LIMA/.test(i))return await e.skip(4),await e.readUint16();{const t=await e.peekBuffer(2);switch(t[0]){case 86:if(!(224&~t[1]))return 15;break;case 255:if(240==(246&t[1]))return 15;if([242,244,246,250,252].includes(254&t[1]))return 14}}}return t}i.d(t,{A:()=>r})},43523:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(91390),s=i(25092),a=i(33134),o=i(4068),n=i(97494),h=i(17630);const d=["php","asp","aspx","jsp","do","pl"];async function c(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l="",u={url:e};if(/^rtsp/.test(e)||/^rtmp/.test(e)){/^rtsp/.test(e)?l="rtsp":/^rtmp/.test(e)&&(l="rtmp"),t=2;const i=n.qg(e).protocol.split("+")[1]||"wss";"wss"===i||"ws"===i?t=2:"webtransport"===i&&(t=3),u.url=u.url.replace(/^\S+:\/\//,i+"://"),"rtmp"===l&&(u.subProtocol=t,t=6)}else{var f;const u=n.qg(e).protocol;l=i||n.qg(e).file.split(".").pop(),l&&!h.zy(d,l)||!/^https?/.test(u)||(l=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};let r;t.headers&&s.__(t.headers,((e,t)=>{i.headers[t]=e})),t.credentials&&(i.credentials=t.credentials),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"function"==typeof AbortController&&(r=new AbortController,i.signal=r.signal);const n=await fetch(e,i);if(n.ok&&n.status>=200&&n.status<=299){const e=n.body.getReader(),t=[];let i=0;for(;;){let r=await e.read();if(r.done)break;if(i+=r.value.length,t.push(r.value),i>=100)break}if(r&&r.abort(),t.length){const e=t.length>1?(0,a.A)(Uint8Array,t):t[0];if(e.length){const t=o.decode(e.subarray(0,100));if(/<\?xml/.test(t)){if(t.indexOf("<MPD")>-1)return"mpd"}else if(/#EXTM3U/.test(t))return"m3u8"}}}return""}(e,c));let p=0;"wss"===u||"ws"===u?p=2:"webtransport"===u&&(p=3),t=null!==(f=r.$$[l])&&void 0!==f?f:p}return{type:t,ext:l,info:u}}},58081:(e,t,i)=>{i.d(t,{t:()=>d});var r=i(42524),s=i(77389),a=i(42365),o=i(74883),n=i(91278),h=i(41863);function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0===t&&(t=(0,a.FP)()),s.M[15](t+152,e.sampleRate),s.M[15](t+76,e.numberOfFrames),s.M[15](t+292,e.numberOfChannels),s.M[15](t+80,function(e){switch(e){case"u8":return 0;case"s16":return 1;case"s32":return 2;case"f32":return 3;case"u8-planar":return 5;case"s16-planar":return 6;case"s32-planar":return 7;case"f32-planar":return 8;default:throw new Error("not support")}}(e.format)),s.M[17](t+104,e.timestamp<0?n.Dh:BigInt(Math.floor(e.timestamp))),s.M[17](t+312,BigInt(Math.floor(e.duration))),s.M[15](t+124,n.SF),s.M[15](t+120,1),(0,a.rh)(t);const i=(0,o.K0)(r.f[15](t+80))?r.f[15](t+292):1;for(let s=0;s<i;s++)e.copyTo((0,h.s3)(r.f[20](r.f[20](t+64)+4*s),r.f[15](t+32)),{planeIndex:s});return t}},48511:(e,t,i)=>{i.d(t,{pt:()=>m});var r=i(42524),s=i(41402),a=i(30027),o=i(91278),n=i(33740),h=i(25092),d=i(53175);const c=h.BE(d.GR),l=h.BE(d.OG),u=h.BE(d.SY),f=h.BE(d.re);function p(e){var t,i,s;const a={fullRange:!1,matrix:null!==(t=u[r.f[15](e+220)])&&void 0!==t?t:null,primaries:null!==(i=l[r.f[15](e+212)])&&void 0!==i?i:null,transfer:null!==(s=f[r.f[15](e+216)])&&void 0!==s?s:null};return 2===r.f[15](e+208)&&(a.fullRange=!0),a}function m(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=r.f[15](e+72);const l=(0,s.I)(r.f[15](e+80)),u=[];for(let t=0;t<l.comp.length;t++)u.push({offset:r.f[20](e+4*t),stride:r.f[15](e+32+4*t)});const f=h.X$({codedWidth:r.f[15](e+68),codedHeight:d,timestamp:Number(t||(0,a.Mr)(r.f[17](e+104),e+120,o.KR)),format:(m=r.f[15](e+80),null!==(g=c[m])&&void 0!==g?g:null),duration:Number((0,a.Mr)(r.f[17](e+312),e+120,o.KR)),layout:u,colorSpace:p(e),visibleRect:{x:r.f[25](e+276),y:r.f[25](e+268),width:r.f[15](e+68)-(r.f[25](e+276)+r.f[25](e+280)),height:r.f[15](e+72)-(r.f[25](e+268)+r.f[25](e+272))}},i);var m,g;return new VideoFrame((0,n.Lv)(),f)}},15541:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(42524),s=i(30027),a=i(41863),o=i(91278);function n(e){const t=1&r.f[15](e+36);return new EncodedAudioChunk({type:t?"key":"delta",duration:r.f[17](e+48)<0?void 0:Number((0,s.Mr)(r.f[17](e+48),e+72,o.KR)),timestamp:r.f[17](e+8)===o.Dh?o.N_:Number((0,s.Mr)(r.f[17](e+8),e+72,o.KR)),data:(0,a.s3)(r.f[20](e+24),r.f[15](e+28))})}},34082:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(42524),s=i(30027),a=i(41863),o=i(91278);function n(e){const t=1&r.f[15](e+36);return new EncodedVideoChunk({type:t?"key":"delta",duration:r.f[17](e+48)<0?void 0:Number((0,s.Mr)(r.f[17](e+48),e+72,o.KR)),timestamp:r.f[17](e+8)===o.Dh?o.N_:Number((0,s.Mr)(r.f[17](e+8),e+72,o.KR)),data:(0,a.s3)(r.f[20](e+24),r.f[15](e+28))})}},83496:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(81819),s=i(15860),a=i(75176);async function o(e){let t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r.Yj(e)||r.sv(e)?(t=await(0,s.A)({source:e}),a.USE_THREADS&&i&&(t.threadModule=await(0,s.A)({source:t.buffer},{child:!0})),delete t.buffer):t=e,t}},53175:(e,t,i)=>{i.d(t,{GR:()=>r,OG:()=>a,SY:()=>s,re:()=>o});const r={BGRA:28,BGRX:121,I420:0,I420P10:62,I420P12:123,I420A:33,I420AP10:87,I420AP12:229,I422:4,I422P10:64,I422P12:127,I422A:78,I422AP10:89,I422AP12:185,I444:5,I444P10:68,I444P12:131,I444A:79,I444AP10:91,I444AP12:187,NV12:23,RGBA:26,RGBX:119},s={bt709:1,smpte170m:6,bt470bg:5,"bt2020-ncl":9,rgb:0},a={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},o={bt709:1,"iec61966-2-1":13,smpte170m:6,linear:8,pq:16,hlg:18}},92957:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(42524),s=i(91390);function a(e){const t=r.f[15](e+4);let i=r.f[15](e+48),a=s.os[t];return 86018===t&&(a=`${a}.${i}`),a||"unknown"}},28579:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(42524),s=i(71195),a=i(92957);function o(e){let t="";return t=86017!==r.f[15](e+4)||s.A.firefox?`audio/mp4; codecs="${(0,a.A)(e)}"`:"audio/mpeg",t}},90332:(e,t,i)=>{i.d(t,{C:()=>s});var r=i(71195);function s(e){return e?!r.A.chrome||r.A.checkVersion(r.A.majorVersion,"94",!0)?"prefer-hardware":"allow":!r.A.chrome||r.A.checkVersion(r.A.majorVersion,"94",!0)?"prefer-software":"deny"}},20770:(e,t,i)=>{i.d(t,{A:()=>m});var r=i(42524),s=i(91390),a=i(44980),o=i(35536),n=i(93535),h=i(17635),d=i(73872),c=i(91278),l=i(41863),u=i(67094),f=i(1279),p=i(5639);function m(e,t){const i=r.f[15](e+4);let m=r.f[15](e+48),g=r.f[15](e+52);!t&&0!==r.f[20](e+12)&&r.f[15](e+16)&&(t=(0,l.s3)(r.f[20](e+12),r.f[15](e+16)));let A=s.os[i],v="";if(27===i)110===m&&(m=100),v=u.GP("%s.%02x00%02x",A,255&m,255&g);else if(173===i){let e=0,i=0,r=0,s=0;t&&(p.Bs(t)&&(t=d.S1(t)),t.length>13&&(e=t[1]>>>6&3,r=t[1]>>>5&1,i=t[2]|t[3]<<8|t[4]<<16|t[5]<<24,s=240&t[6]));const a={0:"",1:"A",2:"B",3:"C"};v=u.GP("%s.%s%d.%x.%s%d.%x",A,a[e],m,i,0===r?"L":"H",g,s)}else if(196===i){var y;let e=0;if((null===(y=t)||void 0===y?void 0:y.length)>13&&(e=1&t[5]),v=u.GP("%s.%d.%s%d",A,m,0===e?"L":"H",g),t){p.Bs(t)&&(t=h.S1(t));const e=h.Ui(t);if(e.generalConstraintInfo.length){let t=e.generalConstraintInfo.length-1;for(;t>0&&0===e.generalConstraintInfo[t];)t--;const i=e.generalConstraintInfo.slice(0,t+1);i.length&&(v+=`.C${f.l(new Uint8Array(i),!1)}`)}e.generalSubProfileIdc.length&&(v+=`.S${e.generalSubProfileIdc.map((e=>e.toString(16))).join("+")}`),v+=`.O${e.olsIdx}+${e.numSublayers}`}}else if(225===i)if(t){const e=a.Ui(t);v=u.GP("%s.%d.%02d%s.%02d.%d.%d%d%d",A,e.profile,e.level,e.tier?"H":"M",e.bitDepth,e.monochrome,e.chromaSubsamplingX,e.chromaSubsamplingY,e.chromaSamplePosition)}else v=u.GP("%s.%d.%02dM.08",A,m,g);else if(139===i)if(t){const e=o.Ui(t);v=u.GP("%s.%02d.%02d.%02d",A,e.profile,e.level,e.bitDepth)}else v=m!==c.N_&&g!==c.N_?u.GP("%s.%02d.%02d.08",A,m,g):A;else if(167===i)if(t){const e=n.Ui(t);v=u.GP("%s.%02d.%02d.%02d.%02d.%02d.%02d.%02d.%02d",A,e.profile,e.level,e.bitDepth,e.chromaSubsampling,e.colorPrimaries,e.colorTrc,e.colorSpace,e.fullRangeFlag)}else v=m!==c.N_&&g!==c.N_?u.GP("%s.%02d.%02d.08.00",A,m,g):u.GP("%s.%02d.%02d.08.00",A,0,40);else v=A||"unknown";return v}},81498:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(42524),s=i(20770);function a(e){return 139===r.f[15](e+4)?`video/webm; codecs="${(0,s.A)(e)}"`:`video/mp4; codecs="${(0,s.A)(e)}"`}},16408:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(18152);let s=WebAssembly.validate(r.E_("AGFzbQEAAAABBgFgAX8BfwISAQNlbnYGbWVtb3J5AgMBgIACAwIBAAcJAQVsb2FkOAAACgoBCAAgAP4SAAAL")),a=WebAssembly.validate(r.E_("AGFzbQEAAAABBQFgAAF7AhIBA2VudgZtZW1vcnkCAwGAgAIDAgEACgoBCABBAP0ABAAL"));function o(e,t,i){let r=a?"-simd":s?"-atomic":"";switch(t){case"decoder":if(i>65536&&i<=65572)return`${e}/decode/pcm${r}.wasm`;if(i>=69632&&i<=69683)return`${e}/decode/adpcm${r}.wasm`;switch(i){case 2:return`${e}/decode/mpeg2video${r}.wasm`;case 27:return`${e}/decode/h264${r}.wasm`;case 30:return`${e}/decode/theora${r}.wasm`;case 86018:return`${e}/decode/aac${r}.wasm`;case 86019:return`${e}/decode/ac3${r}.wasm`;case 86056:return`${e}/decode/eac3${r}.wasm`;case 86020:return`${e}/decode/dca${r}.wasm`;case 86017:return`${e}/decode/mp3${r}.wasm`;case 173:return`${e}/decode/hevc${r}.wasm`;case 196:return`${e}/decode/vvc${r}.wasm`;case 12:return`${e}/decode/mpeg4${r}.wasm`;case 225:return`${e}/decode/av1${r}.wasm`;case 86051:return`${e}/decode/speex${r}.wasm`;case 86076:return`${e}/decode/opus${r}.wasm`;case 86028:return`${e}/decode/flac${r}.wasm`;case 86021:return`${e}/decode/vorbis${r}.wasm`;case 139:return`${e}/decode/vp8${r}.wasm`;case 167:return`${e}/decode/vp9${r}.wasm`;case 86022:return`${e}/decode/dvaudio${r}.wasm`;case 24:return`${e}/decode/dvvideo${r}.wasm`;case 3:return`${e}/decode/h261${r}.wasm`;case 4:case 20:case 19:return`${e}/decode/h263${r}.wasm`;case 14:case 15:case 16:case 5:case 6:case 68:case 69:return`${e}/decode/msmpeg4${r}.wasm`;case 86036:case 86057:case 86073:return`${e}/decode/ra${r}.wasm`;case 86023:case 86024:case 86052:case 86054:case 86053:return`${e}/decode/wma${r}.wasm`;case 17:case 18:case 71:return`${e}/decode/wmv${r}.wasm`;case 7:return`${e}/decode/mjpeg${r}.wasm`;case 61:return`${e}/decode/png${r}.wasm`;case 171:return`${e}/decode/webp${r}.wasm`;case 97:return`${e}/decode/gif${r}.wasm`;case 96:return`${e}/decode/tiff${r}.wasm`;case 78:return`${e}/decode/bmp${r}.wasm`;default:return null}case"encoder":if(i>65536&&i<=65572)return`${e}/encode/pcm${r}.wasm`;switch(i){case 27:return`${e}/encode/x264${r}.wasm`;case 30:return`${e}/encode/theora${r}.wasm`;case 86018:return`${e}/encode/aac${r}.wasm`;case 86019:return`${e}/encode/ac3${r}.wasm`;case 86056:return`${e}/encode/eac3${r}.wasm`;case 86020:return`${e}/encode/dca${r}.wasm`;case 86017:return`${e}/encode/mp3lame${r}.wasm`;case 173:return`${e}/encode/x265${r}.wasm`;case 12:return`${e}/encode/mpeg4${r}.wasm`;case 225:return`${e}/encode/av1${r}.wasm`;case 86051:return`${e}/encode/speex${r}.wasm`;case 86076:return`${e}/encode/opus${r}.wasm`;case 86028:return`${e}/encode/flac${r}.wasm`;case 86021:return`${e}/encode/vorbis${r}.wasm`;case 139:return`${e}/encode/vp8${r}.wasm`;case 167:return`${e}/encode/vp9${r}.wasm`;default:return null}case"resampler":return`${e}/resample/resample${r}.wasm`;case"scaler":return`${e}/scale/scale${r}.wasm`;case"stretchpitcher":return`${e}/stretchpitch/stretchpitch${r}.wasm`}}},97194:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(42524),s=i(41402);function a(e){if(0!==r.f[15](e))return!1;const t=(0,s.I)(r.f[15](e+28));return t&&128&t.flags}},5015:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(42524),s=i(41402);function a(e){if(0!==r.f[15](e))return!1;const t=(0,s.I)(r.f[15](e+28));return!(!t||t.comp[0].depth<=8||18!==r.f[15](e+92)&&16!==r.f[15](e+92))}},62394:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(19371),s=i(31184),a=i(42365),o=i(53971),n=i(59502);class h{constructor(e,t){(0,r.A)(this,"list",void 0),(0,r.A)(this,"mutex",void 0),this.list=e,this.mutex=t}alloc(){let e=this.list.find((e=>-1===o.p_(e+320,-1,1,16,2)),20);return e||(e=(0,s.Gy)(328),(0,a._h)(e),o.M_(e+320,1,16,2),n.s2(this.mutex),this.list.push(e,20),n.Tl(this.mutex)),e}release(e){o.Hh(e+320,16,2)<=0||1===o.jb(e+320,1,16,2)&&((0,a.to)(e),o.M_(e+320,-1,16,2))}}},50605:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(19371),s=i(31184),a=i(53971),o=i(59502);class n{constructor(e,t){(0,r.A)(this,"list",void 0),(0,r.A)(this,"mutex",void 0),this.list=e,this.mutex=t}alloc(){let e=this.list.find((e=>-1===a.p_(e+48,-1,1,16,2)),20);return e||(e=(0,s.Gy)(56),a.M_(e+48,1,16,2),o.s2(this.mutex),this.list.push(e,20),o.Tl(this.mutex)),e}release(e){a.Hh(e+48,16,2)<=0||1===a.jb(e+48,1,16,2)&&a.M_(e+48,-1,16,2)}}},7615:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(19371),s=i(31184),a=i(1818),o=i(53971),n=i(59502);class h{constructor(e,t){(0,r.A)(this,"list",void 0),(0,r.A)(this,"mutex",void 0),this.list=e,this.mutex=t}alloc(){let e=this.list.find((e=>-1===o.p_(e+80,-1,1,16,2)),20);return e||(e=(0,s.Gy)(88),(0,a.Pd)(e),o.M_(e+80,1,16,2),n.s2(this.mutex),this.list.push(e,20),n.Tl(this.mutex)),e}release(e){o.Hh(e+80,16,2)<=0||1===o.jb(e+80,1,16,2)&&((0,a.Up)(e),o.M_(e+80,-1,16,2))}}},41402:(e,t,i)=>{i.d(t,{I:()=>s});const r=new Map;function s(e){if(r.has(e))return r.get(e);const t=C[e];if(!t)return;const i={log2ChromaW:t[0],log2ChromaH:t[1],flags:t[2],comp:t[3].map((e=>({plane:e[0],step:e[1],offset:e[2],shift:e[3],depth:e[4]})))};return r.set(e,i),i}const a=[[0,1,0,0,8],[1,1,0,0,8],[2,1,0,0,8]],o=[...a,[3,1,0,0,8]],n=[[0,2,0,0,9],[1,2,0,0,9],[2,2,0,0,9]],h=[...n,[3,2,0,0,9]],d=[[0,2,0,0,10],[1,2,0,0,10],[2,2,0,0,10]],c=[...d,[3,2,0,0,10]],l=[[0,2,0,0,12],[1,2,0,0,12],[2,2,0,0,12]],u=[...l,[3,2,0,0,12]],f=[[0,2,0,0,14],[1,2,0,0,14],[2,2,0,0,14]],p=[[0,2,0,0,16],[1,2,0,0,16],[2,2,0,0,16]],m=[...p,[3,2,0,0,16]],g=[[0,1,0,0,8],[1,2,0,0,8],[1,2,1,0,8]],A=[[0,1,0,0,8],[1,2,1,0,8],[1,2,0,0,8]],v=[[0,8,2,0,16],[0,8,4,0,16],[0,8,6,0,16],[0,8,0,0,16]],y=[[0,2,0,6,10],[1,4,0,6,10],[1,4,2,6,10]],b=[[0,2,0,4,12],[1,4,0,4,12],[1,4,2,4,12]],k=[[0,2,0,0,16],[1,4,0,0,16],[1,4,2,0,16]],w=[[0,8,0,0,16],[0,8,2,0,16],[0,8,4,0,16],[0,8,6,0,16]],x=[[0,8,4,0,16],[0,8,2,0,16],[0,8,0,0,16],[0,8,6,0,16]],T=[[2,2,0,0,9],[0,2,0,0,9],[1,2,0,0,9]],I=[[2,2,0,0,10],[0,2,0,0,10],[1,2,0,0,10]],_=[[2,2,0,0,12],[0,2,0,0,12],[1,2,0,0,12]],P=[[2,2,0,0,14],[0,2,0,0,14],[1,2,0,0,14]],M=[[2,2,0,0,16],[0,2,0,0,16],[1,2,0,0,16]],S=[[2,2,0,0,16],[0,2,0,0,16],[1,2,0,0,16],[3,2,0,0,16]],C={6:[2,2,16,a],0:[1,1,16,a],12:[1,1,16,a],4:[1,0,16,a],13:[1,0,16,a],5:[0,0,16,a],14:[0,0,16,a],23:[1,1,16,g],24:[1,1,16,A],188:[0,0,16,g],189:[0,0,16,A],59:[1,1,17,n],60:[1,1,16,n],69:[1,0,17,n],70:[1,0,16,n],65:[0,0,17,n],66:[0,0,16,n],61:[1,1,17,d],62:[1,1,16,d],63:[1,0,17,d],64:[1,0,16,d],67:[0,0,17,d],68:[0,0,16,d],122:[1,1,17,l],123:[1,1,16,l],126:[1,0,17,l],127:[1,0,16,l],130:[0,0,17,l],131:[0,0,16,l],124:[1,1,17,f],125:[1,1,16,f],128:[1,0,17,f],129:[1,0,16,f],132:[0,0,17,f],133:[0,0,16,f],46:[1,1,17,p],45:[1,1,16,p],48:[1,0,17,p],47:[1,0,16,p],50:[0,0,17,p],49:[0,0,16,p],33:[1,1,144,o],78:[1,0,144,o],79:[0,0,144,o],80:[1,1,145,h],81:[1,1,144,h],82:[1,0,145,h],83:[1,0,144,h],84:[0,0,145,h],85:[0,0,144,h],86:[1,1,145,c],87:[1,1,144,c],88:[1,0,145,c],89:[1,0,144,c],90:[0,0,145,c],91:[0,0,144,c],230:[1,1,145,u],229:[1,1,144,u],184:[1,0,145,u],185:[1,0,144,u],186:[0,0,145,u],187:[0,0,144,u],92:[1,1,145,m],93:[1,1,144,m],94:[1,0,145,m],95:[1,0,144,m],96:[0,0,145,m],97:[0,0,144,m],156:[0,0,129,v],155:[0,0,128,v],159:[1,1,17,y],158:[1,1,16,y],210:[1,1,17,b],209:[1,1,16,b],170:[1,1,17,k],169:[1,1,16,k],8:[0,0,0,[[0,1,0,0,8]]],29:[0,0,1,[[0,2,0,0,16]]],30:[0,0,0,[[0,2,0,0,16]]],56:[0,0,128,[[0,2,0,0,8],[0,2,1,0,8]]],109:[0,0,129,[[0,4,0,0,16],[0,4,2,0,16]]],110:[0,0,128,[[0,4,0,0,16],[0,4,2,0,16]]],26:[0,0,160,[[0,4,0,0,8],[0,4,1,0,8],[0,4,2,0,8],[0,4,3,0,8]]],25:[0,0,160,[[0,4,1,0,8],[0,4,2,0,8],[0,4,3,0,8],[0,4,0,0,8]]],104:[0,0,161,w],105:[0,0,160,w],28:[0,0,160,[[0,4,2,0,8],[0,4,1,0,8],[0,4,0,0,8],[0,4,3,0,8]]],27:[0,0,160,[[0,4,3,0,8],[0,4,2,0,8],[0,4,1,0,8],[0,4,0,0,8]]],106:[0,0,161,x],107:[0,0,160,x],2:[0,0,32,[[0,3,0,0,8],[0,3,1,0,8],[0,3,2,0,8]]],3:[0,0,32,[[0,3,2,0,8],[0,3,1,0,8],[0,3,0,0,8]]],119:[0,0,32,[[0,4,0,0,8],[0,4,1,0,8],[0,4,2,0,8]]],121:[0,0,32,[[0,4,2,0,8],[0,4,1,0,8],[0,4,0,0,8]]],71:[0,0,48,[[2,1,0,0,8],[0,1,0,0,8],[1,1,0,0,8]]],111:[0,0,176,[[2,1,0,0,8],[0,1,0,0,8],[1,1,0,0,8],[3,1,0,0,8]]],72:[0,0,49,T],73:[0,0,48,T],74:[0,0,49,I],75:[0,0,48,I],134:[0,0,49,_],135:[0,0,48,_],136:[0,0,49,P],137:[0,0,48,P],76:[0,0,49,M],77:[0,0,48,M],112:[0,0,177,S],113:[0,0,176,S]}},6306:(e,t,i)=>{i.d(t,{J:()=>r});const r={0:{bits:8,planar:!1},1:{bits:16,planar:!1},2:{bits:32,planar:!1},10:{bits:64,planar:!1},3:{bits:32,planar:!1},4:{bits:64,planar:!1},5:{bits:8,planar:!0},6:{bits:16,planar:!0},7:{bits:32,planar:!0},11:{bits:64,planar:!0},8:{bits:32,planar:!0},9:{bits:64,planar:!0}}},91390:(e,t,i)=>{i.d(t,{$$:()=>a,Eh:()=>m,HR:()=>s,IY:()=>b,Ki:()=>y,Ld:()=>d,Mb:()=>A,Sz:()=>l,Xp:()=>h,_R:()=>o,_m:()=>p,d8:()=>g,iW:()=>u,mX:()=>f,n1:()=>n,os:()=>r,qO:()=>c,u6:()=>v});const r={86017:"mp3",86018:"mp4a.40",86021:"vorbis",86028:"flac",86076:"opus",65542:"ulaw",65543:"alaw",86019:"ac-3",86056:"ec-3",86020:"dtsc",65541:"pcm-u8",65540:"pcm-s8",65536:"pcm-s16",65537:"pcm-s16be",65548:"pcm-s24",65549:"pcm-s24be",65544:"pcm-s32",65545:"pcm-s32be",65557:"pcm-f32",65556:"pcm-f32be",65559:"pcm-f64",65558:"pcm-f64be",225:"av01",27:"avc1",173:"hev1",196:"vvc1",139:"vp8",167:"vp09",12:"mp4v"},s={flv:0,mp4:1,m4s:1,mov:1,ts:2,mts:2,m2ts:2,ivf:5,opus:4,oggs:4,ogg:4,m3u8:2,m3u:2,mpd:1,mp3:14,mkv:8,mka:8,webm:9,aac:15,flac:17,wav:16,srt:19,vtt:18,ssa:20,ass:20,xml:21,ttml:21,h264:11,264:11,avc:11,h265:12,265:12,hevc:12,h266:13,266:13,vvc:13,mpeg:3,mpg:3,rtsp:6,rtmp:7,avi:10,avif:1,heic:1},a={m3u8:4,m3u:4,mpd:5},o={copy:0,h264:27,h261:3,h263:4,h263i:20,h263p:19,mjpeg:7,wmv1:17,wmv2:18,wmv3:71,avc:27,hevc:173,h265:173,vvc:196,h266:196,av1:225,vp9:167,vp8:139,mpeg4:12,theora:30,mpeg2video:2,rv10:5,rv20:6,rv30:68,rv40:69,png:61,bmp:78,webp:171,tiff:96,gif:97},n={copy:0,aac:86018,ac3:86019,eac3:86056,dts:86020,mp3:86017,opus:86076,flac:86028,speex:86051,vorbis:86021,pcm_alaw:65543,pcm_mulaw:65542,wmav1:86023,wmav2:86024,cook:86036,sipr:86057,ralf:86073,pcm_u8:65541,pcm_s16le:65536,pcm_s24le:65548,pcm_s32le:65544,pcm_s64le:65567,pcm_f32le:65557,pcm_f64le:65559},h={webvtt:94226,subrip:94225,ass:94230,ttml:94232,mov_text:94213,hdmv_pgs:94214,hdmv_text:94231,dvd:94208,dvb:94209,eia_608:94218},d={bin_data:98314},c={yuv420p:0,yuv422p:4,yuv444p:5,yuva420p:33,yuva422p:78,yuva444p:79,yuvj420p:12,yuvj422p:13,yuvj444p:14,yuv420p10le:62,yuv422p10le:64,yuv444p10le:68,yuva420p10le:87,yuva422p10le:89,yuva444p10le:91,yuv420p10be:61,yuv422p10be:63,yuv444p10be:67,yuva420p10be:86,yuva422p10be:88,yuva444p10be:90,rgba:26,rgb24:2,bgr24:3,gray:8},l={u8:0,"u8-planar":5,s16:1,"s16-planar":6,s32:2,"s32-planar":7,s64:10,"s64-planar":11,float:3,"float-planar":8,double:4,"double-planar":9},u={flv:0,isobmff:1,mp4:1,mov:1,ts:2,mpegts:2,mpeg:3,ivf:5,ogg:4,opus:4,m3u8:2,m3u:2,mpd:1,mp3:14,mkv:8,matroska:8,mka:8,webm:9,aac:15,flac:17,wav:16,raw_h264:11,raw_h265:12,raw_vvc:13,rtsp:6,rtmp:7,avi:10,h264:11,h265:12,h266:13},f={tv:1,pc:2},p={bt709:1,fcc:4,bt470bg:5,smpte170m:6,smpte240m:7,ycgco:8,gbr:0,bt2020nc:9},m={bt709:1,bt470m:4,bt470bg:5,smpte170m:6,smpte240m:7,smpte428:10,film:8,smpte431:11,smpte432:12,bt2020:9,"jedec-p22":22,ebu3213:22},g={bt709:1,gamma22:4,gamma28:5,smpte170m:6,smpte240m:7,srgb:13,xvycc:11,"bt2020-10":14,"bt2020-12":15,smpte2084:16,"arib-std-b67":18},A={Audio:1,Video:0,Subtitle:3,Attachment:4,Data:2},v={"Tile Grid":3,"Audio Element":1,"Mix Presentation":2},y={default:1,dub:2,original:4,comment:8,lyrics:16,karaoke:32,forced:64,"hearing impaired":128,"visual impaired":256,"clean effects":512,"attached pic":1024,"timed thumbnails":2048,captions:65536,descriptions:131072,metadata:262144,dependent:524288,"still image":1048576,thumbnail:8192},b={mono:4,stereo:3,2.1:11,"3.0":7,"3.0(back)":259,"4.0":263,quad:51,"quad(side)":1539,3.1:15,"5.0":55,"5.0(side)":1543,4.1:271,5.1:63,"5.1(side)":1551,"6.0":1799,"6.0(front)":1731,"3.1.2":20495,hexagonal:311,6.1:1807,"6.1(back)":319,"6.1(front)":1739,"7.0":1591,"7.0(front)":1735,7.1:1599,"7.1(wide)":255,"7.1(wide-side)":1743,"5.1.2":20543,octagonal:1847,cube:184371,"5.1.4":184383,"7.1.2":22079,"7.1.4":185919,"7.2.3":34359825983,"9.1.4":186111,hexadecagonal:6442710839,downmix:1610612736,22.2:2164663779327}},45e3:(e,t,i)=>{i.d(t,{r:()=>d});var r,s,a=i(19371),o=i(75354),n=i(86220);class h{constructor(){(0,a.A)(this,"id",void 0),(0,a.A)(this,"name",void 0),(0,a.A)(this,"opaque",void 0)}}r=h,(()=>{const e=r.prototype,t=new Map;t.set("id",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("name",{0:4,1:0,2:0,3:1,4:16,5:0,6:0,7:4,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:20,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,4),(0,n.A)(e,o.g7,24),(0,n.A)(e,o.JY,t)})();class d{constructor(){(0,a.A)(this,"order",void 0),(0,a.A)(this,"nbChannels",void 0),(0,a.A)(this,"u",void 0),(0,a.A)(this,"opaque",void 0)}}s=d,(()=>{const e=s.prototype,t=new Map;t.set("order",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("nbChannels",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("u",{0:function(e){const t=new Map;return t.set("mask",{0:10,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("map",{0:h,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,8),(0,n.A)(e,o.g7,8),(0,n.A)(e,o.JY,t),e}({}),1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:16,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,8),(0,n.A)(e,o.g7,24),(0,n.A)(e,o.JY,t)})()},34391:(e,t,i)=>{i.d(t,{BU:()=>u});var r,s,a,o,n=i(19371),h=i(75354),d=i(86220),c=i(59502);class l{constructor(){(0,n.A)(this,"data",0),(0,n.A)(this,"size",0),(0,n.A)(this,"refcount",0),(0,n.A)(this,"free",0),(0,n.A)(this,"opaque",0),(0,n.A)(this,"flags",0),(0,n.A)(this,"flagsInternal",0)}}r=l,(()=>{const e=r.prototype,t=new Map;t.set("data",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("size",{0:25,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("refcount",{0:9,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("free",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("flags",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:20,8:0}),t.set("flagsInternal",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:24,8:0}),(0,d.A)(e,h.Og,!0),(0,d.A)(e,h.dc,4),(0,d.A)(e,h.g7,28),(0,d.A)(e,h.JY,t)})();class u{constructor(){(0,n.A)(this,"buffer",0),(0,n.A)(this,"data",0),(0,n.A)(this,"size",0)}}s=u,(()=>{const e=s.prototype,t=new Map;t.set("buffer",{0:l,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("data",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("size",{0:25,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),(0,d.A)(e,h.Og,!0),(0,d.A)(e,h.dc,4),(0,d.A)(e,h.g7,12),(0,d.A)(e,h.JY,t)})();class f{constructor(){(0,n.A)(this,"mutex",void 0),(0,n.A)(this,"pool",0),(0,n.A)(this,"refcount",0),(0,n.A)(this,"size",0),(0,n.A)(this,"opaque",0),(0,n.A)(this,"alloc",0),(0,n.A)(this,"alloc2",0),(0,n.A)(this,"poolFree",0)}}a=f,(()=>{const e=a.prototype,t=new Map;t.set("mutex",{0:c.eu,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("pool",{get 0(){return p},1:1,2:1,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("refcount",{0:9,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("size",{0:25,1:0,2:0,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("alloc",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:20,8:0}),t.set("alloc2",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("poolFree",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:28,8:0}),(0,d.A)(e,h.Og,!0),(0,d.A)(e,h.dc,4),(0,d.A)(e,h.g7,32),(0,d.A)(e,h.JY,t)})();class p{constructor(){(0,n.A)(this,"data",0),(0,n.A)(this,"opaque",0),(0,n.A)(this,"free",0),(0,n.A)(this,"pool",0),(0,n.A)(this,"next",0),(0,n.A)(this,"buffer",void 0)}}o=p,(()=>{const e=o.prototype,t=new Map;t.set("data",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("free",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("pool",{0:f,1:1,2:1,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("next",{0:o,1:1,2:1,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("buffer",{0:l,1:0,2:0,3:0,4:0,5:0,6:0,7:20,8:0}),(0,d.A)(e,h.Og,!0),(0,d.A)(e,h.dc,4),(0,d.A)(e,h.g7,48),(0,d.A)(e,h.JY,t)})()},36271:(e,t,i)=>{i.d(t,{A:()=>f});var r,s=i(19371),a=i(75354),o=i(86220),n=i(96445),h=i(3912),d=i(45e3),c=i(91278),l=i(62787),u=i(55606);class f{constructor(){(0,s.A)(this,"codecType",-1),(0,s.A)(this,"codecId",0),(0,s.A)(this,"codecTag",0),(0,s.A)(this,"extradata",0),(0,s.A)(this,"extradataSize",0),(0,s.A)(this,"codedSideData",0),(0,s.A)(this,"nbCodedSideData",0),(0,s.A)(this,"format",c.N_),(0,s.A)(this,"bitrate",BigInt(0)),(0,s.A)(this,"bitsPerCodedSample",0),(0,s.A)(this,"bitsPerRawSample",0),(0,s.A)(this,"profile",c.N_),(0,s.A)(this,"level",c.N_),(0,s.A)(this,"width",0),(0,s.A)(this,"height",0),(0,s.A)(this,"sampleAspectRatio",new h.Q({den:1,num:1})),(0,s.A)(this,"framerate",new h.Q({den:1,num:0})),(0,s.A)(this,"fieldOrder",0),(0,s.A)(this,"colorRange",0),(0,s.A)(this,"colorPrimaries",2),(0,s.A)(this,"colorTrc",2),(0,s.A)(this,"colorSpace",2),(0,s.A)(this,"chromaLocation",0),(0,s.A)(this,"videoDelay",0),(0,s.A)(this,"chLayout",void 0),(0,s.A)(this,"sampleRate",c.N_),(0,s.A)(this,"blockAlign",0),(0,s.A)(this,"frameSize",0),(0,s.A)(this,"initialPadding",0),(0,s.A)(this,"trailingPadding",0),(0,s.A)(this,"seekPreroll",0),(0,s.A)(this,"flags",0)}destroy(){(0,l.dn)(this[a.o9]),(0,u.A)(this)}}r=f,(()=>{const e=r.prototype,t=new Map;t.set("codecType",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("codecId",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("codecTag",{0:8,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("extradata",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("extradataSize",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("codedSideData",{0:n.lg,1:1,2:1,3:0,4:0,5:0,6:0,7:20,8:0}),t.set("nbCodedSideData",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("format",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:28,8:0}),t.set("bitrate",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:32,8:0}),t.set("bitsPerCodedSample",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:40,8:0}),t.set("bitsPerRawSample",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:44,8:0}),t.set("profile",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:48,8:0}),t.set("level",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:52,8:0}),t.set("width",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:56,8:0}),t.set("height",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:60,8:0}),t.set("sampleAspectRatio",{0:h.Q,1:0,2:0,3:0,4:0,5:0,6:0,7:64,8:0}),t.set("framerate",{0:h.Q,1:0,2:0,3:0,4:0,5:0,6:0,7:72,8:0}),t.set("fieldOrder",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:80,8:0}),t.set("colorRange",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:84,8:0}),t.set("colorPrimaries",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:88,8:0}),t.set("colorTrc",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:92,8:0}),t.set("colorSpace",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:96,8:0}),t.set("chromaLocation",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:100,8:0}),t.set("videoDelay",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:104,8:0}),t.set("chLayout",{0:d.r,1:0,2:0,3:0,4:0,5:0,6:0,7:112,8:0}),t.set("sampleRate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:136,8:0}),t.set("blockAlign",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:140,8:0}),t.set("frameSize",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:144,8:0}),t.set("initialPadding",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:148,8:0}),t.set("trailingPadding",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:152,8:0}),t.set("seekPreroll",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:156,8:0}),t.set("flags",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:160,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,8),(0,o.A)(e,a.g7,168),(0,o.A)(e,a.JY,t)})()},96445:(e,t,i)=>{i.d(t,{lg:()=>f});var r,s,a,o,n=i(19371),h=i(75354),d=i(86220),c=i(34391),l=i(3912),u=i(91278);class f{constructor(){(0,n.A)(this,"data",0),(0,n.A)(this,"size",0),(0,n.A)(this,"type",-1)}}r=f,(()=>{const e=r.prototype,t=new Map;t.set("data",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("size",{0:25,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("type",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),(0,d.A)(e,h.Og,!0),(0,d.A)(e,h.dc,4),(0,d.A)(e,h.g7,12),(0,d.A)(e,h.JY,t)})(),s=class{constructor(){(0,n.A)(this,"wallclock",void 0),(0,n.A)(this,"flags",void 0)}},(()=>{const e=s.prototype,t=new Map;t.set("wallclock",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("flags",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),(0,d.A)(e,h.Og,!0),(0,d.A)(e,h.dc,8),(0,d.A)(e,h.g7,16),(0,d.A)(e,h.JY,t)})();class p{constructor(){(0,n.A)(this,"buf",0),(0,n.A)(this,"pts",u.Dh),(0,n.A)(this,"dts",u.Dh),(0,n.A)(this,"data",0),(0,n.A)(this,"size",0),(0,n.A)(this,"streamIndex",u.N_),(0,n.A)(this,"flags",0),(0,n.A)(this,"sideData",0),(0,n.A)(this,"sideDataElems",0),(0,n.A)(this,"duration",u.Dh),(0,n.A)(this,"pos",u.Dh),(0,n.A)(this,"opaque",0),(0,n.A)(this,"opaqueRef",0),(0,n.A)(this,"timeBase",new l.Q({den:u.SF,num:1}))}}a=p,(()=>{const e=a.prototype,t=new Map;t.set("buf",{0:c.BU,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("pts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("dts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("data",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("size",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:28,8:0}),t.set("streamIndex",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:32,8:0}),t.set("flags",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:36,8:0}),t.set("sideData",{0:f,1:1,2:1,3:0,4:0,5:0,6:0,7:40,8:0}),t.set("sideDataElems",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:44,8:0}),t.set("duration",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:48,8:0}),t.set("pos",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:56,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:64,8:0}),t.set("opaqueRef",{0:c.BU,1:1,2:1,3:0,4:0,5:0,6:0,7:68,8:0}),t.set("timeBase",{0:l.Q,1:0,2:0,3:0,4:0,5:0,6:0,7:72,8:0}),(0,d.A)(e,h.Og,!0),(0,d.A)(e,h.dc,8),(0,d.A)(e,h.g7,80),(0,d.A)(e,h.JY,t)})(),o=class extends p{constructor(){super(...arguments),(0,n.A)(this,"refCount",void 0)}},(()=>{const e=o.prototype,t=new Map;t.set("refCount",{0:16,1:0,2:0,3:0,4:0,5:0,6:0,7:80,8:0}),(0,d.A)(e,h.Og,!0),(0,d.A)(e,h.dc,8),(0,d.A)(e,h.g7,88),(0,d.A)(e,h.JY,t)})()},44867:(e,t,i)=>{i.d(t,{A:()=>h});var r,s,a=i(19371),o=i(75354),n=i(86220);class h{constructor(){(0,a.A)(this,"data",void 0),(0,a.A)(this,"linesize",void 0),(0,a.A)(this,"nbSamples",void 0),(0,a.A)(this,"maxnbSamples",void 0),(0,a.A)(this,"channels",void 0),(0,a.A)(this,"sampleRate",void 0),(0,a.A)(this,"format",void 0),(0,a.A)(this,"timestamp",void 0),(0,a.A)(this,"duration",void 0)}}r=h,(()=>{const e=r.prototype,t=new Map;t.set("data",{0:2,1:1,2:2,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("linesize",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("nbSamples",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("maxnbSamples",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("channels",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("sampleRate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:20,8:0}),t.set("format",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("timestamp",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:32,8:0}),t.set("duration",{0:19,1:0,2:0,3:0,4:0,5:0,6:0,7:40,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,8),(0,n.A)(e,o.g7,48),(0,n.A)(e,o.JY,t)})(),s=class extends h{constructor(){super(...arguments),(0,a.A)(this,"refCount",void 0)}},(()=>{const e=s.prototype,t=new Map;t.set("refCount",{0:16,1:0,2:0,3:0,4:0,5:0,6:0,7:48,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,8),(0,n.A)(e,o.g7,56),(0,n.A)(e,o.JY,t)})()},3912:(e,t,i)=>{i.d(t,{Q:()=>n});var r,s=i(19371),a=i(75354),o=i(86220);class n{constructor(e){(0,s.A)(this,"num",1),(0,s.A)(this,"den",1),e&&(this.den=e.den,this.num=e.num)}}r=n,(()=>{const e=r.prototype,t=new Map;t.set("num",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("den",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,4),(0,o.A)(e,a.g7,8),(0,o.A)(e,a.JY,t)})()},85124:(e,t,i)=>{i.d(t,{A6:()=>A,D$:()=>u,Q7:()=>m,VG:()=>f,aw:()=>l,us:()=>g});var r=i(41863),s=i(42524),a=i(77389),o=i(31184),n=i(53971),h=i(65772),d=i(59502);const c=1;function l(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const h=(0,o.Gy)(28);if(!h)return 0;const d=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;a.M[20](e,t),a.M[25](e+4,i),a.M[20](e+12,r),a.M[20](e+16,s),n.M_(e+8,1,9,2),a.M[15](e+20,h);const d=(0,o.Gy)(12);return d?(a.M[20](d,e),a.M[20](d+4,t),a.M[25](d+8,i),d):0}(h,e,t,i,r,s);return d||((0,o.Eb)(h),0)}function u(e){return l((0,o.sY)(e),e)}function f(e){const t=(0,o.Gy)(12);return(0,r.Mr)(t,e,12),n.WQ(s.f[20](e)+8,1,9,2),t}function p(e,t){const i=s.f[20](s.f[20](e));if(t?((0,r.Mr)(s.f[20](e),s.f[20](t),12),(0,o.aI)(t)):(0,o.aI)(e),1===n.jb(i+8,1,9,2)){const e=!(2&s.f[15](i+24));s.f[20](i+16)?v(s.f[20](i+16),s.f[20](i)):(0,o.Eb)(s.f[20](i)),e&&(0,o.Eb)(i)}}function m(e){e&&s.f[20](e)&&p(e,0)}function g(e,t){const i=s.f[20](e);if(!t)return m(e),0;if(i&&s.f[20](i+4)===s.f[20](t+4))return a.M[20](i+4,s.f[20](t+4)),a.M[25](i+8,s.f[25](t+8)),0;const r=f(t);return m(e),a.M[20](e,r),0}function A(e,t){if(!s.f[20](e)){const i=l((0,o.cz)(0,t),t);return a.M[20](e,i),a.M[15](s.f[20](i)+24,s.f[15](s.f[20](i)+24)|c),0}const i=s.f[20](e),d=s.f[20](i);if(s.f[25](i+8)===t)return 0;if(!(s.f[15](d+24)&c&&function(e){return 1&s.f[15](s.f[20](e)+20)?0:1===n.Hh(s.f[20](e)+8,9,2)?1:0}(i)&&s.f[20](i+4)===s.f[20](d))){let i=h.z(4);a.M[20](i,0);const o=A(i,t);return o<0?(h.t(4),o):((0,r.Mr)(s.f[20](s.f[20](i)+4),s.f[20](d),Math.min(t,s.f[25](d+4))),p(e,i),h.t(4),0)}const u=(0,o.cz)(s.f[20](d),t);return a.M[20](i+4,u),a.M[20](d,u),a.M[25](i+8,t),a.M[25](d+4,t),0}function v(e,t){const i=e,r=s.f[20](i+12);d.s2(r),a.M[20](i+16,s.f[20](r+4)),a.M[20](r+4,i),d.Tl(r),1===n.jb(r+8,1,9,2)&&function(e){!function(e){for(;s.f[20](e+4);){const t=s.f[20](e+4);a.M[20](e+4,s.f[20](t+16)),s.f[20](t+4)?v(s.f[20](t+4),s.f[20](t)):(0,o.Eb)(s.f[20](t)),(0,o.Eb)(t)}}(e),d.zr(e),(0,o.Eb)(e)}(r)}},86270:(e,t,i)=>{i.d(t,{AO:()=>l,IH:()=>c,a5:()=>f});var r=i(42524),s=i(77389),a=i(33740),o=i(31184),n=i(81819),h=i(73575),d=i(41863);function c(e){l(r.f[20](e)),(0,o.aI)(e)}function l(e){if(e){for(;s.M[15](e,r.f[15](e)-1),r.f[15](e)+1;)(0,o.aI)(r.f[20](e+4)+8*r.f[15](e)),(0,o.aI)(r.f[20](e+4)+8*r.f[15](e)+4);(0,o.aI)(e+4)}}function u(e,t){let i=0;return e?(t&&(i=1+(t-r.f[20](e+4)>>3)),i>=r.f[15](e)?0:r.f[20](e+4)+8*i):0}function f(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!e)throw new Error("m is nullptr");let c=0;if(64&o&&(c=function(e,t){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!e)return 0;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t)return 0;for(;s=u(e,s);){let e=(0,d.lH)(r.f[20](s));if(1&i&&(e.toLocaleLowerCase(),t.toLocaleLowerCase()),e===t||2&i&&0===e.indexOf(t))return s}}(e,t,0,o)),c){if(16&o)return 0;32&o&&(i=`${(0,d.lH)(r.f[20](c+4))},${i}`),a.s_.free(r.f[20](c+4)),s.M[20](c+4,a.s_.malloc(i.length+1)),(0,d.qW)(r.f[20](c+4),i,i.length)}else{n.Yj(i)||(i=(0,h.A)(i));let o=a.s_.realloc(r.f[20](e+4),8*(r.f[15](e)+1));s.M[20](e+4,o),s.M[20](r.f[20](e+4)+8*r.f[15](e),a.s_.malloc(t.length+1)),s.M[20](r.f[20](e+4)+8*r.f[15](e)+4,a.s_.malloc(i.length+1)),(0,d.qW)(r.f[20](r.f[20](e+4)+8*r.f[15](e)),t,t.length),(0,d.qW)(r.f[20](r.f[20](e+4)+8*r.f[15](e)+4),i,i.length),s.M[15](e,r.f[15](e)+1)}return 0}},42365:(e,t,i)=>{i.d(t,{FP:()=>p,_h:()=>v,aH:()=>A,rh:()=>y,to:()=>b,xj:()=>m});var r,s=i(42524),a=i(77389),o=i(31184),n=i(91278),h=i(85124),d=i(86270),c=i(21962),l=i(74883),u=i(47378),f=i(41863);function p(){const e=(0,o.Gy)(320);return v(e),e}function m(e){b(e),(0,o.Eb)(e)}function g(e){const t=s.f[20](e);(0,h.Q7)(t+16),(0,d.IH)(t+12),(0,o.aI)(e)}function A(e,t){for(let i=0;i<s.f[15](e+200);i++)if(s.f[15](s.f[20](s.f[20](e+196)+4*i))===t)return s.f[20](s.f[20](e+196)+4*i);return 0}function v(e){s.f[20](e+64)!==e&&(0,o.aI)(e+64),(0,c.bl)(e+288),(0,f.sO)(e,0,320),a.M[17](e+104,n.Dh),a.M[17](e+112,n.Dh),a.M[17](e+232,n.Dh),a.M[17](e+240,n.Dh),a.M[15](e+256,-1),a.M[15](e+84,1),a.M[15](e+92,0),a.M[15](e+96,1),a.M[15](e+80,-1),a.M[20](e+64,e),a.M[15](e+212,2),a.M[15](e+216,2),a.M[15](e+220,2),a.M[15](e+208,0),a.M[15](e+224,0),a.M[15](e+204,0)}function y(e,t){const i=(0,l.K0)(s.f[15](e+80)),r=s.f[15](e+292),d=i?r:1;let c=0;if(!s.f[15](e+32)){if(c=(0,l.f8)(s.f[15](e+80),r,s.f[15](e+76),t),c<0)return c;a.M[15](e+32,c)}if(d>n.pu){if(a.M[20](e+64,(0,o.sY)(4*d)),a.M[20](e+188,(0,o.sY)(4*d)),!s.f[20](e+188)||!s.f[20](e+64))return(0,o.aI)(e+64),(0,o.aI)(e+188),u.gR;a.M[15](e+192,d-n.pu)}else a.M[20](e+64,e);for(let t=0;t<Math.min(d,n.pu);t++){if(a.M[20](e+156+4*t,(0,h.D$)(s.f[15](e+32))),!s.f[20](e+156+4*t))return b(e),u.gR;a.M[20](s.f[20](e+64)+4*t,s.f[20](s.f[20](e+156+4*t)+4)),a.M[20](e+4*t,s.f[20](s.f[20](e+156+4*t)+4))}for(let t=0;t<d-n.pu;t++){if(a.M[20](s.f[20](e+188)+4*t,(0,h.D$)(s.f[15](e+32))),!s.f[20](s.f[20](e+188)+4*t))return b(e),u.gR;a.M[20](s.f[20](e+64)+4*(t+n.pu),s.f[20](s.f[20](s.f[20](e+188)+4*t)+4))}}function b(e){if(e){!function(e){!function(e,t){const i=s.f[15](t),r=s.f[20](e);for(let e=0;e<i;e++)g(r+4*e);a.M[15](t,0),(0,o.aI)(e)}(e+196,e+200)}(e);for(let t=0;t<8;t++)(0,h.Q7)(e+156+4*t);for(let t=0;t<s.f[15](e+192);t++)(0,h.Q7)(s.f[20](e+188)+4*t);(0,o.aI)(e+188),(0,d.IH)(e+248),(0,h.Q7)(e+260),(0,h.Q7)(e+264),(0,h.Q7)(e+284),v(e)}}!function(e){e[e.UNIQUE=1]="UNIQUE"}(r||(r={}))},1818:(e,t,i)=>{i.d(t,{$W:()=>m,E4:()=>g,Is:()=>v,NX:()=>M,NZ:()=>k,Ow:()=>A,Pd:()=>w,Qe:()=>b,Un:()=>l,Up:()=>_,Zx:()=>P,_5:()=>y,fQ:()=>p,iI:()=>c,rN:()=>I,rU:()=>u,sn:()=>f,zu:()=>x});var r=i(41863),s=i(42524),a=i(77389),o=i(31184),n=i(91278),h=i(85124);const d=64;function c(e,t){return t?(0,r.JW)(s.f[20](e+24),s.f[15](e+28)):(0,r.s3)(s.f[20](e+24),s.f[15](e+28))}function l(e,t,i){const r=s.f[15](t),a=s.f[20](e);for(let e=0;e<r;e++)if(s.f[15](a+12*e+8)===i)return a+12*e;return 0}function u(e,t){return l(e+40,e+44,t)}function f(e,t,i){const r=s.f[15](t),a=s.f[20](e);for(let e=0;e<r;e++)if(s.f[15](a+12*e+8)===i)return!0;return!1}function p(e,t){return f(e+40,e+44,t)}function m(e,t,i,n,h){const d=s.f[15](t),c=s.f[20](e);for(let e=0;e<d;e++)if(s.f[15](c+12*e+8)===i)return(0,o.Eb)(s.f[20](c+12*e)),a.M[20](c+12*e,n),void a.M[25](c+12*e+4,h);const l=12*(d+1),u=(0,o.Gy)(l);if(d)for(let e=0;e<d;e++)(0,r.Mr)(u+12*e,c+12*e,12);const f=u+12*d;return a.M[20](f,n),a.M[15](f+8,i),a.M[25](f+4,h),c&&(0,o.Eb)(c),a.M[20](e,u),a.M[15](t,d+1),f}function g(e,t,i,s){const a=(0,o.sY)(s+d);return(0,r.sO)(a+s,0,d),m(e,t,i,a,s)}function A(e,t,i,r){m(e+40,e+44,t,i,r)}function v(e,t){let i=-1;for(let r=0;r<s.f[15](e+44);r++)if(s.f[15](s.f[20](e+40)+12*r+8)===t){i=r;break}if(i>-1)if(1===s.f[15](e+44))(0,o.Eb)(s.f[20](s.f[20](e+40))),(0,o.Eb)(s.f[20](e+40)),a.M[20](e+40,0),a.M[15](e+44,0);else{const t=12*(s.f[15](e+44)-1),n=(0,o.Gy)(t);for(let t=0;t<s.f[15](e+44);t++)t!==i?(0,r.Mr)(n+12*t,s.f[20](e+40)+12*t,12):(0,o.Eb)(s.f[20](s.f[20](e+40)+12*t));(0,o.Eb)(s.f[20](e+40)),a.M[20](e+40,n),a.M[15](e+44,s.f[15](e+44)-1)}}function y(){const e=(0,o.Gy)(80);return w(e),e}function b(e){_(e),(0,o.Eb)(e)}function k(e,t){const i=s.f[20](e),r=s.f[15](t);if(i){for(let e=0;e<r;e++)(0,o.Eb)(s.f[20](i+12*e));(0,o.aI)(e),a.M[15](t,0)}}function w(e){a.M[20](e+24,0),a.M[15](e+28,0),a.M[20](e+40,0),a.M[15](e+44,0),a.M[15](e+32,n.N_),a.M[17](e+56,n.Dh),a.M[17](e+48,n.Dh),a.M[15](e+36,0),a.M[17](e+16,n.Dh),a.M[17](e+8,n.Dh),a.M[15](e+76,n.SF),a.M[15](e+72,1),a.M[20](e,0)}function x(e,t){return a.M[15](e+32,s.f[15](t+32)),a.M[17](e+56,s.f[17](t+56)),a.M[17](e+48,s.f[17](t+48)),a.M[15](e+36,s.f[15](t+36)),a.M[17](e+16,s.f[17](t+16)),a.M[17](e+8,s.f[17](t+8)),a.M[20](e+64,s.f[20](t+64)),a.M[15](e+76,s.f[15](t+76)),a.M[15](e+72,s.f[15](t+72)),a.M[20](e+68,0),(0,h.us)(e+68,s.f[20](t+68)),function(e,t){if(k(e+40,e+44),s.f[15](t+44)){let i=12;a.M[20](e+40,(0,o.Gy)(i*s.f[15](t+44)));for(let i=0;i<s.f[15](t+44);i++)a.M[25](s.f[20](e+40)+12*i+4,s.f[25](s.f[20](t+40)+12*i+4)),a.M[15](s.f[20](e+40)+12*i+8,s.f[15](s.f[20](t+40)+12*i+8)),a.M[20](s.f[20](e+40)+12*i,(0,o.sY)(s.f[25](s.f[20](t+40)+12*i+4))),(0,r.Mr)(s.f[20](s.f[20](e+40)+12*i),s.f[20](s.f[20](t+40)+12*i),s.f[25](s.f[20](t+40)+12*i+4));a.M[15](e+44,s.f[15](t+44))}}(e,t),0}function T(e,t){return(0,h.A6)(e,t+d),(0,r.sO)(s.f[20](s.f[20](e)+4)+t,0,d),0}function I(e,t){return s.f[20](e)&&(0,h.Q7)(e),a.M[20](e,0),x(e,t),!s.f[20](t)&&s.f[15](t+28)?(T(e,s.f[15](t+28)),s.f[15](t+28)&&(0,r.Mr)(s.f[20](s.f[20](e)+4),s.f[20](t+24),s.f[15](t+28)),a.M[20](e+24,s.f[20](s.f[20](e)+4))):s.f[20](t)&&(a.M[20](e,(0,h.VG)(s.f[20](t))),a.M[20](e+24,s.f[20](t+24))),a.M[15](e+28,s.f[15](t+28)),0}function _(e){k(e+40,e+44),(0,h.Q7)(e+68),s.f[20](e)?(0,h.Q7)(e):s.f[20](e+24)&&(0,o.Eb)(s.f[20](e+24)),w(e)}function P(e,t){s.f[20](e)&&(0,h.Q7)(e),a.M[20](e,0),!s.f[20](t)&&s.f[15](t+28)?(T(e,s.f[15](t+28)),s.f[15](t+28)&&(0,r.Mr)(s.f[20](s.f[20](e)+4),s.f[20](t+24),s.f[15](t+28)),a.M[20](e+24,s.f[20](s.f[20](e)+4))):s.f[20](t)&&(a.M[20](e,(0,h.VG)(s.f[20](t))),a.M[20](e+24,s.f[20](t+24))),a.M[15](e+28,s.f[15](t+28))}function M(e,t,i){s.f[20](e)?(0,h.Q7)(e):s.f[20](e+24)&&(0,o.Eb)(s.f[20](e+24)),a.M[20](e,(0,h.aw)(t,i+d)),a.M[20](e+24,t),a.M[15](e+28,i)}},21962:(e,t,i)=>{i.d(t,{ML:()=>c,bl:()=>d,xY:()=>l});var r=i(42524),s=i(77389),a=i(77368),o=i(31184),n=i(47378),h=i(41863);function d(e){2==r.f[15](e)&&(0,o.aI)(e+8),(0,h.sO)(e,0,24)}function c(e,t){return t?(s.M[15](e,1),s.M[15](e+4,(0,a.Xb)(t)),s.M[10](e+8,t),0):n.UY}function l(e,t){if(t<=0)throw new Error("invalid channels");const i=(0,o.Gy)(24*t);for(let e=0;e<t;e++)s.M[15](i+24*e,768);s.M[15](e,2),s.M[15](e+4,t),s.M[20](e+8,i)}},62787:(e,t,i)=>{i.d(t,{Yi:()=>c,dn:()=>l});var r=i(41863),s=i(42524),a=i(77389),o=i(31184),n=i(21962),h=i(1818),d=i(91278);function c(e,t){a.M[15](e,s.f[15](t)),a.M[15](e+4,s.f[15](t+4)),a.M[8](e+8,s.f[8](t+8)),a.M[15](e+28,s.f[15](t+28)),a.M[17](e+32,s.f[17](t+32)),a.M[15](e+40,s.f[15](t+40)),a.M[15](e+44,s.f[15](t+44)),a.M[15](e+48,s.f[15](t+48)),a.M[15](e+52,s.f[15](t+52)),a.M[15](e+56,s.f[15](t+56)),a.M[15](e+60,s.f[15](t+60)),a.M[15](e+68,s.f[15](t+68)),a.M[15](e+64,s.f[15](t+64)),a.M[15](e+80,s.f[15](t+80)),a.M[15](e+84,s.f[15](t+84)),a.M[15](e+88,s.f[15](t+88)),a.M[15](e+92,s.f[15](t+92)),a.M[15](e+96,s.f[15](t+96)),a.M[15](e+100,s.f[15](t+100)),a.M[15](e+104,s.f[15](t+104)),(0,r.Mr)(e+112,t+112,24),a.M[15](e+136,s.f[15](t+136)),a.M[15](e+140,s.f[15](t+140)),a.M[15](e+144,s.f[15](t+144)),a.M[15](e+148,s.f[15](t+148)),a.M[15](e+152,s.f[15](t+152)),a.M[15](e+156,s.f[15](t+156)),a.M[15](e+160,s.f[15](t+160)),(0,r.Mr)(e+72,t+72,8),s.f[20](t+12)&&(s.f[20](e+12)&&(0,o.Eb)(s.f[20](e+12)),a.M[20](e+12,(0,o.sY)(s.f[15](t+16))),a.M[15](e+16,s.f[15](t+16)),(0,r.Mr)(s.f[20](e+12),s.f[20](t+12),s.f[15](t+16))),s.f[20](t+20)&&function(e,t,i,n){if(!i)return;const h=(0,o.Gy)(12*n);for(let e=0;e<n;e++)a.M[15](h+12*e+8,s.f[15](i+12*e+8)),a.M[25](h+12*e+4,s.f[25](i+12*e+4)),a.M[20](h+12*e,(0,o.sY)(s.f[25](i+12*e+4))),(0,r.Mr)(s.f[20](h+12*e),s.f[20](i+12*e),s.f[25](i+12*e+4));a.M[15](t,n),a.M[20](e,h)}(e+20,e+24,s.f[20](t+20),s.f[15](t+24))}function l(e){e&&(function(e){s.f[20](e+12)&&(0,o.aI)(e+12),(0,n.bl)(e+112),(0,h.NZ)(e+20,e+24),(0,r.sO)(e,0,168),a.M[15](e,-1),a.M[15](e+4,0),a.M[15](e+28,-1),a.M[15](e+112,0),a.M[15](e+80,0),a.M[15](e+84,0),a.M[15](e+88,2),a.M[15](e+92,2),a.M[15](e+96,2),a.M[15](e+100,0),a.M[15](e+64,0),a.M[15](e+68,1),a.M[15](e+72,0),a.M[15](e+72,1),a.M[15](e+48,d.N_),a.M[15](e+52,d.N_),a.M[15](e+160,0)}(e),(0,o.Eb)(e))}},77368:(e,t,i)=>{function r(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,(e+=e>>8)+(e>>16)&63}function s(e){return r(Number(BigInt.asUintN(32,e)))+r(Number(BigInt.asUintN(32,e>>BigInt(32))))}function a(e){const t=e/BigInt(1e3),i=e-t*BigInt(1e3);return Number(t)+Number(i)/1e3}i.d(t,{Xb:()=>s,yw:()=>a})},95704:(e,t,i)=>{i.d(t,{ZK:()=>n,bE:()=>h,p$:()=>a,zz:()=>o});var r=i(54570),s=i(21374);function a(e){const t=new r.A(e,!0),i=t.readUint32(),s=t.readUint32(),a=t.readUint32(),o=t.readUint32(),n=t.readUint32(),h=t.readUint32(),d={scheme:i,cryptByteBlock:s,skipByteBlock:a,keyId:t.readBuffer(o),iv:t.readBuffer(n),subsamples:[]};if(h)for(let e=0;e<h;e++)d.subsamples.push({bytesOfClearData:t.readUint32(),bytesOfProtectedData:t.readUint32()});return d}function o(e){const t=new Uint8Array(24+e.keyId.length+e.iv.length+8*e.subsamples.length),i=new s.A(t,!0);return i.writeUint32(e.scheme),i.writeUint32(e.cryptByteBlock),i.writeUint32(e.skipByteBlock),i.writeUint32(e.keyId.length),i.writeUint32(e.iv.length),i.writeUint32(e.subsamples.length),i.writeBuffer(e.keyId),i.writeBuffer(e.iv),e.subsamples.forEach((e=>{i.writeUint32(e.bytesOfClearData),i.writeUint32(e.bytesOfProtectedData)})),t}function n(e){const t=new r.A(e,!0),i=t.readUint32(),s=[];for(let e=0;e<i;e++){const e=t.readUint32(),i=t.readUint32(),r=t.readUint32(),a=t.readUint32(),o={systemId:t.readBuffer(e),keyIds:[],data:null};if(i)for(let e=0;e<i;e++)o.keyIds.push(t.readBuffer(r));o.data=t.readBuffer(a),s.push(o)}return s}function h(e){let t=4;e.forEach((e=>{t+=16+e.systemId.length+e.keyIds.length*(e.keyIds.length?e.keyIds[0].length:0)+e.data.length}));const i=new Uint8Array(t),r=new s.A(i,!0);return r.writeUint32(e.length),e.forEach((e=>{r.writeUint32(e.systemId.length),r.writeUint32(e.keyIds.length),r.writeUint32(e.keyIds.length?e.keyIds[0].length:0),r.writeUint32(e.data.length),r.writeBuffer(e.systemId),e.keyIds.forEach((e=>{r.writeBuffer(e)})),r.writeBuffer(e.data)})),i}},76658:(e,t,i)=>{function r(e){let t=0,i=0;for(;i<32&&0===e.readU1();)i++;return t=e.readU(i),t+=(1<<i)-1,t}function s(e){let t=r(e);return t=1&t?(t+1)/2:-t/2,t}i.d(t,{$x:()=>s,xb:()=>r})},43776:(e,t,i)=>{i.d(t,{E3:()=>a,Sg:()=>d,Y0:()=>h,ht:()=>n,r8:()=>s,v4:()=>c,yd:()=>o});var r=i(42524);function s(e){return r.f[2](e)}function a(e){return s(e+1)<<8|s(e)}function o(e){return s(e)<<8|s(e+1)}function n(e){return s(e)<<16|s(e+1)<<8|s(e+2)}function h(e){return a(e+2)<<16|a(e)}function d(e){return o(e)<<16|o(e+2)}function c(e){return BigInt(d(e))<<BigInt(32)|BigInt(d(e+4))}},62705:(e,t,i)=>{i.d(t,{Cv:()=>n,w8:()=>s});var r=i(77389);function s(e,t){r.M[2](e,255&t)}function a(e,t){s(e,t>>>8),s(e+1,t)}function o(e,t){a(e,t>>>16),a(e+2,65535&t)}function n(e,t){o(e,Number(BigInt.asUintN(32,t>>BigInt(32)))),o(e+4,Number(BigInt.asUintN(32,t)))}},31184:(e,t,i)=>{i.d(t,{Eb:()=>l,Gy:()=>c,aI:()=>u,cz:()=>f,sY:()=>d});var r=i(33740),s=i(42524),a=i(77389),o=i(41863),n=i(87339);const h="packages/avutil/src/util/mem.ts";function d(e){const t=r.s_.malloc(e);return t||n.h2("can not alloc buffer",h,32),t}function c(e){const t=r.s_.malloc(e);return t||n.h2("can not alloc buffer",h,40),(0,o.sO)(t,0,e),t}function l(e){r.s_.free(e)}function u(e){r.s_.free(s.f[20](e)),a.M[20](e,0)}function f(e,t){return r.s_.realloc(e,t)}},5639:(e,t,i)=>{i.d(t,{BN:()=>u,Bs:()=>o,Ky:()=>n,Le:()=>d,S9:()=>l,nW:()=>c,py:()=>h});var r=i(53773),s=i(17630),a=i(21374);function o(e){return e.length>4&&0===e[0]&&0===e[1]&&(1===e[2]||0===e[2]&&1===e[3])}function n(e,t){let i=0;for(let r=t;r<e.length;r++)switch(e[r]){case 0:i++;break;case 1:if(i>=2)return{offset:r-Math.min(i,3),startCode:Math.min(i+1,4)};i=0;break;default:i=0}return{offset:-1,startCode:0}}function h(e){const t=[];e instanceof r.A&&(e=e.subarray(0,e.length,!1));let i=n(e,0),s={offset:-1,startCode:0};for(;s=n(e,i.offset+i.startCode),s.offset>-1;)t.push(e.subarray(i.offset+i.startCode,s.offset,!0)),i=s;return t.push(e.subarray(i.offset+i.startCode,void 0,!0)),t}function d(e,t){return e.reduce(((e,i,r)=>0===t?e+4+i.length:1===t?e+3+i.length:e+(r?3:4)+i.length),0)}function c(e,t,i){if(!i){let r=e.reduce(((e,i,r)=>0===t?e+4+i.length:1===t?e+3+i.length:e+(r?3:4)+i.length),0);i=new Uint8Array(r)}const r=new a.A(i);return s.__(e,((e,i)=>{r.writeUint8(0),r.writeUint8(0),(0===t||2===t&&!i)&&r.writeUint8(0),r.writeUint8(1),r.writeBuffer(e)})),i}function l(e,t,i){if(!i){const r=e.reduce(((e,i)=>e+t+1+i.length),0);i=new Uint8Array(r)}const r=new a.A(i);return s.__(e,(e=>{3===t?r.writeUint32(e.length):2===t?r.writeUint24(e.length):1===t?r.writeUint16(e.length):r.writeUint8(e.length),r.writeBuffer(e)})),i}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;i||(i=e.length);const r=new Uint8Array(e.length);let s=0,a=0;for(let o=0;o<e.length;o++){if(o>=t&&o<i)if(0===e[o])s++;else if(3===e[o]&&2===s&&o+1<e.length&&e[o+1]<=3){if(o++,o===e.length)break;s=0===e[o]?1:0}else s=0;r[a++]=e[o]}return r.slice(0,a)}},30027:(e,t,i)=>{i.d(t,{FP:()=>h,Mr:()=>n,iU:()=>l,j2:()=>c,k:()=>o,lb:()=>d});var r=i(42524),s=i(91278),a=i(95111);function o(e,t,i){return e*BigInt(t.num)*BigInt(i.den)/(BigInt(t.den)*BigInt(i.num))}function n(e,t,i){return e*BigInt(r.f[15](t))*BigInt(i.den)/(BigInt(r.f[15](t+4))*BigInt(i.num))}function h(e,t,i){return e*BigInt(t.num)*BigInt(r.f[15](i+4))/(BigInt(t.den)*BigInt(r.f[15](i)))}function d(e){return e.num/e.den}function c(e,t){if(isNaN(19))return{den:0,num:0};if(Math.abs(e)>s.go+3)return{den:0,num:e<0?-1:1};const i=e>1?{den:Math.floor(t/e+.5),num:t}:{den:t,num:Math.floor(e*t+.5)};return l(i),i}function l(e){const t=(0,a.A)(e.num,e.den);t<=1||(e.den/=t,e.num/=t)}},74883:(e,t,i)=>{i.d(t,{K0:()=>o,f8:()=>n});var r=i(91278),s=i(6306),a=i(37688);function o(e){return!(e<0||e>=12)&&s.J[e].planar}function n(e,t,i,n){const h=function(e){return e<0||e>=12?0:s.J[e].bits>>3}(e),d=o(e);return!h||i<=0||t<=0?-1:(n||(n=1,i=(0,a.A)(i,32)),t>r.go/n||t*i>(r.go-n*t)/h?-1:d?(0,a.A)(i*h,n):(0,a.A)(i*h*t,n))}},10567:(e,t,i)=>{i.d(t,{T8:()=>l,Wu:()=>c,r0:()=>d,wm:()=>h});var r=i(42524),s=i(77389),a=i(41863),o=i(1818),n=i(31184);function h(e){const t={pts:r.f[17](e+8),dts:r.f[17](e+16),data:(0,o.iI)(e).slice(),streamIndex:r.f[15](e+32),flags:r.f[15](e+36),sideData:[],duration:r.f[17](e+48),pos:r.f[17](e+56),timeBase:{den:r.f[15](e+76),num:r.f[15](e+72)}};for(let i=0;i<r.f[15](e+44);i++){const s={type:r.f[15](r.f[20](e+40)+12*i+8),data:(0,a.s3)(r.f[20](r.f[20](e+40)+12*i),r.f[25](r.f[20](e+40)+12*i+4)).slice()};t.sideData.push(s)}return t}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t||(t=(0,o._5)()),s.M[17](t+8,e.pts),s.M[17](t+16,e.dts);const i=(0,n.sY)(e.data.length);if((0,a.lW)(i,e.data.length,e.data),(0,o.NX)(t,i,e.data.length),s.M[15](t+32,e.streamIndex),s.M[15](t+36,e.flags),s.M[17](t+48,e.duration),s.M[17](t+56,e.pos),s.M[15](t+76,e.timeBase.den),s.M[15](t+72,e.timeBase.num),e.sideData.length)for(let i=0;i<e.sideData.length;i++){const r=(0,n.sY)(e.sideData[i].data.length);(0,a.lW)(r,e.sideData[i].data.length,e.sideData[i].data),(0,o.Ow)(t,e.sideData[i].type,r,e.sideData[i].data.length)}else(0,o.NZ)(t+40,t+44);return t}function c(e){const t={codecType:r.f[15](e),codecId:r.f[15](e+4),codecTag:r.f[8](e+8),extradata:null,codedSideData:[],format:r.f[15](e+28),bitrate:r.f[17](e+32),bitsPerCodedSample:r.f[15](e+40),bitsPerRawSample:r.f[15](e+44),profile:r.f[15](e+48),level:r.f[15](e+52),width:r.f[15](e+56),height:r.f[15](e+60),sampleAspectRatio:{den:r.f[15](e+68),num:r.f[15](e+64)},framerate:{den:r.f[15](e+76),num:r.f[15](e+72)},fieldOrder:r.f[15](e+80),colorRange:r.f[15](e+84),colorPrimaries:r.f[15](e+88),colorTrc:r.f[15](e+92),colorSpace:r.f[15](e+96),chromaLocation:r.f[15](e+100),videoDelay:r.f[15](e+104),chLayout:{order:r.f[15](e+112),nbChannels:r.f[15](e+116),u:r.f[10](e+120)},sampleRate:r.f[15](e+136),blockAlign:r.f[15](e+140),frameSize:r.f[15](e+144),initialPadding:r.f[15](e+148),trailingPadding:r.f[15](e+152),seekPreroll:r.f[15](e+156),flags:r.f[15](e+160)};r.f[15](e+16)&&(t.extradata=(0,a.s3)(r.f[20](e+12),r.f[15](e+16)).slice());for(let i=0;i<r.f[15](e+24);i++){const s={type:r.f[15](r.f[20](e+20)+12*i+8),data:(0,a.s3)(r.f[20](r.f[20](e+20)+12*i),r.f[25](r.f[20](e+20)+12*i+4)).slice()};t.codedSideData.push(s)}return t}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t||(t=(0,n.sY)(168),(0,a.sO)(t,0,168)),s.M[15](t,e.codecType),s.M[15](t+4,e.codecId),s.M[8](t+8,e.codecTag),e.extradata&&(r.f[20](t+12)&&(0,n.Eb)(r.f[20](t+12)),s.M[20](t+12,(0,n.sY)(e.extradata.length)),(0,a.lW)(r.f[20](t+12),e.extradata.length,e.extradata),s.M[15](t+16,e.extradata.length)),e.codedSideData.length)for(let i=0;i<e.codedSideData.length;i++){const r=(0,n.sY)(e.codedSideData[i].data.length);(0,a.lW)(r,e.codedSideData[i].data.length,e.codedSideData[i].data),(0,o.$W)(t+20,t+24,e.codedSideData[i].type,r,e.codedSideData[i].data.length)}else(0,o.NZ)(t+20,t+24);return s.M[15](t+28,e.format),s.M[17](t+32,e.bitrate),s.M[15](t+40,e.bitsPerCodedSample),s.M[15](t+44,e.bitsPerRawSample),s.M[15](t+48,e.profile),s.M[15](t+52,e.level),s.M[15](t+56,e.width),s.M[15](t+60,e.height),s.M[15](t+68,e.sampleAspectRatio.den),s.M[15](t+64,e.sampleAspectRatio.num),s.M[15](t+76,e.framerate.den),s.M[15](t+72,e.framerate.num),s.M[15](t+80,e.fieldOrder),s.M[15](t+84,e.colorRange),s.M[15](t+88,e.colorPrimaries),s.M[15](t+92,e.colorTrc),s.M[15](t+96,e.colorSpace),s.M[15](t+100,e.chromaLocation),s.M[15](t+104,e.videoDelay),s.M[15](t+112,e.chLayout.order),s.M[15](t+116,e.chLayout.nbChannels),s.M[10](t+120,e.chLayout.u),s.M[15](t+136,e.sampleRate),s.M[15](t+140,e.blockAlign),s.M[15](t+144,e.frameSize),s.M[15](t+148,e.initialPadding),s.M[15](t+152,e.trailingPadding),s.M[15](t+156,e.seekPreroll),s.M[15](t+160,e.flags),t}},15660:(e,t,i)=>{i.d(t,{A:()=>f});var r=i(19371),s=i(59502),a=i(22448),o=i(25092),n=i(87339),h=i(17630);const d="packages/cheap/src/allocator/AllocatorJS.ts",c=A(16),l=32,u=68;class f{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i,s,a,h;(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"byteOffset",void 0),(0,r.A)(this,"heapOffset",void 0),(0,r.A)(this,"heapLength",void 0),(0,r.A)(this,"int32Array",void 0),(0,r.A)(this,"updates",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"shared",void 0),(0,r.A)(this,"handles",void 0),this.options=o.X$({growSize:1048576,maxHeapSize:2097152e3},e),this.handles=[],this.buffer=e.buffer,this.shared=!1,this.options.memory||this.buffer instanceof ArrayBuffer||this.buffer instanceof SharedArrayBuffer?(this.byteOffset=null!==(i=e.byteOffset)&&void 0!==i?i:0,this.heapOffset=y(this.byteOffset+g(l),null!==(s=e.byteLength)&&void 0!==s?s:this.buffer.byteLength),this.heapLength=b((null!==(a=e.byteLength)&&void 0!==a?a:this.buffer.byteLength)-this.heapOffset),this.int32Array=new Int32Array(this.buffer,this.heapOffset,A(this.heapLength)),this.updates=new Int32Array(this.buffer,this.byteOffset,l),"function"==typeof SharedArrayBuffer&&this.buffer instanceof SharedArrayBuffer&&(this.shared=!0)):n.h2("Expected buffer to be an instance of Buffer or ArrayBuffer",d,112),t&&(this.updates.fill(1),function(e){return 65===e[0]&&65===e[66]}(h=this.int32Array)||function(e){const t=e.length-69;x(e,65,1),e[1]=1,e[3]=68;for(let t=1;t<l;t++)e[3+t]=1;x(e,t,68),e[68]=1,e[70]=1}(h),function(e){let t=u;for(;t<e.length-1;){const i=w(e,t);i<2||i>=e.length-u?n.h2(`Got invalid sized chunk at ${g(t)} (${g(i)} bytes).`,d,568):_(e,t)?p(e,t,i):m(e,t,i),t+=i+2}}(this.int32Array))}addUpdateHandle(e){h.zy(this.handles,e)||this.handles.push(e)}removeUpdateHandle(e){h.TF(this.handles,e)}malloc_(e){(e=v(e,7))<16&&(e=16);const t=A(e),i=this.findFreeBlock(this.int32Array,t);if(i<=1)return 0;const r=w(this.int32Array,i);return r-(t+2)>=c?function(e,t,i,r,s){const a=t+i+2,o=r-(a-t);I(e,t,r,s),e[t-1]=-i,e[t+i]=-i,e[a-1]=-o,e[a+o]=-o,S(e,a,o,s)}(this.int32Array,i,t,r,this.updates):I(this.int32Array,i,r,this.updates),g(i)+this.heapOffset}malloc(e){this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer());const t=this.malloc_(e);return this.shared&&(0,s.Tl)(a.II),t}calloc_(e,t){let i=e*t;i=i<16?16:v(i,7);const r=this.malloc_(i);if(0===r)return 0;const s=A(r-this.heapOffset);return this.int32Array.subarray(s,s+A(i)).fill(0),r}calloc(e,t){this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer());const i=this.calloc_(e,t);return this.shared&&(0,s.Tl)(a.II),i}realloc_(e,t){if(0===e)return this.malloc_(t);const i=e;if(0===t)return this.free_(i),0;let r=A(e-=this.heapOffset),s=r,a=0;P(this.int32Array,r)&&(s=this.int32Array[r-1],a=r-s);const o=w(this.int32Array,s)-a;if(o>=A(v(t,7)))return i;{const e=this.malloc_(t);return 0===e?(this.free_(i),0):(this.int32Array.set(this.int32Array.subarray(r,r+o),A(e-this.heapOffset)),this.free_(i),e)}}realloc(e,t){return this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer()),e=this.realloc_(e,t),this.shared&&(0,s.Tl)(a.II),e}alignedAlloc_(e,t){if(e<=8)return this.malloc_(t);const i=this.malloc_(t+e-1+4);if(0===i)return 0;const r=i+e-1+4&~(e-1);return this.int32Array[A(r-this.heapOffset)-1]=A(i-this.heapOffset),r}alignedAlloc(e,t){this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer());const i=this.alignedAlloc_(e,t);return this.shared&&(0,s.Tl)(a.II),i}free_(e){if(0===e)return;let t=A(e-=this.heapOffset);if(P(this.int32Array,t)&&(t=this.int32Array[t-1]),_(this.int32Array,t))return;const i=w(this.int32Array,t),r=M(this.int32Array,t),s=function(e,t){const i=w(e,t);if(t+i+2>=e.length-2)return 0;const r=t+i+2;return e[r-1]<2?0:r}(this.int32Array,t);0!==r?0!==s?function(e,t,i,r,s,a){const o=w(e,t),n=w(e,s),h=s-t+n;I(e,t,o,a),I(e,s,n,a),e[t-1]=-h,e[s+n]=-h,S(e,t,h,a)}(this.int32Array,r,0,0,s,this.updates):C(this.int32Array,r,t,i,this.updates):0!==s?function(e,t,i,r,s){const a=w(e,t);I(e,t,a,s);const o=r+a+2;e[i-1]=-o,e[t+a]=-o,S(e,i,o,s)}(this.int32Array,s,t,i,this.updates):S(this.int32Array,t,i,this.updates)}free(e){this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer()),this.free_(e),this.shared&&(0,s.Tl)(a.II)}sizeof(e){if(0===e)return 0;let t=A(e-=this.heapOffset);return P(this.int32Array,t)&&(t=this.int32Array[t-1]),g(w(this.int32Array,t))}inspect(){return this.checkBuffer(),function(e,t){const i=[],r=k(e,1,t);let s=u,a=0;for(;s<e.length-1;){const r=w(e,s);(r<2||r>=e.length)&&n.h2(`Got invalid sized chunk at ${g(s)} (${g(r)})`,d,624),_(e,s)?i.push(k(e,s,t)):(a+=g(r),i.push({type:"used",block:s,offset:g(s)+t,size:g(r)})),s+=r+2}return{header:r,blocks:i,total:g(e.length),used:a}}(this.int32Array,this.heapOffset)}findFreeBlock(e,t){let i=function(e,t){let i=1;for(let r=e[1];r>0;r--){let s=e[i+2+(r-1)];for(;1!==s&&e[s-1]<t;)i=s,s=e[i+2+(r-1)]}return i=e[i+2],i}(e,t);if(1===i){if(this.options.growAllowed&&this.heapLength<this.options.maxHeapSize){const e=this.int32Array.length+1;let i,o,n=0,d=0,c=0;if(this.options.onResize){var r,s,a;const e=this.options.onResize(this.int32Array,this.int32Array.byteLength+v(Math.max(this.options.growSize,g(t)),7));n=null!==(r=e.byteOffset)&&void 0!==r?r:0,c=y(n+g(l),null!==(s=e.byteLength)&&void 0!==s?s:e.buffer.byteLength),d=b((null!==(a=e.byteLength)&&void 0!==a?a:e.buffer.byteLength)-c),i=new Int32Array(e.buffer,c,A(d)),o=new Int32Array(e.buffer,n,l)}else{const e=new ArrayBuffer(this.int32Array.length+A(this.options.growSize));c=y(n+g(l),e.byteLength),d=b(e.byteLength-c),i=new Int32Array(e,c,A(d)),i.set(this.int32Array,0),o=new Int32Array(e,n,l)}this.byteOffset=n,this.heapOffset=c,this.buffer=i.buffer,this.heapLength=d,this.int32Array=i,this.updates=o;const u=i.length-(e-1)-2;x(i,u,e);const f=M(i,e);return 0!==f?C(i,f,e,u,this.updates):S(i,e,u,this.updates),this.handles.length&&h.__(this.handles,(e=>{e(this.buffer)})),this.findFreeBlock(this.int32Array,t)}return i}return i}getBuffer(){return this.buffer}isAlloc(e){this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer());const t=A(e-this.heapOffset);let i=this.int32Array[3];for(;i&&1!==i;){if(t>=i&&t<i+this.int32Array[i-1])return this.shared&&(0,s.Tl)(a.II),!1;i=this.int32Array[i+2]}return this.shared&&(0,s.Tl)(a.II),!0}checkBuffer(){this.options.memory&&this.options.memory.buffer!==this.buffer&&(this.buffer=this.options.memory.buffer,this.heapLength=b(this.buffer.byteLength-this.heapOffset),this.int32Array=new Int32Array(this.buffer,this.heapOffset,A(this.heapLength)))}}function p(e,t,i){e[t-1]!==e[t+i]&&n.h2(`Block length header does not match footer (${g(e[t-1])} vs ${g(e[t+i])}).`,d,584);const r=e[t+0];(r<1||r>l)&&n.h2(`Block ${g(t)} height must be between 1 and 32, got ${r}.`,d,589);for(let i=0;i<r;i++){const r=e[t+2+i];r>=u&&!_(e,r)&&n.h2(`Block ${g(t)} has a pointer to a non-free block (${g(r)}).`,d,595)}return!0}function m(e,t,i){if(e[t-1]===e[t+i])return!0;n.h2(`Block length header does not match footer (${g(e[t-1])} vs ${g(e[t+i])}).`,d,604)}function g(e){return e<<2>>>0}function A(e){return e>>>2}function v(e,t){return(e+t&~t)>>>0}function y(e,t){const i=t-e;return e+(v(i,7)===i?0:i-v(i,7)+8)}function b(e){return e-4}function k(e,t,i){const r=e[t+0],s=[];for(let i=0;i<r;i++)s.push(e[t+2+i]);return{type:"free",block:t,offset:g(t)+i,height:r,pointers:s,size:g(e[t-1])}}function w(e,t){const i=e[t-1],r=i>>31;return i+r^r}function x(e,t,i){e[i-1]=t,e[i+t]=t}function T(e,t,i){let r=1;for(let s=e[1];s>0;s--){let a=r+2+(s-1);for(;e[a]>=u&&e[e[a]-1]<t;)r=e[a],a=r+2+(s-1);i[s-1]=r}}function I(e,t,i,r){T(e,i,r);let s=e[r[0]+2];for(;s!==t&&1!==s&&e[s-1]<=i;){for(let i=e[s+0]-1;i>=0;i--)e[s+2+i]===t&&(r[i]=s);s=e[s+2]}let a=e[1];for(let i=0;i<a&&e[r[i]+2+i]===t;i++)e[r[i]+2+i]=e[t+2+i];for(;a>0&&1===e[a-1+3];)a--,e[1]=a;e[t-1]=-i,e[t+i]=-i}function _(e,t){return!(t<65)&&!(e[t-1]<0)}function P(e,t){return!(t<65)&&!(e[t-1]<0)}function M(e,t){if(t<=u)return 0;const i=e[t-2];return i<2?0:t-(2+i)}function S(e,t,i,r){T(e,i,r);const s=function(e,t,i,r){const s=e[1];let a=function(){let e=1;for(;Math.random()<.5&&e<l;)e+=1;return e}();if(i-1<a+1&&(a=i-2),a>s){const i=s+1;return e[1]=i,e[i-1+3]=1,r[i]=1,e[t+0]=i,i}return e[t+0]=a,a}(e,t,i,r);for(let i=1;i<=s;i++){const s=r[i-1]+2+(i-1);e[t+2+(i-1)]=e[s],e[s]=t,r[i-1]=1}return e[t-1]=i,e[t+i]=i,i}function C(e,t,i,r,s){const a=i-t+r;return I(e,t,i-t-2,s),e[t-1]=-a,e[i+r]=-a,S(e,t,a,s),r}},99338:(e,t,i)=>{i.d(t,{z:()=>s});var r=i(19371);class s{constructor(){(0,r.A)(this,"table",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"nodes",void 0),this.table=new WebAssembly.Table({initial:16,element:"anyfunc",address:"i32",index:"i32"}),this.pointer=6,this.nodes=[{pointer:this.pointer,length:10,free:!0}]}getPointer(){return this.pointer}alloc(e){let t=this.findFree(e);if(t<0){const i=this.nodes[this.nodes.length-1],r=e-(i.free?i.length:0);this.table.grow(r),i.free?i.length=i.length+r:this.nodes.push({pointer:i.pointer+i.length,length:r,free:!0}),t=this.findFree(e)}const i=this.nodes[t];return i.length>e&&(this.nodes.splice(t+1,0,{pointer:i.pointer+e,length:i.length-e,free:!0}),i.length=e),i.free=!1,i.pointer}free(e){let t=this.findNode(e);const i=this.nodes[t];if(i&&!i.free){const e=this.nodes[t-1],r=this.nodes[t+1];e&&e.free?r&&r.free?(e.length+=i.length+r.length,this.nodes.splice(t,2)):(e.length+=i.length,this.nodes.splice(t,1)):r&&r.free?(i.length+=r.length,this.nodes.splice(t+1,1),i.free=!0):i.free=!0}if(1===this.nodes.length&&this.nodes[0].free){const e=new WebAssembly.Table({initial:16,element:"anyfunc",address:"i32",index:"i32"});this.pointer=6,this.nodes=[{pointer:this.pointer,length:10,free:!0}];for(let t=1;t<this.pointer;t++)e.set(t,this.table.get(t));this.table=e}}get(e){return this.table.get(e)}set(e,t){if(e<0||e>=this.pointer)throw new RangeError("index out of bound");this.table.set(e,t)}inspect(){return this.nodes}findFree(e){let t=-1;for(let i=0;i<this.nodes.length;i++)if(this.nodes[i].length>=e&&this.nodes[i].free){t=i;break}return t}findNode(e){let t=-1;for(let i=0;i<this.nodes.length;i++)if(this.nodes[i].pointer===e){t=i;break}return t}}},73804:(e,t,i)=>{i.d(t,{A:()=>r});const r="AGFzbQEAAAABLwlgAn9/AGACf34AYAJ/fQBgAn98AGABfwF/YAF/AX5gAX8BfWABfwF8YAN/f38AAhIBA2VudgZtZW1vcnkCAwGAgAQDERAAAAABAgMEBAQEBAUGBwgIB5YBEAZ3cml0ZTgAAAd3cml0ZTE2AAEHd3JpdGUzMgACB3dyaXRlNjQAAwh3cml0ZWYzMgAECHdyaXRlZjY0AAUFcmVhZDgABgZyZWFkVTgABwZyZWFkMTYACAdyZWFkVTE2AAkGcmVhZDMyAAoGcmVhZDY0AAsHcmVhZGYzMgAMB3JlYWRmNjQADQRmaWxsAA4EY29weQAPCpYBEAkAIAAgAToAAAsJACAAIAE7AQALCQAgACABNgIACwkAIAAgATcDAAsJACAAIAE4AgALCQAgACABOQMACwcAIAAsAAALBwAgAC0AAAsHACAALgEACwcAIAAvAQALBwAgACgCAAsHACAAKQMACwcAIAAqAgALBwAgACsDAAsLACAAIAEgAvwLAAsMACAAIAEgAvwKAAAL"},91621:(e,t,i)=>{i.d(t,{Ts:()=>l});var r=i(42524),s=i(77389),a=i(73804),o=i(46647),n=i(18152),h=i(87339);const d="packages/cheap/src/asm/memory.ts";let c;function l(e,t,i){try{const h=o.bx(n.E_(a.A),{shared:"function"==typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer,initial:t,maximum:i});c=new WebAssembly.Instance(new WebAssembly.Module(h),{env:{memory:e}}),(0,r.$)({4:c.exports.readU8,5:c.exports.readU8,2:c.exports.readU8,3:c.exports.readU8,6:c.exports.readU16,7:c.exports.readU16,8:e=>c.exports.read32(e)>>>0,9:e=>c.exports.read32(e)>>>0,10:e=>BigInt.asUintN(64,c.exports.read64(e)),22:e=>BigInt.asUintN(64,c.exports.read64(e)),11:c.exports.read8,12:c.exports.read8,13:c.exports.read16,14:c.exports.read16,15:c.exports.read32,16:c.exports.read32,17:c.exports.read64,21:c.exports.read64,18:c.exports.readf32,19:c.exports.readf64,20:e=>c.exports.read32(e)>>>0,25:e=>c.exports.read32(e)>>>0}),(0,s.$)({4:c.exports.write8,5:c.exports.write8,2:c.exports.write8,3:c.exports.write8,6:c.exports.write16,7:c.exports.write16,8:c.exports.write32,9:c.exports.write32,10:c.exports.write64,22:c.exports.write64,11:c.exports.write8,12:c.exports.write8,13:c.exports.write16,14:c.exports.write16,15:c.exports.write32,16:c.exports.write32,17:c.exports.write64,21:c.exports.write64,18:c.exports.writef32,19:c.exports.writef64,20:c.exports.write32,25:c.exports.write32,copy:c.exports.copy,fill:c.exports.fill})}catch(e){h.R8("memory asm not support, cannot use asm memory function",d,122)}}},75176:(e,t,i)=>{i.r(t),i.d(t,{HEAP_INITIAL:()=>p,HEAP_MAXIMUM:()=>m,HEAP_OFFSET:()=>f,STACK_ALIGNMENT:()=>l,STACK_SIZE:()=>u,USE_THREADS:()=>c});var r,s,a=i(84799),o=i(24788),n=i(77969),h=i(71195);const d=a.TK,c=!!o.A.thread&&!d.CHEAP_DISABLE_THREAD;let l=16,u=1048576;const f=1024,p=null!==(r=d.CHEAP_HEAP_INITIAL)&&void 0!==r?r:265,m=null!==(s=d.CHEAP_HEAP_MAXIMUM)&&void 0!==s?s:c&&n.A.ios&&!h.A.checkVersion(n.A.version,"17",!0)?8192:65536},7310:(e,t,i)=>{i.d(t,{A:()=>R});var r=i(42524),s=i(77389);let a,o;const n=(0,i(45984).A)();function h(e,t){o().setUint8(e,t)}function d(e){return o().getUint8(e)}function c(e,t){o().setUint16(e,t,n)}function l(e){return o().getUint16(e,n)}function u(e,t){o().setUint32(e,t,n)}function f(e){return o().getUint32(e,n)}function p(e,t){o().setBigUint64(e,t,n)}function m(e){return o().getBigUint64(e,n)}function g(e,t){o().setInt8(e,t)}function A(e){return o().getInt8(e)}function v(e,t){o().setInt16(e,t,n)}function y(e){return o().getInt16(e,n)}function b(e,t){o().setInt32(e,t,n)}function k(e){return o().getInt32(e,n)}function w(e,t){o().setBigInt64(e,t,n)}function x(e){return o().getBigInt64(e,n)}function T(e,t){o().setFloat32(e,t,n)}function I(e){return o().getFloat32(e,n)}function _(e,t){o().setFloat64(e,t,n)}function P(e){return o().getFloat64(e,n)}function M(e){return o().getUint32(e,n)}function S(e,t){return o().setUint32(e,t,n)}function C(e,t){o().setUint32(e,t,n)}function R(e,t){a=e,o=t,(0,r.$)({4:d,5:d,2:d,3:d,6:l,7:l,8:f,9:f,10:m,11:A,12:A,13:y,14:y,15:k,16:k,17:x,18:I,19:P,20:M,23:e=>!!A(e),24:e=>!!A(e),25:e=>function(e){return o().getUint32(e,n)}(e)}),(0,s.$)({4:h,5:h,2:h,3:h,6:c,7:c,8:u,9:u,10:p,11:g,12:g,13:v,14:v,15:b,16:b,17:w,18:T,19:_,20:S,23:(e,t)=>{g(e,t?1:0)},24:(e,t)=>{g(e,t?1:0)},25:C})}},42524:(e,t,i)=>{i.d(t,{$:()=>o,f:()=>a});var r=i(25092),s=i(46784);const a={4:s.A,5:s.A,2:s.A,3:s.A,6:s.A,7:s.A,8:s.A,9:s.A,10:s.A,11:s.A,12:s.A,13:s.A,14:s.A,15:s.A,16:s.A,17:s.A,18:s.A,19:s.A,20:s.A,0:s.A,1:s.A,22:s.A,21:s.A,23:s.A,24:s.A,25:s.A};function o(e){r.X$(a,e)}},77389:(e,t,i)=>{i.d(t,{$:()=>o,M:()=>a});var r=i(25092),s=i(46784);const a={4:s.A,5:s.A,2:s.A,3:s.A,6:s.A,7:s.A,8:s.A,9:s.A,10:s.A,11:s.A,12:s.A,13:s.A,14:s.A,15:s.A,16:s.A,17:s.A,18:s.A,19:s.A,20:s.A,0:s.A,1:s.A,22:s.A,21:s.A,23:s.A,24:s.A,25:s.A,copy:s.A,fill:s.A};function o(e){r.X$(a,e)}},39372:(e,t,i)=>{i.d(t,{X:()=>P,l:()=>_});var r=i(24692),s=i(42524),a=i(77389),o=i(75354),n=i(20723),h=i(25092),d=i(73575),c=i(81819),l=i(17630);function u(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,configurable:!0,enumerable:!0})}function f(e){return function(){return s.f[20](e())}}function p(e,t,i,r){return function(){return e[`__$__${t}`]||(e[`__$__${t}`]=_(i(),r))}}function m(e,t){return function(){return s.f[t](e())}}function g(e,t,i,r){const a=8*n.i[t]-r-i,o=Math.pow(2,i)-1;return function(){return s.f[t](e())>>>a&o}}function A(e){return function(t){a.M[20](e(),t)}}function v(e,t,i,r){const s=`__$__${t}`;return function(t){const a=e[s]||(e[s]=_(i(),r));h.__(t,((e,t)=>{a[t]=e})),e[s]=a}}function y(e,t){return function(i){a.M[t](e(),i)}}function b(e,t,i,r){let o=0,h=8*n.i[t];for(let e=0;e<i;e++)o|=1<<h-1-(e+r);const d=Math.pow(2,i)-1,c=h-r-i;return function(i){const r=e(),n=s.f[t](r);a.M[t](r,n&~o|(i&d)<<c)}}function k(e,t,i){const s={};let a=(0,r.A)(i);for(let r=0;r<t;r++){const t=(0,d.A)(r);u(s,t,p(s,t,(()=>e()+a*r),i),v(s,t,(()=>e()+a*r),i))}return s}function w(e,t,i){const s={};let a=(0,r.A)(i);for(let r=0;r<t;r++)u(s,(0,d.A)(r),m((()=>e()+a*r),i),y((()=>e()+a*r),i));return s}function x(e,t,i,r,s){return function(){let a=t[`__$__${i}`];return a||(a=c.Pc(s)||c.Ik(s)?k(e,r,s):w(e,r,s),t[`__$__${i}`]=a),a[o.o9]=e(),a}}function T(e,t,i,r,s){const a=`__$__${t}`;return function(t){let n=e[a]||k(i,r,s);n[o.o9]=i(),l.__(t,((e,t)=>{n[t]=e})),e[a]=n}}function I(e,t,i,r,s){const a=`__$__${t}`;return function(t){let n=e[a]||w(i,r,s);n[o.o9]=i(),l.__(t,((e,t)=>{n[t]=e})),e[a]=n}}function _(e,t){let i=c.Pc(t)?t.prototype:t;const r={};for(r[o.o9]=e,Object.setPrototypeOf(r,i);;){let e=i[o.JY];if(e&&e.forEach(((e,t)=>{e[3]?e[1]?u(r,t,x((()=>r[o.o9]+e[7]),r,t,e[4],e[0]),I(r,t,(()=>r[o.o9]+e[7]),e[4],20)):c.Pc(e[0])||c.Ik(e[0])?u(r,t,x((()=>r[o.o9]+e[7]),r,t,e[4],e[0]),T(r,t,(()=>r[o.o9]+e[7]),e[4],e[0])):u(r,t,x((()=>r[o.o9]+e[7]),r,t,e[4],e[0]),I(r,t,(()=>r[o.o9]+e[7]),e[4],e[0])):e[1]?u(r,t,f((()=>r[o.o9]+e[7])),A((()=>r[o.o9]+e[7]))):c.Pc(e[0])||c.Ik(e[0])?u(r,t,p(r,t,(()=>r[o.o9]+e[7]),e[0]),v(r,t,(()=>r[o.o9]+e[7]),e[0])):e[5]?u(r,t,g((()=>r[o.o9]+e[7]),e[0],e[6],e[8]),b((()=>r[o.o9]+e[7]),e[0],e[6],e[8])):u(r,t,m((()=>r[o.o9]+e[7]),e[0]),y((()=>r[o.o9]+e[7]),e[0]))})),i=Object.getPrototypeOf(i),!i)break}return r}function P(e){let t=Object.getPrototypeOf(e);for(;;){let i=t[o.JY];if(i&&i.forEach(((t,i)=>{delete e[i]})),t=Object.getPrototypeOf(t),!t)break}}},86220:(e,t,i)=>{function r(e,t,i){Object.defineProperty(e,t,{value:i,writable:!1,enumerable:!1,configurable:!1})}i.d(t,{A:()=>r})},46784:(e,t,i)=>{function r(e,t,i){throw new Error("unimplemented")}i.d(t,{A:()=>r})},33740:(e,t,i)=>{i.d(t,{GE:()=>w,Lv:()=>V,Tg:()=>q,XI:()=>I,ce:()=>P,eq:()=>g,pv:()=>H,s_:()=>_,wE:()=>x});var r=i(15660),s=i(99338),a=i(84799),o=i(75176),n=i(22448),h=i(71545),d=i(91621),c=i(62123),l=i(7310),u=i(71195),f=i(77969),p=i(47845),m=i(59087);let g,A,v,y=-1,b=!0,k="",w=null,x=null,T=0,I=null,_=null,P=null,M=null,S=null,C=null,R=null,B=null,D=null,E=null,U=null,L=null,$={5:B,3:B,7:D,9:E,22:U,12:M,14:S,16:C,21:R};function F(){return!(!P||P.buffer===B.buffer)}function V(){return P.buffer}function N(){return F()&&W(P.buffer),B}function O(){return F()&&W(P.buffer),L}function z(e){return F()&&W(P.buffer),$[e]}function G(){o.USE_THREADS?(g=N,A=O,v=z):(g=()=>B,A=()=>L,v=e=>$[e])}function W(e){M=new Int8Array(e),S=new Int16Array(e),C=new Int32Array(e),R=new BigInt64Array(e),B=new Uint8Array(e),D=new Uint16Array(e),E=new Uint32Array(e),U=new BigUint64Array(e),L=new DataView(e),$={5:B,3:B,7:D,9:E,22:U,12:M,14:S,16:C,21:R}}function H(){return Atomics.add(E,n.hb>>>2,1)}async function q(e){var t;G(),(0,l.A)((()=>_),A),(0,h.A)(v),P=e.memory,e.disableAsm||("function"==typeof BigInt&&BigInt!==Number&&(u.A.chrome&&u.A.checkVersion(u.A.majorVersion,"85",!0)||u.A.firefox&&u.A.checkVersion(u.A.majorVersion,"78",!0)||u.A.safari&&u.A.checkVersion(u.A.majorVersion,"15",!0)||f.A.ios&&u.A.checkVersion(f.A.version,"15",!0)||u.A.newEdge)&&d.Ts(P,o.HEAP_INITIAL,o.HEAP_MAXIMUM),(u.A.chrome&&u.A.checkVersion(u.A.majorVersion,"85",!0)||u.A.firefox&&u.A.checkVersion(u.A.majorVersion,"78",!0)||u.A.safari&&u.A.checkVersion(u.A.majorVersion,"15",!0)||f.A.ios&&u.A.checkVersion(f.A.version,"15",!0)||u.A.newEdge)&&c.Ts(P,o.HEAP_INITIAL,o.HEAP_MAXIMUM));var i;i=new r.A({buffer:P.buffer,memory:P,byteOffset:o.HEAP_OFFSET,maxHeapSize:64*o.HEAP_MAXIMUM*1024,growAllowed:!0,onResize:(e,t)=>(P.grow(t-e.byteLength>>>16),{buffer:P.buffer,byteOffset:o.HEAP_OFFSET})},!1),_&&_.removeUpdateHandle(W),_=i,a.TK.CHeap&&(a.TK.CHeap.Allocator=_),_.addUpdateHandle(W),W(_.getBuffer()),e.stackPointer&&(T=e.stackSize,x=e.stackPointer,w=new WebAssembly.Global({value:"i32",mutable:!0},x+T),I=new s.z),y="number"==typeof e.id?e.id:Atomics.add(E,n.hb>>>2,1),k=null!==(t=e.name)&&void 0!==t?t:"anonymous",a.TK.CHeap={initThread:q,Allocator:_,Table:I,ThreadId:y,ThreadName:k,Memory:P,Config:o,StackSize:T,StackTop:x,StackPointer:w,isMainThread:!1},b=!1}!(0,p.A)()&&!(0,m.A)()||(0,p.A)()&&!o.USE_THREADS?function(){var e,t,i,p,m,g,M,S;if(G(),(0,l.A)((()=>_),A),(0,h.A)(v),P=null!==(e=a.TK.CHeap)&&void 0!==e&&e.Memory?a.TK.CHeap.Memory:new WebAssembly.Memory({initial:o.HEAP_INITIAL,maximum:o.HEAP_MAXIMUM,shared:o.USE_THREADS,address:"i32",index:"i32"}),"function"==typeof BigInt&&BigInt!==Number&&(u.A.chrome&&u.A.checkVersion(u.A.majorVersion,"85",!0)||u.A.firefox&&u.A.checkVersion(u.A.majorVersion,"78",!0)||u.A.safari&&u.A.checkVersion(u.A.majorVersion,"15",!0)||f.A.ios&&u.A.checkVersion(f.A.version,"15",!0)||u.A.newEdge)&&o.USE_THREADS&&d.Ts(P,o.HEAP_INITIAL,o.HEAP_MAXIMUM),o.USE_THREADS&&(u.A.chrome&&u.A.checkVersion(u.A.majorVersion,"85",!0)||u.A.firefox&&u.A.checkVersion(u.A.majorVersion,"78",!0)||u.A.safari&&u.A.checkVersion(u.A.majorVersion,"15",!0)||f.A.ios&&u.A.checkVersion(f.A.version,"15",!0)||u.A.newEdge)&&c.Ts(P,o.HEAP_INITIAL,o.HEAP_MAXIMUM),_=null!==(t=a.TK.CHeap)&&void 0!==t&&t.Allocator?a.TK.CHeap.Allocator:new r.A({buffer:P.buffer,memory:P,byteOffset:o.HEAP_OFFSET,maxHeapSize:64*o.HEAP_MAXIMUM*1024,growAllowed:!0,onResize:(e,t)=>(P.grow(t-e.byteLength>>>16),{buffer:P.buffer,byteOffset:o.HEAP_OFFSET})}),_.addUpdateHandle(W),W(_.getBuffer()),T=null!==(i=a.TK.CHeap)&&void 0!==i&&i.StackSize?a.TK.CHeap.StackSize:o.STACK_SIZE,x=null!==(p=a.TK.CHeap)&&void 0!==p&&p.StackTop?a.TK.CHeap.StackTop:_.malloc(T),w=null!==(m=a.TK.CHeap)&&void 0!==m&&m.StackPointer?a.TK.CHeap.StackPointer:new WebAssembly.Global({value:"i32",mutable:!0},x+T),I=null!==(g=a.TK.CHeap)&&void 0!==g&&g.Table?a.TK.CHeap.Table:new s.z,y=null!==(M=a.TK.CHeap)&&void 0!==M&&M.ThreadId?a.TK.CHeap.ThreadId:0,k=null!==(S=a.TK.CHeap)&&void 0!==S&&S.ThreadName?a.TK.CHeap.ThreadName:"main",!a.TK.CHeap)if(o.USE_THREADS)Atomics.store(E,n.hb>>>2,y+1),Atomics.store(C,n.II>>>2,0);else{E[n.hb>>>2]=y+1;let e=n.II>>>2;C[e]=0}a.TK.CHeap||(a.TK.CHeap={Allocator:_,Table:I,ThreadId:y,ThreadName:k,Memory:P,Config:o,StackSize:T,StackTop:x,StackPointer:w,isMainThread:!0}),b=!0}():(a.TK.CHeap={initThread:q,isMainThread:!1,Config:o},b=!1)},1545:(e,t,i)=>{i.d(t,{I_:()=>m,SQ:()=>g});var r=i(24692),s=i(42524),a=i(77389),o=i(75354),n=i(20723),h=i(3315),d=i(81819),c=i(25092),l=i(17630);const u=Object.getPrototypeOf({});function f(e,t){for(;;){let i=e[o.JY];if(i){const e=i.get(t);if(e)return e}if(!(e=Object.getPrototypeOf(e))||e===u)return null}}function p(e,t,i,n){const l={};l[o.o9]=e;let u=(0,r.A)(n?20:i);return new Proxy(l,{get(e,t,r){if(t===o.o9)return e[o.o9];const a=(0,h.A)(t);return n?s.f[20](e[o.o9]+a*u):d.Pc(i)?e[t]:s.f[i](e[o.o9]+a*u)},set(e,t,r,s){if(t===o.o9)return e[o.o9]=r,!0;const l=(0,h.A)(t);if(n)a.M[20](e[o.o9]+l*u,r),e[t]=r;else if(d.Pc(i)){const s=e[t]||(e[t]=m(e[o.o9]+l*u,i));c.__(r,((e,t)=>{s[t]=e})),e[t]=s}else a.M[i](e[o.o9]+l*u,r),e[t]=r;return!0}})}function m(e,t){const i=d.Pc(t)?t.prototype:t,r={};r[o.o9]=e,Object.setPrototypeOf(r,i);const{proxy:h,revoke:u}=Proxy.revocable(r,{get(e,t,r){if(d.Yj(t)){const r=f(i,t.replace(/^\$+/,""));if(r){const i=e[o.o9]+r[7];if(r[3]){let s=e[t];return s||(s=p(i,r[4],r[0],r[1]),e[t]=s),s[o.o9]=i,s}if(r[1])return s.f[20](i);if(d.Pc(r[0])||d.Ik(r[0]))return e[t]||(e[t]=m(i,r[0]));{let e=s.f[r[0]](i);return r[5]&&(e=e>>>8*n.i[r[0]]-r[8]-r[6]&Math.pow(2,r[6])-1),e}}return e[t]}return e[t]},set(e,t,r,h){if(d.Yj(t)){const h=f(i,t.replace(/^\$+/,""));if(h){const i=e[o.o9]+h[7];if(h[3]){const s=e[t]||p(i,h[4],h[0],h[1]);l.__(r,((e,t)=>{s[t]=e})),e[t]=s}else if(h[1])a.M[20](i,r),e[t]=r;else if(d.Pc(h[0])||d.Ik(h[0])){const s=e[t]||(e[t]=m(i,h[0]));c.__(r,((e,t)=>{s[t]=e})),e[t]=s}else{if(h[5]){let e=0,t=8*n.i[h[0]];for(let i=0;i<h[6];i++)e|=1<<t-1-(i+h[8]);const o=s.f[h[0]](i);a.M[h[0]](i,o&~e|(r&Math.pow(2,h[6])-1)<<t-h[8]-h[6])}else a.M[h[0]](i,r);e[t]=r}}else e[t]=r}else e[t]=r;return!0},getOwnPropertyDescriptor:(e,t)=>({enumerable:!0,configurable:!0}),ownKeys:e=>Array.from(e[o.JY].keys())});return r[o.kE]=u,h}function g(e){const t=e[o.kE];t&&t()}},65772:(e,t,i)=>{i.d(t,{t:()=>a,z:()=>s});var r=i(33740);function s(e){return r.GE.value=r.GE.value-e,r.GE.value}function a(e){r.GE.value=r.GE.value+e}},22448:(e,t,i)=>{i.d(t,{II:()=>o,hb:()=>a,hf:()=>n});let r=4;function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=r;for(;i%t;)i+=1;return r=i+e,i}const a=s(4,4),o=s(4,4),n=s(4,4);s(8,8)},53773:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(19371),s=i(42524),a=i(77389),o=i(33740),n=i(5752),h=i(75176);class d{constructor(e,t){(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"len",void 0),(0,r.A)(this,"view",void 0),this.pointer=e,this.len=t}get byteLength(){return this.len}get buffer(){return o.Lv}get byteOffset(){return this.pointer}getView(){return this.view&&this.view.buffer===o.ce.buffer||(this.view=new DataView((0,o.Lv)(),this.pointer,this.len)),this.view}getFloat32(e,t){return this.getView().getFloat32(e,t)}getFloat64(e,t){return this.getView().getFloat64(e,t)}getInt8(e){return this.getView().getInt8(e)}getInt16(e,t){return this.getView().getInt16(e,t)}getInt32(e,t){return this.getView().getInt32(e,t)}getUint8(e){return this.getView().getUint8(e)}getUint16(e,t){return this.getView().getUint16(e,t)}getUint32(e,t){return this.getView().getUint32(e,t)}setFloat32(e,t,i){this.getView().setFloat32(e,t,i)}setFloat64(e,t,i){this.getView().setFloat64(e,t,i)}setInt8(e,t){this.getView().setInt8(e,t)}setInt16(e,t,i){this.getView().setInt16(e,t,i)}setInt32(e,t,i){this.getView().setInt32(e,t,i)}setUint8(e,t){this.getView().setUint8(e,t)}setUint16(e,t,i){this.getView().setUint16(e,t,i)}setUint32(e,t,i){this.getView().setUint32(e,t,i)}getBigInt64(e,t){return this.getView().getBigInt64(e,t)}getBigUint64(e,t){return this.getView().getBigUint64(e,t)}setBigInt64(e,t,i){this.getView().setBigInt64(e,t,i)}setBigUint64(e,t,i){this.getView().setBigUint64(e,t,i)}}class c extends n.A{constructor(e,t){return super(),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"len",void 0),this.pointer=e,this.len=t,this.proxy}getIndexValue(e){return s.f[2](this.pointer+e)}setIndexValue(e,t){a.M[2](this.pointer+e,t)}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;new Uint8Array((0,o.Lv)(),this.pointer,this.len).set(e,t)}subarray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return(arguments.length>2?arguments[2]:void 0)&&!h.USE_THREADS?new c(this.pointer+e,(t||this.len)-e):new Uint8Array((0,o.Lv)(),this.pointer+e,(null!=t?t:this.len)-e)}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return new Uint8Array((0,o.Lv)(),this.pointer+e,(null!=t?t:this.len)-e).slice()}get length(){return this.len}get byteLength(){return this.len}get buffer(){return(0,o.Lv)()}get byteOffset(){return this.pointer}get view(){return new d(this.pointer,this.len)}}},54911:(e,t,i)=>{i.d(t,{A:()=>g});var r,s,a=i(19371),o=i(75354),n=i(86220),h=i(33740),d=i(42524),c=i(77389),l=i(24692),u=i(41863),f=i(81819),p=i(75589);class m{constructor(){(0,a.A)(this,"prev",void 0),(0,a.A)(this,"next",void 0),(0,a.A)(this,"data",void 0)}}r=m,(()=>{const e=r.prototype,t=new Map;t.set("prev",{0:r,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("next",{0:r,1:1,2:1,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("data",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:8,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,4),(0,n.A)(e,o.g7,12),(0,n.A)(e,o.JY,t)})();class g{constructor(){(0,a.A)(this,"length",0),(0,a.A)(this,"head",0),(0,a.A)(this,"tail",0)}createNode(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=h.s_.malloc(12);if(c.M[20](r+4,0),c.M[20](r,0),f.ai(t))if(20===t)c.M[20](r+8,e);else{const i=h.s_.malloc((0,l.A)(t));c.M[t](i,e),c.M[20](r+8,i)}else if(i)c.M[20](r+8,e);else{const i=h.s_.malloc((0,l.A)(t));(0,u.Mr)(i,e[o.o9],(0,l.A)(t)),c.M[20](r+8,i)}return r}getItem(e,t){let i;return i=f.ai(t)?20===t?e:d.f[t](e):(0,p.A)(e,t),i}push(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.createNode(e,t,i);this.tail?(c.M[20](this.tail+4,r),c.M[20](r,this.tail),this.tail=r):(this.head=r,this.tail=r),this.length++}pop(e){const t=this.tail;let i=this.getItem(d.f[20](t+8),e);return this.length>1?(c.M[20](d.f[20](t)+4,0),this.tail=d.f[20](t)):(this.head=0,this.tail=0),this.length--,h.s_.free(d.f[20](t+8)),h.s_.free(t),i}shift(e){const t=this.head;let i=this.getItem(d.f[20](t+8),e);return this.length>1?(c.M[20](d.f[20](t+4),0),this.head=d.f[20](t+4)):(this.head=0,this.tail=0),this.length--,h.s_.free(d.f[20](t+8)),h.s_.free(t),i}unshift(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.createNode(e,t,i);this.head?(c.M[20](this.head,r),c.M[20](r+4,this.head),this.head=r):(this.head=r,this.tail=r),this.length++}forEach(e,t){if(!this.length)return;let i=this.head,r=0;for(;0!==i&&!1!==e(this.getItem(d.f[20](i+8),t),r);)i=d.f[20](i+4),r++}find(e,t){if(!this.length)return 0;let i=this.head,r=0;for(;0!==i;){const s=this.getItem(d.f[20](i+8),t);if(!0===e(s,r))return s;i=d.f[20](i+4),r++}return 0}indexOf(e,t){if(!this.length)return 0;let i=this.head,r=0;for(;0!==i;){if(r===e)return this.getItem(d.f[20](i+8),t);i=d.f[20](i+4),r++}return 0}clear(e,t){if(this.length){let i=this.head;for(;0!==i;){e&&e(this.getItem(d.f[20](i+8),t)),h.s_.free(d.f[20](i+8));const r=d.f[20](i+4);h.s_.free(i),i=r}}this.head=0,this.tail=0,this.length=0}}s=g,(()=>{const e=s.prototype,t=new Map;t.set("length",{0:8,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("head",{0:m,1:1,2:1,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("tail",{0:m,1:1,2:1,3:0,4:0,5:0,6:0,7:8,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,4),(0,n.A)(e,o.g7,12),(0,n.A)(e,o.JY,t)})()},23734:(e,t,i)=>{let r;function s(e){r.getRandomValues(e)}i.d(t,{A:()=>s}),"undefined"!=typeof crypto&&(r=crypto)},37523:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(22448),s=i(53971);function a(){return s.WQ(r.hf,1,9,2)}},2198:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(81819);function s(e){return r.ai(e)&&e>=0}},11846:(e,t,i)=>{i.d(t,{A:()=>d});var r=i(24692),s=i(33740),a=i(41863),o=i(75589),n=i(65992),h=i(25092);function d(e,t){(0,n.A)(t)||(t=e,e=null);const i=(0,r.A)(t),d=s.s_.malloc(i);if(!d)throw new TypeError("cannot alloc memory for struct");(0,a.sO)(d,0,i);const c=(0,o.A)(d,t),l=new t;return e&&h.X$(l,e),h.__(l,((e,t)=>{(0,n.A)(e)&&(c[t]=e)})),c}},75589:(e,t,i)=>{i.d(t,{A:()=>d});var r=i(75354),s=i(1545),a=i(39372),o=i(81819),n=i(94447),h=i(24788);function d(e,t){return arguments[2]&&o.Yj(arguments[2])&&(t=t.prototype,n.__(arguments[2],(e=>{const i=t[r.JY];t=i.get(e)[0]}))),h.A.proxy?(0,s.I_)(e,t):(0,a.l)(e,t)}},41863:(e,t,i)=>{i.d(t,{JW:()=>u,Mr:()=>d,bg:()=>p,lH:()=>m,lW:()=>c,qW:()=>g,s3:()=>f,sO:()=>l});var r=i(33740),s=i(4068),a=i(77389),o=i(53773),n=i(75176),h=i(42524);function d(e,t,i){(0,r.eq)().set((0,r.eq)().subarray(t,t+i),e)}function c(e,t,i){(0,r.eq)().set(i.subarray(0,t),e)}function l(e,t,i){(0,r.eq)().subarray(e,e+i).fill(t)}function u(e,t){return n.USE_THREADS?f(e,t):new o.A(e,t)}function f(e,t){return new Uint8Array((0,r.Lv)(),e,t)}function p(e,t){return new Uint16Array((0,r.Lv)(),e,t)}function m(e,t){let i=0;for(;h.f[4]((e+=1)-1)&&(i++,!(t&&i>=t)););const r=Math.min(i,null!=t?t:i);return s.decode(f(e,r))}function g(e,t,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=s.encode(t);let n=o.length,h=r?1:0;i&&n-h>i&&(n=i-h),c(e,n,o),r&&a.M[11](e+n,0)}},55606:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(75354);function s(e){e[r.o9]=0}},24692:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(75354),s=i(81819),a=i(20723);function o(e){return s.ai(e)?a.i[e]||0:s.Pc(e)&&e.prototype[r.Og]?e.prototype[r.g7]:0}},93793:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(33740),s=i(75354),a=i(1545),o=i(39372),n=i(24788);function h(e){const t=e[s.o9];t&&(r.s_.free(t),e[s.o9]=0,n.A.proxy?(0,a.SQ)(e):(0,o.X)(e))}},75354:(e,t,i)=>{i.d(t,{JY:()=>n,Og:()=>r,dc:()=>a,g7:()=>s,kE:()=>h,o9:()=>o});const r=Symbol("Struct"),s=Symbol("StructLength"),a=Symbol("StructMaxBaseTypeByteLength"),o=Symbol("StructAddress"),n=(Symbol("StructKeysQueue"),Symbol("StructKeysMeta")),h=(Symbol("StructKeysInstance"),Symbol("StructProxyRevoke"))},12450:(e,t,i)=>{i.d(t,{A:()=>r});const r="AGFzbQEAAAABLAdgAX8Bf2ABfwF+YAJ/fwF/YAJ/fgF+YAN/f38Bf2ADf35+AX5gA39/fgF/AhIBA2VudgZtZW1vcnkCAwGAgAQDKCcAAAABAgICAwICAgMCAgIDAgICAwICAgMCAgIDAgICAwQEBAUCAgYHhgMnBWxvYWQ4AAAGbG9hZDE2AAEGbG9hZDMyAAIGbG9hZDY0AAMGc3RvcmU4AAQHc3RvcmUxNgAFB3N0b3JlMzIABgdzdG9yZTY0AAcEYWRkOAAIBWFkZDE2AAkFYWRkMzIACgVhZGQ2NAALBHN1YjgADAVzdWIxNgANBXN1YjMyAA4Fc3ViNjQADwRhbmQ4ABAFYW5kMTYAEQVhbmQzMgASBWFuZDY0ABMDb3I4ABQEb3IxNgAVBG9yMzIAFgRvcjY0ABcEeG9yOAAYBXhvcjE2ABkFeG9yMzIAGgV4b3I2NAAbCWV4Y2hhbmdlOAAcCmV4Y2hhbmdlMTYAHQpleGNoYW5nZTMyAB4KZXhjaGFuZ2U2NAAfEWNvbXBhcmVfZXhjaGFuZ2U4ACASY29tcGFyZV9leGNoYW5nZTE2ACESY29tcGFyZV9leGNoYW5nZTMyACISY29tcGFyZV9leGNoYW5nZTY0ACMGbm90aWZ5ACQEd2FpdAAlC3dhaXRUaW1lb3V0ACYKugMnCAAgAP4SAAALCAAgAP4TAQALCAAgAP4QAgALCAAgAP4RAwALDAAgACAB/hkAACABCwwAIAAgAf4aAQAgAQsMACAAIAH+FwIAIAELDAAgACAB/hgDACABCwoAIAAgAf4gAAALCgAgACAB/iEBAAsKACAAIAH+HgIACwoAIAAgAf4fAwALCgAgACAB/icAAAsKACAAIAH+KAEACwoAIAAgAf4lAgALCgAgACAB/iYDAAsKACAAIAH+LgAACwoAIAAgAf4vAQALCgAgACAB/iwCAAsKACAAIAH+LQMACwoAIAAgAf41AAALCgAgACAB/jYBAAsKACAAIAH+MwIACwoAIAAgAf40AwALCgAgACAB/jwAAAsKACAAIAH+PQEACwoAIAAgAf46AgALCgAgACAB/jsDAAsKACAAIAH+QwAACwoAIAAgAf5EAQALCgAgACAB/kECAAsKACAAIAH+QgMACwwAIAAgASAC/koAAAsMACAAIAEgAv5LAQALDAAgACABIAL+SAIACwwAIAAgASAC/kkDAAsKACAAIAH+AAIACwwAIAAgAUJ//gECAAsMACAAIAEgAv4BAgAL"},62123:(e,t,i)=>{i.d(t,{KJ:()=>d,Ko:()=>c,Ts:()=>l});var r=i(46647),s=i(18152),a=i(87339),o=i(12450),n=i(53971);const h="packages/cheap/src/thread/asm/atomics.ts";let d;function c(){return!!d}function l(e,t,i){try{if(!("function"==typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer))return;{const a=r.bx(s.E_(o.A),{shared:!0,initial:t,maximum:i});d=new WebAssembly.Instance(new WebAssembly.Module(a),{env:{memory:e}})}(0,n.$Z)({add:function(e,t,i){switch(i){case 5:case 3:return 255&d.exports.add8(e,t);case 12:return d.exports.add8(e,t);case 14:return d.exports.add16(e,t);case 7:return 65535&d.exports.add16(e,t);case 16:return d.exports.add32(e,t);case 9:return 4294967295&d.exports.add32(e,t);case 21:return d.exports.add64(e,t);case 22:return BigInt.asUintN(64,d.exports.add64(e,t))}},sub:function(e,t,i){switch(i){case 5:case 3:return 255&d.exports.sub8(e,t);case 12:return d.exports.sub8(e,t);case 14:return d.exports.sub16(e,t);case 7:return 65535&d.exports.sub16(e,t);case 16:return d.exports.sub32(e,t);case 9:return 4294967295&d.exports.sub32(e,t);case 21:return d.exports.sub64(e,t);case 22:return BigInt.asUintN(64,d.exports.sub64(e,t))}},and:function(e,t,i){switch(i){case 5:case 3:return 255&d.exports.and8(e,t);case 12:return d.exports.and8(e,t);case 14:return d.exports.and16(e,t);case 7:return 65535&d.exports.and16(e,t);case 16:return d.exports.and32(e,t);case 9:return 4294967295&d.exports.and32(e,t);case 21:return d.exports.and64(e,t);case 22:return BigInt.asUintN(64,d.exports.and64(e,t))}},or:function(e,t,i){switch(i){case 5:case 3:return 255&d.exports.or8(e,t);case 12:return d.exports.or8(e,t);case 14:return d.exports.or16(e,t);case 7:return 65535&d.exports.or16(e,t);case 16:case 9:return d.exports.or32(e,t);case 21:return d.exports.or64(e,t);case 22:return BigInt.asUintN(64,d.exports.or64(e,t))}},xor:function(e,t,i){switch(i){case 5:case 3:return 255&d.exports.xor8(e,t);case 12:return d.exports.xor8(e,t);case 14:return d.exports.xor16(e,t);case 7:return 65535&d.exports.xor16(e,t);case 16:case 9:return d.exports.xor32(e,t);case 21:return d.exports.xor64(e,t);case 22:return BigInt.asUintN(64,d.exports.xor64(e,t))}},store:function(e,t,i){switch(i){case 5:case 12:case 3:return d.exports.store8(e,t);case 14:case 7:return d.exports.store16(e,t);case 16:case 9:return d.exports.store32(e,t);case 21:case 22:return d.exports.store64(e,t)}},load:function(e,t){switch(t){case 5:case 3:return 255&d.exports.load8(e);case 12:return d.exports.load8(e);case 14:case 7:return d.exports.load16(e);case 16:return d.exports.load32(e);case 9:return 4294967295&d.exports.load32(e);case 21:return d.exports.load64(e);case 22:return BigInt.asUintN(64,d.exports.load64(e))}},compareExchange:function(e,t,i,r){switch(r){case 5:case 3:return 255&d.exports.compare_exchange8(e,t,i);case 12:return d.exports.compare_exchange8(e,t,i);case 14:return d.exports.compare_exchange16(e,t,i);case 7:return 65535&d.exports.compare_exchange16(e,t,i);case 16:return d.exports.compare_exchange32(e,t,i);case 9:return 4294967295&d.exports.compare_exchange32(e,t,i);case 21:return d.exports.compare_exchange64(e,t,i);case 22:return BigInt.asUintN(64,d.exports.compare_exchange64(e,t,i))}},exchange:function(e,t,i){switch(i){case 5:case 3:return 255&d.exports.exchange8(e,t);case 12:return d.exports.exchange8(e,t);case 14:return d.exports.exchange16(e,t);case 7:return 65535&d.exports.exchange16(e,t);case 16:return d.exports.exchange32(e,t);case 9:return 4294967295&d.exports.exchange32(e,t);case 21:return d.exports.exchange64(e,t);case 22:return BigInt.asUintN(64,d.exports.exchange64(e,t))}},notify:function(e,t){return d.exports.notify(e,t)},wait:function(e,t){return d.exports.wait(e,t)},waitTimeout:function(e,t,i){return d.exports.waitTimeout(e,t,BigInt(0|i)*BigInt(1e6))}})}catch(e){a.R8("atomics asm not support, cannot use asm atomics function",h,289)}}},53971:(e,t,i)=>{let r,s,a,o,n,h,d,c,l,u,f,p,m,g;function A(e){e.add&&(r=e.add),e.sub&&(s=e.sub),e.and&&(a=e.and),e.or&&(o=e.or),e.xor&&(n=e.xor),e.store&&(h=e.store),e.load&&(d=e.load),e.compareExchange&&(c=e.compareExchange),e.exchange&&(l=e.exchange),e.notify&&(u=e.notify),e.wait&&(f=e.wait),e.waitTimeout&&(p=e.waitTimeout),e.waitAsync&&(m=e.waitAsync),e.waitTimeoutAsync&&(g=e.waitTimeoutAsync)}i.d(t,{$Z:()=>A,Hh:()=>d,I8:()=>n,M_:()=>h,R_:()=>g,Uo:()=>a,WQ:()=>r,cv:()=>l,j4:()=>p,jb:()=>s,me:()=>u,of:()=>m,or:()=>o,p_:()=>c,uk:()=>f})},71545:(e,t,i)=>{i.d(t,{A:()=>_});var r=i(53971),s=i(75176),a=i(71195),o=i(24788),n=i(32347),h=i(16563);let d;const c=s.USE_THREADS||!a.A.chrome&&o.A.atomics||a.A.checkVersion(a.A.majorVersion,"94",!0);function l(e,t,i,r){if(c)return Atomics.add(d(i),e>>>r,t);{const s=d(i),a=e>>>r,o=s[a];return s[a]+=t,o}}function u(e,t,i,r){if(c)return Atomics.sub(d(i),e>>>r,t);{const s=d(i),a=e>>>r,o=s[a];return s[a]-=t,o}}function f(e,t,i,r){if(c)return Atomics.and(d(i),e>>>r,t);{const s=d(i),a=e>>>r,o=s[a];return s[a]&=t,o}}function p(e,t,i,r){if(c)return Atomics.or(d(i),e>>>r,t);{const s=d(i),a=e>>>r,o=s[a];return s[a]|=t,o}}function m(e,t,i,r){if(c)return Atomics.xor(d(i),e>>>r,t);{const s=d(i),a=e>>>r,o=s[a];return s[a]^=t,o}}function g(e,t,i,r){if(c)return Atomics.store(d(i),e>>>r,t);{const s=d(i),a=e>>>r,o=s[a];return s[a]=t,o}}function A(e,t,i){return c?Atomics.load(d(t),e>>>i):d(t)[e>>>i]}function v(e,t,i,r,s){if(c)return Atomics.compareExchange(d(r),e>>>s,t,i);{const a=d(r),o=e>>>s,n=a[o];return n===t&&(a[o]=i),n}}function y(e,t,i,r){if(c)return Atomics.exchange(d(i),e>>>r,t);{const s=d(i),a=e>>>r,o=s[a];return s[a]=t,o}}function b(e,t){return c?Atomics.notify(d(16),e>>>2,t):void 0}const k={ok:0,"not-equal":1,"timed-out":2};function w(e,t){return k[Atomics.wait(d(16),e>>>2,t)]}function x(e,t,i){return k[Atomics.wait(d(16),e>>>2,t,i)]}async function T(e,t){if(Atomics.waitAsync){const i=Atomics.waitAsync(d(16),e>>>2,t);return i.async?k[await i.value]:k[i.value]}if(A(e)!==t)return 1;for(;A(e)===t;)await new Promise((e=>{(0,n.A)((()=>{e()}))}));return 0}async function I(e,t,i){if(Atomics.waitAsync){const r=Atomics.waitAsync(d(16),e>>>2,t,i);return r.async?k[await r.value]:k[r.value]}if(A(e)!==t)return 1;{const r=(0,h.A)();for(;A(e)===t&&(0,h.A)()-r<i;)await new Promise((e=>{(0,n.A)((()=>{e()}))}));return A(e)!==t?0:2}}function _(e){d=e,(0,r.$Z)({add:l,sub:u,and:f,or:p,xor:m,store:g,load:A,compareExchange:v,exchange:y,notify:b,wait:w,waitTimeout:x,waitAsync:T,waitTimeoutAsync:I})}},773:(e,t,i)=>{i.d(t,{Ts:()=>d,XR:()=>m,fs:()=>g,mq:()=>u,of:()=>p,uk:()=>f,vP:()=>l,zr:()=>c});var r,s=i(19371),a=i(75354),o=i(86220),n=i(59502),h=i(53971);function d(e,t){return h.M_(e,0,16,2),0}function c(e){return h.M_(e,0,16,2),0}function l(e){return h.WQ(e,1,16,2),h.me(e,1),0}function u(e){return h.WQ(e,1,16,2),h.me(e,1073741824),0}function f(e,t){let i=h.Hh(e,16,2);return n.Tl(t),h.uk(e,i),n.s2(t),0}async function p(e,t){let i=h.Hh(e,16,2);return n.Tl(t),await h.of(e,i),await n.yh(t),0}function m(e,t,i){let r=h.Hh(e,16,2);n.Tl(t);let s=h.j4(e,r,i);return n.s2(t),2===s?110:0}async function g(e,t,i){let r=h.Hh(e,16,2);n.Tl(t);let s=await h.R_(e,r,i);return await n.yh(t),2===s?110:0}r=class{constructor(){(0,s.A)(this,"atomic",void 0)}},(()=>{const e=r.prototype,t=new Map;t.set("atomic",{0:16,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,4),(0,o.A)(e,a.g7,4),(0,o.A)(e,a.JY,t)})()},32948:(e,t,i)=>{i.r(t),i.d(t,{default:()=>n});var r=i(84799),s=i(81819),a=i(85266);let o=r.TK;function n(e){let t,i;o.onmessage=n=>{const h=n.data,d=h.type,c=h.data;switch(d){case"init":if(r.TK.CHeap&&r.TK.CHeap.initThread&&r.TK.CHeap.Config.USE_THREADS)return void r.TK.CHeap.initThread(c).then((()=>{o.postMessage({type:"ready"})}));o.postMessage({type:"ready"});break;case"run":o.postMessage({type:"running"}),i=e(c.params),l=c.port,t=new a.Ay(l),t.on(a.S3,(async e=>{const r=e.method,a=e.params;if(s.Pc(i[r]))try{i[r].transfer||(i[r].transfer=[]);const s=await i[r](...a.params);t.reply(e,s,null,i[r].transfer),i[r].transfer.length=0}catch(i){t.reply(e,-2097152,{message:i.message})}}));break;case"stop":t&&t.destroy(),r.TK.__freeSmartPtr__&&r.TK.__freeSmartPtr__(),o.postMessage({type:"stopped"})}var l}}},45403:(e,t,i)=>{i.r(t),i.d(t,{default:()=>a});var r=i(84799);let s=r.TK;function a(e){let t;s.onmessage=i=>{const a=i.data,o=a.type,n=a.data;switch(o){case"init":if(r.TK.CHeap&&r.TK.CHeap.initThread&&r.TK.CHeap.Config.USE_THREADS)return void r.TK.CHeap.initThread(n).then((()=>{s.postMessage({type:"ready"})}));s.postMessage({type:"ready"});break;case"run":t=e(n.params);break;case"stop":t&&t.then?t.then((e=>{r.TK.__freeSmartPtr__&&r.TK.__freeSmartPtr__(),s.postMessage({type:"stopped",data:e})})):(r.TK.__freeSmartPtr__&&r.TK.__freeSmartPtr__(),s.postMessage({type:"stopped",data:t}))}}}},59251:(e,t,i)=>{i.r(t),i.d(t,{default:()=>n});var r=i(84799),s=i(81819),a=i(85266);let o=r.TK;function n(e){let t;o.onmessage=i=>{const n=i.data,h=n.type,d=n.data;switch(h){case"init":if(r.TK.CHeap&&r.TK.CHeap.initThread&&r.TK.CHeap.Config.USE_THREADS)return void r.TK.CHeap.initThread(d).then((()=>{o.postMessage({type:"ready"})}));o.postMessage({type:"ready"});break;case"run":o.postMessage({type:"running"}),c=d.port,t=new a.Ay(c),t.on(a.S3,(async i=>{const r=i.method,a=i.params;if(s.Pc(e[r]))try{e[r].transfer||(e[r].transfer=[]);const s=await e[r](...a.params);t.reply(i,s,null,e[r].transfer),e[r].transfer.length=0}catch(e){t.reply(i,-2097152,{message:e.message})}}));break;case"stop":t&&t.destroy(),r.TK.__freeSmartPtr__&&r.TK.__freeSmartPtr__(),o.postMessage({type:"stopped"})}var c}}},59502:(e,t,i)=>{i.d(t,{Tl:()=>p,Ts:()=>c,bh:()=>u,eu:()=>d,s2:()=>l,yh:()=>f,zr:()=>m});var r,s=i(19371),a=i(75354),o=i(86220),n=i(53971),h=i(47845);class d{constructor(){(0,s.A)(this,"atomic",void 0)}}function c(e){return n.M_(e,0,16,2),0}function l(e){let t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==(t=n.p_(e,0,1,16,2)))do{2!=t&&0===n.p_(e,1,2,16,2)||!i&&(0,h.A)()&&n.uk(e,2)}while(0!==(t=n.p_(e,0,2,16,2)));return 0}function u(e){return 0===n.p_(e,0,1,16,2)?0:16}async function f(e){let t;if(0!==(t=n.p_(e,0,1,16,2)))do{2!=t&&0===n.p_(e,1,2,16,2)||await n.of(e,2)}while(0!==(t=n.p_(e,0,2,16,2)));return 0}function p(e){return 1!==n.jb(e,1,16,2)&&(n.M_(e,0,16,2),n.me(e,1)),0}function m(e){return n.M_(e,0,16,2),0}r=d,(()=>{const e=r.prototype,t=new Map;t.set("atomic",{0:16,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,4),(0,o.A)(e,a.g7,4),(0,o.A)(e,a.JY,t)})()},43847:(e,t,i)=>{i.d(t,{Ts:()=>l,XR:()=>g,Zr:()=>m,bE:()=>f,uk:()=>p,zr:()=>u});var r,s=i(19371),a=i(75354),o=i(86220),n=i(59502),h=i(42524),d=i(77389),c=i(53971);function l(e,t){return c.M_(e,0|t,16,2),n.Ts(e+4),0}function u(e){return n.zr(e+4),0}function f(e){return c.WQ(e,1,16,2),c.me(e,1),0}function p(e){for(;c.uk(e,0),c.jb(e,1,16,2)<=0;)c.WQ(e,1,16,2);return 0}function m(e){return n.s2(e+4),h.f[16](e)>0?(d.M[16](e,h.f[16](e)-1),n.Tl(e+4),0):(n.Tl(e+4),11)}function g(e,t){return 2!==c.j4(e,0,t)&&c.jb(e,1,16,2)<=0?(c.WQ(e,1,16,2),110):0}r=class{constructor(){(0,s.A)(this,"atomic",void 0),(0,s.A)(this,"mutex",void 0)}},(()=>{const e=r.prototype,t=new Map;t.set("atomic",{0:16,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("mutex",{0:n.eu,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,4),(0,o.A)(e,a.g7,8),(0,o.A)(e,a.JY,t)})()},51477:(e,t,i)=>{i.d(t,{nE:()=>v,nx:()=>y,pt:()=>A});var r=i(33740),s=i(75176),a=i(84799),o=i(37688),n=i(546),h=i(81819),d=i(73575),c=i(85266);let l=a.TK.Worker,u=a.TK.MessageChannel;i(32948),i(45403),i(59251);const f=(0,n.A)(32948,{varName:"init"}),p=((0,n.A)(45403,{varName:"init"}),(0,n.A)(59251,{varName:"init"}),Symbol("revoke")),m=new Map;function g(e,t){return`${e}_${t}`}function A(e,t,i){t=t||{},h.Pc(t)&&(i=t,t={});let A,v=[];function y(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=new e(...r);return new Promise((t=>{const r={$worker:null,$ipc:null,$channel:null,$moduleId:(0,d.A)(i),$stackPointer:0,$instance:a,$type:"class"},{proxy:s,revoke:o}=Proxy.revocable(r,{get(t,i,s){if(t[i])return r[i];if(i in e.prototype&&"function"==typeof e.prototype[i]){const e=function(){return a[i](...arguments)};e.transfer=function(){return{invoke:function(){return a[i](...arguments)}}},t[i]=e}return t[i]}});r[p]=o,t(s)}))}return A=function(){for(var A=arguments.length,y=new Array(A),b=0;b<A;b++)y[b]=arguments[b];let k;if(h.Pc(i))k=i();else{let r;const s=g(i,"class");if(m.has(s))r=m.get(s).url,m.get(s).refCount++;else{const t=(0,n.A)(i,{varName:`__module_${e.name}__`,exportName:`__${e.name}__`,pointName:e.name,exportIsClass:!0}),o=`\n            self.CHEAP_DISABLE_THREAD = ${a.TK.CHEAP_DISABLE_THREAD}\n            self.CHEAP_HEAP_INITIAL = ${a.TK.CHEAP_HEAP_INITIAL}\n            self.CHEAP_HEAP_MAXIMUM = ${a.TK.CHEAP_HEAP_MAXIMUM}\n            ${a.TK.CHEAP_POLYFILL_URL?`self.CHEAP_POLYFILL_URL = '${a.TK.CHEAP_POLYFILL_URL}'`:""}\n            ${a.TK.CHEAP_POLYFILL_URL?`importScripts('${a.TK.CHEAP_POLYFILL_URL}');`:""}\n            ${t}\n            function run(params) {\n              params.unshift(null)\n              return new (Function.prototype.bind.apply(__module_${e.name}__.__${e.name}__, params))()\n            }\n            ${f}\n            init.default(run);\n          `;{const e=new Blob([o],{type:"text/javascript"});r=URL.createObjectURL(e)}m.set(s,{url:r,refCount:1})}k=new l(r,t)}const w=new u;return new Promise(((a,n)=>{var h;const l=s.USE_THREADS?r.s_.alignedAlloc(s.STACK_ALIGNMENT,t.stackSize?(0,o.A)(t.stackSize,s.STACK_ALIGNMENT):s.STACK_SIZE):0;k.onmessage=t=>{const r=t.data,s=r.type;switch(r.data,s){case"ready":k.postMessage({type:"run",data:{port:w.port2,params:y}},[w.port2,...v]);break;case"running":!function(){const t=new c.Ay(w.port1),r={$worker:k,$ipc:t,$channel:w,$moduleId:(0,d.A)(i),$stackPointer:l,$type:"class"},{proxy:s,revoke:o}=Proxy.revocable(r,{get(i,s,a){if(i[s])return r[s];if(s in e.prototype&&"function"==typeof e.prototype[s]){const e=async function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return t.request(s,{params:i})};e.transfer=function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return{invoke:async function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return t.request(s,{params:r},i)}}},i[s]=e}return i[s]}});r[p]=o,a(s)}()}},k.postMessage({type:"init",data:{memory:s.USE_THREADS?r.ce:null,name:t.name||e.name,stackPointer:l,stackSize:null!==(h=t.stackSize)&&void 0!==h?h:s.STACK_SIZE}})}))},{run:!s.USE_THREADS&&!t.dispatchToWorker||t.disableWorker?y:A,transfer:function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return v=i,{run:!s.USE_THREADS&&!t.dispatchToWorker||t.disableWorker?y:A}}}}function v(e){if(e.$worker&&(e.$worker.terminate(),e.$worker=null),e.$moduleId){if(h.Yj(e.$moduleId)){const t=g(e.$moduleId,e.$type);m.has(t)&&(m.get(t).refCount--,0===m.get(t).refCount&&(URL.revokeObjectURL(m.get(t).url),m.delete(t)))}e.$moduleId=null}if(e.$ipc&&(e.$ipc.destroy(),e.$ipc=null),e.$stackPointer&&(r.s_.free(e.$stackPointer),e.$stackPointer=0),e.$channel=null,e.$instance=null,e[p]){const t=e[p];e[p]=null,t()}}async function y(e){return e.$worker?new Promise((t=>{e.$worker.onmessage=function(i){const r=i.data,s=r.type,a=r.data;"stopped"===s&&(v(e),t(a))},e.$worker.postMessage({type:"stop"})})):e.$retval?e.$retval:void 0}},20723:(e,t,i)=>{i.d(t,{_:()=>s,i:()=>r});const r={2:1,3:1,4:1,5:1,6:2,7:2,8:4,9:4,10:8,11:1,12:1,13:2,14:2,15:4,16:4,17:8,18:4,19:8,20:4,0:4,1:4,22:8,21:8,23:1,24:1,25:4},s={2:0,3:0,4:0,5:0,6:1,7:1,8:2,9:2,10:4,11:0,12:0,13:1,14:1,15:2,16:2,17:4,18:2,19:4,20:2,1:2,0:2,22:4,21:4,23:0,24:0,25:2}},76959:(e,t,i)=>{i.d(t,{A:()=>f});var r=i(19371),s=i(33740),a=i(42524),o=i(77389),n=i(75176),h=i(41863),d=i(773),c=i(59502),l=i(53971),u=i(84799);class f{constructor(e,t,i){(0,r.A)(this,"count",void 0),(0,r.A)(this,"url",void 0),(0,r.A)(this,"childImportUrl",void 0),(0,r.A)(this,"childThreads",void 0),this.count=e,this.url=t,this.childImportUrl=i,this.childThreads=[]}async createTheadPoolEntry(e){return new Promise(((t,i)=>{const r=(0,s.pv)(),l=new Worker(this.url,{name:u.TK.name?`${u.TK.name}-Thread-${r}`:""}),f=s.s_.alignedAlloc(n.STACK_ALIGNMENT,n.STACK_SIZE),p=s.s_.malloc(8);(0,h.sO)(p,0,8),o.M[15](p+4,0),o.M[15](p,2|a.f[15](p)),l.onmessage=e=>{if("ready"===e.data.type){const e=f;(0,h.sO)(e,0,20),c.Ts(e+16),d.Ts(e+12),l.postMessage({type:"wait"}),t({id:r,thread:{thread:0,worker:l,stackPointer:f,threadDescriptor:p},threadWait:e})}},this.childImportUrl&&l.postMessage({type:"import",data:{url:this.childImportUrl.href}}),l.postMessage({type:"ready",data:{cheap:{memory:s.ce,stackPointer:f,stackSize:n.STACK_SIZE,id:r},runner:{resource:{tableSize:e.tableSize,module:e.module,initFuncs:e.initFuncs},options:{memoryBase:e.memoryBase,tableBase:e.tableBase,threadDescriptor:p,childImports:e.childImports},imports:e.childImports}}})}))}async ready(e){this.childThreads=await Promise.all(new Array(this.count).fill(0).map((()=>this.createTheadPoolEntry(e))))}hasFree(){for(let e=0;e<this.childThreads.length;e++)if(0===a.f[15](this.childThreads[e].thread.threadDescriptor+4))return!0;return!1}isPoolThread(e){for(let t=0;t<this.childThreads.length;t++)if(this.childThreads[t].thread.thread===e)return!0;return!1}createThread(e,t,i,r){for(let t=0;t<this.childThreads.length;t++)if(0===a.f[15](this.childThreads[t].thread.threadDescriptor+4))return o.M[15](this.childThreads[t].thread.threadDescriptor+4,1),this.childThreads[t].thread.thread=e,o.M[15](e+8,2|a.f[15](e+8)),c.s2(this.childThreads[t].threadWait+16),o.M[20](this.childThreads[t].threadWait,e),o.M[20](this.childThreads[t].threadWait+4,i),o.M[20](this.childThreads[t].threadWait+8,r),c.Tl(this.childThreads[t].threadWait+16),void d.vP(this.childThreads[t].threadWait+12)}joinThread(e,t){let i;for(let t=0;t<this.childThreads.length;t++)if(this.childThreads[t].thread.thread===e){i=this.childThreads[t];break}return i?(1&a.f[15](e+8)||(l.uk(e+12,1),0!==t&&o.M[20](t,a.f[20](e+4)),o.M[15](i.thread.threadDescriptor+4,0)),0):-1}detachThread(e){let t;for(let i=0;i<this.childThreads.length;i++)if(this.childThreads[i].thread.thread===e){t=this.childThreads[i];break}return t?(o.M[15](t.thread.threadDescriptor,1|a.f[15](t.thread.threadDescriptor)),o.M[15](e+8,1|a.f[15](e+8)),0):-1}destroy(){for(let e=0;e<this.childThreads.length;e++)s.s_.free(this.childThreads[e].thread.stackPointer),s.s_.free(this.childThreads[e].thread.threadDescriptor),this.childThreads[e].thread.worker.terminate();this.childThreads=[]}}},81585:(e,t,i)=>{i.d(t,{A:()=>E});var r=i(19371),s=i(42524),a=i(77389),o=i(33740),n=i(41863),h=i(79508),d=i(20813),c=i(35402),l=i(66528),u=i(75176),f=i(53971),p=i(62123),m=i(23464),g=i(3596),A=i(76959),v=i(773),y=i(59502),b=(i(13888),i(84799)),k=i(546),w=i(81819),x=i(87339),T=i(3760),I=i(24788),_=i(25092),P=i(47845),M=i(59087),S=i(17630);const C="packages/cheap/src/webassembly/WebAssemblyRunner.ts";let R=b.TK.Worker;function B(){}let D=!1;class E{static getTable(){return o.XI}static mutexLock(e){y.s2(e)}static mutexUnlock(e){y.Tl(e)}static condWait(e,t){v.uk(e,t)}static readPointer(e){return s.f[20](e)}static writePointer(e,t){a.M[20](e,t)}constructor(e){var t,i;let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,r.A)(this,"resource",void 0),(0,r.A)(this,"instance",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"builtinMalloc",void 0),(0,r.A)(this,"memoryBase",void 0),(0,r.A)(this,"tableBase",void 0),(0,r.A)(this,"childImports",void 0),(0,r.A)(this,"childUrl",void 0),(0,r.A)(this,"childImportUrl",void 0),(0,r.A)(this,"childBlob",void 0),(0,r.A)(this,"childThreads",void 0),(0,r.A)(this,"imports",void 0),(0,r.A)(this,"childReadyPromises",void 0),(0,r.A)(this,"threadPool",void 0),(0,r.A)(this,"initCalling",void 0),(0,r.A)(this,"promisingMap",void 0),this.resource=e,this.builtinMalloc=[],this.initCalling=!1,this.childThreads=new Map,this.childReadyPromises=[],this.promisingMap=new Map,w.Yj(p.childImports)?this.childImports=p.childImports:w.Ik(p.childImports)&&p.childImports instanceof Blob&&(this.childImports=URL.createObjectURL(p.childImports)),this.memoryBase=e.dataSize?o.s_.alignedAlloc(null!==(t=e.dataAlign)&&void 0!==t?t:8,e.dataSize):0,this.memoryBase&&e.bssSize&&(0,n.sO)(this.memoryBase+(e.dataSize-e.bssSize),0,e.bssSize),p.thread&&p.tableBase&&o.XI.getPointer()!==p.tableBase&&o.XI.alloc(p.tableBase-o.XI.getPointer()),this.tableBase=e.tableSize?o.XI.alloc(e.tableSize):0,this.options=p,this.imports={env:{memory:o.ce,__stack_pointer:o.GE,__indirect_function_table:o.XI.table,clock_time_get:h.WU,clock_res_get:h.Lq,random_get:h.Pp,abort:h.h2,proc_exit:function(e){x.z3(`wasm module exit, code: ${e}`,C,171)},__syscall_renameat:B,__syscall_unlinkat:B,environ_get:h.B,environ_sizes_get:h.CK,fd_close:B,fd_fdstat_get:h.LS,fd_read:B,fd_seek:B,fd_write:h.nK,emscripten_builtin_malloc:e=>{const t=o.s_.malloc(e);return this.builtinMalloc.push(t),t},emscripten_builtin_free:e=>{o.s_.free(e)},emscripten_builtin_memalign:(e,t,i)=>{const r=o.s_.alignedAlloc(t,i);return 0!==r?(a.M[20](e,r),this.builtinMalloc.push(r),0):-1},emscripten_memcpy_big:function(e,t,i){(0,n.Mr)(e,t,i)},__libc_malloc:function(e){return o.s_.malloc(e)},__libc_free:e=>{o.s_.free(e)},malloc:e=>{if(!0===this.initCalling){const t=o.s_.malloc(e);return this.builtinMalloc.push(t),t}return o.s_.malloc(e)},calloc:function(e,t){return o.s_.calloc(e,t)},realloc:function(e,t){return o.s_.realloc(e,t)},aligned_alloc:(e,t)=>o.s_.alignedAlloc(e,t),free:function(e){o.s_.free(e)},posix_memalign:function(e,t,i){const r=o.s_.alignedAlloc(t,i);return 0!==r?(a.M[20](e,r),0):-1},memalign:function(e,t){return o.s_.alignedAlloc(e,t)}},"GOT.func":{malloc:new WebAssembly.Global({mutable:!0,value:"i32"},2),calloc:new WebAssembly.Global({mutable:!0,value:"i32"},3),realloc:new WebAssembly.Global({mutable:!0,value:"i32"},4),aligned_alloc:new WebAssembly.Global({mutable:!0,value:"i32"},5),free:new WebAssembly.Global({mutable:!0,value:"i32"},1)}};{const e=(e,t,i,r)=>{if(this.threadPool&&this.threadPool.hasFree())return this.threadPool.createThread(e,t,i,r),0;this.childUrl||this.createChildUrl();const h=(0,o.pv)(),d=new R(this.childUrl,{name:b.TK.name?`${b.TK.name}-Thread-${h}`:""});a.M[15](e,h),a.M[16](e+12,1),a.M[15](e+8,0),a.M[20](e+4,0);const c=o.s_.alignedAlloc(u.STACK_ALIGNMENT,u.STACK_SIZE),l=o.s_.malloc(8);(0,n.sO)(l,0,8),this.childThreads.set(s.f[15](e),{thread:e,worker:d,stackPointer:c,threadDescriptor:l});const{promise:f,resolve:p}=(0,T.A)();I.A.jspi||this.childReadyPromises.push(f);return d.onmessage=e=>{const t=e.data,i=t.type;t.data,"run"===i&&p(0)},this.childImportUrl&&d.postMessage({type:"import",data:{url:this.childImportUrl.href}}),d.postMessage({type:"run",data:{cheap:{memory:o.ce,stackPointer:c,stackSize:u.STACK_SIZE,id:s.f[15](e)},runner:{resource:{tableSize:this.resource.tableSize,module:this.resource.threadModule.module,initFuncs:this.resource.threadModule.initFuncs},options:{memoryBase:this.options.memoryBase||this.memoryBase,tableBase:this.tableBase,thread:e,threadDescriptor:l,childImports:this.childImports},func:i,args:r,imports:this.childImports,thread:e}}}),I.A.jspi?f:0};_.X$(this.imports.env,{wasm_pthread_create:I.A.jspi?new WebAssembly.Suspending(e):e,wasm_pthread_join2:(e,t)=>{if(this.threadPool&&this.threadPool.isPoolThread(e))return this.threadPool.joinThread(e,t),0;if(1&s.f[15](e+8))return this.childThreads.delete(s.f[15](e)),0;f.uk(e+12,1),0!==t&&a.M[20](t,s.f[20](e+4));const i=this.childThreads.get(s.f[15](e));return o.s_.free(i.stackPointer),o.s_.free(i.threadDescriptor),i.worker.terminate(),this.childThreads.delete(s.f[15](e)),(0,n.sO)(e,0,16),0},wasm_pthread_detach2:e=>{if(this.threadPool&&this.threadPool.isPoolThread(e))return this.threadPool.detachThread(e),0;const t=this.childThreads.get(s.f[15](e));a.M[15](t.threadDescriptor,1|s.f[15](t.threadDescriptor)),a.M[15](e+8,1|s.f[15](e+8))}}),_.X$(this.imports.env,d),_.X$(this.imports.env,c),_.X$(this.imports.env,l)}if(this.memoryBase?_.X$(this.imports.env,{__memory_base:this.memoryBase}):p.memoryBase&&_.X$(this.imports.env,{__memory_base:p.memoryBase}),this.tableBase&&_.X$(this.imports.env,{__table_base:this.tableBase}),null!==(i=p.imports)&&void 0!==i&&i.env&&(_.X$(this.imports.env,p.imports.env),p.envKey&&p.importMap)){const e={};_.__(this.imports.env,((t,i)=>{p.importMap[i]&&(e[p.importMap[i]]=t)})),this.imports[p.envKey]=e}this.imports.wasi_snapshot_preview1=this.imports.env}createChildUrl(){{let e="";{i(13888);const t=(0,k.A)(81585,{varName:"__WebAssemblyRunner__",exportName:"__WebAssemblyRunner__",pointName:E.name,exportIsClass:!0}),r=(0,k.A)(13888,{varName:"runThread"});let s="",a="";this.childImports&&(s=`importScripts('${this.childImports}');`),b.TK.CHEAP_POLYFILL_URL&&(a=`importScripts('${b.TK.CHEAP_POLYFILL_URL}');`),e=`\n          ${t}\n          ${r}\n          self.imports = {env:{}};\n          ${a}\n          ${s}\n          runThread.default();\n        `}this.childBlob=new Blob([e],{type:"text/javascript"}),this.childUrl=URL.createObjectURL(this.childBlob)}}overrideAtomic(){d.override({atomic_add_i8:p.KJ.exports.add8,atomic_sub_i8:p.KJ.exports.sub8,atomic_and_i8:p.KJ.exports.and8,atomic_or_i8:p.KJ.exports.or8,atomic_xor_i8:p.KJ.exports.xor8,atomic_store_i8:p.KJ.exports.store8,atomic_load_i8:p.KJ.exports.load8,atomic_compare_exchange_i8:p.KJ.exports.compare_exchange8,atomic_exchange_i8:p.KJ.exports.exchange8,atomic_add_i16:p.KJ.exports.add16,atomic_sub_i16:p.KJ.exports.sub16,atomic_and_i16:p.KJ.exports.and16,atomic_or_i16:p.KJ.exports.or16,atomic_xor_i16:p.KJ.exports.xor16,atomic_store_i16:p.KJ.exports.store16,atomic_load_i16:p.KJ.exports.load16,atomic_compare_exchange_i16:p.KJ.exports.compare_exchange16,atomic_exchange_i16:p.KJ.exports.exchange16,atomic_add_i32:p.KJ.exports.add32,atomic_sub_i32:p.KJ.exports.sub32,atomic_and_i32:p.KJ.exports.and32,atomic_or_i32:p.KJ.exports.or32,atomic_xor_i32:p.KJ.exports.xor32,atomic_store_i32:p.KJ.exports.store32,atomic_load_i32:p.KJ.exports.load32,atomic_compare_exchange_i32:p.KJ.exports.compare_exchange32,atomic_exchange_i32:p.KJ.exports.exchange32,atomic_add_i64:p.KJ.exports.add64,atomic_sub_i64:p.KJ.exports.sub64,atomic_and_i64:p.KJ.exports.and64,atomic_or_i64:p.KJ.exports.or64,atomic_xor_i64:p.KJ.exports.xor64,atomic_store_i64:p.KJ.exports.store64,atomic_load_i64:p.KJ.exports.load64,atomic_compare_exchange_i64:p.KJ.exports.compare_exchange64,atomic_exchange_i64:p.KJ.exports.exchange64,atomics_notify:p.KJ.exports.notify,atomics_wait:p.KJ.exports.wait}),_.X$(this.imports.env,d)}async run(e,t){if(w.Ik(e)&&_.X$(this.options.imports,e),g.Ko()&&this.resource.threadModule&&(g.LK||(g.Ts(o.ce,u.HEAP_INITIAL,u.HEAP_MAXIMUM,c.override),(0,P.A)()||(0,M.A)()||!I.A.jspi||c.override({wasm_pthread_mutex_lock:new WebAssembly.Suspending(c.wasm_pthread_mutex_lock_async),wasm_pthread_cond_wait:new WebAssembly.Suspending(c.wasm_pthread_cond_wait_async),wasm_pthread_cond_timedwait:new WebAssembly.Suspending(c.wasm_pthread_cond_timedwait_async)})),_.X$(this.imports.env,c)),!m.LK&&m.Ko()&&m.Ts(o.ce,u.HEAP_INITIAL,u.HEAP_MAXIMUM),!D&&p.Ko()&&(D=!0,this.overrideAtomic()),this.instance=await WebAssembly.instantiate(this.resource.module,this.imports),this.initRunTime(),this.resource.threadModule&&this.resource.enableThreadPool&&t>0&&!I.A.jspi){this.childUrl||this.createChildUrl();let e=t;this.resource.enableThreadCountRate&&(e*=this.resource.enableThreadCountRate),this.threadPool=new A.A(e,this.childUrl,this.childImportUrl),await this.threadPool.ready({tableSize:this.resource.tableSize,module:this.resource.threadModule.module,initFuncs:this.resource.threadModule.initFuncs,memoryBase:this.options.memoryBase||this.memoryBase,tableBase:this.tableBase,childImports:this.childImports})}}runAsChild(e){w.Ik(e)&&_.X$(this.options.imports,e),g.Ko()&&(g.LK||g.Ts(o.ce,u.HEAP_INITIAL,u.HEAP_MAXIMUM,c.override),_.X$(this.imports.env,c)),!D&&p.Ko()&&(D=!0,this.overrideAtomic()),this.instance=new WebAssembly.Instance(this.resource.module,this.imports),this.initRunTime()}async childThreadsReady(){if(!this.childReadyPromises.length)return;const e=this.childReadyPromises;this.childReadyPromises=[],await Promise.all(e)}initRunTime(){this.builtinMalloc=[],this.initCalling=!0,w.YO(this.resource.initFuncs)&&S.__(this.resource.initFuncs,(e=>{let t;if(this.asm[e]&&(t=this.asm[e]),t)return t()})),this.initCalling=!1}invoke(e){if(!this.asm)return-1;let t;if(this.asm[e]?t=this.asm[e]:this.options.exportMap&&this.options.exportMap[e]&&this.asm[this.options.exportMap[e]]&&(t=this.asm[this.options.exportMap[e]]),t){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return t.apply(null,r)}x.z3(`the wasm module has not function ${e} to call`,C,737)}async invokeAsync(e){if(!this.asm)return-1;for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];if(!I.A.jspi)return this.invoke(e,...i);let s;if(this.promisingMap.has(e)?s=this.promisingMap.get(e):(this.asm[e]?s=this.asm[e]:this.options.exportMap&&this.options.exportMap[e]&&this.asm[this.options.exportMap[e]]&&(s=this.asm[this.options.exportMap[e]]),s=WebAssembly.promising(s),this.promisingMap.set(e,s)),s)return s.apply(null,i);x.z3(`the wasm module has not function ${e} to call`,C,778)}get asm(){return this.instance&&this.instance.exports}getInstance(){return this.instance}getChildThreadCount(){return this.childThreads.size}destroy(){var e;null!==(e=this.builtinMalloc)&&void 0!==e&&e.length&&(S.__(this.builtinMalloc,(e=>{o.s_.free(e)})),this.builtinMalloc.length=0),this.memoryBase&&(o.s_.free(this.memoryBase),this.memoryBase=null),this.tableBase&&(o.XI.free(this.tableBase),this.tableBase=0),this.childImports&&(URL.revokeObjectURL(this.childImports),this.childImports=null),this.childUrl&&(w.Yj(this.childUrl)&&URL.revokeObjectURL(this.childUrl),this.childUrl=null),this.childBlob=null,this.childImportUrl=null,this.childReadyPromises.length=0,this.childThreads.size&&this.childThreads.forEach(((e,t)=>{1&s.f[15](e.threadDescriptor)||(x.R8("has child thread running, maybe resource leakage",C,839),e.worker.terminate(),a.M[16](e.thread+12,0),e.stackPointer&&o.s_.free(e.stackPointer),o.s_.free(e.threadDescriptor),this.childThreads.delete(t))})),this.builtinMalloc=null,this.instance=null,this.options.thread&&(this.options.threadDescriptor&&a.M[15](this.options.threadDescriptor+4,0),this.options.threadDescriptor&&(1&s.f[15](this.options.threadDescriptor)||4&s.f[15](this.options.thread+8))?2&s.f[15](this.options.threadDescriptor)||(o.wE&&o.s_.free(o.wE),o.s_.free(this.options.threadDescriptor),(0,n.sO)(this.options.thread,0,16),self.close()):(a.M[16](this.options.thread+12,0),f.me(this.options.thread+12,1))),this.threadPool&&this.threadPool.destroy(),this.threadPool=null,this.promisingMap&&(this.promisingMap.clear(),this.promisingMap=null)}}},15860:(e,t,i)=>{i.d(t,{A:()=>p});var r=i(75176),s=i(76177),a=i(46647),o=i(77969),n=i(71195),h=i(25092),d=i(81819),c=i(33134),l=i(21374),u=i(31616),f=i(28032);async function p(e){let t,i,p,m,g,A,v,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(y=h.X$({enableThread:r.USE_THREADS,initFuncs:y.child?[]:["__wasm_apply_data_relocs","_initialize"]},y),d.ai(e.dataSize)&&d.ai(e.tableSize))if(i=e.dataSize,m=e.dataSize,p=e.dataAlign,g=e.dataAlign,A=e.bssSize,d.Yj(e.source)){const i={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(d.Pc(WebAssembly.compileStreaming))t=await WebAssembly.compileStreaming(fetch(e.source,i));else{const r=await fetch(e.source,i);v=await r.arrayBuffer(),t=await WebAssembly.compile(v)}}else t=await WebAssembly.compile(e.source),v=d.sv(e.source)?e.source:e.source.buffer;else{const s={ioReader:new u.A(1048576),ioWriter:new f.A(1048576),bufferEnded:!1,compileStopped:!1,error:"",abortController:null,pullResolve:null,bufferResolve:null,buffers:[],data:{},options:y},h=new Response(new ReadableStream({async start(t){if(d.Yj(e.source)){var i;"function"==typeof AbortController&&(s.abortController=new AbortController);const r={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade",signal:null===(i=s.abortController)||void 0===i?void 0:i.signal},a=await fetch(e.source,r);let o;a.ok&&a.status>=200&&a.status<=299?o=a.body.getReader():t.error(`Http code invalid, ${a.status} ${a.statusText}`);const n=[];s.ioReader.onFlush=async e=>{let t=0;for(;n.length&&t<e.length;){const i=n.shift();i.length>e.length-t?(e.set(i.subarray(0,e.length-t),t),n.unshift(i.subarray(e.length-t)),t=e.length):(e.set(i,t),t+=i.length)}if(t>=e.length)return e.length;const{value:i,done:r}=await o.read();return r?t>0?t:-1048576:(s.buffers.push(i),i.length>e.length-t?(e.set(i.subarray(0,e.length-t),t),n.push(i.subarray(e.length-t)),e.length):(e.set(i,t),t+=i.length,t))}}else{let t=0,i=e.source.byteLength;const r=d.sv(e.source)?new Uint8Array(e.source):e.source;s.ioReader.onFlush=async e=>{if(t>=i)return-1048576;const s=Math.min(e.length,i-t);return e.set(r.subarray(t,t+s),0),t+=s,s}}s.ioWriter.onFlush=async e=>{if(s.pullResolve)return s.pullResolve(e.slice()),s.pullResolve=null,0;const t=await new Promise((e=>{s.bufferResolve=e}));return t.enqueue(e.slice()),s.bufferEnded&&t.close(),0},async function(e){try{for(await e.ioWriter.writeUint32(await e.ioReader.readUint32()),await e.ioWriter.writeUint32(await e.ioReader.readUint32());;){if(e.compileStopped){e.abortController&&e.abortController.abort();break}const t=await e.ioReader.readUint8();if(e.options.child&&11===t){await e.ioWriter.writeUint8(t),await a.$z(e.ioWriter,7),await a.$z(e.ioWriter,1),await a.$z(e.ioWriter,0),await e.ioWriter.writeUint8(65),await e.ioWriter.writeUint8(0),await e.ioWriter.writeUint8(11),await a.$z(e.ioWriter,1),await e.ioWriter.writeUint8(0);const i=await a.GW(e.ioReader);await e.ioReader.skip(i);continue}await e.ioWriter.writeUint8(t);const i=await a.GW(e.ioReader),s=e.ioReader.getPos();if(0===t){await a.$z(e.ioWriter,i);const t=e.ioReader.getPos(),r=await a.GW(e.ioReader),s=await e.ioReader.readString(r);if(await a.$z(e.ioWriter,r),await e.ioWriter.writeString(s),"dylink.0"===s){const r=e.ioReader.getPos()+(BigInt(Math.floor(i))-(e.ioReader.getPos()-t));for(;e.ioReader.getPos()<r;){const t=await e.ioReader.readUint8();await e.ioWriter.writeUint8(t);const i=await a.GW(e.ioReader);await a.$z(e.ioWriter,i),1===t?(e.data.dataSize=await a.GW(e.ioReader),e.data.dataAlign=await a.GW(e.ioReader),e.data.tableSize=await a.GW(e.ioReader),e.data.tableAlign=await a.GW(e.ioReader),await a.$z(e.ioWriter,e.data.dataSize),await a.$z(e.ioWriter,e.data.dataAlign),await a.$z(e.ioWriter,e.data.tableSize),await a.$z(e.ioWriter,e.data.tableAlign)):await e.ioWriter.writeBuffer(await e.ioReader.readBuffer(i))}}}else if(11===t){await a.$z(e.ioWriter,i);const t=await a.GW(e.ioReader);if(await a.$z(e.ioWriter,t),t){for(await a.$z(e.ioWriter,await a.GW(e.ioReader));;){const t=await e.ioReader.readUint8();if(await e.ioWriter.writeUint8(t),11===t)break}const t=await a.GW(e.ioReader);e.data.dataSize?e.data.bssSize=e.data.dataSize-t:e.data.dataSize=t,await a.$z(e.ioWriter,t)}}else if(2===t){const t=new l.A(new Uint8Array(i+100));let h=await a.GW(e.ioReader);a.tt(t,h);let d=0;for(;h--;){const i=await a.GW(e.ioReader);a.tt(t,i),t.writeBuffer(await e.ioReader.readBuffer(i));const s=await a.GW(e.ioReader);a.tt(t,s),t.writeBuffer(await e.ioReader.readBuffer(s));const h=await e.ioReader.readUint8();switch(t.writeUint8(h),h){case 0:a.tt(t,await a.GW(e.ioReader));break;case 3:a.p2(t,await a.WP(e.ioReader)),a.tt(t,await a.GW(e.ioReader));break;case 2:{let i=await a.GW(e.ioReader);e.options.enableThread?i|=2:i&=-3,a.tt(t,i);const s=await a.GW(e.ioReader);if(a.tt(t,r.HEAP_INITIAL||s),1&i){let i=await a.GW(e.ioReader);o.A.ios&&!n.A.checkVersion(o.A.version,"17",!0)&&e.options.enableThread||(i=r.HEAP_MAXIMUM),a.tt(t,i)}d++;break}case 1:{a.p2(t,await a.WP(e.ioReader));const i=await a.GW(e.ioReader);a.tt(t,i);const r=await a.GW(e.ioReader);a.tt(t,r),e.data.tableSize=r,1&i&&a.tt(t,await a.GW(e.ioReader)),d++;break}}if(2===d)break}const c=t.getWroteBuffer(),u=i-Number(e.ioReader.getPos()-s);await a.$z(e.ioWriter,c.length+u),await e.ioWriter.writeBuffer(c)}else await a.$z(e.ioWriter,i);i-Number(e.ioReader.getPos()-s)&&await e.ioReader.pipe(e.ioWriter,i-Number(e.ioReader.getPos()-s))}}catch(t){-1048576===e.ioReader.error?e.bufferEnded=!0:e.error=t,e.ioReader.remainingLength()&&await e.ioWriter.writeBuffer(await e.ioReader.readBuffer(e.ioReader.remainingLength())),await e.ioWriter.flush()}}(s)},async pull(e){if(s.error)e.close();else{if(s.bufferResolve)return s.bufferResolve(e),void(s.bufferResolve=null);e.enqueue(await new Promise(((e,t)=>{s.pullResolve=e}))),s.bufferEnded?e.close():s.error&&e.error(s.error)}},cancel(e){s.compileStopped=!0}}),{headers:{"Content-Type":"application/wasm"}});t=d.Pc(WebAssembly.compileStreaming)?await WebAssembly.compileStreaming(h):await WebAssembly.compile(await h.arrayBuffer()),v=d.Yj(e.source)?(0,c.A)(Uint8Array,s.buffers).buffer:d.sv(e.source)?e.source:e.source.buffer,i=s.data.tableSize,m=s.data.dataSize,p=s.data.tableAlign,g=s.data.dataAlign,A=s.data.bssSize}return y.child?{module:t,initFuncs:y.initFuncs||[],tableSize:0,tableAlign:p||0,dataSize:1,dataAlign:g?Math.max((0,s.A)(g),8):8,bssSize:0,buffer:v}:{module:t,tableSize:i,tableAlign:p||0,dataSize:m,dataAlign:g?Math.max((0,s.A)(g),8):8,bssSize:A||0,initFuncs:y.initFuncs||[],buffer:v}}},13888:(e,t,i)=>{function r(){let e;"object"==typeof __WebAssemblyRunner__?e=__WebAssemblyRunner__.__WebAssemblyRunner__:"object"==typeof __CHeap_WebAssemblyRunner__&&(e=__CHeap_WebAssemblyRunner__.default);let t,i,r=self,s=0;r.onmessage=a=>{const o=a.data,n=o.type,h=o.data;switch(n){case"run":r.postMessage({type:"run"}),self.CHeap&&self.CHeap.initThread&&self.CHeap.initThread(h.cheap).then((()=>{self.__SELF_THREAD__=h.runner.thread,h.runner.options.imports=self.imports,t=new e(h.runner.resource,h.runner.options),t.runAsChild(),e.getTable().get(h.runner.func)(h.runner.args),t.destroy()}));break;case"ready":i=h.runner,s=h.cheap.stackPointer,self.CHeap&&self.CHeap.initThread&&self.CHeap.initThread(h.cheap).then((()=>{r.postMessage({type:"ready"})}));break;case"wait":{async function d(){for(;;){for(e.mutexLock(s+16);0===e.readPointer(s);)e.condWait(s+12,s+16);self.__SELF_THREAD__=e.readPointer(s),i.options.thread=e.readPointer(s),i.thread=e.readPointer(s),i.func=e.readPointer(s+4),i.args=e.readPointer(s+8),t=new e(i.resource,i.options),t.runAsChild(),e.getTable().get(i.func)(i.args),t.destroy(),e.writePointer(s,0),e.mutexUnlock(s+16)}}i.options.imports=self.imports,d();break}}}}i.r(t),i.d(t,{default:()=>r})},22537:(e,t,i)=>{i.d(t,{A:()=>r});const r="AGFzbQEAAAABEANgAX8Bf2ABfwBgAn9/AX8CWQYDZW52Bm1lbW9yeQIDAYCABANlbnYGbWFsbG9jAAADZW52BGZyZWUAAQNlbnYGY2FsbG9jAAIDZW52B3JlYWxsb2MAAgNlbnYNYWxpZ25lZF9hbGxvYwACAwYFAAECAgIHMwUGbWFsbG9jAAUEZnJlZQAGBmNhbGxvYwAHB3JlYWxsb2MACAxhbGlnbmVkQWxsb2MACQoqBQYAIAAQAAsGACAAEAELCAAgACABEAILCAAgACABEAMLCAAgACABEAML"},23464:(e,t,i)=>{i.d(t,{Ko:()=>l,LK:()=>d,Ts:()=>u});var r=i(33740),s=i(22537),a=i(46647),o=i(18152),n=i(87339);const h="packages/cheap/src/webassembly/runtime/asm/libc.ts";let d,c=!0;function l(){return c}function u(e,t,i){try{const n=a.bx(o.E_(s.A),{shared:"function"==typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer,initial:t,maximum:i});d=new WebAssembly.Instance(new WebAssembly.Module(n),{env:{memory:e,malloc:function(e){return r.s_.malloc(e)},calloc:function(e,t){return r.s_.calloc(e,t)},realloc:function(e,t){return r.s_.realloc(e,t)},aligned_alloc:(e,t)=>r.s_.alignedAlloc(e,t),free:function(e){r.s_.free(e)}}}),r.XI.set(2,d.exports.malloc),r.XI.set(1,d.exports.free),r.XI.set(3,d.exports.calloc),r.XI.set(4,d.exports.realloc),r.XI.set(5,d.exports.alignedAlloc)}catch(e){c=!1,n.R8("libc asm not support, cannot use asm thread function",h,58)}}},91997:(e,t,i)=>{i.d(t,{A:()=>r});const r="AGFzbQEAAAABEwNgAX8Bf2ACf38Bf2ADf39/AX8CEgEDZW52Bm1lbW9yeQIDAYCABAMIBwAAAAECAAAHQwcEbG9jawAAB3RyeWxvY2sAAQZ1bmxvY2sAAgR3YWl0AAMJdGltZWR3YWl0AAQGc2lnbmFsAAUJYnJvYWRjYXN0AAYKnAIHVgEBfyAAQQBBAf5IAgAhASABQQBHBEADQCABQQJGBH9BAQUgAEEBQQL+SAIAQQBHCwRAIABBAkJ//gECABoLIABBAEEC/kgCACEBIAFBAEcNAAsLQQALFwAgAEEAQQH+SAIAQQBGBH9BAAVBEAsLIwAgAEEB/iUCAEEBRwRAIABBAP4XAgAgAEEB/gACABoLQQALHQAgACAA/hACACABEAIaQn/+AQIAGiABEAAaQQALNwAgACAA/hACACABEAIaIAIpAwBCgJTr3AN+IAIoAgitfP4BAgAgARAAGkECRgR/QfAABUEACwsWACAAQQH+HgIAGiAAQQH+AAIAGkEACxoAIABBAf4eAgAaIABBgICAgAT+AAIAGkEACw=="},3596:(e,t,i)=>{i.d(t,{Ko:()=>c,LK:()=>h,Ts:()=>l});var r=i(91997),s=i(46647),a=i(18152),o=i(87339);const n="packages/cheap/src/webassembly/runtime/asm/thread.ts";let h,d=!0;function c(){return d}function l(e,t,i,c){try{if(!("function"==typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer))return void(d=!1);{const o=s.bx(a.E_(r.A),{shared:!0,initial:t,maximum:i});h=new WebAssembly.Instance(new WebAssembly.Module(o),{env:{memory:e}})}c({wasm_pthread_mutex_lock:h.exports.lock,wasm_pthread_mutex_trylock:h.exports.trylock,wasm_pthread_mutex_unlock:h.exports.unlock,wasm_pthread_cond_wait:h.exports.wait,wasm_pthread_cond_timedwait:h.exports.timedwait,wasm_pthread_cond_signal:h.exports.signal,wasm_pthread_cond_broadcast:h.exports.broadcast})}catch(e){d=!1,o.R8("thread asm not support, cannot use asm thread function",n,67)}}},20813:(e,t,i)=>{i.r(t),i.d(t,{atomic_add_i16:()=>p,atomic_add_i32:()=>x,atomic_add_i64:()=>B,atomic_add_i8:()=>a,atomic_and_i16:()=>g,atomic_and_i32:()=>I,atomic_and_i64:()=>E,atomic_and_i8:()=>n,atomic_compare_exchange_i16:()=>k,atomic_compare_exchange_i32:()=>C,atomic_compare_exchange_i64:()=>V,atomic_compare_exchange_i8:()=>u,atomic_exchange_i16:()=>w,atomic_exchange_i32:()=>R,atomic_exchange_i64:()=>N,atomic_exchange_i8:()=>f,atomic_load_i16:()=>b,atomic_load_i32:()=>S,atomic_load_i64:()=>F,atomic_load_i8:()=>l,atomic_or_i16:()=>A,atomic_or_i32:()=>_,atomic_or_i64:()=>U,atomic_or_i8:()=>h,atomic_store_i16:()=>y,atomic_store_i32:()=>M,atomic_store_i64:()=>$,atomic_store_i8:()=>c,atomic_sub_i16:()=>m,atomic_sub_i32:()=>T,atomic_sub_i64:()=>D,atomic_sub_i8:()=>o,atomic_xor_i16:()=>v,atomic_xor_i32:()=>P,atomic_xor_i64:()=>L,atomic_xor_i8:()=>d,atomics_notify:()=>O,atomics_wait:()=>z,atomics_wait_timeout:()=>G,override:()=>W});var r=i(53971),s=i(20723);let a=function(e,t){return r.WQ(e,t,12,s._[12])},o=function(e,t){return r.jb(e,t,12,s._[12])},n=function(e,t){return r.Uo(e,t,12,s._[12])},h=function(e,t){return r.or(e,t,12,s._[12])},d=function(e,t){return r.I8(e,t,12,s._[12])},c=function(e,t){return r.M_(e,t,12,s._[12])},l=function(e){return r.Hh(e,12,s._[12])},u=function(e,t,i){return r.p_(e,t,i,12,s._[12])},f=function(e,t){return r.cv(e,t,12,s._[12])},p=function(e,t){return r.WQ(e,t,14,s._[14])},m=function(e,t){return r.jb(e,t,14,s._[14])},g=function(e,t){return r.Uo(e,t,14,s._[14])},A=function(e,t){return r.or(e,t,14,s._[14])},v=function(e,t){return r.I8(e,t,14,s._[14])},y=function(e,t){return r.M_(e,t,14,s._[14])},b=function(e){return r.Hh(e,14,s._[14])},k=function(e,t,i){return r.p_(e,t,i,14,s._[14])},w=function(e,t){return r.cv(e,t,14,s._[14])},x=function(e,t){return r.WQ(e,t,16,s._[16])},T=function(e,t){return r.jb(e,t,16,s._[16])},I=function(e,t){return r.Uo(e,t,16,s._[16])},_=function(e,t){return r.or(e,t,16,s._[16])},P=function(e,t){return r.I8(e,t,16,s._[16])},M=function(e,t){return r.M_(e,t,16,s._[16])},S=function(e){return r.Hh(e,16,s._[16])},C=function(e,t,i){return r.p_(e,t,i,16,s._[16])},R=function(e,t){return r.cv(e,t,16,s._[16])},B=function(e,t){return r.WQ(e,t,21,s._[21])},D=function(e,t){return r.jb(e,t,21,s._[21])},E=function(e,t){return r.Uo(e,t,21,s._[21])},U=function(e,t){return r.or(e,t,21,s._[21])},L=function(e,t){return r.I8(e,t,21,s._[21])},$=function(e,t){return r.M_(e,t,21,s._[21])},F=function(e){return r.Hh(e,21,s._[21])},V=function(e,t,i){return r.p_(e,t,i,21,s._[21])},N=function(e,t){return r.cv(e,t,21,s._[21])},O=function(e,t){return r.me(e,t)},z=function(e,t){return r.uk(e,t)},G=function(e,t,i){return r.j4(e,t,Number(BigInt.asIntN(32,i)))};function W(e){e.atomic_add_i8&&(a=e.atomic_add_i8),e.atomic_sub_i8&&(o=e.atomic_sub_i8),e.atomic_and_i8&&(n=e.atomic_and_i8),e.atomic_or_i8&&(h=e.atomic_or_i8),e.atomic_xor_i8&&(d=e.atomic_xor_i8),e.atomic_store_i8&&(c=e.atomic_store_i8),e.atomic_load_i8&&(l=e.atomic_load_i8),e.atomic_compare_exchange_i8&&(u=e.atomic_compare_exchange_i8),e.atomic_exchange_i8&&(f=e.atomic_exchange_i8),e.atomic_add_i16&&(p=e.atomic_add_i16),e.atomic_sub_i16&&(m=e.atomic_sub_i16),e.atomic_and_i16&&(g=e.atomic_and_i16),e.atomic_or_i16&&(A=e.atomic_or_i16),e.atomic_xor_i16&&(v=e.atomic_xor_i16),e.atomic_store_i16&&(y=e.atomic_store_i16),e.atomic_load_i16&&(b=e.atomic_load_i16),e.atomic_compare_exchange_i16&&(k=e.atomic_compare_exchange_i16),e.atomic_exchange_i16&&(w=e.atomic_exchange_i16),e.atomic_add_i32&&(x=e.atomic_add_i32),e.atomic_sub_i32&&(T=e.atomic_sub_i32),e.atomic_and_i32&&(I=e.atomic_and_i32),e.atomic_or_i32&&(_=e.atomic_or_i32),e.atomic_xor_i32&&(P=e.atomic_xor_i32),e.atomic_store_i32&&(M=e.atomic_store_i32),e.atomic_load_i32&&(S=e.atomic_load_i32),e.atomic_compare_exchange_i32&&(C=e.atomic_compare_exchange_i32),e.atomic_exchange_i32&&(R=e.atomic_exchange_i32),e.atomic_add_i64&&(B=e.atomic_add_i64),e.atomic_sub_i64&&(D=e.atomic_sub_i64),e.atomic_and_i64&&(E=e.atomic_and_i64),e.atomic_or_i64&&(U=e.atomic_or_i64),e.atomic_xor_i64&&(L=e.atomic_xor_i64),e.atomic_store_i64&&($=e.atomic_store_i64),e.atomic_load_i64&&(F=e.atomic_load_i64),e.atomic_compare_exchange_i64&&(V=e.atomic_compare_exchange_i64),e.atomic_exchange_i64&&(N=e.atomic_exchange_i64),e.atomics_notify&&(O=e.atomics_notify),e.atomics_wait&&(z=e.atomics_wait),e.atomics_wait_timeout&&(G=e.atomics_wait_timeout)}},79508:(e,t,i)=>{i.d(t,{B:()=>b,CK:()=>k,LS:()=>w,Lq:()=>_,Pp:()=>P,WU:()=>I,h2:()=>T,nK:()=>x});var r,s=i(19371),a=i(75354),o=i(77389),n=i(86220),h=i(42524),d=i(41863),c=i(4068),l=i(23734);const u=[null,[],[]],f=0,p=28;function m(e,t){const i=u[e];0===t||10===t?(console.log.bind(console)(c.decode(i)),i.length=0):i.push(t)}const g={};let A,v="./this.program";function y(){if(!A){const e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:v||"./this.program"};for(let t in g)e[t]=g[t];const t=[];for(let i in e)t.push(i+"="+e[i]);A=t}return A}function b(e,t){let i=0;return y().forEach((function(r,s){const a=t+i;o.M[20](e+4*s,a),function(e,t){for(let i=0;i<e.length;++i)o.M[4](t,e.charCodeAt(i)),t+=1;o.M[4](t,0)}(r,a),i+=r.length+1})),0}function k(e,t){const i=y();o.M[25](e,i.length);let r=0;return i.forEach((function(e){r+=e.length+1})),o.M[25](t,r),0}function w(e,t){let i=0;return 0==e?i=2:1!=e&&2!=e||(i=64),o.M[11](t,2),o.M[13](t+2,1),o.M[15](t+8,i),o.M[15](t+12,0),o.M[17](t+16,BigInt(0)),f}function x(e,t,i,r){let s=0;for(let r=0;r<i;r++){let i=h.f[20](t),r=h.f[25](t+4);for(let t=0;t<r;t++)m(e,h.f[4](i+t));s+=r,t+=8}return o.M[25](r,s),f}function T(e){throw e=`abort(${e+=""}). Build with -s ASSERTIONS=1 for more info.`,new WebAssembly.RuntimeError(e)}function I(e,t,i){if(0!==e)return p;const r=(new Date).getTime();return o.M[10](i,BigInt(r)*BigInt(1e6)),f}function _(e,t){return 0!==e?p:(o.M[10](t,BigInt(1e6)),f)}function P(e,t){const i=(0,d.s3)(e,t);return(0,l.A)(i),f}r=class{constructor(){(0,s.A)(this,"buf",void 0),(0,s.A)(this,"len",void 0)}},(()=>{const e=r.prototype,t=new Map;t.set("buf",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("len",{0:25,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),(0,n.A)(e,a.Og,!0),(0,n.A)(e,a.dc,4),(0,n.A)(e,a.g7,8),(0,n.A)(e,a.JY,t)})()},35402:(e,t,i)=>{i.r(t),i.d(t,{override:()=>D,wasm_cpu_core_count:()=>M,wasm_pthread_cond_broadcast:()=>w,wasm_pthread_cond_destroy:()=>v,wasm_pthread_cond_init:()=>A,wasm_pthread_cond_signal:()=>k,wasm_pthread_cond_timedwait:()=>b,wasm_pthread_cond_timedwait_async:()=>B,wasm_pthread_cond_wait:()=>y,wasm_pthread_cond_wait_async:()=>R,wasm_pthread_equal2:()=>_,wasm_pthread_exit:()=>I,wasm_pthread_mutex_destroy:()=>f,wasm_pthread_mutex_init:()=>u,wasm_pthread_mutex_lock:()=>p,wasm_pthread_mutex_lock_async:()=>C,wasm_pthread_mutex_trylock:()=>m,wasm_pthread_mutex_unlock:()=>g,wasm_pthread_once:()=>x,wasm_pthread_self2:()=>T,wasm_pthread_support:()=>P,wasm_threw_error:()=>S});var r=i(42524),s=i(77389),a=i(59502),o=i(773),n=i(75176),h=i(33740),d=i(53971),c=i(84799),l=i(41863);let u,f,p,m,g,A,v,y,b,k,w,x;function T(){return c.TK.__SELF_THREAD__}function I(e){const t=c.TK.__SELF_THREAD__;s.M[20](t+4,e),s.M[15](t+8,4|r.f[15](t+8))}function _(e,t){return r.f[15](e)===r.f[15](t)?1:0}function P(){return n.USE_THREADS?1:0}function M(){return navigator.hardwareConcurrency}function S(e,t){throw new Error((0,l.lH)(t))}function C(e){return a.yh(e)}function R(e,t){return o.of(e,t)}function B(e,t,i){let s=1e3*Number(r.f[17](i))+r.f[15](i+8)/1e6;return o.fs(e,t,s)}function D(e){e.wasm_pthread_mutex_lock&&(p=e.wasm_pthread_mutex_lock),e.wasm_pthread_mutex_trylock&&(m=e.wasm_pthread_mutex_trylock),e.wasm_pthread_mutex_unlock&&(g=e.wasm_pthread_mutex_unlock),e.wasm_pthread_cond_wait&&(y=e.wasm_pthread_cond_wait),e.wasm_pthread_cond_timedwait&&(b=e.wasm_pthread_cond_timedwait),e.wasm_pthread_cond_signal&&(k=e.wasm_pthread_cond_signal),e.wasm_pthread_cond_broadcast&&(w=e.wasm_pthread_cond_broadcast)}u=function(e,t){return a.Ts(e)},f=function(e){return a.zr(e)},p=function(e){return a.s2(e)},m=function(e){return a.bh(e)},g=function(e){return a.Tl(e)},A=function(e,t){return o.Ts(e,t)},v=function(e){return o.zr(e)},y=function(e,t){return o.uk(e,t)},b=function(e,t,i){let s=1e3*Number(r.f[17](i))+r.f[15](i+8)/1e6;return o.XR(e,t,s)},k=function(e){return o.vP(e)},w=function(e){return o.mq(e)},x=function(e,t){return 0===d.WQ(e,1,16,2)&&h.XI.get(t)(),0}},66528:(e,t,i)=>{i.r(t),i.d(t,{Timespec:()=>d,wasm_sem_destroy:()=>l,wasm_sem_init:()=>c,wasm_sem_post:()=>m,wasm_sem_timedwait:()=>p,wasm_sem_trywait:()=>f,wasm_sem_wait:()=>u});var r,s=i(19371),a=i(75354),o=i(86220),n=i(42524),h=i(43847);class d{constructor(){(0,s.A)(this,"tvSec",void 0),(0,s.A)(this,"tvNSec",void 0)}}function c(e,t,i){return h.Ts(e,i)}function l(e){return h.zr(e)}function u(e){return h.uk(e)}function f(e){return h.Zr(e)}function p(e,t){let i=1e3*Number(n.f[17](t))+n.f[15](t+8)/1e6;return h.XR(e,i)}function m(e){return h.bE(e)}r=d,(()=>{const e=r.prototype,t=new Map;t.set("tvSec",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("tvNSec",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,8),(0,o.A)(e,a.g7,16),(0,o.A)(e,a.JY,t)})()},44132:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(84799);class a{constructor(e,t){(0,r.A)(this,"type",void 0),(0,r.A)(this,"phase",void 0),(0,r.A)(this,"ns",void 0),(0,r.A)(this,"target",void 0),(0,r.A)(this,"originalEvent",void 0),(0,r.A)(this,"isPrevented",void 0),(0,r.A)(this,"isStopped",void 0),(0,r.A)(this,"listener",void 0),this.type=e,this.phase=a.PHASE_CURRENT,t&&(this.originalEvent=t)}preventDefault(){const e=this;if(!e.isPrevented){const{originalEvent:t}=e;t&&t.preventDefault(),e.isPrevented=s.rT}return e}stopPropagation(){const e=this;if(!e.isStopped){const{originalEvent:t}=e;t&&t.stopPropagation(),e.isStopped=s.rT}return e}prevent(){return this.preventDefault()}stop(){return this.stopPropagation()}}(0,r.A)(a,"PHASE_CURRENT",0),(0,r.A)(a,"PHASE_UPWARD",1),(0,r.A)(a,"PHASE_DOWNWARD",s.Cy)},47691:(e,t,i)=>{i.d(t,{A:()=>l});var r=i(19371),s=i(81819),a=i(17630),o=i(44132),n=i(25092),h=i(67094),d=i(16460),c=i(84799);class l{constructor(e){(0,r.A)(this,"ns",void 0),(0,r.A)(this,"listeners",void 0),(0,r.A)(this,"nativeListeners",void 0),this.ns=e||c.W8,this.listeners={}}fire(e,t,i){let r=this,h=s.Yj(e)?r.parse(e):e,l=r.listeners[h.type],u=c.rT;if(l){l=n.C(l);const e=t&&t[0]instanceof o.A?t[0]:c.ZH;a.__(l,(function(s){if(!p(h.ns,s,c.rT)||!a.zy(l,s)||i&&!i(h,t,s))return;e&&(e.listener=s.fn);let o=(0,d.A)(s.fn,s.ctx,t);return e&&(e.listener=c.ZH),s.num=s.num?s.num+1:1,s.num===s.max&&r.off(h,s.fn),e&&(o===c.W8?e.prevent().stop():e.isStopped&&(o=c.W8)),o===c.W8?u=c.W8:void 0}))}return u}on(e,t){const i=this,r=i.listeners,o=s.Pc(t)?{fn:t}:t;if(s.Ik(o)&&s.Pc(o.fn)){const t=s.Yj(e)?i.parse(e):e;o.ns=t.ns,a.VC(r[t.type]||(r[t.type]=[]),o)}return this}one(e,t){return s.Pc(t)?t={fn:t,max:1}:t.max=1,this.on(e,t)}off(e,t){const i=this,r=i.listeners;if(e){const o=s.Yj(e)?i.parse(e):e,h=o.type,d=o.ns,l=f(t),u=function(e,t){a.__(e,(function(t,i){l(t)&&e.splice(i,1)}),c.rT),e.length||delete r[t]},m=function(e,t){a.__(e,(function(t,i){p(d,t)&&e.splice(i,1)}),c.rT),e.length||delete r[t]};h?r[h]&&u(r[h],h):d&&n.__(r,m)}else i.listeners={}}has(e,t){let i=this.listeners,r=s.Yj(e)?this.parse(e):e,o=r.type,h=r.ns,d=c.rT,l=f(t);var u;return o?i[o]&&(u=i[o],a.__(u,(function(e){if(l(e))return d=c.W8}))):h&&n.__(i,(function(e){return a.__(e,(function(e){if(p(h,e))return d=c.W8})),d})),!d}parse(e){const t={type:e,ns:c.u1};if(this.ns){const i=h.qh(e,c.ZG);i>=0&&(t.type=h.di(e,0,i),t.ns=h.di(e,i+1))}return t}}function u(){return c.rT}function f(e){return s.Pc(e)?function(t){return e===t.fn}:u}function p(e,t,i){const{ns:r}=t;return r&&e?r===e:i?c.rT:c.W8}},90179:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(3315);function s(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=t.split("."),a=e.split(".");for(let e=0;e<a.length;e++){if(i&&e==a.length-1&&(0,r.A)(a[e])>=(0,r.A)(s[e]))return a.length>=s.length;if((0,r.A)(a[e])>(0,r.A)(s[e]))return!0;if((0,r.A)(a[e])<(0,r.A)(s[e]))return!1;if(e===s.length-1&&e===a.length-1)return i;if(e===s.length-1)return!0;if(e===a.length-1)return!1}return!0}},33134:(e,t,i)=>{function r(e,t){if(!t.length)return null;if(1===t.length)return t[0];let i,r=0;for(i of t)r+=i.length;let s=new e(r),a=0;for(i of t)s.set(i,a),a+=i.length;return s}i.d(t,{A:()=>r})},66968:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(16460),s=i(17630),a=i(84799);function o(e,t,i){let o,n,h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return function(){let d=this;h&&(n=s.$r(arguments)),o||(h||(n=s.$r(arguments)),i&&(0,r.A)(e,d,n),o=setTimeout((function(){o=a.ZH,i||(0,r.A)(e,d,n)}),t))}}},16460:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(81819),s=i(84799);function a(e,t,i){if(r.Pc(e))return r.YO(i)?e.apply(t,i):t!==s.ZH?e.call(t,i):i!==s.ZH?e(i):e()}},58999:(e,t,i)=>{function r(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)}))}i.d(t,{A:()=>r})},16563:(e,t,i)=>{function r(){return Date.now()}i.d(t,{A:()=>r})},59087:(e,t,i)=>{function r(){return"function"==typeof registerProcessor&&"number"==typeof sampleRate&&"number"==typeof currentFrame&&"number"==typeof currentTime}i.d(t,{A:()=>r})},65992:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(84799);function s(e){return e!==r.ZH}},45984:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(65992);let s;function a(){if((0,r.A)(s))return s;const e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),s=256===new Int16Array(e)[0],s}},86444:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(81819),s=i(73575),a=i(67094);function o(e){return r.Pc(e)&&a.zy((0,s.A)(e),"[native code]")}},47845:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(65992),s=i(59087);function a(){return!("object"==typeof window&&(0,r.A)(window.document)||(0,s.A)())}},32347:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(86444),s=i(84799);let a;typeof setImmediate===s.s0&&(0,r.A)(setImmediate)&&(a=setImmediate),a=typeof MessageChannel===s.s0&&(0,r.A)(MessageChannel)?function(e){const t=new MessageChannel;t.port1.onmessage=e,t.port2.postMessage(1)}:"function"==typeof setTimeout?setTimeout:function(e){setTimeout(e)};const o=a},54579:(e,t,i)=>{function r(e,t,i){return e<t?e=t:e>i&&(e=i),e}i.d(t,{A:()=>r})},546:(e,t,i)=>{i.d(t,{A:()=>d});const r='\nfunction webpackBootstrapFunc (modules) {\n  var installedModules = {};\n  function __webpack_require__(moduleId) {\n    if(installedModules[moduleId])\n    return installedModules[moduleId].exports;\n    var module = installedModules[moduleId] = {\n      i: moduleId,\n      l: false,\n      exports: {}\n    };\n    if (!modules[moduleId]) {\n      console.error(\'can not found module:\', moduleId)\n    }\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    module.l = true;\n    return module.exports;\n  }\n  __webpack_require__.m = modules;\n  __webpack_require__.c = installedModules;\n  __webpack_require__.i = function(value) { return value; };\n  __webpack_require__.d = function(exports, definition, getter) {\n    if (typeof definition === \'string\') {\n      if(!__webpack_require__.o(exports, definition)) {\n        Object.defineProperty(exports, definition, {\n          enumerable: true,\n          get: getter\n        });\n      }\n    }\n    else {\n      for(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n          Object.defineProperty(exports, key, {\n            enumerable: true,\n            get: definition[key]\n          });\n        }\n      }\n    }\n  };\n  __webpack_require__.r = function(exports) {\n    if(typeof Symbol !== \'undefined\' && Symbol.toStringTag) {\n    \tObject.defineProperty(exports, Symbol.toStringTag, { value: \'Module\' });\n    }\n    Object.defineProperty(exports, \'__esModule\', { value: true });\n  };\n  __webpack_require__.f = {};\n  __webpack_require__.e = function(chunkId) {\n    return Promise.all(Object.keys(__webpack_require__.f).reduce(function (promises, key) {\n      __webpack_require__.f[key](chunkId, promises);\n        return promises;\n    \t}, []));\n\t};\n  __webpack_require__.u = function(chunkId) {\n    return chunkId + "LIB_NAME";\n  };\n  __webpack_require__.n = function(module) {\n    var getter = module && module.__esModule ?\n      function getDefault() { return module[\'default\']; } :\n      function getModuleExports() { return module; };\n    __webpack_require__.d(getter, \'a\', getter);\n    return getter;\n  };\n  (function() {\n    var installedChunks = {\n      "main": 0\n    };\n    __webpack_require__.f.j = function(chunkId, promises) {\n      var installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n      if (installedChunkData !== 0) {\n        if(installedChunkData) {\n          promises.push(installedChunkData[2]);\n        } else {\n          if (true) {\n            var promise = new Promise(function(resolve, reject){installedChunkData = installedChunks[chunkId] = [resolve, reject]});\n            promises.push(installedChunkData[2] = promise);\n            var url = __webpack_require__.p + __webpack_require__.u(chunkId);\n            var error = new Error();\n            var loadingEnded = function(event) {\n              if(__webpack_require__.o(installedChunks, chunkId)) {\n                installedChunkData = installedChunks[chunkId];\n                if(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n                if(installedChunkData) {\n                  var errorType = event && (event.type === \'load\' ? \'missing\' : event.type);\n                  var realSrc = url;\n                  error.message = "Loading chunk " + chunkId + " failed.\\n(" + errorType + ": " + realSrc + ")";\n                  error.name = "ChunkLoadError";\n                  error.type = errorType;\n                  error.request = realSrc;\n                  installedChunkData[1](error);\n                }\n              }\n            };\n            __webpack_require__.l(url, loadingEnded);\n          }\n        }\n      }\n    };\n    var webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n    var [chunkIds, moreModules, runtime] = data;\n    var moduleId, chunkId, i = 0;\n    if (chunkIds.some(function(id){return installedChunks[id] !== 0})) {\n      for(moduleId in moreModules) {\n        if(__webpack_require__.o(moreModules, moduleId)) {\n          __webpack_require__.m[moduleId] = moreModules[moduleId];\n        }\n      }\n      if(runtime) runtime(__webpack_require__);\n    }\n    if (parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n      for (;i < chunkIds.length; i++) {\n        chunkId = chunkIds[i];\n        if (__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n          installedChunks[chunkId][0]();\n        }\n        installedChunks[chunkId] = 0;\n      }\n    }\n    var self = typeof globalThis !== undefined ? globalThis : self\n    var exportName = \'LIBRARY_EXPORT_NAME\'\n    var chunkLoadingGlobal = self["webpackChunk" + exportName] = self["webpackChunk" + exportName] || [];\n    chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\n    chunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\n  })();\n  (function() {\n    var inProgress = {};\n    __webpack_require__.l = function(url, done) {\n      if (inProgress[url]) { inProgress[url].push(done); return; }\n        inProgress[url] = [done];\n        var onComplete = function(event) {\n          clearTimeout(timeout);\n          var doneFns = inProgress[url];\n          delete inProgress[url];\n          doneFns && doneFns.forEach(function(fn){fn(event)});\n        }\n        var timeout = setTimeout(onComplete.bind(null, undefined, { type: "timeout" }), 120000);\n      if (typeof importScripts === \'function\') {\n        try {\n          importScripts(url);onComplete({type: "load"});\n        }\n        catch(e) {\n          onComplete({type: "missing"});\n        }\n      }\n      else {\n        import(url).then(function() {\n          onComplete({\n            type: "load"\n          });\n        }, function (error) {\n          onComplete({\n            type: "missing"\n          });\n        })\n      }\n    };\n  })();\n  __webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n  __webpack_require__.p = "ROOT_URL";\n  __webpack_require__.oe = function(err) { console.error(err); throw err; };\n  var f = __webpack_require__(__webpack_require__.s = ENTRY_MODULE);\n  return f;\n}\n',s="[\\.|\\-|\\+|\\w|/|@|!]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+s+").*?\\)";function o(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function n(e,t,r,n){const h={};h[r]=[];let d=t.toString();const c=d.match(/^(function)?\s?\w*\(\w+,\s*(\w+),\s*(\w+)\)/);if(!c)return h;const l=c[3];n.__webpack_exports_process__||(n.__webpack_require__=l,n.__webpack_exports__=c[2],n.__webpack_exports_process__=!0);let u,f=new RegExp("(\\\\n|\\W)"+o(l)+a,"g");for(;u=f.exec(d);)"dll-reference"!==u[3]&&h[r].push(u[3]);for(f=new RegExp("(\\\\n|\\W)"+o(l)+"\\.bind\\("+l+",\\s*(/\\*.*?\\*/)?\\s*.*?("+s+").*?\\)","g");u=f.exec(d);)"dll-reference"!==u[3]&&h[r].push(u[3]);for(f=new RegExp("\\("+o(l)+'\\("(dll-reference\\s('+s+'))"\\)\\)'+a,"g");u=f.exec(d);)e[u[2]]||(h[r].push(u[1]),e[u[2]]=i(u[1]).m),h[u[2]]=h[u[2]]||[],h[u[2]].push(u[4]);const p=Object.keys(h);for(let e=0;e<p.length;e++)for(let t=0;t<h[p[e]].length;t++)m=+h[p[e]][t],isNaN(m)||(h[p[e]][t]=+h[p[e]][t]);var m;return h}function h(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}function d(e,t){const s={main:i.m},a=function(e,t){const i={main:[t]},r={main:[],__webpack_exports__:"__webpack_exports__",__webpack_require__:"__webpack_require__",__webpack_exports_process__:!1},s={main:{}};for(;h(i);){const t=Object.keys(i);for(let a=0;a<t.length;a++){let o=t[a],h=i[o].pop();if(s[o]=s[o]||{},s[o][h]||!e[o][h])continue;s[o][h]=!0,r[o]=r[o]||[],r[o].push(h);let d=n(e,e[o][h],o,r),c=Object.keys(d);for(let e=0;e<c.length;e++)i[c[e]]=i[c[e]]||[],i[c[e]]=i[c[e]].concat(d[c[e]])}}return r}(s,e);let o=JSON.stringify(e);return"var "+t.varName+"=("+r.replace("ENTRY_MODULE",o).replace("ROOT_URL",i.p||"").replace("LIBRARY_EXPORT_NAME","AVPlayer").replace("LIB_NAME",i.u&&i.u("")||"")+")({"+a.main.map((function(e){const i=JSON.stringify(e);let r=i+": "+s.main[e].toString();if(i===o&&t.exportName&&t.pointName){const e=`;${a.__webpack_require__}.d(\n          ${a.__webpack_exports__},\n          "${t.exportName}",\n          function() {\n            if (${t.exportIsClass}) {\n              for (var key in ${a.__webpack_exports__}) {\n                if (key === '${t.exportName}') {\n                  continue;\n                }\n                var v = ${a.__webpack_exports__}[key];\n                if (typeof v === 'function' && v.name === '${t.pointName}') {\n                  return v;\n                }\n              }\n            }\n            return ${t.pointName};\n          }\n        );`;r=r.slice(0,r.length-1)+e+"}"}return r})).join(",")+"});"}},3315:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(81819),s=i(84799);function a(e,t){return r.sH(e)?+e:t!==s.ZH?t:0}},73575:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(84799);function s(e,t){return e!=r.Cq&&e.toString?e.toString():t!==r.ZH?t:r.u1}},3760:(e,t,i)=>{function r(){let e,t;return{promise:new Promise(((i,r)=>{e=i,t=r})),resolve:e,reject:t}}i.d(t,{A:()=>r})},5752:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(81819);class a{constructor(){(0,r.A)(this,"proxy",void 0),this.proxy=new Proxy(this,{get:(e,t,i)=>s.sH(t)?e.getIndexValue(+t):e[t],set:(e,t,i,r)=>(s.sH(t)?e.setIndexValue(+t,i):e[t]=i,!0)})}}},5043:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(87339);class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576;(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitsLeft",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"endPointer",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.pos=BigInt(0),this.size=e,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let e=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let t=this.pointer,i=this.bitsLeft;return 0===i&&(t++,i=8),e=this.buffer[t]>>i-1&1,e}readU1(){let e=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,e=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8,this.pos++),e}readU(e){let t=0;for(let i=0;i<e;i++)t|=this.readU1()<<e-i-1;return t}peekU(e){const t=this.pointer,i=this.bitsLeft,r=this.pos,s=this.readU(e);return this.pointer=t,this.bitsLeft=i,this.pos=r,s}remainingLength(){return this.endPointer-this.pointer}getBitLeft(){return this.bitsLeft}getPointer(){return this.pointer}setPointer(e){this.pointer=e}getPos(){return this.pos}skip(e){const t=(e-e%8)/8;this.pointer+=t,this.pos+=BigInt(t);const i=e%8;this.bitsLeft<=i?(this.pointer++,this.pos++,this.bitsLeft=8-(i-this.bitsLeft)):this.bitsLeft-=i}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&(this.pointer++,this.pos++),!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const e=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(e<0)throw this.error=e,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+e,this.pointer=0}else{const e=this.onFlush(this.buffer);if(this.endPointer=e,this.pointer=0,this.bitsLeft=8,e<0)throw this.error=e,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(e){if(this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else{const t=Math.min(this.size-this.endPointer,e.length);this.buffer.set(e.subarray(0,t),this.endPointer),this.endPointer+=t,s.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","packages/common/src/io/BitReader.ts",257)}}reset(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0,this.pos=BigInt(0)}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++,this.pos++)}}},56772:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(19371);class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576;(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"bitPointer",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=e,this.error=0,this.pos=BigInt(0),this.buffer=new Uint8Array(this.size)}writeU1(e){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&e?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.pos++,this.bitPointer=0)}writeU(e,t){for(let i=0;i<e;i++)this.writeU1(t>>e-i-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>0){const e=this.onFlush(this.buffer.subarray(0,this.pointer).slice());if(0!==e)throw this.error=e,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}reset(){this.pointer=0,this.bitPointer=0,this.error=0,this.pos=BigInt(0)}getBuffer(){return this.buffer}getPointer(){return this.pointer}getPos(){return this.pos}}},54570:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(19371),s=i(33134),a=i(4068);class o{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"byteStart",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}readUint8(){return this.data.getUint8(this.pos+++this.byteStart)}peekUint8(){return this.data.getUint8(this.pos+this.byteStart)}readUint16(){const e=this.data.getUint16(this.pos+this.byteStart,this.littleEndian);return this.pos+=2,e}peekUint16(){return this.data.getUint16(this.pos+this.byteStart,this.littleEndian)}readUint24(){const e=this.readUint16(),t=this.readUint8();return this.littleEndian?t<<16|e:e<<8|t}peekUint24(){const e=this.readUint16(),t=this.readUint8();return this.pos-=3,this.littleEndian?t<<16|e:e<<8|t}readUint32(){const e=this.data.getUint32(this.pos+this.byteStart,this.littleEndian);return this.pos+=4,e}peekUint32(){return this.data.getUint32(this.pos+this.byteStart,this.littleEndian)}readUint64(){const e=BigInt(this.readUint32()),t=BigInt(this.readUint32());return this.littleEndian?t<<BigInt(32)|e:e<<BigInt(32)|t}peekUint64(){const e=BigInt(this.readUint32()),t=BigInt(this.readUint32());return this.pos-=8,this.littleEndian?t<<BigInt(32)|e:e<<BigInt(32)|t}readInt8(){return this.data.getInt8(this.pos+++this.byteStart)}peekInt8(){return this.data.getInt8(this.pos+this.byteStart)}readInt16(){const e=this.data.getInt16(this.pos+this.byteStart,this.littleEndian);return this.pos+=2,e}peekInt16(){return this.data.getInt16(this.pos+this.byteStart,this.littleEndian)}readInt24(){const e=this.readUint24();return 8388608&e?e-16777216:e}peekInt24(){const e=this.peekUint24();return 8388608&e?e-16777216:e}readInt32(){const e=this.data.getInt32(this.pos+this.byteStart,this.littleEndian);return this.pos+=4,e}peekInt32(){return this.data.getInt32(this.pos+this.byteStart,this.littleEndian)}readInt64(){const e=BigInt(this.readInt32()),t=BigInt(this.readInt32());return this.littleEndian?t<<BigInt(32)|e:e<<BigInt(32)|t}peekInt64(){const e=BigInt(this.readInt32()),t=BigInt(this.readInt32());return this.pos-=8,this.littleEndian?t<<BigInt(32)|e:e<<BigInt(32)|t}readFloat(){const e=this.data.getFloat32(this.pos+this.byteStart,this.littleEndian);return this.pos+=4,e}peekFloat(){return this.data.getFloat32(this.pos+this.byteStart,this.littleEndian)}readDouble(){const e=this.data.getFloat64(this.pos+this.byteStart,this.littleEndian);return this.pos+=8,e}peekDouble(){return this.data.getFloat64(this.pos+this.byteStart,this.littleEndian)}readHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="";for(let i=0;i<e;i++){const e=this.readUint8().toString(16);t+=1===e.length?"0"+e:e}return t}peekHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=this.pos,i=this.readHex(e);return this.pos=t,i}readString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="";if(e){let i=this.pos;for(let t=0;t<e&&0===this.buffer[this.pos+t];t++)i++;t=a.decode(this.buffer.subarray(i,i+e))}return this.pos+=e,t}peekString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=this.pos,i=this.readString(e);return this.pos=t,i}readLine(){let e="";for(let t=this.pos;t<this.size;t++)if(10===this.buffer[t]||13===this.buffer[t]){e+=this.readString(t-this.pos);break}for(let e=this.pos;e<this.size&&(10===this.buffer[e]||13===this.buffer[e]);e++)this.readUint8();return e}peekLine(){const e=this.pos,t=this.readLine();return this.pos=e,t}getPos(){return BigInt(this.pos)}seek(e){e>this.size&&(e=this.size),this.pos=Math.max(0,e)}skip(e){this.seek(this.pos+e)}back(e){this.seek(this.pos-e)}remainingSize(){return this.size-this.pos}readBuffer(e){e=Math.min(e,this.remainingSize());const t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t}appendBuffer(e){this.buffer=(0,s.A)(Uint8Array,[this.buffer.slice(),e.slice()]),this.data=new DataView(this.buffer.buffer),this.size+=e.byteLength,this.byteStart=0}resetBuffer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}}},21374:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(19371),s=i(87339),a=i(4068);class o{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"byteStart",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}writeUint8(e){this.data.setUint8(this.pos+++this.byteStart,e)}writeUint16(e){this.data.setUint16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}writeUint24(e){const t=3840&e,i=240&e,r=15&e;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(i),this.writeUint8(r))}writeUint32(e){this.data.setUint32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeUint64(e){this.data.setBigUint64(this.pos+this.byteStart,e,this.littleEndian),this.pos+=8}writeInt8(e){this.data.setInt8(this.pos+++this.byteStart,e)}writeInt16(e){this.data.setInt16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}writeInt24(e){this.writeUint24(e<0?e+16777216:e)}writeInt32(e){this.data.setInt32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeInt64(e){this.data.setBigInt64(this.pos+this.byteStart,e,this.littleEndian),this.pos+=8}writeFloat(e){this.data.setFloat32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeDouble(e){this.data.setFloat64(this.pos+this.byteStart,e,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(e){e>this.size&&(e=this.size),this.pos=Math.max(0,e)}skip(e){this.seek(this.pos+e)}back(e){this.seek(this.pos-e)}remainingSize(){return this.size-this.pos}writeBuffer(e){let t=e.length;this.remainingSize()<t&&(t=this.remainingSize(),s.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${e.length}, but set ${t}`,"packages/common/src/io/BufferWriter.ts",202)),this.buffer.set(e,this.pos),this.pos+=e.length}writeString(e){const t=a.encode(e);return this.writeBuffer(t),t.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}}},31616:(e,t,i)=>{i.d(t,{A:()=>h});var r=i(19371),s=i(87339),a=i(4068),o=i(88583);const n="packages/common/src/io/IOReader.ts";class h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;if((0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"endPointer",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),(0,r.A)(this,"fileSize_",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),(0,r.A)(this,"onSeek",void 0),(0,r.A)(this,"onSize",void 0),(0,r.A)(this,"flags",void 0),(0,r.A)(this,"flushResolve",void 0),this.pos=BigInt(0),this.pointer=0,this.error=0,this.endPointer=0,this.littleEndian=!t,this.flags=0,i&&i.view)this.size=i.length,this.buffer=i,this.data=i.view;else if(i&&!i.byteOffset)this.size=i.length,this.buffer=i,this.data=new DataView(this.buffer.buffer);else{if(i)throw new Error("not support subarray of ArrayBuffer");this.size=Math.max(e,102400),this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}async readUint8(){this.remainingLength()<1&&await this.flush(1);const e=this.data.getUint8(this.pointer);return this.pointer++,this.pos++,e}async peekUint8(){return this.remainingLength()<1&&await this.flush(1),this.data.getUint8(this.pointer)}async readUint16(){this.remainingLength()<2&&await this.flush(2);const e=this.data.getUint16(this.pointer,this.littleEndian);return this.pointer+=2,this.pos+=BigInt(2),e}async peekUint16(){return this.remainingLength()<2&&await this.flush(2),this.data.getUint16(this.pointer,this.littleEndian)}async readUint24(){this.remainingLength()<3&&await this.flush(3);const e=await this.readUint16(),t=await this.readUint8();return this.littleEndian?t<<16|e:e<<8|t}async peekUint24(){this.remainingLength()<3&&await this.flush(3);const e=this.pointer,t=this.pos,i=await this.readUint16(),r=await this.readUint8(),s=this.littleEndian?r<<16|i:i<<8|r;return this.pointer=e,this.pos=t,s}async readUint32(){this.remainingLength()<4&&await this.flush(4);const e=this.data.getUint32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),e}async peekUint32(){return this.remainingLength()<4&&await this.flush(4),this.data.getUint32(this.pointer,this.littleEndian)}async readUint64(){this.remainingLength()<8&&await this.flush(8);const e=this.data.getBigUint64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),e}async peekUint64(){return this.remainingLength()<8&&await this.flush(8),this.data.getBigUint64(this.pointer,this.littleEndian)}async readInt8(){this.remainingLength()<1&&await this.flush(1);const e=this.data.getInt8(this.pointer);return this.pointer++,this.pos++,e}async peekInt8(){return this.remainingLength()<1&&await this.flush(1),this.data.getInt8(this.pointer)}async readInt16(){this.remainingLength()<2&&await this.flush(2);const e=this.data.getInt16(this.pointer,this.littleEndian);return this.pointer+=2,this.pos+=BigInt(2),e}async peekInt16(){return this.remainingLength()<2&&await this.flush(2),this.data.getInt16(this.pointer,this.littleEndian)}async readInt24(){const e=await this.readUint24();return 8388608&e?e-16777216:e}async peekInt24(){const e=await this.peekUint24();return 8388608&e?e-16777216:e}async readInt32(){this.remainingLength()<4&&await this.flush(4);const e=this.data.getInt32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),e}async peekInt32(){return this.remainingLength()<4&&await this.flush(4),this.data.getInt32(this.pointer,this.littleEndian)}async readInt64(){this.remainingLength()<8&&await this.flush(8);const e=this.data.getBigInt64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),e}async peekInt64(){return this.remainingLength()<8&&await this.flush(8),this.data.getBigInt64(this.pointer,this.littleEndian)}async readFloat(){this.remainingLength()<4&&await this.flush(4);const e=this.data.getFloat32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),e}async peekFloat(){return this.remainingLength()<4&&await this.flush(4),this.data.getFloat32(this.pointer,this.littleEndian)}async readDouble(){this.remainingLength()<8&&await this.flush(8);const e=this.data.getFloat64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),e}async peekDouble(){return this.remainingLength()<8&&await this.flush(8),this.data.getFloat64(this.pointer,this.littleEndian)}async readHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="";for(let i=0;i<e;i++){const e=(await this.readUint8()).toString(16);t+=1===e.length?"0"+e:e}return t}async peekHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e>this.size&&(this.error=-1048574,s.h2("peekHex, length too large",n,416)),this.remainingLength()<e&&await this.flush(e);const t=this.pointer,i=this.pos;let r="";for(let t=0;t<e;t++){const e=(await this.readUint8()).toString(16);r+=1===e.length?"0"+e:e}return this.pointer=t,this.pos=i,r}async readBuffer(e,t){if(t||(t=new Uint8Array(e)),this.remainingLength()<e){let i=0;if(this.remainingLength()>0){const r=this.remainingLength();t.set(this.buffer.subarray(this.pointer,this.pointer+r),i),i+=r,this.pointer+=r,this.pos+=BigInt(r),e-=r}for(;e>0;){await this.flush();const r=Math.min(this.endPointer-this.pointer,e);t.set(this.buffer.subarray(this.pointer,this.pointer+r),i),i+=r,this.pointer+=r,this.pos+=BigInt(r),e-=r}}else t.set(this.buffer.subarray(this.pointer,this.pointer+e),0),this.pointer+=e,this.pos+=BigInt(e);return t}async peekBuffer(e,t){return e>this.size&&(this.error=-1048574,s.h2("peekBuffer, length too large",n,501)),this.remainingLength()<e&&await this.flush(e),t||(t=new Uint8Array(e)),t.set(this.buffer.subarray(this.pointer,this.pointer+e),0),t}async readToBuffer(e,t){if(this.remainingLength()<e){let i=0;if(this.remainingLength()>0){const r=this.remainingLength();t.set(this.buffer.subarray(this.pointer,this.pointer+r),i),i+=r,this.pointer+=r,this.pos+=BigInt(r),e-=r}for(;e>0;){try{await this.flush()}catch(e){if(-1048576===this.error&&i)return i;throw e}const r=Math.min(this.endPointer-this.pointer,e);t.set(this.buffer.subarray(this.pointer,this.pointer+r),i),i+=r,this.pointer+=r,this.pos+=BigInt(r),e-=r}return i}return t.set(this.buffer.subarray(this.pointer,this.pointer+e),0),this.pointer+=e,this.pos+=BigInt(e),e}async readString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=await this.readBuffer(e);return a.decode(t)}async peekString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=await this.peekBuffer(e);return a.decode(t)}async readLine(){let e="";for(;;){let t=!1;for(let i=this.pointer;i<this.endPointer;i++)if(10===this.buffer[i]||13===this.buffer[i]){i!==this.pointer&&(e+=await this.readString(i-this.pointer)),t=!0;break}if(t)break;e+=await this.readString(this.remainingLength()),await this.flush()}let t=await this.peekUint8();return 10!==t&&13!==t||(this.pointer++,13===t&&(t=await this.peekUint8(),10===t&&this.pointer++)),e}async peekLine(){if(this.remainingLength()<this.size)try{await this.flush()}catch(e){if(-1048576!==this.error)throw e}let e="",t=!1;for(let i=this.pointer;i<this.endPointer;i++)if(10===this.buffer[i]||13===this.buffer[i]){e+=await this.peekString(i-this.pointer),t=!0;break}return t||(this.error=-1048574,s.h2("peekLine, out of buffer",n,659)),e}getPointer(){return this.pointer}getPos(){return this.pos}async skip(e){const t=e;for(;this.remainingLength()<e;)e-=this.remainingLength(),this.pointer=this.endPointer,await this.flush();this.remainingLength()>=e&&(this.pointer+=e),this.pos+=BigInt(t)}remainingLength(){return this.endPointer-this.pointer}async flush_(e){return new Promise((async t=>{for(this.flushResolve=t;;){const i=await this.onFlush(e);if(-1048575!==i){this.flushResolve=null,t(i);break}await new o.A(0)}}))}async flush(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.onFlush||(this.error=-1048574,s.h2("IOReader error, flush failed because of no flush callback",n,738)),!(this.size-this.remainingLength()<=0)){if(e=Math.min(e,this.size),this.pointer<this.endPointer?(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer):this.endPointer=0,this.pointer=0,e)for(;this.remainingLength()<e;){const e=await this.flush_(this.buffer.subarray(this.endPointer));if(e<0)throw this.error=e,new Error(`IOReader error, flush ${-1048576===e?"ended":"failed"}, ret: ${e}`);this.endPointer+=e}else{const e=await this.flush_(this.buffer.subarray(this.endPointer));if(e<0)throw this.error=e,new Error(`IOReader error, flush ${-1048576===e?"ended":"failed"}, ret: ${e}`);this.endPointer+=e}this.error=0}}async seek(e){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])){const t=Number(e-this.pos);if(t<0&&Math.abs(t)<=this.pointer)return this.pointer+=t,void(this.pos=e);if(t>0&&this.pointer+t<this.endPointer)return this.pointer+=t,void(this.pos=e);if(0===t)return}this.onSeek||(this.error=-1048574,s.h2("IOReader error, seek failed because of no seek callback",n,809)),this.pointer=this.endPointer=0,this.pos=e;const i=await this.onSeek(e);0!==i&&(this.error=i,s.h2("IOReader error, seek failed",n,818)),t&&await this.flush()}getBuffer(){return this.buffer}appendBuffer(e){if(this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else{const t=Math.min(this.size-this.endPointer,e.length);this.buffer.set(e.subarray(0,t),this.endPointer),this.endPointer+=t,s.R8("IOReader, call appendBuffer but the buffer's size is lagger then the remaining size",n,856)}}reset(){this.pointer=this.endPointer=0,this.pos=BigInt(0),this.error=0}setEndian(e){this.littleEndian=!e}isBigEndian(){return!this.littleEndian}async fileSize(){if(this.fileSize_)return this.fileSize_;if(!this.onSize)return s.R8("IOReader error, fileSize failed because of no onSize callback",n,898),BigInt(0);try{this.fileSize_=await this.onSize()}catch(e){s.R8(`IOReader error, call fileSize failed: ${e}`,n,905),this.fileSize_=BigInt(0)}return this.fileSize_}getBufferSize(){return this.size}async pipe(e,t){if(t)if(this.remainingLength()<t){if(this.remainingLength()>0){const i=this.remainingLength();await e.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+i)),this.pointer+=i,this.pos+=BigInt(i),t-=i}for(;t>0;){await this.flush();const i=Math.min(this.remainingLength(),t);await e.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+i)),this.pointer+=i,this.pos+=BigInt(i),t-=i}}else await e.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+t)),this.pointer+=t,this.pos+=BigInt(t);else{if(this.remainingLength()>0){const t=this.remainingLength();await e.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+t)),this.pointer+=t,this.pos+=BigInt(t)}for(;await this.flush_(this.buffer.subarray(0))>0;){const t=this.remainingLength();await e.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+t)),this.pointer+=t,this.pos+=BigInt(t)}}}abort(){this.error=-1048572,this.flushResolve&&(this.flushResolve(-1048572),this.flushResolve=null)}}},28032:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(4068);class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;if((0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),(0,r.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=e,this.littleEndian=!t,this.error=0,i&&i.view)this.size=i.length,this.buffer=i,this.data=i.view;else if(i&&!i.byteOffset)this.size=i.length,this.buffer=i,this.data=new DataView(this.buffer.buffer);else{if(i)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}async writeUint8(e){this.remainingLength()<1&&await this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}async writeUint16(e){this.remainingLength()<2&&await this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}async writeUint24(e){this.remainingLength()<3&&await this.flush();const t=(16711680&e)>>16,i=(65280&e)>>8,r=255&e;this.littleEndian?(await this.writeUint8(r),await this.writeUint8(i),await this.writeUint8(t)):(await this.writeUint8(t),await this.writeUint8(i),await this.writeUint8(r))}async writeUint32(e){this.remainingLength()<4&&await this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}async writeUint64(e){this.remainingLength()<8&&await this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}async writeInt8(e){this.remainingLength()<1&&await this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}async writeInt16(e){this.remainingLength()<2&&await this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}async writeInt24(e){await this.writeUint24(e<0?e+16777216:e)}async writeInt32(e){this.remainingLength()<4&&await this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}async writeInt64(e){this.remainingLength()<8&&await this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}async writeFloat(e){this.remainingLength()<4&&await this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}async writeDouble(e){this.remainingLength()<8&&await this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}async writeBuffer(e){if(!e.length)return;let t=e.length;if(this.remainingLength()<t){let i=0;for(;t>0;){await this.flush();const r=Math.min(this.size,t);this.buffer.set(e.subarray(i,i+r),this.pointer),this.pointer+=r,this.pos+=BigInt(r),i+=r,t-=r}}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}async writeString(e){const t=s.encode(e);return await this.writeBuffer(t),t.length}async flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=await this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}async flushToPos(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=await this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}async seek(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");await this.flush();const t=await this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}seekInline(e){const t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}skip(e){const t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}back(e){const t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(e){this.littleEndian=!e}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}},82947:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(19371),s=i(17630),a=i(87339);const o="packages/common/src/math/Matrix3.ts";class n{static RowMajor(e){return new n([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]])}static ColMajor(e){return new n(e)}constructor(e){(0,r.A)(this,"element",void 0),e?(this.element=new Float32Array(9),this.set(e)):this.element=new Float32Array([1,0,0,0,1,0,0,0,1])}rc(e,t){return this.getValue(3*t+e)}setRC(e,t,i){this.setValue(3*t+e,i)}getValue(e){if(e>=0&&e<9)return this.element[e];a.z3("index out of Matrix4's rang [0 - 9]",o,47)}setValue(e,t){e>=0&&e<9?this.element[e]=t:a.z3("index out of Matrix4's rang [0 - 9]",o,56)}setIdentity(){return this.element=new Float32Array([1,0,0,0,1,0,0,0,1]),this}set(e){return s.__(e,((e,t)=>{this.element[t]=e})),this}invert(){const e=this.element,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],n=e[6],h=e[7],d=e[8],c=d*a-o*h,l=o*n-d*s,u=h*s-a*n,f=t*c+i*l+r*u;if(0===f)return this.set([0,0,0,0,0,0,0,0,0]);const p=1/f;return e[0]=c*p,e[1]=(r*h-d*i)*p,e[2]=(o*i-r*a)*p,e[3]=l*p,e[4]=(d*t-r*n)*p,e[5]=(r*s-o*t)*p,e[6]=u*p,e[7]=(i*n-h*t)*p,e[8]=(a*t-i*s)*p,this}toArray(){let e=[];for(let t=0;t<9;t++)e[t]=this.element[t];return e}copy(){return(new n).set(this.toArray())}}},11202:(e,t,i)=>{i.d(t,{A:()=>d});var r=i(19371),s=i(17630),a=i(87339),o=i(46033);const n="packages/common/src/math/Matrix4.ts";let h;class d{static shared(){return h||(h=new d)}static RowMajor(e){return new d([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]])}static ColMajor(e){return new d(e)}constructor(e){(0,r.A)(this,"element",void 0),e?(this.element=new Float32Array(16),this.set(e)):this.element=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}rc(e,t){return this.getValue(4*t+e)}setRC(e,t,i){this.setValue(4*t+e,i)}getValue(e){if(e>=0&&e<=15)return this.element[e];a.z3("index out of Matrix4's rang [0 - 15]",n,58)}setValue(e,t){e>=0&&e<=15?this.element[e]=t:a.z3("index out of Matrix4's rang [0 - 15]",n,67)}setIdentity(){return this.element=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this}set(e){return s.__(e,((e,t)=>{this.element[t]=e})),this}multiply(e){let t,i,r,s,a,o,n,h;if(s=i=this.element,r=e.element,s===r)for(r=new Float32Array(16),t=0;t<16;t++)r[t]=s[t];for(t=0;t<4;t++)a=i[t],o=i[t+4],n=i[t+8],h=i[t+12],s[t]=a*r[0]+o*r[1]+n*r[2]+h*r[3],s[t+4]=a*r[4]+o*r[5]+n*r[6]+h*r[7],s[t+8]=a*r[8]+o*r[9]+n*r[10]+h*r[11],s[t+12]=a*r[12]+o*r[13]+n*r[14]+h*r[15];return this}multiplyVector3(e){let t=this.element,i=e.element;return new o.P([i[0]*t[0]+i[1]*t[4]+i[2]*t[8]+t[12],i[0]*t[1]+i[1]*t[5]+i[2]*t[9]+t[13],i[0]*t[2]+i[1]*t[6]+i[2]*t[10]+t[14]])}multiplyVector4(e){let t=this.element,i=e.element;return new o.I([i[0]*t[0]+i[1]*t[4]+i[2]*t[8]+i[3]*t[12],i[0]*t[1]+i[1]*t[5]+i[2]*t[9]+i[3]*t[13],i[0]*t[2]+i[1]*t[6]+i[2]*t[10]+i[3]*t[14],i[0]*t[3]+i[1]*t[7]+i[2]*t[11]+i[3]*t[15]])}transpose(){let e,t;return e=this.element,t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setInverseOf(e){let t,i,r,s,a;if(i=e.element,r=this.element,s=new Float32Array(16),s[0]=i[5]*i[10]*i[15]-i[5]*i[11]*i[14]-i[9]*i[6]*i[15]+i[9]*i[7]*i[14]+i[13]*i[6]*i[11]-i[13]*i[7]*i[10],s[1]=-i[1]*i[10]*i[15]+i[1]*i[11]*i[14]+i[9]*i[2]*i[15]-i[9]*i[3]*i[14]-i[13]*i[2]*i[11]+i[13]*i[3]*i[10],s[2]=i[1]*i[6]*i[15]-i[1]*i[7]*i[14]-i[5]*i[2]*i[15]+i[5]*i[3]*i[14]+i[13]*i[2]*i[7]-i[13]*i[3]*i[6],s[3]=-i[1]*i[6]*i[11]+i[1]*i[7]*i[10]+i[5]*i[2]*i[11]-i[5]*i[3]*i[10]-i[9]*i[2]*i[7]+i[9]*i[3]*i[6],s[4]=-i[4]*i[10]*i[15]+i[4]*i[11]*i[14]+i[8]*i[6]*i[15]-i[8]*i[7]*i[14]-i[12]*i[6]*i[11]+i[12]*i[7]*i[10],s[5]=i[0]*i[10]*i[15]-i[0]*i[11]*i[14]-i[8]*i[2]*i[15]+i[8]*i[3]*i[14]+i[12]*i[2]*i[11]-i[12]*i[3]*i[10],s[6]=-i[0]*i[6]*i[15]+i[0]*i[7]*i[14]+i[4]*i[2]*i[15]-i[4]*i[3]*i[14]-i[12]*i[2]*i[7]+i[12]*i[3]*i[6],s[7]=i[0]*i[6]*i[11]-i[0]*i[7]*i[10]-i[4]*i[2]*i[11]+i[4]*i[3]*i[10]+i[8]*i[2]*i[7]-i[8]*i[3]*i[6],s[8]=i[4]*i[9]*i[15]-i[4]*i[11]*i[13]-i[8]*i[5]*i[15]+i[8]*i[7]*i[13]+i[12]*i[5]*i[11]-i[12]*i[7]*i[9],s[9]=-i[0]*i[9]*i[15]+i[0]*i[11]*i[13]+i[8]*i[1]*i[15]-i[8]*i[3]*i[13]-i[12]*i[1]*i[11]+i[12]*i[3]*i[9],s[10]=i[0]*i[5]*i[15]-i[0]*i[7]*i[13]-i[4]*i[1]*i[15]+i[4]*i[3]*i[13]+i[12]*i[1]*i[7]-i[12]*i[3]*i[5],s[11]=-i[0]*i[5]*i[11]+i[0]*i[7]*i[9]+i[4]*i[1]*i[11]-i[4]*i[3]*i[9]-i[8]*i[1]*i[7]+i[8]*i[3]*i[5],s[12]=-i[4]*i[9]*i[14]+i[4]*i[10]*i[13]+i[8]*i[5]*i[14]-i[8]*i[6]*i[13]-i[12]*i[5]*i[10]+i[12]*i[6]*i[9],s[13]=i[0]*i[9]*i[14]-i[0]*i[10]*i[13]-i[8]*i[1]*i[14]+i[8]*i[2]*i[13]+i[12]*i[1]*i[10]-i[12]*i[2]*i[9],s[14]=-i[0]*i[5]*i[14]+i[0]*i[6]*i[13]+i[4]*i[1]*i[14]-i[4]*i[2]*i[13]-i[12]*i[1]*i[6]+i[12]*i[2]*i[5],s[15]=i[0]*i[5]*i[10]-i[0]*i[6]*i[9]-i[4]*i[1]*i[10]+i[4]*i[2]*i[9]+i[8]*i[1]*i[6]-i[8]*i[2]*i[5],a=i[0]*s[0]+i[1]*s[4]+i[2]*s[8]+i[3]*s[12],0===a)return this;for(a=1/a,t=0;t<16;t++)r[t]=s[t]*a;return this}invert(){return this.setInverseOf(this),this}setOrtho(e,t,i,r,s,o){let h,d,c;return e!==t&&i!==r&&s!==o||a.h2("null frustum",n,240),h=1/(t-e),d=1/(r-i),c=1/(o-s),this.set([2*h,0,0,0,0,2*d,0,0,0,0,-2*c,0,-(t+e)*h,-(r+i)*d,-(o+s)*c,1]),this}ortho(e,t,i,r,s,a){return this.multiply((new d).setOrtho(e,t,i,r,s,a))}setFrustum(e,t,i,r,s,o){let h,d,c;return e!==t&&i!==r&&s!==o||a.z3("null frustum",n,281),s<=0&&a.h2("near <= 0",n,284),o<=0&&a.h2("far <= 0",n,287),h=1/(t-e),d=1/(r-i),c=1/(o-s),this.set([2*s*h,0,0,0,0,2*s*d,0,0,(t+e)*h,(r+i)*d,-(o+s)*c,-1,0,0,-2*s*o*c,0]),this}frustum(e,t,i,r,s,a){return this.multiply((new d).setOrtho(e,t,i,r,s,a))}setPerspective(e,t,i,r){let s,o,h;return i!==r&&0!==t||a.h2("null frustum",n,328),i<=0&&a.h2("near <= 0",n,331),r<=0&&a.h2("far <= 0",n,334),e=Math.PI*e/180/2,o=Math.sin(e),0===o&&a.h2("null frustum",n,342),s=1/(r-i),h=Math.cos(e)/o,this.set([h/t,0,0,0,0,h,0,0,0,0,-(r+i)*s,-1,0,0,-2*i*r*s,0]),this}perspective(e,t,i,r){return this.multiply((new d).setPerspective(e,t,i,r))}setScale(e){return this.set([e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1]),this}scale(e){let t=this.element;return t[0]*=e.x,t[1]*=e.x,t[2]*=e.x,t[3]*=e.x,t[4]*=e.y,t[5]*=e.y,t[6]*=e.y,t[7]*=e.y,t[8]*=e.z,t[9]*=e.z,t[10]*=e.z,t[11]*=e.z,this}setTranslate(e){return this.set([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1]),this}preTranslate(e){let t=this.element;return t[12]+=t[0]*e.x+t[4]*e.y+t[8]*e.z,t[13]+=t[1]*e.x+t[5]*e.y+t[9]*e.z,t[14]+=t[2]*e.x+t[6]*e.y+t[10]*e.z,t[15]+=t[3]*e.x+t[7]*e.y+t[11]*e.z,this}postTranslate(e){let t=this.element;return t[0]+=e.x*t[3],t[1]+=e.y*t[3],t[2]+=e.z*t[3],t[4]+=e.x*t[7],t[5]+=e.y*t[7],t[6]+=e.z*t[7],t[8]+=e.x*t[11],t[9]+=e.y*t[11],t[10]+=e.z*t[11],t[12]+=e.x*t[15],t[13]+=e.y*t[15],t[14]+=e.z*t[15],this}setRotate(e,t){let i,r,s,a,o,n,h,d,c,l,u,f,p,m;return e=Math.PI*e/180,i=t.x,r=t.y,s=t.z,a=Math.sin(e),o=Math.cos(e),0!==t.x&&0===t.y&&0===t.z?(t.x<0&&(a=-a),this.set([1,0,0,0,0,o,-a,0,0,a,o,0,0,0,0,1])):0===t.x&&0!==t.y&&0===t.z?(t.y<0&&(a=-a),this.set([o,0,a,0,0,1,0,0,-a,0,o,0,0,0,0,1])):0===t.x&&0===t.y&&0!==t.z?(t.z<0&&(a=-a),this.set([o,-a,0,0,a,o,0,0,0,0,1,0,0,0,0,1])):(n=t.magnitude,1!==n&&(h=1/n,i*=h,r*=h,s*=h),d=1-o,c=i*r,l=r*s,u=s*i,f=i*a,p=r*a,m=s*a,this.set([i*i*d+o,c*d+m,u*d-p,0,c*d-m,r*r*d+o,l*d+f,0,u*d+p,l*d-f,s*s*d+o,0,0,0,0,1])),this}rotate(e,t){return this.multiply((new d).setRotate(e,t)),this}setLookAt(e,t,i){let r,s,a,n,h,d,c,l,u,f,p;return r=t.x-e.x,s=t.y-e.y,a=t.z-e.z,n=1/Math.sqrt(r*r+s*s+a*a),r*=n,s*=n,a*=n,h=s*i.z-a*i.y,d=a*i.x-r*i.z,c=r*i.y-s*i.x,l=1/Math.sqrt(h*h+d*d+c*c),h*=l,d*=l,c*=l,u=d*a-c*s,f=c*r-h*a,p=h*s-d*r,this.set([h,u,-r,0,d,f,-s,0,c,p,-a,0,0,0,0,1]),this.preTranslate(new o.P([-e.x,-e.y,-e.z]))}lookAt(e,t,i){return this.multiply((new d).setLookAt(e,t,i))}toArray(){let e=[];for(let t=0;t<16;t++)e[t]=this.element[t];return e}copy(){return(new d).set(this.toArray())}}},46033:(e,t,i)=>{i.d(t,{I:()=>a,P:()=>s});var r=i(19371);class s{constructor(e){(0,r.A)(this,"element",void 0),this.element=new Float32Array(3),e&&(this.element[0]=e[0],this.element[1]=e[1],this.element[2]=e[2])}normalize(){let e=this.x,t=this.y,i=this.z,r=this.magnitude;return r?(1===r||(r=1/r,this.x=e*r,this.y=t*r,this.z=i*r),this):(this.x=this.y=this.z=0,this)}toArray(){return[this.x,this.y,this.z]}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}get sqrMagnitude(){return this.x*this.x+this.y*this.y+this.z*this.z}get x(){return this.element[0]}set x(e){this.element[0]=e}get y(){return this.element[1]}set y(e){this.element[1]=e}get z(){return this.element[2]}set z(e){this.element[2]=e}}class a{constructor(e){(0,r.A)(this,"element",void 0),this.element=new Float32Array(4),e&&(this.element[0]=e[0],this.element[1]=e[1],this.element[2]=e[2],this.element[4]=e[3])}}},37688:(e,t,i)=>{function r(e,t){return e+(t-1)&~(t-1)}i.d(t,{A:()=>r})},95111:(e,t,i)=>{function r(e,t){for(;0!==t;)[e,t]=[t,e%t];return e}i.d(t,{A:()=>r})},50948:(e,t,i)=>{i.d(t,{B:()=>s});var r=i(82947);function s(e,t){const i=new r.A([0,0,0,0,0,0,0,0,0]);for(let r=0;r<3;r++)for(let s=0;s<3;s++){let a=e.rc(r,0)*t.rc(0,s)+e.rc(r,1)*t.rc(1,s)+e.rc(r,2)*t.rc(2,s);i.setRC(r,s,a)}return i}},76177:(e,t,i)=>{function r(e){return e<=0?1:Math.pow(2,Math.ceil(Math.log2(e)))}i.d(t,{A:()=>r})},31434:(e,t,i)=>{i.d(t,{Y3:()=>s});var r=i(46033);function s(e,t){const i=new r.P([0,0,0]);for(let r=0;r<3;r++)i.element[r]=e.rc(r,0)*t.x+e.rc(r,1)*t.y+e.rc(r,2)*t.z;return i}},80564:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371);class s extends EventTarget{constructor(){super(...arguments),(0,r.A)(this,"peer",void 0),(0,r.A)(this,"onmessage",void 0),(0,r.A)(this,"onmessageerror",void 0)}postMessage(e,t){var i;null!==(i=this.peer)&&void 0!==i&&i.onmessage&&this.peer.onmessage({data:e})}close(){this.peer=null}start(){}}class a{constructor(){(0,r.A)(this,"port1",void 0),(0,r.A)(this,"port2",void 0),this.port1=new s,this.port2=new s,this.port1.peer=this.port2,this.port2.peer=this.port1}}},85266:(e,t,i)=>{i.d(t,{Ay:()=>h,S3:()=>n,Wo:()=>o});var r=i(19371),s=i(47691),a=i(65992);const o="notify",n="request";class h extends s.A{constructor(e){super(!0),(0,r.A)(this,"port",void 0),(0,r.A)(this,"requestMap",void 0),(0,r.A)(this,"seq",void 0),(0,r.A)(this,"closed",void 0),this.port=e,this.port.onmessage=this.handle.bind(this),this.seq=0,this.requestMap=new Map,this.port.start(),this.closed=!1}handle(e){const t=e.data,i=t.type,r=t.data;if("notify"===i)this.fire(o,r);else if("reply"===i){const e=this.requestMap.get(r.seq);e&&((0,a.A)(r.result)?e.resolve(r.result):r.error?e.reject(r.error):e.resolve(void 0),this.requestMap.delete(r.seq))}else"request"===i&&this.fire(n,r)}notify(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.port.postMessage({type:"notify",data:{method:e,params:t}},i)}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new Promise(((r,s)=>{const a=this.seq++;this.requestMap.set(a,{resolve:r,reject:s}),this.port.postMessage({type:"request",data:{seq:a,method:e,params:t}},i)}))}reply(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const s={seq:e.seq};(0,a.A)(t)?s.result=t:i&&(s.error=i),null!=r&&r.length?this.port.postMessage({type:"reply",data:s},r):this.port.postMessage({type:"reply",data:s})}getPort(){return this.port}destroy(){this.requestMap.size&&(this.requestMap.forEach((e=>{e.reject("ipc port close")})),this.requestMap.clear()),this.port&&(this.port.close(),this.port=null),this.closed=!0}}},28230:(e,t,i)=>{i.d(t,{A:()=>u});var r=i(19371),s=i(47845),a=i(16563),o=i(7475),n=i(66968);let h,d=0;function c(){return h?(d++,h):(h=new o.A,d=1,h)}function l(){0!==d&&(d--,0===d&&(h.destroy(),h=null))}class u{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,r.A)(this,"messageChannel",void 0),(0,r.A)(this,"interval",void 0),(0,r.A)(this,"started",void 0),(0,r.A)(this,"timer",void 0),(0,r.A)(this,"workerTimer",void 0),(0,r.A)(this,"workerSetTimeout",void 0),(0,r.A)(this,"onClock",void 0),(0,r.A)(this,"nextTick",void 0),(0,r.A)(this,"a",void 0),(0,r.A)(this,"b",void 0),(0,r.A)(this,"beta",void 0),(0,r.A)(this,"alpha",void 0),(0,r.A)(this,"count",void 0),(0,r.A)(this,"equivalent",void 0),(0,r.A)(this,"timestamp",void 0),(0,r.A)(this,"onVisibilityChange",void 0),(0,r.A)(this,"timeoutNext",void 0),(0,r.A)(this,"running",void 0),(0,r.A)(this,"highPerformance",void 0),(0,r.A)(this,"forceWorker",void 0),this.started=!1,this.interval=e,this.highPerformance=t,this.forceWorker=i,this.a=.2,this.b=4,this.equivalent=50,this.timestamp=0,this.nextTick=()=>{if(this.started&&!this.running)if(this.running=!0,this.interval>=4||!this.highPerformance)this.timeoutTick();else if(this.interval<=0)this.messageChannel.port1.postMessage(null);else{const e=(0,a.A)();e-this.timestamp>this.equivalent&&(this.count=0,this.timestamp=e),this.count<this.beta?this.messageChannel.port1.postMessage(null):this.timeoutTick()}},this.compute(),this.messageChannel=new MessageChannel,this.handleEvent(),this.timeoutNext=e=>{e?this.workerTimer=null:this.timer=null,this.running=!1,this.count++,this.onClock?this.onClock(this.nextTick):this.nextTick()},(0,s.A)()||"hidden"!==document.visibilityState||(this.workerSetTimeout=c()),this.running=!1}compute(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.interval>0&&(this.beta=Math.ceil(this.equivalent*(1-this.b/this.interval)/(this.a-this.b)),this.alpha=Math.floor(this.equivalent/this.interval-this.beta),e&&(this.count=0))}timeoutTick(){this.workerSetTimeout&&"hidden"===document.visibilityState&&(this.interval<1e3||this.forceWorker)?this.workerTimer=this.workerSetTimeout.setTimeout(this.timeoutNext,this.interval):this.timer=setTimeout(this.timeoutNext,this.interval)}start(){this.started||(this.started=!0,this.timestamp=(0,a.A)(),this.nextTick())}stop(){this.started=!1,this.timer&&(clearTimeout(this.timer),this.timer=null),this.workerTimer&&this.workerSetTimeout&&this.workerSetTimeout.clearTimeout(this.workerTimer),this.running=!1}isStarted(){return this.started}setInterval(e){this.interval=Math.max(e,0),this.compute()}getInterval(){return this.interval}isZeroTimeout(){return this.interval<4}destroy(){this.stop(),this.workerSetTimeout&&(l(),this.workerSetTimeout=null),this.onVisibilityChange&&(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.onVisibilityChange=null)}handleEvent(){this.messageChannel.port2.onmessage=()=>{this.started&&(this.running=!1,this.count++,this.onClock?this.onClock(this.nextTick):this.nextTick())},(0,s.A)()||(this.onVisibilityChange=(0,n.A)((e=>{"hidden"===document.visibilityState?(this.workerSetTimeout=c(),this.timer&&(clearTimeout(this.timer),this.timer=null,this.running=!1),this.nextTick()):(this.workerTimer&&(this.workerSetTimeout.clearTimeout(this.workerTimer),this.workerTimer=null,this.running=!1),this.timer&&(clearTimeout(this.timer),this.timer=null,this.running=!1),l(),this.workerSetTimeout=null,this.nextTick())}),20),document.addEventListener("visibilitychange",this.onVisibilityChange))}}},39753:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(19371),s=i(28230),a=i(16563);class o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];(0,r.A)(this,"task",void 0),(0,r.A)(this,"count",void 0),(0,r.A)(this,"emptyCount",void 0),(0,r.A)(this,"started",void 0),(0,r.A)(this,"clock",void 0),(0,r.A)(this,"timestamp",void 0),(0,r.A)(this,"timeout",void 0),(0,r.A)(this,"interval",void 0),(0,r.A)(this,"startTimer",void 0),(0,r.A)(this,"autoInterval",void 0),(0,r.A)(this,"sync",void 0),(0,r.A)(this,"tickAfter",void 0),(0,r.A)(this,"processing",void 0),this.task=e,this.timeout=t,this.interval=i,this.autoInterval=a,this.sync=o,this.count=0,this.emptyCount=0,this.timestamp=0,this.started=!1,this.processing=!1,this.clock=new s.A(this.interval),this.clock.onClock=e=>{if(this.started)if(this.count++,this.sync)this.tickAfter&&(this.tickAfter(),this.tickAfter=null),!1===this.task()?this.stop():this.next(e);else{if(this.processing)return;this.processing=!0,this.task().then((t=>{this.processing=!1,this.tickAfter&&(this.tickAfter(),this.tickAfter=null),!1===t?this.stop():this.next(e)}))}}}next(e){if(!this.started)return;const t=(0,a.A)();if(this.autoInterval&&t-this.timestamp>50){const e=this.emptyCount/this.count;0===this.emptyCount?this.clock.setInterval(Math.max(this.clock.getInterval()>>1,this.interval)):e<.1?this.clock.setInterval(this.clock.getInterval()-1):e>.2?this.clock.setInterval(Math.min(this.clock.getInterval()+1,20)):e>.5&&this.clock.setInterval(this.clock.getInterval()<<1),this.count=0,this.emptyCount=0,this.timestamp=t}e()}start(){this.started=!0,this.timeout?this.startTimer=setTimeout((()=>{this.count=0,this.emptyCount=0,this.timestamp=(0,a.A)(),this.clock.start(),this.startTimer=null}),this.timeout):(this.count=0,this.emptyCount=0,this.timestamp=(0,a.A)(),this.clock.start())}stop(){this.started=!1,this.processing=!1,this.startTimer&&(clearTimeout(this.startTimer),this.startTimer=null),this.clock.stop()}async stopBeforeNextTick(){if(this.startTimer&&(clearTimeout(this.startTimer),this.startTimer=null),this.clock.isStarted())return this.sync?(this.started=!1,this.processing=!1,void this.clock.stop()):new Promise((e=>{this.tickAfter=()=>{this.started=!1,this.processing=!1,this.clock.stop(),e()}}))}isStarted(){return this.started}emptyTask(){this.emptyCount++}isZeroTimeout(){var e;return null===(e=this.clock)||void 0===e?void 0:e.isZeroTimeout()}restart(){this.clock&&(this.stop(),this.clock.setInterval(this.interval),this.start())}resetInterval(){this.clock.setInterval(Math.max(this.clock.getInterval()>>1,this.interval)),this.emptyCount=0,this.count=0,this.timestamp=(0,a.A)()}destroy(){this.stop(),this.task=null,this.timeout=null,this.interval=null}}},10063:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(16563);class a{constructor(){(0,r.A)(this,"base",BigInt(0)),(0,r.A)(this,"rate",BigInt(1e3)),(0,r.A)(this,"startTimestamp",BigInt(0))}start(){this.base=BigInt(0),this.startTimestamp=BigInt((0,s.A)())}getMasterTime(){return this.base+(BigInt((0,s.A)())-this.startTimestamp)*this.rate/BigInt(1e3)}setRate(e){this.base=this.getMasterTime(),this.startTimestamp=BigInt((0,s.A)()),this.rate=BigInt(1e3*e>>>0)}setMasterTime(e){this.base=e,this.startTimestamp=BigInt((0,s.A)())}}},88583:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(19371);class s{constructor(e){(0,r.A)(this,"timeout",void 0),(0,r.A)(this,"timer",void 0),(0,r.A)(this,"resolve",void 0),(0,r.A)(this,"reject",void 0),(0,r.A)(this,"startTime",void 0),this.timeout=e}then(e,t){this.resolve=e,this.reject=t,this.startTime=Date.now(),this.timer=setTimeout((()=>{this.resolve(Date.now()-this.startTime),this.timer=null}),1e3*this.timeout)}stop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.timer&&(clearTimeout(this.timer),this.timer=null,this.resolve&&e?this.resolve(Date.now()-this.startTime):this.reject&&!e&&this.reject(Date.now()-this.startTime))}reset(e){e&&(this.timeout=e),this.timer&&(clearTimeout(this.timer),this.timer=setTimeout((()=>{this.resolve(Date.now()-this.startTime),this.timer=null}),1e3*this.timeout))}}},88897:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(19371);class s{constructor(e,t,i){(0,r.A)(this,"task",void 0),(0,r.A)(this,"timeout",void 0),(0,r.A)(this,"interval",void 0),(0,r.A)(this,"timer",void 0),this.task=e,this.timeout=t,this.interval=i}start(){const e=this;e.stop();let t=e.timeout;const i=e.interval,r=function(){!1!==e.task()&&e.timer?e.timer=setTimeout(r,e.interval):e.stop()};null==t&&(t=i),e.timer=setTimeout(r,t)}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)}updateInterval(e){this.interval=e}isStarted(){return!!this.timer}destroy(){this.stop(),this.task=this.timeout=this.interval=null}}},7475:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371);function s(e){e.addEventListener("message",(t=>{var i;let r=t.data.data;setTimeout((()=>{e.postMessage({type:"pong",id:r.id})}),Math.max(null!==(i=r.timeout)&&void 0!==i?i:0,4))}))}class a{constructor(){(0,r.A)(this,"worker",void 0),(0,r.A)(this,"workerUrl",void 0),(0,r.A)(this,"taskMap",void 0),(0,r.A)(this,"id",void 0),this.id=0,this.taskMap=new Map;const e=`\n      ${s.toString()}\n      ${s.name}(self)\n    `,t=new Blob([e],{type:"text/javascript"});this.workerUrl=URL.createObjectURL(t),this.worker=new Worker(this.workerUrl),this.worker.addEventListener("message",(e=>{const t=e.data,i=t.type,r=t.id;if("pong"===i){const e=this.taskMap.get(r);e&&e(!0)}}))}setTimeout(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.id++;return this.taskMap.set(i,e),this.worker.postMessage({type:"ping",data:{timeout:t,id:i}}),i}clearTimeout(e){this.taskMap.delete(e)}destroy(){this.worker&&(this.worker.terminate(),this.worker=null),this.workerUrl&&(URL.revokeObjectURL(this.workerUrl),this.workerUrl=null),this.taskMap&&(this.taskMap.clear(),this.taskMap=null)}}},48135:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(19371),s=i(28230);class a{constructor(e,t,i){(0,r.A)(this,"task",void 0),(0,r.A)(this,"timeout",void 0),(0,r.A)(this,"interval",void 0),(0,r.A)(this,"clock",void 0),(0,r.A)(this,"started",void 0),(0,r.A)(this,"timer",void 0),this.task=e,this.timeout=t,this.interval=i,this.started=!1,this.clock=new s.A(this.interval,!1,!0),this.clock.onClock=e=>{this.started&&!1===this.task()?this.stop():e()}}start(){this.started=!0,this.timeout>0?this.timer=setTimeout((()=>{this.timer=null,this.clock.start()}),this.timeout):this.clock.start()}stop(){this.started=!1,this.clock.stop(),this.timer&&(clearTimeout(this.timer),this.timer=null)}isStarted(){return this.started}updateInterval(e){this.interval=e,this.clock.setInterval(e)}destroy(){this.clock&&(this.stop(),this.clock.destroy(),this.clock=null),this.started=!1,this.task=this.timeout=this.interval=null}}},17630:(e,t,i)=>{i.d(t,{$r:()=>l,El:()=>u,FB:()=>p,TF:()=>d,VC:()=>h,_:()=>f,__:()=>o,zy:()=>c});var r=i(81819),s=i(84799),a=i(16460);function o(e,t,i){if(!e)return;const{length:r}=e;if(r)if(i)for(let i=r-1;i>=0&&t(e[i],i)!==s.W8;i--);else for(let i=0;i<r&&t(e[i],i)!==s.W8;i++);}function n(e,t){e[e.length]=t}function h(e,t){!function(e,t,i){r.YO(t)?o(t,(function(t){i(e,t)})):i(e,t)}(e,t,n)}function d(e,t,i){let r=0;return o(e,(function(a,o){(i===s.W8?a==t:a===t)&&(e.splice(o,1),r++)}),s.rT),r}function c(e,t,i){return function(e,t,i){let r=s.Cy;return o(e,(function(e,a){if(i===s.W8?e==t:e===t)return r=a,s.W8})),r}(e,t,i)>=0}function l(e){return r.YO(e)?e:(0,a.A)(s.Ml.slice,e)}function u(e,t){let i=0,r=e.length-1,s=-1;for(;i<=r;){let a=(i+r)/2>>>0;const o=t(e[a]);if(0===o){s=a;break}1===o?i=a+1:(r=a-1,s=a)}return s}function f(e,t,i){const r=u(e,i);r>-1?e.splice(r,0,t):e.push(t)}function p(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}},1279:(e,t,i)=>{i.d(t,{l:()=>s});const r="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";function s(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=e.length;let s=0,a=0,o="";for(let t=0;t<i;t++)for(a=a<<8|e[t],s+=8;s>=5;)o+=r[a>>>s-5&31],s-=5;if(s>0&&(o+=r[a<<5-s&31]),t)for(;o.length%8!=0;)o+="=";return o}},18152:(e,t,i)=>{i.d(t,{E_:()=>a});var r=i(17630);const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function a(e){const t="function"==typeof atob?atob(e):function(e){function t(e){const t=s.indexOf(e);return-1===t?0:t}let i="";for(let r=0;r<e.length;){const s=t(e[r++]),a=t(e[r++]),o=t(e[r++]),n=t(e[r++]),h=s<<2|a>>4,d=(15&a)<<4|o>>2,c=(3&o)<<6|n;i+=String.fromCharCode(h),64!==o&&(i+=String.fromCharCode(d)),64!==n&&(i+=String.fromCharCode(c))}return i}(e),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return i}const o={};r.__(["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],((e,t)=>{o[e]=t}))},29592:(e,t,i)=>{function r(e){return e>0?e:-e}function s(e,t){return e>t?e:t}function a(e,t){return e>t?t:e}i.d(t,{T9:()=>s,jk:()=>a,tn:()=>r})},71195:(e,t,i)=>{i.d(t,{A:()=>u});var r=i(17630),s=i(81819),a=i(90179),o=i(77969);function n(e){return s.Yj(e)&&e.split(".").shift()||""}const h=[["alipay",/alipay/],["wechat",/micromessenger/],["dingtalk",/dingtalk[ \/]([\d_.]+)/],["baiduApp",/baiduboxapp/],["baidu",/baidubrowser/],["baidu",/bdbrowser/],["uc",/ucbrowser/],["uc",/ucweb/],["qq",/qqbrowser/],["qqApp",/qq/],["ie",/iemobile[ \/]([\d_.]+)/],["ie",/msie[ \/]([\d_.]+)/],["ie",/trident[ \/]([\d_.]+)/,4],["edge",/edge[ \/]([\d_.]+)/],["newEdge",/edg[ \/]([\d_.]+)/],["chrome",/chrome[ \/]([\d_.]+)/],["firefox",/firefox[ \/]([\d_.]+)/],["opera",/opera(?:.*version)?[ \/]([\d_.]+)/],["safari",/version[ \/]([\d_.]+) safari/],["safari",/version[ \/]([\d_.]+) \S* safari/],["safari",/safari/]],d={},c={},l=function(e){let t,i;return(0,r.__)(h,(r=>{let s=r[1].exec(e);if(s)return t=r[0],i=s[1],i&&(i=i.replace(/_/g,"."),r[2]&&(i=parseInt(i,10)+r[2]+".0")),!1})),"safari"!==t||i||(i=o.A.version),{name:t||"",version:i||"",majorVersion:(d[t]||n)(i),checkVersion:c[t]||a.A}}(("object"==typeof navigator&&navigator.userAgent||"").toLowerCase());l.name&&(l[l.name]=!0);const u=l},84799:(e,t,i)=>{i.d(t,{Cq:()=>a,Cy:()=>n,M_:()=>u,Ml:()=>m,TK:()=>f,W8:()=>s,ZG:()=>c,ZH:()=>o,aV:()=>h,rT:()=>r,s0:()=>d,u1:()=>g,x7:()=>p});const r=!0,s=!1,a=null,o=void 0,n=-1,h="undefined",d="function",c=".",l=typeof window!==h?window:o,u=(typeof document!==h&&document,typeof globalThis!==h?globalThis:typeof i.g!==h?i.g:l),f=typeof self!==h?self:u,p=function(){},m=(Object.freeze({}),Object.freeze([])),g=""},81819:(e,t,i)=>{i.d(t,{Ik:()=>o,Pc:()=>s,YO:()=>a,Yj:()=>n,ai:()=>h,o:()=>d,sH:()=>l,sv:()=>u,zM:()=>c});var r=i(84799);function s(e){return typeof e===r.s0}function a(e){return Array.isArray(e)}function o(e){return e!==r.Cq&&"object"==typeof e}function n(e){return"string"==typeof e}function h(e){return"number"==typeof e&&!isNaN(e)}function d(e){return"bigint"==typeof e}function c(e){return"boolean"==typeof e}function l(e){return h(e)||n(e)&&!isNaN(parseFloat(e))&&isFinite(+e)}function u(e){return e instanceof ArrayBuffer}},94447:(e,t,i)=>{i.d(t,{__:()=>a});var r=i(84799);const s={};function a(e,t){const i=s.hasOwnProperty(e)?s[e]:s[e]=e.split(r.ZG);for(let e=0,s=i.length-1;e<=s&&t(i[e],e===s)!==r.W8;e++);}},87339:(e,t,i)=>{i.d(t,{R8:()=>b,V$:()=>A,Yz:()=>v,h2:()=>w,pq:()=>y,rD:()=>n,z3:()=>k});var r=i(84799),s=i(73575);const a=0,o=1,n=2,h=3,d=4,c=5,l=typeof console!==r.aV?console:r.Cq,u=/common/.test((0,s.A)(r.x7))?n:h,f=l?function(e,t){l.log(e,t)}:r.x7,p=l?function(e,t){l.warn(e,t)}:r.x7,m=l?function(e,t){l.error(e,t)}:r.x7;function g(){if(r.M_){const e=r.TK.COMMON_LOG_LEVEL;if(e>=a&&e<=c)return e}return u}function A(e){r.TK.COMMON_LOG_LEVEL=e}function v(e,t,i){g()<=o&&f(`[${arguments[1]}][line ${arguments[2]}] [debug]`,e)}function y(e,t,i){g()<=n&&f(`[${arguments[1]}][line ${arguments[2]}] [info]`,e)}function b(e,t,i){g()<=h&&p(`[${arguments[1]}][line ${arguments[2]}] [warn]`,e)}function k(e,t,i){g()<=d&&m(`[${arguments[1]}][line ${arguments[2]}] [error]`,e)}function w(e,t,i){if(g()<=c)throw k(e,t,i),new Error(`[${arguments[1]}][line ${arguments[2]}] [fatal]: ${e}`)}},25092:(e,t,i)=>{i.d(t,{BE:()=>f,C:()=>l,HP:()=>n,X$:()=>c,__:()=>h,zy:()=>u});var r=i(81819),s=i(17630),a=i(84799),o=i(65992);function n(e){return(0,o.A)(e)?Object.keys(e):[]}function h(e,t){for(let i in e)if(t(e[i],i)===a.W8)break}function d(e,t){return r.Ik(e)?r.Ik(t)?(h(t,(function(t,i){e[i]=t})),e):e:t}function c(e,t,i){return d(d(e,t),i)}function l(e,t){let i=e;return r.YO(e)?t?(i=[],s.__(e,(function(e,r){i[r]=l(e,t)}))):i=e.slice():r.Ik(e)&&(i={},h(e,(function(e,r){i[r]=t?l(e,t):e}))),i}function u(e,t){return e[t]!==a.ZH}function f(e){const t={};return h(e,((e,i)=>{t[e]=i})),t}},77969:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(17630);const s=[["harmony",/harmonyos ([\d_.]+)/],["harmony",/openharmony ([\d_.]+)/],["iphone",/iphone os ([\d_.]+)/],["ipad",/ipad; cpu os ([\d_.]+)/],["itouch",/itouch; cpu os ([\d_.]+)/],["android",/android ([\d_.]+)/],["wp",/windows phone ([\d_.]+)/],["windows",/windows nt ([\d_.]+)/],["linux",/linux/],["mac",/mac os x ([\d_.]+)/]],a=function(e){let t,i;return(0,r.__)(s,(r=>{let s=r[1].exec(e);if(s)return t=r[0],i=s[1],i&&(i=i.replace(/_/g,".")),!1})),{name:t||"",version:i||"",mobile:e.indexOf("mobile")>-1}}(("object"==typeof navigator&&navigator.userAgent||"").toLowerCase());a.name&&(a[a.name]=!0,{iphone:1,ipad:1,itouch:1}[a.name]&&(a.ios=!0));const o=a},67094:(e,t,i)=>{i.d(t,{GP:()=>d,di:()=>o,qh:()=>n,yh:()=>c,zy:()=>h});var r=i(81819),s=i(84799),a=i(73575);function o(e,t,i){return r.ai(i)?t===i?s.u1:e.slice(t,i):e.slice(t)}function n(e,t,i){return e.indexOf(t,i!==s.ZH?i:0)}function h(e,t){return n(e,t)>=0}function d(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];let s=0;const o=i.length;return e.replace(/(%[sdvx%])|(%0(\d)+[dx])/g,(e=>{if(s>=o)return e;const t=i[s++];if(/%0(\d)+[dx]/g.test(e)){const i=parseInt(e.substring(1));let r="d"===e[e.length-1]?(0,a.A)(Number(t)):Number(t).toString(16);return i>r.length&&(r=new Array(i-r.length).fill("0").join("")+r),r}switch(e){case"%%":return"%";case"%s":return String(t);case"%d":return(0,a.A)(Number(t));case"%v":return"";case"%x":return Number(t).toString(16)}return e}))}function c(e,t,i){if(t instanceof RegExp){if(!t.global)throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument");return e.replace(t,i)}return e.split(t).join(i)}},24788:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(59087),s=i(47845),a=i(71195),o=i(77969);const n=function(){let e="function"==typeof Blob,t="object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate,i="function"==typeof fetch,n="object"==typeof document&&document.createElement("canvas"),h=n&&!!n.getContext("webgl"),d="function"==typeof OffscreenCanvas,c="function"==typeof Worker,l="function"==typeof ArrayBuffer,u="object"==typeof Atomics&&"Atomics"===Atomics[Symbol.toStringTag],f="function"==typeof AudioContext||"function"==typeof webkitAudioContext,p="function"==typeof AudioWorklet,m="function"==typeof VideoDecoder,g="function"==typeof VideoEncoder,A="function"==typeof AudioDecoder,v="function"==typeof AudioEncoder,y="function"==typeof SharedArrayBuffer,b="function"==typeof MediaSource||"function"==typeof ManagedMediaSource,k="function"==typeof Proxy,w=(c||(0,s.A)()||(0,r.A)())&&y&&u&&k,x="function"==typeof WebAssembly.Suspending&&"function"==typeof WebAssembly.promising;(a.A.safari&&!a.A.checkVersion(a.A.majorVersion,"11",!0)||o.A.ios&&!a.A.checkVersion(o.A.version,"11",!0))&&(t=!1),a.A.chrome&&!a.A.checkVersion(a.A.majorVersion,"94",!0)&&(m=!1,A=!1),(a.A.safari&&!a.A.checkVersion(a.A.majorVersion,"17",!0)||o.A.ios&&!a.A.checkVersion(o.A.version,"17",!0))&&(m=!1);let T="object"==typeof navigator&&"object"==typeof navigator.gpu,I="function"==typeof MediaSourceHandle,_=t&&"function"==typeof WebAssembly.Global,P="function"==typeof MediaStreamTrackGenerator;return{blob:e,wasm:t,fetch:i,webgl:h,worker:c,mse:b,arrayBuffer:l,audioContext:f,audioWorklet:p,videoDecoder:m,videoEncoder:g,audioDecoder:A,audioEncoder:v,atomics:u,shareArrayBuffer:y,thread:w,webgpu:T,offscreenCanvas:d,workerMSE:I,webAssemblyGlobal:_,jspi:x,proxy:k,simd:(a.A.chrome||a.A.newEdge)&&a.A.checkVersion(a.A.majorVersion,"91",!0)||a.A.firefox&&a.A.checkVersion(a.A.majorVersion,"89",!0)||a.A.safari&&a.A.checkVersion(a.A.version,"16.4",!0)||o.A.ios&&a.A.checkVersion(o.A.version,"16.4",!0),wasmPlayerSupported:i&&t&&h&&f&&l&&_,wasmBaseSupported:t&&_&&l,trackGenerator:P}}()},4068:(e,t,i)=>{i.r(t),i.d(t,{decode:()=>n,encode:()=>a});const r="function"==typeof TextEncoder?new TextEncoder:null,s="function"==typeof TextDecoder?new TextDecoder:null;function a(e){if(r)return r.encode(e);const t=[];for(let i=0;i<e.length;++i){let r=e.charCodeAt(i);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++i)),r<=127?t.push(r):r<=2047?(t.push(192|r>>6),t.push(128|63&r)):r<=65535?(t.push(224|r>>12),t.push(128|r>>6&63),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|r>>12&63),t.push(128|r>>6&63),t.push(128|63&r))}return new Uint8Array(t)}function o(e){let t="";for(let i=0;i<e.length;){let r=e[i++>>>0];if(!(128&r)){t+=String.fromCharCode(r);continue}let s=63&e[i++>>>0];if(192==(224&r)){t+=String.fromCharCode((31&r)<<6|s);continue}let a=63&e[i++>>>0];if(r=224==(240&r)?(15&r)<<12|s<<6|a:(7&r)<<18|s<<12|a<<6|63&e[i++>>>0],r<65536)t+=String.fromCharCode(r);else{let e=r-65536;t+=String.fromCharCode(55296|e>>10,56320|1023&e)}}return t}function n(e){if(e instanceof Uint8Array&&s&&!("function"==typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer))try{return s.decode(e)}catch(t){return o(e)}return o(e)}},97494:(e,t,i)=>{function r(e){const t=e,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],r=/:\/\/([^\/@]*@?)\[(\S+)\]/;let s="";r.test(e)&&(e=e.replace(r,((e,t,i)=>(s=i,`://${t||""}a.b`))));const a={},o=/^(?:(?![^:@\/]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e);let n=14;for(;n--;){var h;a[i[n]]=null!==(h=o[n])&&void 0!==h?h:""}return s&&(a.host=s,a.source=t,a.authority=s+(a.port?":"+a.port:"")),{protocol:a.protocol,file:a.file,host:a.host,port:a.port,user:a.user,password:a.password,origin:`${a.protocol}://${a.authority}`,pathname:a.path,search:`?${a.query}`,hash:a.anchor?`#${a.anchor}`:""}}i.d(t,{ll:()=>l,qg:()=>r});const s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o=/^(?=([^\/?#]*))\1([^]*)$/,n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/;function h(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}function d(e){const t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null}function c(e){for(e=e.split("").reverse().join("").replace(s,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")}function l(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;let t=d(e);if(!t)throw new Error("Error trying to parse base URL.");return t.path=c(t.path),h(t)}let r=d(t);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return i.alwaysNormalize?(r.path=c(r.path),h(r)):t;let s=d(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){let e=o.exec(s.path);s.netLoc=e[1],s.path=e[2]}s.netLoc&&!s.path&&(s.path="/");const a={scheme:s.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(a.netLoc=s.netLoc,"/"!==r.path[0]))if(r.path){let e=s.path,t=e.substring(0,e.lastIndexOf("/")+1)+r.path;a.path=c(t)}else a.path=s.path,r.params||(a.params=s.params,r.query||(a.query=s.query));return null===a.path&&(a.path=i.alwaysNormalize?c(r.path):r.path),h(a)}},46647:(e,t,i)=>{i.d(t,{$z:()=>f,GW:()=>h,WP:()=>c,bx:()=>p,p2:()=>l,tt:()=>u});var r=i(21374),s=i(54570),a=i(71195),o=i(77969);function n(e){let t=0,i=0;for(;;){const r=e.readUint8();if(t|=(127&r)<<i,i+=7,!(128&r))break}return t}async function h(e){let t=0,i=0;for(;;){const r=await e.readUint8();if(t|=(127&r)<<i,i+=7,!(128&r))break}return t}function d(e){let t,i=0,r=0;for(;t=e.readUint8(),i|=(127&t)<<r,r+=7,128&t;);return 64&t&&(i|=-1<<r),i}async function c(e){let t,i=0,r=0;for(;t=await e.readUint8(),i|=(127&t)<<r,r+=7,128&t;);return 64&t&&(i|=-1<<r),i}function l(e,t){let i=!0;for(;i;){let r=127&t;0==(t>>=7)&&!(64&r)||-1===t&&64&r?i=!1:r|=128,e.writeUint8(r)}}function u(e,t){do{let i=127&t;0!=(t>>=7)&&(i|=128),e.writeUint8(i)}while(0!==t)}async function f(e,t){do{let i=127&t;0!=(t>>=7)&&(i|=128),await e.writeUint8(i)}while(0!==t)}function p(e,t){const i=new s.A(e,!0),h=new r.A(new Uint8Array(e.length+100),!0);for(h.writeBuffer(i.readBuffer(8));i.remainingSize();){const e=i.readUint8();h.writeUint8(e);const s=n(i);if(2===e){const e=new r.A(new Uint8Array(s+100));let c=n(i);for(u(e,c);c--;){const r=n(i);u(e,r),e.writeBuffer(i.readBuffer(r));const s=n(i);u(e,s),e.writeBuffer(i.readBuffer(s));const h=i.readUint8();switch(e.writeUint8(h),h){case 0:u(e,n(i));break;case 3:l(e,d(i)),u(e,n(i));break;case 2:{let r=n(i);t.shared?u(e,2|r):u(e,-3&r);const s=n(i);if(u(e,t.initial||s),1&r){let r=n(i);!t.maximum||o.A.ios&&!a.A.checkVersion(o.A.version,"17",!0)&&t.shared||(r=t.maximum),u(e,r)}break}case 1:{l(e,d(i));const t=n(i);u(e,t),u(e,n(i)),1&t&&u(e,n(i));break}}}const f=e.getWroteBuffer();u(h,f.length),h.writeBuffer(f)}else u(h,s),h.writeBuffer(i.readBuffer(s))}return h.getWroteBuffer()}},87936:(e,t,i)=>{i.d(t,{A:()=>r});const r="precision highp float;\n\nattribute vec3 point;\nattribute vec4 color;\nvarying vec4 v_color;\n\nuniform mat4 rotateMatrix;\n\nvoid main(void){\n  gl_Position = rotateMatrix * vec4(point, 1.0);\n  v_color = color;\n}\n"},13624:(e,t,i)=>{i.d(t,{A:()=>r});const r="struct PositionColorInput {\n    @location(0) in_position_3d: vec3<f32>,\n    @location(1) in_color_rgba: vec4<f32>\n};\n\nstruct PositionColorOutput {\n    @builtin(position) coords_output: vec4<f32>,\n    @location(0) color_output: vec4<f32>\n};\n\nstruct RotateMatrix {\n    matrix: mat4x4<f32>\n};\n\n@group(0) @binding(0) var<uniform> rotateMatrix: RotateMatrix;\n\n@vertex\nfn main(input: PositionColorInput) -> PositionColorOutput {\n    var output: PositionColorOutput;\n    output.color_output = input.in_color_rgba;\n    output.coords_output = rotateMatrix.matrix * vec4<f32>(input.in_position_3d, 1.0);\n    return output;\n}"},19371:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(8154);function s(e,t,i){return(t=(0,r.A)(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}},92639:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(29476);function s(e,t){if("object"!=(0,r.A)(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=(0,r.A)(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}},8154:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(29476),s=i(92639);function a(e){var t=(0,s.A)(e,"string");return"symbol"==(0,r.A)(t)?t:t+""}},29476:(e,t,i)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}i.d(t,{A:()=>r})}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={exports:{}};return i[e](a,a.exports,s),a.exports}s.m=i,s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,i)=>(s.f[i](e,t),t)),[])),s.u=e=>e+".avplayer.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="AVPlayer:",s.l=(i,r,a,o)=>{if(e[i])e[i].push(r);else{var n,h;if(void 0!==a)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var l=d[c];if(l.getAttribute("src")==i||l.getAttribute("data-webpack")==t+a){n=l;break}}n||(h=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,s.nc&&n.setAttribute("nonce",s.nc),n.setAttribute("data-webpack",t+a),n.src=i),e[i]=[r];var u=(t,r)=>{n.onerror=n.onload=null,clearTimeout(f);var s=e[i];if(delete e[i],n.parentNode&&n.parentNode.removeChild(n),s&&s.forEach((e=>e(r))),t)return t(r)},f=setTimeout(u.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=u.bind(null,n.onerror),n.onload=u.bind(null,n.onload),h&&document.head.appendChild(n)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=i[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={792:0};s.f.j=(t,i)=>{var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var a=new Promise(((i,s)=>r=e[t]=[i,s]));i.push(r[2]=a);var o=s.p+s.u(t),n=new Error;s.l(o,(i=>{if(s.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var a=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;n.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",n.name="ChunkLoadError",n.type=a,n.request=o,r[1](n)}}),"chunk-"+t,t)}};var t=(t,i)=>{var r,a,[o,n,h]=i,d=0;if(o.some((t=>0!==e[t]))){for(r in n)s.o(n,r)&&(s.m[r]=n[r]);h&&h(s)}for(t&&t(i);d<o.length;d++)a=o[d],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0},i=self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a=s(55019);return a.default})()));