"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[168],{28481:(e,t,s)=>{s.d(t,{A:()=>u});var i=s(19371),r=s(42524),a=s(47378),n=s(60962),o=s(36519),l=s(20921),d=s(95852),h=s(24011);class u{constructor(e){(0,i.A)(this,"options",void 0),(0,i.A)(this,"frame",void 0),(0,i.A)(this,"decoder",void 0),this.options=e}getAVFrame(){return this.frame?this.frame:this.frame={pts:BigInt(0),duration:BigInt(0),rects:[],timeBase:{den:1,num:1}}}outputAVFrame(){this.frame&&(this.options.onReceiveSubtitle&&this.options.onReceiveSubtitle(this.frame),this.frame=void 0)}receiveAVFrame(){return this.decoder.receiveAVFrame(this.getAVFrame())}async open(e){switch(r.f[15](e+4)){case 94226:this.decoder=new n.A;break;case 94232:this.decoder=new l.A;break;case 94210:case 94225:this.decoder=new h.A;break;case 94213:this.decoder=new d.A;break;case 94212:case 94230:this.decoder=new o.A;break;default:return a.r8}return 0}decode(e){let t=this.decoder.sendAVPacket(e);if(t)return t;for(;;){if(t=this.receiveAVFrame(),1!==t){if(t<0)return t;break}this.outputAVFrame()}return 0}async flush(){for(this.decoder.flush();;){if(this.receiveAVFrame()<1)return;this.outputAVFrame()}}close(){this.frame&&(this.frame=void 0)}}},36519:(e,t,s)=>{s.d(t,{A:()=>l});var i=s(19371),r=s(42524),a=s(1818),n=s(96138),o=s(4068);class l extends n.A{constructor(){super(),(0,i.A)(this,"queue",void 0),this.queue=[]}sendAVPacket(e){return this.queue.push({data:(0,a.iI)(e).slice(),pts:r.f[17](e+8),duration:r.f[17](e+48),timeBase:{den:r.f[15](e+76),num:r.f[15](e+72)}}),0}receiveAVFrame(e){if(this.queue.length){const t=this.queue.shift();e.pts=t.pts,e.duration=t.duration,e.timeBase.den=t.timeBase.den,e.timeBase.num=t.timeBase.num;let s=o.decode(t.data);return/^\w+?\s*:/.test(s)||(s="Dialogue: "+s),e.rects.push({type:3,text:s,flags:0}),1}return 0}flush(){return 0}}},96138:(e,t,s)=>{s.d(t,{A:()=>i});class i{}},24011:(e,t,s)=>{s.d(t,{A:()=>l});var i=s(19371),r=s(42524),a=s(1818),n=s(96138),o=s(4068);class l extends n.A{constructor(){super(),(0,i.A)(this,"queue",void 0),this.queue=[]}sendAVPacket(e){return this.queue.push({data:(0,a.iI)(e).slice(),pts:r.f[17](e+8),duration:r.f[17](e+48),timeBase:{den:r.f[15](e+76),num:r.f[15](e+72)}}),0}receiveAVFrame(e){if(this.queue.length){const t=this.queue.shift();return e.pts=t.pts,e.duration=t.duration,e.timeBase.den=t.timeBase.den,e.timeBase.num=t.timeBase.num,e.rects.push({type:1,text:o.decode(t.data),flags:0}),1}return 0}flush(){return 0}}},95852:(e,t,s)=>{s.d(t,{A:()=>d});var i=s(19371),r=s(42524),a=s(1818),n=s(96138),o=s(87339),l=s(4068);class d extends n.A{constructor(){super(),(0,i.A)(this,"queue",void 0),this.queue=[]}sendAVPacket(e){const t=(0,a.iI)(e).slice();if(t.length<2)return 0;const s=t[0]<<8|t[1];if(s+2>t.length)return o.R8(`invalid timed text data, need ${s+2} but got ${t.length}, ignore it`,"packages/avcodec/src/subtitle/decoder/TimedTextDecoder.ts",61),0;const i=l.decode(t.subarray(2,2+s));return this.queue.push({text:i,pts:r.f[17](e+8),duration:r.f[17](e+48),timeBase:{den:r.f[15](e+76),num:r.f[15](e+72)}}),0}receiveAVFrame(e){if(this.queue.length){const t=this.queue.shift();return e.pts=t.pts,e.duration=t.duration,e.timeBase.den=t.timeBase.den,e.timeBase.num=t.timeBase.num,e.rects.push({type:1,text:t.text,flags:0}),1}return 0}flush(){return 0}}},20921:(e,t,s)=>{s.d(t,{A:()=>h});var i=s(19371),r=s(42524),a=s(1818),n=s(13277),o=s(91278),l=s(4068),d=s(96138);class h extends d.A{constructor(){super(),(0,i.A)(this,"queue",void 0),this.queue=[]}sendAVPacket(e){let t=l.decode((0,a.iI)(e));return t?(/<tt/.test(t.trim())?this.queue=this.queue.concat(n.q(t).queue):this.queue.push({pts:r.f[17](e+8),duration:r.f[17](e+48),context:t,region:"Default"}),0):0}receiveAVFrame(e){if(this.queue.length){const t=this.queue.shift();return e.pts=t.pts,e.duration=t.duration,e.timeBase.den=o.qs,e.timeBase.num=1,e.rects.push({type:2,text:t.context,flags:0}),1}return 0}flush(){return 0}}},60962:(e,t,s)=>{s.d(t,{A:()=>h});var i=s(19371),r=s(42524),a=s(1818),n=s(91278),o=s(4068),l=s(57102),d=s(96138);class h extends d.A{constructor(){super(),(0,i.A)(this,"queue",void 0),this.queue=[]}findTimelineTag(e){const t=e.indexOf("<");if(t>=0){const s=e.indexOf(">",t);if(s>t&&/^(\d{2,}:)?\d{2}:\d{2}\.\d{1,3}$/.test(e.substring(t+1,s)))return{start:t,end:s}}return{start:-1,end:-1}}sendAVPacket(e){let t=o.decode((0,a.iI)(e)),s=r.f[17](e+8);const i=s+r.f[17](e+48),n=[];for(;;){const{start:i,end:a}=this.findTimelineTag(t);if(i<0)break;const o=l.j(t.substring(i+1,a));n.push(t.substring(0,i)),this.queue.push({context:n.join(""),pts:s,duration:o-s,timeBase:{den:r.f[15](e+76),num:r.f[15](e+72)}}),s=o,t=t.substring(a+1)}return n.push(t),this.queue.push({context:n.join(""),pts:s,duration:i-s,timeBase:{den:r.f[15](e+76),num:r.f[15](e+72)}}),0}receiveAVFrame(e){if(this.queue.length){const t=this.queue.shift();return e.pts=t.pts,e.duration=t.duration,e.timeBase.den=n.qs,e.timeBase.num=1,e.rects.push({type:2,text:t.context,flags:0}),1}return 0}flush(){return 0}}},99011:(e,t,s)=>{s.d(t,{Q:()=>i});const i=["ReadOrder","Layer","Start","End","Style","Name","MarginL","MarginR","MarginV","Effect","Text"]},67644:(e,t,s)=>{s.d(t,{Bp:()=>o,Ew:()=>d,_T:()=>l});var i=s(99011),r=s(87339),a=s(57102);const n="packages/avformat/src/formats/ass/iass.ts";function o(e){return function(e,t){const s=t.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/),i=[];for(let t=0;t<s.length;t++){const a=e.find((e=>e.toLowerCase()===s[t].toLowerCase()));a||r.R8(`not support ass field(${s[t]})`,n,37),i.push(a||s[t])}return i}(i.Q,e)}function l(e,t){let s=t.split(",");if(s.length>e.length){const t=s.slice(e.length-1).join(",");s=s.slice(0,e.length-1),s.push(t)}return s}function d(e,t,s,i){const[,,r]=t.match(/^(\w+?)\s*:\s*(.*)/i),n=l(e,r);return{start:a.j(n[s]),end:a.j(n[i])}}},24807:(e,t,s)=>{s.d(t,{A:()=>f});var i=s(19371),r=s(72039),a=s(65603),n=s(32925),o=s(19447),l=s(92937),d=s(12655),h=s(6956),u=s(25092),c=s(58999);const g='.ASS-box{font-family:Arial;overflow:hidden;pointer-events:none;position:absolute}.ASS-dialogue{font-size:0;width:max-content;position:absolute;z-index:0;transform:translate(calc(var(--ass-align-h)*-1),calc(var(--ass-align-v)*-1));span{display:inline-block}[data-text]{display:inline-block;color:var(--ass-fill-color);font-size:calc(var(--ass-scale)*var(--ass-real-fs)*1px);line-height:calc(var(--ass-scale)*var(--ass-tag-fs)*1px);letter-spacing:calc(var(--ass-scale)*var(--ass-tag-fsp)*1px);filter:blur(calc(var(--ass-scale-stroke)*var(--ass-tag-blur)*(1-round(up,sin(var(--ass-tag-xbord))*sin(var(--ass-tag-xbord))))*(1-round(up,sin(var(--ass-tag-ybord))*sin(var(--ass-tag-ybord))))*1px))}[data-is="br"]+[data-is="br"]{height:calc(var(--ass-scale)*var(--ass-tag-fs)*1px/2)}}.ASS-dialogue[data-wrap-style="0"],.ASS-dialogue[data-wrap-style="3"]{text-wrap:balance;white-space:pre-wrap}.ASS-dialogue[data-wrap-style="1"]{word-break:break-word;white-space:pre-wrap}.ASS-dialogue[data-wrap-style="2"]{word-break:normal;white-space:pre}.ASS-dialogue[data-border-style="1"]{position:relative;&::before,&::after{content:attr(data-text);position:absolute;top:0;left:0;z-index:-1;filter:blur(calc(var(--ass-scale-stroke)*var(--ass-tag-blur)*1px))}&::before{color:var(--ass-shadow-color);-webkit-text-stroke:calc(var(--ass-scale-stroke)*var(--ass-border-width)*1px) var(--ass-shadow-color);transform:translate(calc(var(--ass-scale-stroke)*var(--ass-tag-xshad)*1px),calc(var(--ass-scale-stroke)*var(--ass-tag-yshad)*1px))}&::after{color:var(--ass-border-color);-webkit-text-stroke:calc(var(--ass-scale-stroke)*var(--ass-border-width)*1px) var(--ass-border-color)}&[data-stroke="svg"]{color:#000;&::before,&::after{opacity:0}}}@container style(--ass-tag-xbord:0) and style(--ass-tag-ybord:0){.ASS-dialogue[data-border-style="1"]::after{display:none}}@container style(--ass-tag-xshad:0) and style(--ass-tag-yshad:0){.ASS-dialogue[data-border-style="1"]::before{display:none}}.ASS-dialogue[data-border-style="3"]{padding:calc(var(--ass-scale-stroke)*var(--ass-tag-xbord)*1px)calc(var(--ass-scale-stroke)*var(--ass-tag-ybord)*1px);position:relative;filter:blur(calc(var(--ass-scale-stroke)*var(--ass-tag-blur)*1px));&::before,&::after{content:"";width:100%;height:100%;position:absolute;z-index:-1}&::before{background-color:var(--ass-shadow-color);left:calc(var(--ass-scale-stroke)*var(--ass-tag-xshad)*1px);top:calc(var(--ass-scale-stroke)*var(--ass-tag-yshad)*1px)}&::after{background-color:var(--ass-border-color);left:0;top:0}}@container style(--ass-tag-xbord:0) and style(--ass-tag-ybord:0){.ASS-dialogue [data-border-style="3"]::after{background-color:transparent}}@container style(--ass-tag-xshad:0) and style(--ass-tag-yshad:0){.ASS-dialogue [data-border-style="3"]::before{background-color:transparent}}.ASS-dialogue[data-rotate]{transform:perspective(312.5px) rotateY(calc(var(--ass-tag-fry) * 1deg)) rotateX(calc(var(--ass-tag-frx) * 1deg)) rotateZ(calc(var(--ass-tag-frz) * -1deg));&[data-text]{transform-style:preserve-3d;word-break:normal;white-space:nowrap}}.ASS-dialogue[data-scale],.ASS-dialogue[data-skew]{display:inline-block;transform:scale(var(--ass-tag-fscx), var(--ass-tag-fscy)) skew(calc(var(--ass-tag-fax)*1rad),calc(var(--ass-tag-fay) * 1rad));transform-origin:var(--ass-align-h) var(--ass-align-v)}.ASS-fix-font-size{font-family:Arial;line-height:normal;width:0;height:0;position:absolute;visibility:hidden;overflow:hidden;span{position:absolute}}.ASS-clip-area{width:100%;height:100%;position:absolute;top:0;left:0}.ASS-effect-area{position:absolute;display:flex;width:100%;height:fit-content;overflow:hidden;mask-composite:intersect;&[data-effect="banner"]{flex-direction:column;height:100%}.ASS-dialogue{position:static;transform:none}}',p={Name:"Default",Fontname:"Arial",Fontsize:"16",PrimaryColour:"&Hffffff",SecondaryColour:"&Hffffff",OutlineColour:"&H0",BackColour:"&H0",Bold:"0",Italic:"0",Underline:"0",StrikeOut:"0",ScaleX:"100",ScaleY:"100",Spacing:"0",Angle:"0",BorderStyle:"1",Outline:"1",Shadow:"0",Alignment:"2",MarginL:"10",MarginR:"10",MarginV:"10",Encoding:"0"};class f{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{container:e.parentNode};if((0,i.A)(this,"store",void 0),(0,i.A)(this,"resampling_","video_height"),(0,i.A)(this,"resize_",void 0),(0,i.A)(this,"options",void 0),this.options=u.X$({},t),this.store={video:e,box:document.createElement("div"),svg:(0,n.An)("svg"),defs:(0,n.An)("defs"),observer:null,scale:1,width:0,height:0,scriptRes:{width:t.videoWidth||e.clientWidth,height:t.videoHeight||e.clientHeight},layoutRes:{width:t.videoWidth||e.clientWidth,height:t.videoHeight||e.clientHeight},resampledRes:{width:0,height:0},sbas:!0,styles:null,space:[],actives:[],delay:0,index:0,dialogues:[]},null==t.videoWidth&&(e.videoWidth=t.videoWidth),null==t.videoHeight&&(e.videoHeight=t.videoHeight),!t.container)throw new Error("Missing container.");this.resize_=(0,a.By)(this,this.store),this.updateHeader(t.header),r.Y&&t.container.append(r.Y);const{svg:s,defs:o,scriptRes:l,box:d}=this.store;s.setAttributeNS(null,"viewBox",`0 0 ${l.width} ${l.height}`),s.append(o),t.container.append(s),d.className="ASS-box",t.container.append(d),function(e){const t=e.getRootNode()||document;let s=t instanceof Document;!s&&"object"==typeof documentPictureInPicture&&documentPictureInPicture.window&&(s=t===documentPictureInPicture.window.document);const i=s?t.head:t;let r=i.querySelector("#ASS-global-style");r||(r=document.createElement("style"),r.type="text/css",r.id="ASS-global-style",r.append(document.createTextNode(g)),i.append(r)),document.head.querySelector("#ASS-global-style")||(r=document.createElement("style"),r.type="text/css",r.id="ASS-global-style",r.append(document.createTextNode(g)),document.head.append(r))}(t.container),this.resampling_=t.resampling||"video_height";const h=new ResizeObserver(this.resize.bind(this));return h.observe(e),this.store.observer=h,this}framing(e){const t=(0,o.U)(e,this.store);t.animations&&t.animations.forEach((e=>{e.currentTime=Number(this.store.video.currentTime)-1e3*t.start})),(0,n.MA)(t,"play"),t.__dialogue=e,this.store.actives.push(t)}updateHeader(e){if(e){const{info:t,width:s,height:i,styles:r}=(0,l.wE)(e,{defaultStyle:p});this.store.sbas=/yes/i.test(t.ScaledBorderAndShadow),this.store.layoutRes={width:+t.LayoutResX||this.options.videoWidth||this.store.video.clientWidth,height:+t.LayoutResY||this.options.videoHeight||this.store.video.clientHeight},this.store.scriptRes={width:s||this.store.layoutRes.width,height:i||this.store.layoutRes.height},this.store.styles=r}else this.store.styles=(0,h.W)({info:{WrapStyle:""},style:[],defaultStyle:p}),this.store.scriptRes={width:384,height:288};this.resize_(),this.options.header=e}updateVideoResolution(e,t){if(this.options.header){const{info:s,width:i,height:r}=(0,l.wE)(this.options.header,{defaultStyle:p});this.store.layoutRes={width:+s.LayoutResX||e||this.store.video.clientWidth,height:+s.LayoutResY||t||this.store.video.clientHeight},this.store.scriptRes={width:i||this.store.layoutRes.width,height:r||this.store.layoutRes.height}}else this.store.layoutRes={width:e,height:t}}render(e){if(1===e.type){var t;e.Start=Number(e.Start)/1e3,e.End=Number(e.End)/1e3;const s=(0,d.b)({styles:this.store.styles,dialogues:[e]})[0];u.X$(s,{effect:["banner","scroll up","scroll down"].includes(null===(t=s.effect)||void 0===t?void 0:t.name)?s.effect:null,d:`ASS-${(0,c.A)()}`,align:{h:(s.alignment+2)%3,v:Math.trunc((s.alignment-1)/3)}}),this.framing(s)}}clear(e){const t=Number(e)/1e3;for(let e=this.store.actives.length-1;e>=0;e-=1){const s=this.store.actives[e],{end:i}=s;i<t&&(s.$div.remove(),this.store.actives.splice(e,1))}}clearAll(){for(let e=this.store.actives.length-1;e>=0;e-=1)this.store.actives[e].$div.remove();this.store.actives.length=0,this.store.space.length=0}resize(){const e=this.store.actives.slice();this.resize_();for(let t=0;t<e.length;t++)this.framing(e[t].__dialogue)}destroy(){const{video:e,box:t,svg:s,observer:i}=this.store;return(0,a.IU)(this.store),r.Y&&r.Y.remove(),s.remove(),t.remove(),i.unobserve(e),this.store.styles={},this}show(){return this.store.box.style.visibility="visible",this}hide(){return this.store.box.style.visibility="hidden",this}get resampling(){return this.resampling_}set resampling(e){e!==this.resampling_&&/^(video|script)_(width|height)$/.test(e)&&(this.resampling_=e,this.resize())}}},98168:(e,t,s)=>{s.r(t),s.d(t,{default:()=>R,parseEvent:()=>q});var i=s(19371),r=s(54911),a=s(75589),n=s(42524),o=s(77389),l=s(24807),d=s(67644),h=s(13745),u=s(95867),c=s(28481),g=s(7615),p=s(30027),f=s(1818),v=s(91278),m=s(57102),b=s(25092),y=s(4068),A=s(87339),x=s(39753),w=s(41863),S=s(85266);const k="packages/avplayer/src/subtitle/SubtitleRender.ts",B=[{reg:/<i>/g,value:"{\\i1}"},{reg:/<\/i>/g,value:"{\\i0}"},{reg:/<b>/g,value:"{\\b1}"},{reg:/<\/b>/g,value:"{\\b0}"},{reg:/<u>/g,value:"{\\u1}"},{reg:/<\/u>/g,value:"{\\u0}"},{reg:/{/g,value:"\\{"},{reg:/}/g,value:"\\}"},{reg:/&gt;/g,value:">"},{reg:/&lt;/g,value:"<"},{reg:/&lrm;/g,value:""},{reg:/&rlm;/g,value:""},{reg:/&amp;/g,value:"&"},{reg:/&nbsp;/g,value:"\\h"},{reg:/(<br\s*\/?>)|\n>/g,value:"\\N"}];function q(e,t){const[,s,i]=t.match(/^(\w+?)\s*:\s*(.*)/i);let r=0;switch(s){case"Comment":r=2;break;case"Dialogue":r=1;break;case"Command":r=6;break;case"Movie":r=5;break;case"Picture":r=3;break;case"Sound":r=4}const a=d._T(e,i),n={type:r};for(let t=0;t<a.length;t++){n[e[t]]=a[t];const s=e[t],i=a[t].trim();switch(s){case"Layer":case"MarginL":case"MarginR":case"MarginV":n[s]=+i;break;case"Start":case"End":n[s]=m.j(i);break;case"Effect":n[s]=(0,h.d)(i);break;case"Text":n[s]=(0,u.r)(i);break;default:n[s]=i}}return n}class R{constructor(e){(0,i.A)(this,"decoder",void 0),(0,i.A)(this,"loop",void 0),(0,i.A)(this,"demuxer2SubtitleRenderChannels",void 0),(0,i.A)(this,"leftPorts",void 0),(0,i.A)(this,"currentPort",void 0),(0,i.A)(this,"render",void 0),(0,i.A)(this,"queue",void 0),(0,i.A)(this,"ended",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"pulling",void 0),(0,i.A)(this,"formats",void 0),(0,i.A)(this,"avpacketPool",void 0),(0,i.A)(this,"delay",void 0),(0,i.A)(this,"enable",void 0),this.options=b.X$({},e),this.ended=!1,this.pulling=!1,this.queue=[],this.delay=BigInt(0),this.demuxer2SubtitleRenderChannels=new Map,this.leftPorts=new Map,e.avpacketList&&(this.avpacketPool=new g.A((0,a.A)(e.avpacketList,r.A),e.avpacketListMutex)),this.createDecoder(),this.render=new l.A(this.options.dom,{header:this.getAssHeader(this.options.codecpar),container:this.options.container,videoWidth:this.options.videoWidth,videoHeight:this.options.videoHeight}),this.loop=new x.A((()=>{!this.queue.length&&this.ended&&this.loop.stop(),this.queue.length<6&&!this.ended&&this.pull();const e=this.options.getCurrentTime()-this.delay;for(this.render.clear(e);this.queue.length;){const t=this.queue[0];if(t.Start>e)break;t.End>e&&this.render.render(t),this.queue.shift()}}),0,50,!1)}getAssHeader(e){let t="";if(94230===n.f[15](e+4)&&n.f[15](e+16)){t=y.decode((0,w.s3)(n.f[20](e+12),n.f[15](e+16)));const s=t.split(/\r?\n/);let i=!1;for(let e=0;e<s.length;e++){const t=s[e].trim();"[Events]"===t&&(i=!0),/^Format:/.test(t)&&i&&(this.formats=d.Bp(t.trim()))}}return t}createDecoder(){this.decoder&&this.decoder.close(),this.decoder=new c.A({onReceiveSubtitle:e=>{for(let t=0;t<e.rects.length;t++){const s=e.rects[t];if(3===s.type){const t=q(this.formats,s.text);null==t.Start&&(t.Start=e.pts),null==t.End&&(t.End=e.pts+e.duration),this.queue.push(t)}else 2===s.type?this.queue.push(this.webvtt2AssEvent(s.text,e.pts,e.pts+e.duration)):this.queue.push(this.text2AssEvent(s.text,e.pts,e.pts+e.duration))}}}),this.decoder.open(this.options.codecpar)}text2AssEvent(e,t,s){return{type:1,ReadOrder:0,Layer:0,Start:t,End:s,Style:"Default",Name:"",MarginL:0,MarginR:0,MarginV:0,Text:{raw:e,combined:e,parsed:[{tags:[],text:e,drawing:[]}]}}}webvtt2AssEvent(e,t,s){for(let t=0;t<B.length;t++)e=e.replace(B[t].reg,B[t].value);return this.text2AssEvent(e,t,s)}async pull(){if(this.pulling&&!this.ended)return;this.pulling=!0;const e=this.currentPort,t=await this.leftPorts.get(this.currentPort).request("pull");var s;if(-1048576===t)A.Yz("SubtitleRender end",k,378),null===(s=this.decoder)||void 0===s||s.flush(),this.ended=!0;else if(t<0)A.Yz(`SubtitleRender pull avpacket error, ret: ${t}`,k,383),this.ended=!0;else if(this.loop&&e===this.currentPort){o.M[17](t+8,(0,p.Mr)(n.f[17](t+8),t+72,v.i0)),o.M[17](t+48,(0,p.Mr)(n.f[17](t+48),t+72,v.i0));const e=this.decoder.decode(t);this.avpacketPool?this.avpacketPool.release(t):(0,f.Qe)(t),e<0&&(A.Yz(`SubtitleRender decode avpacket error, ret: ${t}`,k,397),this.ended=!0)}else this.avpacketPool?this.avpacketPool.release(t):(0,f.Qe)(t);this.pulling=!1}getDemuxerPort(e){if(this.demuxer2SubtitleRenderChannels.has(e))return this.demuxer2SubtitleRenderChannels.get(e).port1;const t=new MessageChannel,s=new S.Ay(t.port2);return this.demuxer2SubtitleRenderChannels.set(e,t),this.leftPorts.set(e,s),t.port1}start(){this.loop.isStarted()||this.loop.start(),this.ended=!1}stop(){this.loop.stop(),this.render.clearAll()}pause(){this.loop.stop()}reset(){this.queue.length=0,this.render.clearAll()}reopenDecoder(e){this.options.codecpar=e,this.createDecoder(),this.render.updateHeader(this.getAssHeader(e))}updateVideoResolution(e,t){e===this.options.videoWidth&&t===this.options.videoHeight||(this.render.updateVideoResolution(e,t),this.options.videoWidth=e,this.options.videoHeight=t)}setDemuxTask(e){this.currentPort!==e&&(this.pulling=!1),this.currentPort=e}destroy(){this.loop.destroy(),this.loop=null,this.leftPorts.clear(),this.demuxer2SubtitleRenderChannels.clear(),this.queue.length=0,this.render.destroy(),this.render=null,this.decoder.close(),this.decoder=null}setDelay(e){this.delay=e}getDelay(){return this.delay}}},13277:(e,t,s)=>{s.d(t,{q:()=>o});var i=s(79880),r=s(17630),a=s(81819),n=s(57102);function o(e){const t=(0,i.A)(e,{aloneValueName:"context"});if(!t.tt)return{queue:[],head:{}};const s=[];function o(e){let t="";return r.__(e,(e=>{a.Yj(e)?t+=e:e.context?t+=`<${e.tagName}>${e.context}</${e.tagName}>`:t+=`<${e.tagName}/>`})),t}function l(e,t,i){let l=n.j(t||e.begin),d=e.context||"",h=e.region||"Default",u="";a.YO(d)&&(d=o(d)),a.YO(e.span)?r.__(e.span,(e=>{e.context&&(l===-BigInt(1)&&e.begin&&(l=n.j(e.begin)),!h&&e.region&&(h=e.region),a.Yj(e.context)?(d+=e.context,e.br&&(d+="<br>")):(d+=o(e.context),e.br&&(d+="<br>"))),e.end&&(u=e.end)})):e.span&&(e.span.context&&(l===-BigInt(1)&&e.span.begin&&(l=n.j(e.span.begin)),!h&&e.span.region&&(h=e.span.region),a.Yj(e.span.context)?d+=e.span.context:d+=o(e.span.context)),e.span.end&&(u=e.span.end)),s.push({context:d,pts:l,region:h,duration:e.dur?n.j(e.dur):n.j(i||e.end||u)-l})}function d(e,t,s){a.YO(e)?r.__(e,(e=>{l(e,t,s)})):l(e,t,s)}return t.tt.body&&t.tt.body.div&&(a.YO(t.tt.body.div)?r.__(t.tt.body.div,(e=>{e.p&&d(e.p,e.begin,e.end)})):t.tt.body.div.p&&d(t.tt.body.div.p,t.tt.body.div.begin,t.tt.body.end)),{queue:s,head:t.tt.head||{}}}},57102:(e,t,s)=>{function i(e){if(!e)return-BigInt(1);let t=(e=e.trim()).split(":"),s=BigInt(0);if(3===t.length&&(s+=BigInt(+t.shift().trim())*BigInt(36e5)),s+=BigInt(+t.shift().trim())*BigInt(6e4),t=t.shift().trim().split("."),s+=BigInt(+t.shift().trim())*BigInt(1e3),t.length){let e=t[0].trim().length,i=BigInt(+t.shift().trim());1===e?i*=BigInt(100):2===e&&(i*=BigInt(10)),s+=i}return s}function r(e){if(!e)return-BigInt(1);let t=(e=e.trim()).split(":"),s=BigInt(0);if(3===t.length&&(s+=BigInt(+t.shift().trim())*BigInt(36e5)),s+=BigInt(+t.shift().trim())*BigInt(6e4),t=t.shift().trim().split(","),s+=BigInt(+t.shift().trim())*BigInt(1e3),t.length){let e=t[0].trim().length,i=BigInt(+t.shift().trim());1===e?i*=BigInt(100):2===e&&(i*=BigInt(10)),s+=i}return s}s.d(t,{j:()=>i,t:()=>r})},79880:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(17630);const r={aloneValueName:"_@attribute"},a=[" ","/",'"',"'","<",">"];function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r;e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/g,"")).replace(/[\n\t\r]/g,"")).replace(/>[ \t]+</g,"><")).replace(/<\?[^>]*\?>/g,"");const s=[];let n=0;function o(e,i){const r=s[s.length-1];r&&(e!==t.aloneValueName||null==r.obj[t.aloneValueName]?null==r.obj[e]?r.obj[e]=i:Array.isArray(r.obj[e])?r.obj[e].push(i):r.obj[e]=[r.obj[e],i]:r.obj[t.aloneValueName]=[r.obj[t.aloneValueName],{tagName:e,...i}])}function l(t){for(;n<e.length;){if(e[n]===t)return!0;n++}return!1}function d(){h();let t="";for(;n<e.length&&!i.zy(a,e[n]);)t+=e[n],n++;return t}function h(){for(;n<e.length&&/\s|\r|\n/.test(e[n]);)n++}const u=/\s/,c=/'/,g=/"/;function p(){if(n>=e.length)return!0;h();let t=u;'"'!==e[n]&&"'"!=e[n]||(t='"'===e[n]?g:c,n++);let s="";for(;n<e.length;){if(t.test(e[n])){n++;break}s+=e[n],n++}return s}function f(){h();let t="";for(;n<e.length&&"<"!==e[n];)t+=e[n],n++;return t}function v(){for(;"<"===e[n];){const t=n;if(n++,h(),"/"!==e[n]){n=t;break}if(n++,d()===s[s.length-1].tag){if(s.length>1){const e=s.pop();o(e.tag,e.obj)}l(">"),n++,h()}else s.pop(),l(">"),n++,h()}}return function i(){if(n>=e.length)return;let r=n;if(h(),"<"!==e[n])return n=r,o(t.aloneValueName,f()),v(),i();let a=l("<");if(!a)return;r=n,n++;const u=d();if(s.push({obj:{},tag:u,start:r}),function(){for(;h(),">"!==e[n]&&"/"!==e[n];){let e=d();if(!e)break;"="===e[e.length-1]?e=e.substring(0,e.length-1):(l("="),n++),o(e,p())}}(),h(),"/"===e[n]){if(n++,s.length>1){const e=s.pop();o(e.tag,e.obj)}return l(">"),n++,v(),i()}a=l(">"),a&&(n++,h(),"<"!==e[n]&&(o(t.aloneValueName,f()),h()),v(),i())}(),{[s[0].tag]:s[0].obj}}}}]);