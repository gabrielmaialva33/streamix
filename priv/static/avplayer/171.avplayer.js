"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[171],{6072:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(19371);class s{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},73012:(e,a,t)=>{t.r(a),t.d(a,{default:()=>x});var i=t(19371),s=t(42524),r=t(77389),n=t(50012),o=t(47898),c=t(6072),d=t(92031),f=t(6285),p=t(13101),l=t(30018),m=t(41863),u=t(47378),w=t(30027),g=t(1818),h=t(31184),k=t(91278),z=t(43776),v=t(95704),U=t(87339),A=t(25092),I=t(17630),y=t(4068);const b="packages/avformat/src/formats/IIsobmffFormat.ts";class x extends c.A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),(0,i.A)(this,"type",1),(0,i.A)(this,"context",void 0),(0,i.A)(this,"firstAfterSeek",void 0),(0,i.A)(this,"options",void 0),this.options=e,this.context=(0,f.A)(),e.ignoreEditlist&&(this.context.ignoreEditlist=!0)}init(e){e.ioReader&&e.ioReader.setEndian(!0),this.firstAfterSeek=!1}async readHeader(e){try{var a;const t=await e.ioReader.fileSize();let i=0,c=await e.ioReader.readUint32(),d=await e.ioReader.readUint32();d===(0,n.A)("ftyp")?await o.E6(e.ioReader,this.context,{type:d,size:c-8}):(!t||c<t)&&await e.ioReader.skip(c-8);let f=BigInt(0);for(;!this.context.foundMoov;){const a=e.ioReader.getPos();if(a===t){if(this.context.foundHEIF)break;return U.z3("the file format is not mp4",b,144),u.LR}if(c=await e.ioReader.readUint32(),d=await e.ioReader.readUint32(),1===c&&(c=Number(await e.ioReader.readUint64())),c<8||t&&a+BigInt(Math.floor(c))>t||!/^[\x20-\x7E]{4}$/.test((0,l.A)(d))){if(this.context.foundMdat&&(this.context.foundMoov||this.context.foundHEIF))break;return U.z3(`invalid box size ${c}`,b,165),u.LR}d===(0,n.A)("mdat")?(this.context.foundMdat||(f=a),this.context.foundMdat=!0,await e.ioReader.seek(a+BigInt(Math.floor(c)),!1,!1)):d===(0,n.A)("moov")?(await o.wB(e.ioReader,e,this.context,{size:c-8,type:d}),this.context.foundMoov=!0):d!==(0,n.A)("meta")||this.context.majorBrand!==(0,n.A)("avif")&&this.context.majorBrand!==(0,n.A)("avis")&&this.context.majorBrand!==(0,n.A)("heic")&&this.context.majorBrand!==(0,n.A)("heix")&&this.context.majorBrand!==(0,n.A)("hevc")&&this.context.majorBrand!==(0,n.A)("hevx")&&this.context.majorBrand!==(0,n.A)("mif1")&&this.context.majorBrand!==(0,n.A)("msf1")?await e.ioReader.seek(a+BigInt(Math.floor(c))):await o.jF(e.ioReader,e,this.context,{size:c-8,type:d})}if(!this.context.fragment&&!this.context.foundMdat){const a=await e.ioReader.peekUint64()>>BigInt(32);Number(a)===(0,n.A)("moof")&&(this.context.fragment=!0)}if(this.context.fragment&&1&e.ioReader.flags){const a=e.ioReader.getPos(),t=await e.ioReader.fileSize();if(t>BigInt(16)){await e.ioReader.seek(t-BigInt(12));let i=await e.ioReader.readUint32();if(i===(0,n.A)("mfro")){await e.ioReader.skip(4);const a=await e.ioReader.readUint32();await e.ioReader.seek(t-BigInt(Math.floor(a)));const s=await e.ioReader.readUint32();i=await e.ioReader.readUint32(),i===(0,n.A)("mfra")&&await o.t9(e.ioReader,e,this.context,{size:s-8,type:i})}await e.ioReader.seek(a)}}if(!this.context.fragment&&this.context.foundMdat&&await e.ioReader.seek(f),this.context.fragment||e.streams.forEach((e=>{if(27===e.codecpar.codecId||173===e.codecpar.codecId||196===e.codecpar.codecId){const a=e.privData;!(e.codecpar.videoDelay>0)||a.cttsSampleCounts&&a.cttsSampleCounts.length||(e.codecpar.flags|=2)}})),this.context.metadata&&A.X$(e.metadata,this.context.metadata),null!==(a=this.context.chapters)&&void 0!==a&&a.length){for(let e=1;e<this.context.chapters.length;e++)this.context.chapters[e-1].end=(0,w.k)(this.context.chapters[e].start,this.context.chapters[e].timeBase,this.context.chapters[e-1].timeBase);const a=this.context.chapters[this.context.chapters.length-1];e.streams.forEach((e=>{const t=(0,w.k)(e.duration,e.timeBase,a.timeBase);t>a.end&&(a.end=t)})),e.chapters.push(...this.context.chapters)}if(this.context.covr){let a=0;switch(this.context.covr.type){case 13:a=7;break;case 14:a=61;break;case 27:a=78;break;default:U.z3(`"Unknown cover type: ${this.context.covr.type}`,b,291)}if(a){this.context.covr.data.length>=8&&78!==a&&(a=I.FB(this.context.covr.data.subarray(0,8),new Uint8Array([137,80,78,71,13,10,26,10]))?61:7);const t=e.createStream();t.privData=(0,p.A)(),t.codecpar.codecId=a,t.codecpar.codecType=0,t.disposition|=1024,t.attachedPic=(0,g._5)(),r.M[15](t.attachedPic+32,t.index);const i=(0,h.sY)(this.context.covr.data.length);(0,m.lW)(i,this.context.covr.data.length,this.context.covr.data),(0,g.NX)(t.attachedPic,i,this.context.covr.data.length),r.M[15](t.attachedPic+36,1|s.f[15](t.attachedPic+36))}}if(this.context.chapterTrack&&1&e.ioReader.flags&&!this.options.ignoreChapters)for(let a=0;a<this.context.chapterTrack.length;a++){const t=this.context.chapterTrack[a],i=e.streams.find((e=>e.privData.trackId===t));if(i){const a=e.ioReader.getPos(),t=i.privData;if(0===i.codecpar.codecType){if(i.disposition|=1024,i.disposition|=2048,!i.attachedPic){const a=t.samplesIndex[0];if(a){await e.ioReader.seek(a.pos),i.attachedPic=(0,g._5)(),r.M[15](i.attachedPic+32,i.index),r.M[17](i.attachedPic+16,a.dts),r.M[17](i.attachedPic+8,a.pts),r.M[15](i.attachedPic+36,s.f[15](i.attachedPic+36)|a.flags),r.M[15](i.attachedPic+36,1|s.f[15](i.attachedPic+36)),r.M[17](i.attachedPic+56,a.pos);const t=(0,h.sY)(a.size);(0,m.lW)(t,a.size,await e.ioReader.readBuffer(a.size)),(0,g.NX)(i.attachedPic,t,a.size)}}}else{i.codecpar.codecType=2,i.codecpar.codecId=98314,i.discard=48;for(let a=0;a<t.samplesIndex.length;a++){const s=t.samplesIndex[a];await e.ioReader.seek(s.pos);const r=await e.ioReader.readUint16();if(r>s.size-2)continue;let n=s.pts+BigInt(0|s.duration);n<s.pts&&(n=k.Dh),e.chapters.push({id:BigInt(a),timeBase:{den:i.timeBase.den,num:i.timeBase.num},start:s.pts,end:n,metadata:{title:r?y.decode(await e.ioReader.readBuffer(r)):""}})}}await e.ioReader.seek(a)}}return i}catch(a){return U.z3(a.message,b,387),this.context.foundMoov||U.z3("moov not found",b,390),e.ioReader.error}}async readAVPacket_(e,a){const{sample:t,stream:i,encryption:o}=(0,d.G)(e,this.context,e.ioReader.flags);if(!t)return-1048576;{r.M[15](a+32,i.index),r.M[17](a+16,t.dts),2&i.codecpar.flags||r.M[17](a+8,t.pts),r.M[17](a+48,BigInt(Math.floor(t.duration))),r.M[15](a+36,s.f[15](a+36)|t.flags),r.M[17](a+56,t.pos),r.M[15](a+76,i.timeBase.den),r.M[15](a+72,i.timeBase.num),i.startTime===k.Dh&&(i.startTime=s.f[17](a+8));const c=s.f[17](a+56)-e.ioReader.getPos();c!==BigInt(0)&&(c>0&&(4&e.ioReader.flags||2&e.ioReader.flags)&&!this.firstAfterSeek?await e.ioReader.skip(Number(BigInt.asIntN(32,c))):await e.ioReader.seek(s.f[17](a+56))),this.firstAfterSeek&&(this.firstAfterSeek=!1);const d=t.size,f=(0,h.sY)(d);if((0,g.NX)(a,f,d),await e.ioReader.readBuffer(d,(0,m.JW)(f,d)),94226===i.codecpar.codecId&&s.f[15](a+28)>=8){const e=z.Sg(s.f[20](a+24)+4)>>>0,t=s.f[15](a+28);if(e===(0,n.A)("vtte")&&8===t){const e=(0,h.Gy)(1);(0,g.NX)(a,e,1),r.M[15](a+28,1)}if(t>8&&(e===(0,n.A)("vtte")||e===(0,n.A)("vttc"))){let e=s.f[20](a+24)+8;const i=s.f[20](a+24)+t;for(;e<i;){const t=z.Sg(e);if(z.Sg(e+4)>>>0===(0,n.A)("payl")&&t>8){const i=(0,h.sY)(t-8);(0,m.Mr)(i,e+8,t-8),(0,g.NX)(a,i,t-8);break}e+=t}}}if(i.sideData[1]&&1&s.f[15](a+36)){const e=i.sideData[1].length,t=(0,h.sY)(e);(0,g.Ow)(a,1,t,e),(0,m.lW)(t,e,i.sideData[1]),delete i.sideData[1]}if(o){const e=(0,v.zz)(o),t=(0,h.sY)(e.length);(0,m.lW)(t,e.length,e),(0,g.Ow)(a,25,t,e.length)}}return 0}async readAVPacket(e,a){try{if(!e.streams.find((e=>{var a;const t=e.privData;return(null===(a=t.samplesIndex)||void 0===a?void 0:a.length)&&!1===t.sampleEnd}))&&this.context.fragment&&!this.context.currentFragment)for(;!this.context.currentFragment;){const a=e.ioReader.getPos(),t=await e.ioReader.readUint32(),i=await e.ioReader.readUint32();i===(0,n.A)("moof")?(this.context.currentFragment={pos:a,size:t,sequence:0,tracks:[],currentTrack:null},this.context.firstMoof||(this.context.firstMoof=a),await o.wZ(e.ioReader,e,this.context,{type:i,size:t-8})):i===(0,n.A)("moov")?await o.wB(e.ioReader,e,this.context,{size:t-8,type:i}):await e.ioReader.skip(t-8)}return await this.readAVPacket_(e,a)}catch(a){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(U.z3(`read packet error, ${a}`,b,551),u.LR):e.ioReader.error}}async seek(e,a,t,i){const s=e.ioReader.getPos();if(2&i)return await e.ioReader.seek(t),s;const r=t,n=a.privData,o=()=>{this.context.currentFragment=null,e.streams.forEach((e=>{e.privData.samplesIndex.length=0}))};if(16&i&&this.context.fragment){const i=(0,w.k)(t,a.timeBase,k.i0);return await e.ioReader.seek(i,!0),o(),s}if(this.context.fragment){if(n.fragIndexes.length){let a=I.El(n.fragIndexes,(e=>e.time>r?-1:e.time===r?0:1));if(a>-1)return a>0&&n.fragIndexes[a].time>r&&a--,await e.ioReader.seek(n.fragIndexes[a].pos,!0),o(),s}return r===BigInt(0)&&this.context.firstMoof?(await e.ioReader.seek(this.context.firstMoof),o(),s):BigInt(u.E$)}let c=I.El(n.samplesIndex,(e=>e.pts>r?-1:e.pts===r?0:1));if(c>-1&&0===a.codecpar.codecType){let e=c;for(;e>=0;e--)if(1&n.samplesIndex[e].flags){c=e;break}e<0&&(c=-1)}return c>-1?(n.currentSample=c,n.sampleEnd=!1,I.__(e.streams,(e=>{if(e!==a&&!(1024&e.disposition)){const t=e.privData;let i=(0,w.k)(n.samplesIndex[n.currentSample].pts,a.timeBase,e.timeBase),s=I.El(t.samplesIndex,(e=>e.pts>i?-1:e.pts===i?0:1));if(s>-1&&0===e.codecpar.codecType){let e=s;for(;e>=0;e--)if(1&t.samplesIndex[e].flags){s=e;break}e<0&&(s=-1)}s>=0?(t.currentSample=s,t.sampleEnd=!1):(t.sampleEnd=!0,t.currentSample=t.samplesIndex.length)}})),this.firstAfterSeek=!0,s):BigInt(u.LR)}getAnalyzeStreamsCount(){return 0}}},76202:(e,a,t)=>{t.d(a,{_l:()=>i,gQ:()=>s});const i=["hmhd","nmhd","iods","xml ","url ","bxml","ipro","mere","stts","ctts","stss","stsz","stz2","stsc","stco","co64","stsd","dref","mvhd","tkhd","mdhd","hdlr"],s=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","vttc","tref","iref","mfra","hnti","hinf","strd","sinf","rinf","schi","trgr","udta","iprp","ipco","strk","meco","encv","enca","sinf","schi","udta","iprp"]},84514:(e,a,t)=>{function i(e,a,t,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const r=e.privData;let n=a.baseDataOffset+BigInt(Math.floor(a.dataOffset));(a.baseIsMoof||n<i)&&(n+=t.currentFragment.pos);let o=a.baseMediaDecodeTime;const c=a.sampleSizes,d=a.sampleDurations,f=a.sampleFlags,p=a.sampleCompositionTimeOffset,l=a.remainDataOffsets,m=a.remainDataOffsetIndex;let u=0;const w=[];for(let e=0;e<a.sampleCount;e++){m[u]===e&&(n=a.baseDataOffset+BigInt(Math.floor(l[u])),a.baseIsMoof&&(n+=t.currentFragment.pos),u++);const i={dts:o,pts:o+BigInt(Math.floor(p[e])),pos:n,size:c[e],duration:d[e],flags:0};o+=BigInt(Math.floor(i.duration)),n+=BigInt(Math.floor(i.size)),16842752&f[e]||(i.flags|=1),0===e&&c.length>1&&2&s&&(i.flags|=1),w.push(i)}r.samplesIndex=w;const g=t.cencs?t.cencs[r.trackId]:null;g&&a.cenc&&a.cenc.sampleEncryption&&(r.samplesEncryption=a.cenc.sampleEncryption.map((e=>({scheme:g.schemeType,keyId:g.defaultKeyId,skipByteBlock:g.skipByteBlock,cryptByteBlock:g.cryptByteBlock,iv:e.iv,subsamples:e.subsamples}))))}t.d(a,{p:()=>i})},16698:(e,a,t)=>{t.d(a,{X:()=>o});var i=t(87339),s=t(30027),r=t(91278);const n="packages/avformat/src/formats/isobmff/function/buildIndex.ts";function o(e,a){var t;const o=e.privData,c=o.chunkOffsets,d=o.sampleSizes,f=o.cttsSampleCounts,p=o.cttsSampleOffsets,l=o.stscFirstChunk,m=o.stscSamplesPerChunk,u=o.stssSampleNumbersMap,w=o.sttsSampleCounts,g=o.sttsSampleDeltas;if(!c.length)return;let h=0,k=0,z=0,v=0,U=0,A=0,I=BigInt(0),y=0,b=BigInt(0);const x=[];if(!a.ignoreEditlist&&null!==(t=e.metadata.elst)&&void 0!==t&&t.length){let t=BigInt(0),o=0,c=!1,d=BigInt(0),f=BigInt(0);for(let a=0;a<e.metadata.elst.length;a++){const t=e.metadata.elst[a];0===a&&t.mediaTime===-BigInt(1)?(d=t.segmentDuration,o=1):a===o&&t.mediaTime>=BigInt(0)?f=t.mediaTime:c=!0}c&&i.R8("multiple edit list entries, a/v desync might occur, patch welcome",n,96),(d||f)&&a.timescale>0&&(d&&(d=(0,s.k)(d,{num:1,den:a.timescale},e.timeBase),e.duration!==r.Dh&&(e.duration+=d)),t=f-d,b=-t)}for(let a=0;a<c.length;a++)if(I=c[a],h<l.length-1&&l[h+1]===a+1&&h++,A=m[h],o.isPcm){const e={dts:b,pts:b,pos:I,size:d[0]*A,duration:g[0]*A,flags:1};b+=BigInt(Math.floor(e.duration)),x.push(e)}else for(;A>0;){const a={dts:b,pts:b,pos:I,size:d[y],duration:g[k],flags:0};(u&&u.has(y+1)||1===e.codecpar.codecType)&&(a.flags|=1),p&&(a.pts=a.dts+BigInt(Math.floor(p[v])),U++,U===f[v]&&(v++,U=0)),I+=BigInt(Math.floor(a.size)),b+=BigInt(Math.floor(g[k])),z++,z===w[k]&&(k++,z=0),y++,x.push(a),A--}x.length&&e.duration===r.Dh&&(e.duration=x[y-1].pts+BigInt(Math.floor(x[y-1].duration))),o.samplesIndex=x,e.nbFrames=BigInt(x.length)}},78663:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(91278);function s(){return{trackId:0,baseDataOffset:BigInt(0),defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0,baseMediaDecodeTime:BigInt(0),sampleCount:0,dataOffset:0,remainDataOffsets:[],remainDataOffsetIndex:[],dataOffsetPos:BigInt(0),firstSampleFlags:0,sampleDurations:[],sampleSizes:[],sampleFlags:[],sampleCompositionTimeOffset:[],baseIsMoof:!1,ioWriter:null,buffers:[],lastFragIndexDts:BigInt(0),tfdtDelay:i.Dh,trunPtsDelay:BigInt(0)}}},6285:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(91278);function s(){return{isom:!1,timescale:i.N_,duration:i.Dh,foundMoov:!1,foundMdat:!1,foundHEIF:!1,majorBrand:0,minorVersion:0,compatibleBrand:[],creationTime:BigInt(0),modificationTime:BigInt(0),rate:i.N_,volume:i.N_,matrix:null,nextTrackId:1,fragment:!1,trexs:[],currentFragment:null,boxsPositionInfo:[],holdMoovPos:BigInt(0),currentChunk:null}}},13101:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(91278);function s(){return{chunkOffsets:null,cttsSampleCounts:null,cttsSampleOffsets:null,stscFirstChunk:null,stscSamplesPerChunk:null,stscSampleDescriptionIndex:null,stssSampleNumbersMap:null,stssSampleNumbers:null,sampleSizes:null,sttsSampleCounts:null,sttsSampleDeltas:null,duration:BigInt(0),trackId:i.N_,layer:0,alternateGroup:0,volume:0,matrix:null,width:0,height:0,audioCid:0,samplesPerFrame:0,bytesPerFrame:0,currentSample:0,sampleEnd:!1,samplesIndex:[],samplesEncryption:[],fragIndexes:[],lastPts:i.Dh,lastDts:i.Dh,startDts:i.Dh,startCT:i.N_,startPts:i.Dh,lastDuration:0,chunkCount:0,firstWrote:!1,lastStscCount:0,perStreamGrouping:!1,index:0,flags:0}}},92031:(e,a,t)=>{t.d(a,{G:()=>r});var i=t(30027),s=t(91278);function r(e,a,t){let r,n,o,c,d,f,p,l=BigInt(0);if(e.streams.forEach((e=>{const a=e.privData;if(!a.samplesIndex||!a.samplesIndex.length||48===e.discard)return a.sampleEnd=!0,!0;if(32===e.discard){for(;a.currentSample<a.samplesIndex.length&&!(1&a.samplesIndex[a.currentSample].flags);)a.currentSample++;if(a.currentSample>=a.samplesIndex.length)return a.sampleEnd=!0,!0}a.sampleEnd||c&&!(a.samplesIndex[a.currentSample].pos<c.pos)||(c=a.samplesIndex[a.currentSample],d=e),a.sampleEnd||f&&!((0,i.k)(a.samplesIndex[a.currentSample].dts,e.timeBase,s.KR)<l)||(f=a.samplesIndex[a.currentSample],l=(0,i.k)(f.dts,e.timeBase,s.KR),p=e)})),c&&f){const a=(0,i.k)(c.dts,d.timeBase,s.KR),o=(0,i.k)(f.dts,p.timeBase,s.KR);Math.abs(Number(a-o))<1e6||2&e.ioReader.flags||4&e.ioReader.flags||!(1&t)?(r=c,n=d):(r=f,n=p)}else c?(r=c,n=d):f&&(r=f,n=p);if(n){const e=n.privData;o=e.samplesEncryption[e.currentSample],e.currentSample++,e.currentSample>=e.samplesIndex.length&&(e.sampleEnd=!0)}if(a.fragment){const t=!!e.streams.find((e=>!1===e.privData.sampleEnd));t||(a.currentFragment=null)}return{sample:r,stream:n,encryption:o}}},7761:(e,a,t)=>{t.d(a,{c:()=>i});const i={"@PRM":"premiere_version","@PRQ":"quicktime_version",XMP_:"xmp",aART:"albumArtist",akID:"account_type",apID:"account_id",catg:"category",cpil:"compilation",cprt:"copyright",desc:"description",disk:"disc",egid:"episode_uid",FIRM:"firmware",gnre:"genre",hdvd:"hd_video",HMMT:"hmmt",keyw:"keywords",ldes:"synopsis",loci:"loci",manu:"make",modl:"model",pcst:"podcast",pgap:"gapless_playback",purd:"purchase_date",rtng:"rating",soaa:"albumArtistSort",soal:"albumSort",soar:"artistSort",soco:"composerSort",sonm:"nameSort",sosn:"showSort",stik:"media_type",trkn:"track",tven:"episode_id",tves:"episode_sort",tvnn:"network",tvsh:"show",tvsn:"season_number","©ART":"albumArtist","©PRD":"producer","©alb":"album","©aut":"artist","©chp":"chapter","©cmt":"comment","©com":"composer","©cpy":"copyright","©day":"date","©dir":"director","©dis":"disclaimer","©ed1":"edit_date","©enc":"encoder","©fmt":"original_format","©gen":"genre","©grp":"grouping","©hst":"host_computer","©inf":"comment","©lyr":"lyrics","©mak":"make","©mod":"mod","©nam":"title","©ope":"original_artist","©prd":"producer","©prf":"performer","©req":"playback_requirements","©src":"original_source","©st3":"subtitle","©swr":"encoder","©too":"encoder","©trk":"track","©url":"url","©wrn":"warning","©wrt":"composer","©xyz":"location"}},47898:(e,a,t)=>{t.d(a,{E6:()=>x,jF:()=>$,t9:()=>M,wB:()=>P,wZ:()=>S});var i=t(75354),s=t(50012),r=t(76202),n=t(55e3),o=t(84514),c=t(16698),d=t(78663),f=t(13101),p=t(30018),l=t(7761),m=t(60739),u=t(39947),w=t(87339),g=t(25092),h=t(31616),k=t(41863),z=t(31184),v=t(91278),U=t(95704),A=t(1818),I=t(47378),y=t(95681);const b="packages/avformat/src/formats/isobmff/iisobmff.ts";async function x(e,a,t){const i=e.getPos()+BigInt(Math.floor(t.size));for(a.majorBrand=await e.readUint32(),a.minorVersion=await e.readUint32(),a.majorBrand===(0,s.A)("qt  ")&&(a.isom=!0);e.getPos()<i;)a.compatibleBrand.push(await e.readUint32())}async function B(e,a,t,i){const o=e.getPos()+BigInt(Math.floor(t.size));for(;e.getPos()<o;){const o=await e.readUint32(),c=await e.readUint32();if(o<8)return void w.z3(`invalid box size ${o}`,b,91);if(n.A[c])await n.A[c](e,a,{type:c,size:o-8},i);else if(c===(0,s.A)("mdia")){let t=!1,c=BigInt(0);const d=e.getPos()+BigInt(Math.floor(o-8));for(;e.getPos()<d;){const o=await e.readUint32(),d=await e.readUint32();d===(0,s.A)("hdlr")?(await n.A[d](e,a,{type:d,size:o-8},i),t=!0):d===(0,s.A)("minf")&&t?await B(e,a,{type:d,size:o-8},i):d!==(0,s.A)("minf")||t?n.A[d]?await n.A[d](e,a,{type:d,size:o-8},i):r.gQ.some((e=>(0,s.A)(e)===d))?await B(e,a,{type:d,size:o-8},i):await e.skip(o-8):(c=e.getPos()-BigInt(8),await e.skip(o-8))}if(c){const t=e.getPos();await e.seek(c);const s=await e.readUint32(),r=await e.readUint32();await B(e,a,{type:r,size:s-8},i),await e.seek(t)}}else if(r.gQ.some((e=>(0,s.A)(e)===c)))await B(e,a,{type:c,size:o-8},i);else if(c===(0,s.A)("name")&&t.type===(0,s.A)("udta")&&o-8>0){const t=await e.readString(o-8);a?a.metadata.title=t:(i.metadata||(i.metadata={}),i.metadata.title=t)}else if(t.type===(0,s.A)("udta")&&l.c[(0,p.A)(c)]&&o-8>0){const t=await(0,m.G)(e,o-8,{});t.length&&(a?a.metadata[l.c[(0,p.A)(c)]]=1===t.length?t[0]:t:(i.metadata||(i.metadata={}),i.metadata[l.c[(0,p.A)(c)]]=1===t.length?t[0]:t))}else await e.skip(o-8)}}async function P(e,a,t,o){t.parseOneBox=B,t.parsers=n.A;const d=e.getPos()+BigInt(Math.floor(o.size));for(;e.getPos()<d;){const i=await e.readUint32(),o=await e.readUint32();if(i<8)return void w.z3(`invalid box, type: ${o}, size ${i}`,b,253);if(n.A[o])await n.A[o](e,null,{type:o,size:i-8},t);else if(o===(0,s.A)("trak"))if(!t.foundMoov||t.fragment){const s=a.createStream();if(s.privData=(0,f.A)(),await B(e,s,{type:o,size:i-8},t),t.fragment){const e=s.privData,t=a.streams.find((a=>{const t=a.privData;if(a.index!==s.index&&t.trackId===e.trackId)return!0}));t?(s.sideData[1]&&(t.sideData[1]=s.sideData[1],t.codecpar.extradata&&(0,z.Eb)(t.codecpar.extradata),t.codecpar.extradataSize=t.sideData[1].length,t.codecpar.extradata=(0,z.sY)(t.codecpar.extradataSize),(0,k.lW)(t.codecpar.extradata,t.codecpar.extradataSize,t.sideData[1]),s.codecpar.width!==v.N_&&e.width>0&&(t.codecpar.width=e.width),s.codecpar.width!==v.N_&&e.height>0&&(t.codecpar.height=e.height)),a.removeStream(s),a.streamIndex--):(s.codecpar.width===v.N_&&e.width>0&&(s.codecpar.width=e.width),s.codecpar.width===v.N_&&e.height>0&&(s.codecpar.height=e.height))}else(0,c.X)(s,t)}else await e.skip(i-8);else o===(0,s.A)("mvex")?(t.fragment=!0,await B(e,null,{type:o,size:i-8},t)):r.gQ.some((e=>(0,s.A)(e)===o))?await B(e,null,{type:o,size:i-8},t):await e.skip(i-8)}a.streams.forEach((e=>{if(t.encryptionInitInfos){const a=(0,U.bE)(t.encryptionInitInfos),s=(0,z.sY)(a.length);(0,k.lW)(s,a.length,a),(0,A.$W)(e.codecpar[i.o9]+20,e.codecpar[i.o9]+24,24,s,a.length)}if(t.cencs){const a=e.privData,i=t.cencs[a.trackId];i&&(e.metadata.encryption={schemeType:i.schemeType,schemeVersion:i.schemeVersion,cryptByteBlock:i.cryptByteBlock,skipByteBlock:i.skipByteBlock,perSampleIVSize:i.defaultPerSampleIVSize,kid:i.defaultKeyId,constantIV:i.defaultConstantIV,pattern:i.pattern})}}))}async function S(e,a,t,i){const r=e.getPos()+BigInt(Math.floor(i.size));for(;e.getPos()<r;){const i=await e.readUint32(),r=await e.readUint32();if(i<8)return void w.z3(`invalid box, type: ${r}, size ${i}`,b,400);if(n.A[r])await n.A[r](e,null,{type:r,size:i-8},t);else if(r===(0,s.A)("traf")){const s=(0,d.A)();t.currentFragment.currentTrack=s,await B(e,null,{type:r,size:i-8},t),t.currentFragment.tracks.push(s),t.currentFragment.currentTrack=null;const n=a.streams.find((e=>e.privData.trackId===s.trackId));if(n){const e=n.privData;s.streamIndex=n.index,(0,o.p)(n,s,t,a.ioReader.getPos(),a.ioReader.flags),e.currentSample=0,e.sampleEnd=!1}}else await e.skip(i-8)}}async function M(e,a,t,i){const r=e.getPos()+BigInt(Math.floor(i.size)),n={};for(a.streams.forEach((e=>{const a=e.privData;n[e.index]={samples:a.samplesIndex,currentSample:a.currentSample,sampleEnd:a.sampleEnd},a.samplesIndex=[]}));e.getPos()<r;){const i=e.getPos(),r=await e.readUint32();if(await e.readUint32()===(0,s.A)("tfra")){const i=await e.readUint8();await e.skip(3);const r=await e.readUint32(),n=await e.readUint32(),o=await e.readUint32(),c=a.streams.find((e=>e.privData.trackId===r));if(c){const r=c.privData;let d,f;for(let a=0;a<o;a++){1===i?(d=await e.readUint64(),f=await e.readUint64()):(d=BigInt(Math.floor(await e.readUint32())),f=BigInt(Math.floor(await e.readUint32()))),r.fragIndexes.push({pos:f,time:d});for(let a=0;a<1+(n>>4&3);a++)await e.skip(1);for(let a=0;a<1+(n>>2&3);a++)await e.skip(1);for(let a=0;a<1+(3&n);a++)await e.skip(1)}if(r.fragIndexes.length){await e.seek(r.fragIndexes[r.fragIndexes.length-1].pos);const i=await e.readUint32(),n=await e.readUint32();if(n===(0,s.A)("moof")&&(t.currentFragment={pos:BigInt(0),size:i,sequence:0,tracks:[],currentTrack:null},await S(e,a,t,{size:i,type:n}),r.samplesIndex.length)){const e=r.samplesIndex[r.samplesIndex.length-1];c.duration=e.pts+BigInt(Math.floor(e.duration)),r.samplesIndex.length=0}}}}await e.seek(i+BigInt(Math.floor(r)),!1,!1)}t.currentFragment=null,a.streams.forEach((e=>{var a,t,i,s,r,o;const c=e.privData;c.samplesIndex=null!==(a=null===(t=n[e.index])||void 0===t?void 0:t.samples)&&void 0!==a?a:[],c.currentSample=null!==(i=null===(s=n[e.index])||void 0===s?void 0:s.currentSample)&&void 0!==i?i:0,c.sampleEnd=null!==(r=null===(o=n[e.index])||void 0===o?void 0:o.sampleEnd)&&void 0!==r&&r}))}async function D(e,a,t,i,s){let r=BigInt(0);if(t.item.isIdatRelative){if(!s.heif.idatOffset)return w.R8("missing idat box required by the image grid",b,564),I.nr;r=s.heif.idatOffset}if(!(1&e.flags))return w.z3("grid box with non seekable input",b,570),I.nr;const n=e.getPos();await e.seek(BigInt(t.item.extentOffset)+r),await e.readUint8();const o=await e.readUint8(),c=await e.readUint8()+1,d=await e.readUint8()+1;i.width=1&o?await e.readUint32():await e.readUint16(),i.height=1&o?await e.readUint32():await e.readUint16(),await e.seek(n);let f=c*d;if(f!==t.tileIdList.length)return I.nr;i.codedWidth=0,i.codedHeight=0;for(let e=0;e<d;e++){let s=a.streams.find((a=>a.privData.trackId===t.tileIdList[e]));if(!s)return I.nr;i.codedWidth+=s.codecpar.width}for(let e=0;e<f;e+=d){let s=a.streams.find((a=>a.privData.trackId===t.tileIdList[e]));if(!s)return I.nr;i.codedHeight+=s.codecpar.height}i.offsets=new Array(f);let p=0,l=0,m=0;for(;l<i.codedHeight;){let e=m;for(;p<i.codedWidth;){if(m===f)return I.nr;let e=a.streams.find((e=>e.privData.trackId===t.tileIdList[m]));if(!e)return I.nr;i.offsets[m]={idx:e.id,horizontal:p,vertical:l},p+=e.codecpar.width,m++}if(p>i.codedWidth)return w.z3("Non uniform HEIF tiles",b,639),I.nr;p=0;let s=a.streams.find((a=>a.privData.trackId===t.tileIdList[e]));if(!s)return I.nr;l+=s.codecpar.height}return l>i.codedHeight||m!==f?(w.z3("Non uniform HEIF tiles",b,654),I.nr):0}async function R(e,a,t,i,s){let r=BigInt(0);if(t.item.isIdatRelative){if(!s.heif.idatOffset)return w.R8("missing idat box required by the image grid",b,669),I.nr;r=s.heif.idatOffset}if(!(1&e.flags))return w.z3("grid box with non seekable input",b,675),I.nr;const n=e.getPos();await e.seek(BigInt(t.item.extentOffset)+r),await e.readUint8();const o=await e.readUint8();i.background=[];for(let a=0;a<4;a++)i.background.push(await e.readUint16());i.width=i.codedWidth=1&o?await e.readUint32():await e.readUint16(),i.height=i.codedHeight=1&o?await e.readUint32():await e.readUint16(),i.offsets=new Array(t.tileIdList.length);for(let s=0;s<t.tileIdList.length;s++){let r=a.streams.find((e=>e.privData.trackId===t.tileIdList[t.tileIdList[s]]));if(!r)return I.nr;i.offsets[s]={idx:r.id,horizontal:1&o?await e.readUint32():await e.readUint16(),vertical:1&o?await e.readUint32():await e.readUint16()}}await e.seek(n)}async function $(e,a,t,i){var o;t.parseOneBox=B,t.parsers=n.A;const c=e.getPos()+BigInt(Math.floor(i.size));for(t.heif={},i.size>12&&"hdlr"===(await e.peekString(12)).substring(8)&&await e.skip(4);e.getPos()<c;){const a=await e.readUint32(),i=await e.readUint32();if(a<8)return void w.z3(`invalid box, type: ${i}, size ${a}`,b,736);i===(0,s.A)("hdlr")?await e.skip(a-8):i===(0,s.A)("idat")?(t.heif.idatOffset=e.getPos(),await e.skip(a-8)):n.A[i]?await n.A[i](e,null,{type:i,size:a-8},t):r.gQ.some((e=>(0,s.A)(e)===i))?await B(e,null,{type:i,size:a-8},t):await e.skip(a-8)}const d=e.getPos();if(t.heif.foundIloc&&t.heif.foundIinf&&null!==(o=t.heif.items)&&void 0!==o&&o.length){t.foundHEIF=!0;const i=new h.A;for(let e=0;e<t.heif.items.length;e++){const r=t.heif.items[e];if("av01"!==r.type&&"hvc1"!==r.type)continue;const o=a.createStream(),c=(0,f.A)();if(o.privData=c,c.trackId=r.id,o.codecpar.codecType=0,u.uf[(0,s.A)(r.type)]&&(o.codecpar.codecId=u.uf[(0,s.A)(r.type)]),o.nbFrames=BigInt(1),o.codecpar.framerate.den=1,o.codecpar.framerate.num=1,o.timeBase.den=1,o.timeBase.num=1,t.heif.primaryId===r.id&&(o.disposition|=1),r.name&&(o.metadata.title=r.name),r.ipma&&t.heif.ipcoItem)for(let e=0;e<r.ipma.length;e++){const a=t.heif.ipcoItem[r.ipma[e]];a&&n.A[a.tag]&&(i.reset(),i.appendBuffer(a.data),t.heif.currentItem=r,await n.A[a.tag](i,o,{type:a.tag,size:a.data.length},t),t.heif.currentItem=null)}let d=BigInt(0);r.isIdatRelative&&(t.heif.idatOffset||(w.R8(`Missing idat box for item ${r.id}`,b,825),a.removeStream(o),a.streamIndex--),d=t.heif.idatOffset),c.samplesIndex=[{pos:BigInt(r.extentOffset)+d,dts:BigInt(0),pts:BigInt(0),size:r.extentLength,flags:1,duration:v.N_}]}if(t.heif.grid)for(let s=0;s<t.heif.grid.length;s++){const r=t.heif.grid[s];if(r.item){var p;const s=a.createStreamGroup(3);if(s.privData=r,s.params=new y.de,null!==(p=r.tileIdList)&&void 0!==p&&p.length&&r.tileIdList.forEach((e=>{const t=a.streams.find((a=>a.privData.trackId===e));t&&a.addStreamToStreamGroup(s,t)})),r.item.id===t.heif.primaryId&&(s.disposition|=1),r.item.name&&(s.metadata.title=r.item.name),r.item.ipma&&t.heif.ipcoItem)for(let e=0;e<r.item.ipma.length;e++){const a=t.heif.ipcoItem[r.item.ipma[e]];a&&n.A[a.tag]&&(i.reset(),i.appendBuffer(a.data),t.heif.currentItem=r.item,await n.A[a.tag](i,s.params,{type:a.tag,size:a.data.length},t),t.heif.currentItem=null)}if("grid"===r.item.type){if(await D(e,a,r,s.params,t)<0){a.removeStreamGroup(s),a.streamGroupIndex--;continue}}else if("iovl"===r.item.type&&await R(e,a,r,s.params,t)<0){a.removeStreamGroup(s),a.streamGroupIndex--;continue}if(r.item.rotation||r.item.hflip||r.item.vflip){const e=new Float32Array(9),a=r.item.rotation*Math.PI/180,t=Math.cos(a),i=Math.sin(a);e[0]=t,e[1]=-i,e[3]=i,e[4]=t,e[8]=1073741824;const n=[1-2*(r.item.hflip?1:0),1-2*(r.item.vflip?1:0),1];if(r.item.hflip||r.item.vflip)for(let a=0;a<9;a++)e[a]*=n[a%3];s.params.sideData[5]=new Uint8Array(e.buffer)}}}for(let i=0;i<t.heif.items.length;i++){const s=t.heif.items[i];if(s.refs){const i=g.HP(s.refs);for(let r=0;r<i.length;r++){const n=i[r],o=s.refs[n];if("thmb"===n){const e=a.streams.find((e=>e.privData.trackId===o));e&&(e.disposition|=8192)}else{let i=t.heif.items.find((e=>e.id===o));if(i&&"Exif"===i.type&&1&e.flags){let s=BigInt(0);if(i.isIdatRelative){if(!t.heif.idatOffset){w.R8(`Missing idat box for item ${i.id}`,b,942);continue}s=t.heif.idatOffset}const r=e.getPos();await e.seek(BigInt(i.extentOffset)+s);const n=await e.readBuffer(i.extentLength);await e.seek(r);let o=a.streams.find((e=>e.privData.trackId===i.id));if(o)o.sideData[40]=n;else{const e=a.streamGroups.find((e=>{const a=e.privData;if(a.item.refs)return g.zy(g.BE(a.item.refs),i.id)}));e&&(e.params.sideData[40]=n)}}}}}}}await e.seek(d)}},39947:(e,a,t)=>{t.d(a,{Q9:()=>r,f3:()=>n,uf:()=>o,zs:()=>s});var i=t(50012);const s={86018:64,86017:105,86076:173,86028:193,86021:221,12:32,27:33,173:35,196:51,167:177,0:0},r={32:12,33:27,35:173,51:196,177:167,64:86018,102:86018,103:86018,104:86018,105:86017,107:86017,173:86076,193:86028,221:86021,0:0},n={vide:0,pict:0,soun:1,clcp:3,sbtl:3,subt:3,subp:3,text:3},o={[(0,i.A)("mp4a")]:86018,1836253269:86017,[(0,i.A)("Opus")]:86076,[(0,i.A)("fLaC")]:86028,[(0,i.A)("spex")]:86051,[(0,i.A)("SPXN")]:86051,[(0,i.A)("ac-3")]:86019,[(0,i.A)("sac3")]:86019,[i.A.mp4v]:12,[(0,i.A)("av01")]:225,[(0,i.A)("vp08")]:139,[(0,i.A)("vp09")]:167,[(0,i.A)("avc1")]:27,[(0,i.A)("avc3")]:27,[(0,i.A)("hev1")]:173,[(0,i.A)("hvc1")]:173,[(0,i.A)("vvc1")]:196,[(0,i.A)("vvi1")]:196,[(0,i.A)("text")]:94213,[(0,i.A)("tx3g")]:94213,[(0,i.A)("png ")]:61,[(0,i.A)("MNG ")]:61,[(0,i.A)("gif ")]:97,[(0,i.A)("tiff")]:96,[(0,i.A)("H263")]:4,[(0,i.A)("3IVD")]:16}},22173:(e,a,t)=>{t.d(a,{A:()=>c});var i=t(87339),s=t(41863),r=t(44980),n=t(31184);const o="packages/avformat/src/formats/isobmff/parsing/av1c.ts";async function c(e,a,t,c){const d=e.getPos();if(a.codecpar.codecId=225,t.size<=0)return;const f=(0,n.sY)(t.size),p=await e.readBuffer(t.size,(0,s.JW)(f,t.size));c.foundMoov?(a.sideData[1]=p.slice(),(0,n.Eb)(f)):(a.codecpar.extradata&&(0,n.Eb)(a.codecpar.extradata),a.codecpar.extradata=f,a.codecpar.extradataSize=t.size,r.XC(a,p));const l=t.size-Number(e.getPos()-d);l>0?await e.skip(l):l<0&&i.z3(`read avcc error, size: ${t.size}, read: ${t.size-l}`,o,64)}},87795:(e,a,t)=>{t.d(a,{A:()=>c});var i=t(87339),s=t(41863),r=t(61556),n=t(31184);const o="packages/avformat/src/formats/isobmff/parsing/avcc.ts";async function c(e,a,t,c){const d=e.getPos();if(a.codecpar.codecId=27,t.size<=0)return;const f=(0,n.sY)(t.size),p=await e.readBuffer(t.size,(0,s.JW)(f,t.size));c.foundMoov?(a.sideData[1]=p.slice(),(0,n.Eb)(f)):(a.codecpar.extradata&&(0,n.Eb)(a.codecpar.extradata),a.codecpar.extradata=f,a.codecpar.extradataSize=t.size,r.XC(a,p));const l=t.size-Number(e.getPos()-d);l>0?await e.skip(l):l<0&&i.z3(`read avcc error, size: ${t.size}, read: ${t.size-l}`,o,64)}},4188:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/chap.ts";async function r(e,a,t,r){const n=e.getPos(),o=Math.floor(t.size/4);r.chapterTrack=[];for(let a=0;a<o;a++)r.chapterTrack.push(await e.readUint32());const c=t.size-Number(e.getPos()-n);c>0?await e.skip(c):c<0&&i.z3(`read chap error, size: ${t.size}, read: ${t.size-c}`,s,48)}},46425:(e,a,t)=>{t.d(a,{A:()=>n});var i=t(87339),s=t(91278);const r="packages/avformat/src/formats/isobmff/parsing/chpl.ts";async function n(e,a,t,n){const o=e.getPos(),c=await e.readUint8();await e.skip(3),c&&await e.skip(4);const d=await e.readUint8();if(d){const a=[];for(let t=0;t<d;t++){const i=await e.readInt64(),r=await e.readUint8(),n={id:BigInt(t),timeBase:{num:1,den:1e7},start:i,end:s.Dh,metadata:{}};r&&(n.metadata.title=await e.readString(r)),a.push(n)}n.chapters=a}const f=t.size-Number(e.getPos()-o);f>0?await e.skip(f):f<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-f}`,r,74)}},52706:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/co64.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=[],d=await e.readUint32();if(0===o)for(let a=0;a<d;a++)c.push(await e.readUint64());a.privData.chunkOffsets=c;const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read co64 error, size: ${t.size}, read: ${t.size-f}`,s,55)}},55486:(e,a,t)=>{t.d(a,{A:()=>n});var i=t(87339),s=t(95681);const r="packages/avformat/src/formats/isobmff/parsing/colr.ts";async function n(e,a,t,n){const o=e.getPos();let c=await e.readString(4);if("nclx"===c||"nclc"===c||"prof"===c){if("prof"===c){const i=await e.readBuffer(t.size-4);a.sideData[28]=i}else if(a instanceof s.Ay){let t=await e.readUint16(),i=await e.readUint16(),s=await e.readUint16();if("nclx"===c){const t=await e.readUint8()>>7;a.codecpar.colorRange=t?2:1}t>=23&&(t=2),i>=19&&(i=2),s>=15&&(s=2),a.codecpar.colorPrimaries=t,a.codecpar.colorTrc=i,a.codecpar.colorSpace=s}}else i.R8(`unsupported color_parameter_type: ${c}`,r,83);const d=t.size-Number(e.getPos()-o);d>0?await e.skip(d):d<0&&i.z3(`read colr error, size: ${t.size}, read: ${t.size-d}`,r,91)}},43612:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/ctts.ts";async function r(e,a,t,r){const n=e.getPos(),o=a.privData;await e.skip(4);const c=[],d=[],f=await e.readUint32();for(let a=0;a<f;a++)c.push(await e.readUint32()),d.push(await e.readInt32());o.cttsSampleCounts=c,o.cttsSampleOffsets=d;const p=t.size-Number(e.getPos()-n);p>0?await e.skip(p):p<0&&i.z3(`read ctts error, size: ${t.size}, read: ${t.size-p}`,s,57)}},33343:(e,a,t)=>{t.d(a,{A:()=>p});var i=t(75354),s=t(42524),r=t(77389),n=t(87339),o=t(79939),c=t(21962),d=t(1818);const f="packages/avformat/src/formats/isobmff/parsing/dac3.ts";async function p(e,a,t,p){const l=e.getPos();if(a.codecpar.codecId=86019,t.size<=0)return;const m=(0,d.E4)(a.codecpar[i.o9]+20,a.codecpar[i.o9]+24,7,4),u=s.f[20](m),w=await e.readUint24(),g=w>>14&7,h=w>>11&7,k=w>>10&1;let z=BigInt(o.j[h]);k&&(z|=BigInt(8)),c.bl(a.codecpar[i.o9]+112),c.ML(a.codecpar[i.o9]+112,z),r.M[15](u,g);const v=t.size-Number(e.getPos()-l);v>0?await e.skip(v):v<0&&n.z3(`read avcc error, size: ${t.size}, read: ${t.size-v}`,f,77)}},33787:(e,a,t)=>{t.d(a,{A:()=>p});var i=t(75354),s=t(42524),r=t(77389),n=t(87339),o=t(79939),c=t(21962),d=t(1818);const f="packages/avformat/src/formats/isobmff/parsing/dec3.ts";async function p(e,a,t,p){const l=e.getPos();if(a.codecpar.codecId=86056,t.size<=0)return;const m=(0,d.E4)(a.codecpar[i.o9]+20,a.codecpar[i.o9]+24,7,4),u=s.f[20](m);await e.skip(2);const w=await e.readUint24(),g=w>>12&31,h=w>>9&7,k=w>>8&1;let z=BigInt(o.j[h]);k&&(z|=BigInt(8)),c.bl(a.codecpar[i.o9]+112),c.ML(a.codecpar[i.o9]+112,z),r.M[15](u,g),a.codecpar.chLayout.nbChannels>1&&7==g&&r.M[15](u,8);const v=t.size-Number(e.getPos()-l);v>0?await e.skip(v):v<0&&n.z3(`read avcc error, size: ${t.size}, read: ${t.size-v}`,f,83)}},30671:(e,a,t)=>{t.d(a,{A:()=>c});var i=t(87339),s=t(41863),r=t(59586),n=t(31184);const o="packages/avformat/src/formats/isobmff/parsing/dfla.ts";async function c(e,a,t,c){const d=e.getPos();a.codecpar.codecId=86028,await e.skip(1),await e.skip(3);const f=await e.readUint8(),p=128&f,l=127&f,m=await e.readUint24();if(0===l&&34===m){const t=(0,n.sY)(m),i=await e.readBuffer(m,(0,s.JW)(t,m));c.foundMoov?(a.sideData[1]=i.slice(),(0,n.Eb)(t)):(a.codecpar.extradata&&(0,n.Eb)(a.codecpar.extradata),a.codecpar.extradata=t,a.codecpar.extradataSize=m,r.XC(a,i))}else i.z3("streaminfo must be first FLACMetadataBlock",o,67);p||i.R8("non streaminfo FLACMetadataBlock(s) ignored",o,71);const u=t.size-Number(e.getPos()-d);u>0?await e.skip(u):u<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-u}`,o,79)}},39782:(e,a,t)=>{t.d(a,{A:()=>f});var i=t(87339),s=t(54570),r=t(21374),n=t(41863),o=t(31027),c=t(31184);const d="packages/avformat/src/formats/isobmff/parsing/dops.ts";async function f(e,a,t,f){const p=e.getPos();a.codecpar.codecId=86076,await e.skip(1);const l=(0,c.sY)(t.size+8),m=(0,n.JW)(l,t.size+8),u=new s.A(m),w=new r.A(m,!1);w.writeString("OpusHead"),w.writeUint8(1),await e.readBuffer(t.size-1,(0,n.JW)(l+9,t.size-1)),u.seek(10),w.seek(10),w.writeUint16(u.readUint16()),w.writeUint32(u.readUint32()),w.writeUint16(u.readUint16()),f.foundMoov?(a.sideData[1]=m.slice(),(0,c.Eb)(l)):(a.codecpar.extradata&&(0,c.Eb)(a.codecpar.extradata),a.codecpar.extradata=l,a.codecpar.extradataSize=m.length,o.XC(a,m));const g=t.size-Number(e.getPos()-p);g>0?await e.skip(g):g<0&&i.z3(`read dops error, size: ${t.size}, read: ${t.size-g}`,d,78)}},53200:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/elst.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=await e.readInt32(),d=[];for(let a=0;a<c;a++){let a=BigInt(0),t=BigInt(0);1===o?(a=await e.readInt64(),t=await e.readInt64()):(a=BigInt(Math.floor(await e.readInt32())),t=BigInt(Math.floor(await e.readInt32())));const i=await e.readInt16(),s=await e.readInt16();d.push({segmentDuration:a,mediaTime:t,mediaRate:i,mediaRateFraction:s})}a.metadata.elst=d;const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read elst error, size: ${t.size}, read: ${t.size-f}`,s,74)}},79039:(e,a,t)=>{t.d(a,{A:()=>p});var i=t(39947),s=t(87339),r=t(41863),n=t(54829),o=t(31027),c=t(31184);const d="packages/avformat/src/formats/isobmff/parsing/esds.ts";async function f(e){let a=0;for(let t=0;t<4;t++){const t=await e.readUint8();if(a=a<<7|127&t,!(128&t))break}return a}async function p(e,a,t,p){const l=e.getPos();await e.skip(4);let m=e.getPos()+BigInt(Math.floor(t.size-4));for(;e.getPos()<m;){let t=await e.readUint8(),l=await f(e);if(0!==l)if(3===t){let m=e.getPos()+BigInt(Math.floor(l));if(await e.skip(2),await e.skip(1),t=await e.readUint8(),l=await f(e),0===l){s.R8("esds invalid ES descriptor size 0, skip",d,78),await e.skip(Number(m-e.getPos()));continue}if(4===t)if(a.codecpar.codecId=i.Q9[await e.readUint8()],await e.skip(1),await e.skip(3),await e.skip(4),await e.skip(4),e.getPos()<m-BigInt(5))if(t=await e.readUint8(),l=await f(e),5===t){const t=(0,c.sY)(l),i=await e.readBuffer(l,(0,r.JW)(t,l));p.foundMoov?(a.sideData[1]=i.slice(),(0,c.Eb)(t)):(a.codecpar.extradata=t,a.codecpar.extradataSize=l,86018===a.codecpar.codecId?n.XC(a,i.slice()):86076===a.codecpar.codecId&&o.XC(a,i.slice()))}else await e.skip(Number(m-e.getPos()));else await e.skip(Number(m-e.getPos()));else await e.skip(Math.min(l,Number(m-e.getPos())))}else await e.skip(Math.min(l,Number(m-e.getPos())));else s.R8("esds invalid descriptor size 0, skip",d,61),await e.skip(Number(m-e.getPos()))}const u=t.size-Number(e.getPos()-l);u>0?await e.skip(u):u<0&&s.z3(`read vpcc error, size: ${t.size}, read: ${t.size-u}`,d,146)}},968:(e,a,t)=>{t.d(a,{A:()=>n});var i=t(51356),s=t(87339);const r="packages/avformat/src/formats/isobmff/parsing/frma.ts";async function n(e,a,t,n){const o=e.getPos(),c=await e.peekUint32();e.setEndian(!1);const d=await e.readUint32();e.setEndian(!0);let f=i._B[d];f>0&&0!==a.codecpar.codecType?a.codecpar.codecType=1:1!==a.codecpar.codecType&&(f=i.pj[d],f>0?a.codecpar.codecType=0:(f=i._r[d],a.codecpar.codecType=3)),a.codecpar.codecTag=c,a.codecpar.codecId=f;const p=t.size-Number(e.getPos()-o);p>0?await e.skip(p):p<0&&s.z3(`read frma error, size: ${t.size}, read: ${t.size-p}`,r,65)}},98108:(e,a,t)=>{t.d(a,{A:()=>o});var i=t(39947),s=t(65992),r=t(87339);const n="packages/avformat/src/formats/isobmff/parsing/hdlr.ts";async function o(e,a,t,o){const c=e.getPos(),d=await e.readUint8();if(await e.skip(3),0===d){await e.skip(4);const r=await e.readString(4),n=i.f3[r];(0,s.A)(n)&&(a.codecpar.codecType=n),await e.skip(4),await e.skip(4),await e.skip(4);const c=t.size-24;if(c>0){const t=!o.isom&&await e.peekUint8()===c-1;t&&await e.skip(1),a.metadata.handlerName=await e.readString(c-(t?1:0))}}const f=t.size-Number(e.getPos()-c);f>0?await e.skip(f):f<0&&r.z3(`read hdlr error, size: ${t.size}, read: ${t.size-f}`,n,74)}},84630:(e,a,t)=>{t.d(a,{A:()=>c});var i=t(87339),s=t(41863),r=t(73872),n=t(31184);const o="packages/avformat/src/formats/isobmff/parsing/hvcc.ts";async function c(e,a,t,c){const d=e.getPos();if(a.codecpar.codecId=173,t.size<=0)return;const f=(0,n.sY)(t.size),p=await e.readBuffer(t.size,(0,s.JW)(f,t.size));c.foundMoov?(a.sideData[1]=p.slice(),(0,n.Eb)(f)):(a.codecpar.extradata&&(0,n.Eb)(a.codecpar.extradata),a.codecpar.extradata=f,a.codecpar.extradataSize=t.size,r.XC(a,p));const l=t.size-Number(e.getPos()-d);l>0?await e.skip(l):l<0&&i.z3(`read hevc error, size: ${t.size}, read: ${t.size-l}`,o,64)}},69376:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/iinf.ts";async function r(e,a,t,r){const n=e.getPos();if(r.heif.foundIinf)i.R8("Duplicate iinf box found",s,35);else{r.heif.foundIinf=!0;const a=await e.readUint8();await e.skip(3);let t=a?await e.readUint32():await e.readUint16();r.heif.items||(r.heif.items=[]);e:for(let a=0;a<t;a++){let a=await e.readUint32();if(a-=8,"infe"===await e.readString(4)){const t=await e.readUint8();if(await e.skip(3),a-=4,t<2){i.z3("infe version < 2",s,59),r.heif.foundIinf=!1;break e}let n=t>2?await e.readUint32():await e.readUint16();a-=t>2?4:2,await e.readUint16();let o=await e.readString(4);a-=6;let c="";a>0&&(c=await e.readString(a),0===c.charCodeAt(c.length-1)&&(c=c.substring(0,c.length-1)));const d=r.heif.items.find((e=>e.id===n));d?(d.name=c,d.type=o):r.heif.items.push({id:n,name:c,type:o})}else await e.skip(a-8)}}const o=t.size-Number(e.getPos()-n);o>0?await e.skip(o):o<0&&i.z3(`read iloc error, size: ${t.size}, read: ${t.size-o}`,s,104)}},12189:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/iloc.ts";async function r(e,a,t,r){const n=e.getPos();if(r.heif.foundIloc)i.R8("Duplicate iloc box found",s,35);else{r.heif.foundIloc=!0;const a=await e.readUint8();await e.skip(3);let t=await e.readUint8(),n=t>>4&15,o=15&t;t=await e.readUint8();let c=t>>4&15,d=a?15&t:0,f=a<2?await e.readUint16():await e.readUint32();r.heif.items||(r.heif.items=[]);e:for(let t=0;t<f;t++){let t=a<2?await e.readUint16():await e.readUint32(),f=a>0?15&await e.readUint16():0;f>1&&i.R8(`iloc offset type ${f}`,s,59),await e.readUint16();let p=c>0?await e["readUint"+8*c]():0,l=await e.readUint16();if(l>1){i.z3("iloc: extent_count > 1",s,66),r.heif.foundIloc=!1;break e}let m=0,u=0,w=0;for(let a=0;a<l;a++)d>0&&(m=await e["readUint"+8*d]()),w=n>0?await e["readUint"+8*n]():0,u=o>0?await e["readUint"+8*o]():0;const g=r.heif.items.find((e=>e.id===t));g?(g.isIdatRelative=1===f,g.extentOffset=p+w,g.extentIndex=m,g.extentLength=u):r.heif.items.push({id:t,isIdatRelative:1===f,extentOffset:p+w,extentIndex:m,extentLength:u})}}const o=t.size-Number(e.getPos()-n);o>0?await e.skip(o):o<0&&i.z3(`read iloc error, size: ${t.size}, read: ${t.size-o}`,s,104)}},10251:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/imir.ts";async function r(e,a,t,r){var n;const o=e.getPos();let c=1&await e.readUint8();null!==(n=r.heif)&&void 0!==n&&n.currentItem&&(r.heif.currentItem.hflip=!!c,r.heif.currentItem.vflip=!c);const d=t.size-Number(e.getPos()-o);d>0?await e.skip(d):d<0&&i.z3(`read imir error, size: ${t.size}, read: ${t.size-d}`,s,46)}},5817:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/ipco.ts";async function r(e,a,t,r){const n=e.getPos();let o=t.size;for(r.heif.ipcoItem=[];o;){const a=await e.readUint32(),t=await e.readUint32();r.heif.ipcoItem.push({tag:t,data:await e.readBuffer(a-8)}),o-=a}const c=t.size-Number(e.getPos()-n);c>0?await e.skip(c):c<0&&i.z3(`read ipco error, size: ${t.size}, read: ${t.size-c}`,s,55)}},26681:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/ipma.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8(),c=await e.readUint24(),d=await e.readUint32();r.heif.items||(r.heif.items=[]);for(let a=0;a<d;a++){let a=o?await e.readUint32():await e.readUint16(),t=await e.readUint8(),i=r.heif.items.find((e=>e.id===a));i?i.ipma=[]:(i={id:a,ipma:[]},r.heif.items.push(i));for(let a=0;a<t;a++){let a=127&await e.readUint8();1&c&&(a<<=8,a|=await e.readUint8()),i.ipma.push(a-1)}}const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read ipma error, size: ${t.size}, read: ${t.size-f}`,s,71)}},38570:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/iref.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();if(await e.readUint24(),o>1)i.z3(`Unknown iref box version ${o}`,s,38);else{let a=t.size-4;for(;a;){const t=await e.readUint32(),n=await e.readString(4),f=e.getPos();if("dimg"===n){var c;let a=o?await e.readUint32():await e.readUint16();const t=null===(c=r.heif.items)||void 0===c?void 0:c.find((e=>e.id===a));if(t&&("grid"===t.type||"iovl"===t.type)){const a=await e.readUint16();let i=[];for(let t=0;t<a;t++)i.push(o?await e.readUint32():await e.readUint16());r.heif.grid||(r.heif.grid=[]),r.heif.grid.push({item:t,tileIdList:i})}}else if("thmb"===n||"cdsc"===n){let a=o?await e.readUint32():await e.readUint16();if(await e.readUint16()>1)i.z3("thmb in iref referencing several items",s,70);else{var d;let t=o?await e.readUint32():await e.readUint16();const i=null===(d=r.heif.items)||void 0===d?void 0:d.find((e=>e.id===t));i&&(i.refs||(i.refs={}),i.refs[n]=a)}}else await e.skip(t-8);let p=t-8-Number(e.getPos()-f);p&&await e.skip(p),a-=t}}const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read ipma error, size: ${t.size}, read: ${t.size-f}`,s,99)}},45962:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/irot.ts";async function r(e,a,t,r){var n;const o=e.getPos();let c=3&await e.readUint8();null!==(n=r.heif)&&void 0!==n&&n.currentItem&&(r.heif.currentItem.rotation=90*c);const d=t.size-Number(e.getPos()-o);d>0?await e.skip(d):d<0&&i.z3(`read irot error, size: ${t.size}, read: ${t.size-d}`,s,45)}},92109:(e,a,t)=>{t.d(a,{A:()=>n});var i=t(87339),s=t(95681);const r="packages/avformat/src/formats/isobmff/parsing/ispe.ts";async function n(e,a,t,n){const o=e.getPos();await e.skip(4);const c=await e.readUint32(),d=await e.readUint32();a instanceof s.Ay?(a.codecpar.width=c,a.codecpar.height=d):(a.width=c,a.height=d);const f=t.size-Number(e.getPos()-o);f>0?await e.skip(f):f<0&&i.z3(`read ispe error, size: ${t.size}, read: ${t.size-f}`,r,54)}},2123:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/mdhd.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);let c=BigInt(0),d=BigInt(0),f=0,p=BigInt(0);1===o?(c=await e.readUint64(),d=await e.readUint64(),f=await e.readUint32(),p=await e.readUint64()):(c=BigInt(Math.floor(await e.readUint32())),d=BigInt(Math.floor(await e.readUint32())),f=await e.readUint32(),p=BigInt(Math.floor(await e.readUint32()))),a.duration=p,a.timeBase.den=f,a.timeBase.num=1,a.metadata.creationTime=c,a.metadata.modificationTime=d;const l=await e.readUint16(),m=[];m[0]=l>>10&31,m[1]=l>>5&31,m[2]=31&l;const u=String.fromCharCode(m[0]+96,m[1]+96,m[2]+96);a.metadata.language=u,await e.skip(2);const w=t.size-Number(e.getPos()-n);w>0?await e.skip(w):w<0&&i.z3(`read mdhd error, size: ${t.size}, read: ${t.size-w}`,s,80)}},60739:(e,a,t)=>{t.d(a,{A:()=>d,G:()=>c});var i=t(7761),s=t(30018),r=t(81819),n=t(87339);const o="packages/avformat/src/formats/isobmff/parsing/meta.ts";async function c(e,a,t){const i=[];if(await e.peekUint16()+4===a){let t=await e.readUint16();await e.skip(2),i.push(await e.readString(t)),a-=t+4}else for(;a>16;){let s=await e.readUint32();a-=s,await e.skip(4);const r=await e.readUint32();if(await e.skip(4),s-=16,21===r)switch(s){case 1:s>=1&&(i.push(await e.readInt8()),s--);break;case 2:s>=2&&(i.push(await e.readInt16()),s-=2);break;case 3:s>=3&&(i.push(await e.readInt24()),s-=3);break;case 4:s>=4&&(i.push(await e.readInt32()),s-=4)}else if(22===r)switch(s){case 1:s>=1&&(i.push(await e.readUint8()),s--);break;case 2:s>=2&&(i.push(await e.readUint16()),s-=2);break;case 3:s>=3&&(i.push(await e.readUint24()),s-=3);break;case 4:s>=4&&(i.push(await e.readUint32()),s-=4)}else 23===r&&s>=4?(i.push(await e.readFloat()),s-=4):1===r&&s>0?(i.push(await e.readString(s)),s=0):s>0&&(i.push(await e.readBuffer(s)),s=0,t.type=r);s>0&&await e.skip(s)}return a>0&&await e.skip(a),i}async function d(e,a,t,d){const f=e.getPos();let p=t.size;p>12&&["hdlr","mhdr","keys","ilst","ctry","lang"].indexOf((await e.peekString(12)).substring(8))>=0&&(await e.skip(4),p-=4);let l,m,u=[""],w=[];for(;p>=8;){let a=await e.readUint32();const t=await e.readString(4);let i=a;if(a-=8,"keys"===t){await e.skip(4);const t=await e.readUint32();a-=8;for(let i=0;i<t;i++){const t=await e.readUint32();await e.skip(4),u.push(await e.readString(t-8)),a-=t}}else if("hdlr"===t)a>=12&&(await e.skip(8),l=await e.readString(4),a-=12);else if("ilst"===t)for(;a>8;){let t=await e.readUint32(),i=await e.readUint32();"mdta"!==l&&(i=(0,s.A)(i,4));const r={},n=await c(e,t-8,r);n.length&&("covr"===i?d.covr={type:r.type,data:n[0]}:w.push({key:i,value:1===n.length?n[0]:n})),a-=t}else{if(!(a<p-8))break;await e.skip(a),a=0}a&&await e.skip(a),p-=i}a?m=a.metadata:(d.metadata||(d.metadata={}),m=d.metadata),w.forEach((e=>{let a=e.key;r.ai(a)?u[a]&&(a=u[a]):i.c[a]&&(a=i.c[a]),m[a]=e.value}));const g=t.size-Number(e.getPos()-f);g>0?await e.skip(g):g<0&&n.z3(`read meta error, size: ${t.size}, read: ${t.size-g}`,o,262)}},61:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/mfhd.ts";async function r(e,a,t,r){const n=e.getPos();await e.readUint8(),await e.skip(3),r.currentFragment.sequence=await e.readUint32();const o=t.size-Number(e.getPos()-n);o>0?await e.skip(o):o<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-o}`,s,47)}},69901:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/mvhd.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3),1===o?(r.creationTime=await e.readUint64(),r.modificationTime=await e.readUint64(),r.timescale=await e.readUint32(),r.duration=await e.readUint64()):(r.creationTime=BigInt(Math.floor(await e.readUint32())),r.modificationTime=BigInt(Math.floor(await e.readUint32())),r.timescale=await e.readUint32(),r.duration=BigInt(Math.floor(await e.readUint32()))),r.rate=await e.readUint32(),r.volume=await e.readUint16()>>>8,await e.skip(10),r.matrix=new Uint32Array(9);for(let a=0;a<9;a++)r.matrix[a]=await e.readUint32();await e.skip(24),r.nextTrackId=await e.readUint32();const c=t.size-Number(e.getPos()-n);c>0?await e.skip(c):c<0&&i.z3(`read mvhd error, size: ${t.size}, read: ${t.size-c}`,s,68)}},55e3:(e,a,t)=>{t.d(a,{A:()=>X});var i=t(34316),s=t(43612),r=t(51039),n=t(16856),o=t(15629),c=t(29199),d=t(8611),f=t(52706),p=t(2123),l=t(69901),m=t(65392),u=t(98108),w=t(11638),g=t(90445),h=t(61),k=t(20664),z=t(7044),v=t(42287),U=t(53200),A=t(90728),I=t(968),y=t(65391),b=t(9054),x=t(93574),B=t(81297),P=t(22949),S=t(60739),M=t(46425),D=t(4188),R=t(69376),$=t(12189),N=t(5817),C=t(26681),E=t(38570),T=t(92109),O=t(19374),F=t(45962),_=t(10251),L=t(84630),V=t(22173),W=t(50012);const X={[(0,W.A)("stts")]:i.A,[(0,W.A)("ctts")]:s.A,[(0,W.A)("stss")]:r.A,[(0,W.A)("stsz")]:n.A,[(0,W.A)("stz2")]:o.A,[(0,W.A)("stsc")]:c.A,[(0,W.A)("stco")]:d.A,[(0,W.A)("co64")]:f.A,[(0,W.A)("mdhd")]:p.A,[(0,W.A)("mvhd")]:l.A,[(0,W.A)("tkhd")]:m.A,[(0,W.A)("hdlr")]:u.A,[(0,W.A)("stsd")]:w.A,[(0,W.A)("elst")]:U.A,[(0,W.A)("trex")]:g.A,[(0,W.A)("mfhd")]:h.A,[(0,W.A)("tfhd")]:k.A,[(0,W.A)("tfdt")]:z.A,[(0,W.A)("trun")]:v.A,[(0,W.A)("pssh")]:A.A,[(0,W.A)("frma")]:I.A,[(0,W.A)("schm")]:y.A,[(0,W.A)("tenc")]:b.A,[(0,W.A)("saio")]:x.A,[(0,W.A)("saiz")]:B.A,[(0,W.A)("senc")]:P.A,[(0,W.A)("meta")]:S.A,[(0,W.A)("chpl")]:M.A,[(0,W.A)("chap")]:D.A,[(0,W.A)("iinf")]:R.A,[(0,W.A)("iloc")]:$.A,[(0,W.A)("ipco")]:N.A,[(0,W.A)("ipma")]:C.A,[(0,W.A)("iref")]:E.A,[(0,W.A)("ispe")]:T.A,[(0,W.A)("pitm")]:O.A,[(0,W.A)("imir")]:_.A,[(0,W.A)("irot")]:F.A,[(0,W.A)("hvcC")]:L.A,[(0,W.A)("av1C")]:V.A}},86227:(e,a,t)=>{t.d(a,{A:()=>o});var i=t(50012),s=t(87339),r=t(74933);const n="packages/avformat/src/formats/isobmff/parsing/pcmc.ts";async function o(e,a,t,o){const c=e.getPos();await e.readUint8(),await e.readUint24();const d=await e.readUint8(),f=await e.readUint8(),p=1&d,l=a.privData;if(l.format===(0,i.A)("fpcm"))switch(f){case 32:a.codecpar.codecId=p?65557:65556;break;case 64:a.codecpar.codecId=p?65559:65558;break;default:s.z3(`invalid pcmSampleSize: ${f}`,n,55)}else if(l.format===(0,i.A)("ipcm"))switch(f){case 16:a.codecpar.codecId=p?65536:65537;break;case 24:a.codecpar.codecId=p?65548:65549;break;case 32:a.codecpar.codecId=p?65544:65545;break;default:s.z3(`invalid pcmSampleSize: ${f}`,n,71)}l.isPcm=!0,0!==a.codecpar.codecId&&(a.codecpar.bitsPerCodedSample=r.MZ(a.codecpar.codecId));const m=t.size-Number(e.getPos()-c);m>0?await e.skip(m):m<0&&s.z3(`read pcmc error, size: ${t.size}, read: ${t.size-m}`,n,87)}},19374:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/pitm.ts";async function r(e,a,t,r){const n=e.getPos();await e.skip(4),r.heif.primaryId=await e.readUint16();const o=t.size-Number(e.getPos()-n);o>0?await e.skip(o):o<0&&i.z3(`read pitm error, size: ${t.size}, read: ${t.size-o}`,s,44)}},90728:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/pssh.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=r.encryptionInitInfos||[],d={systemId:await e.readBuffer(16),keyIds:[],data:null};if(o>0){const a=await e.readUint32();for(let t=0;t<a;t++)d.keyIds.push(await e.readBuffer(16))}const f=await e.readUint32();d.data=await e.readBuffer(f),c.push(d),r.encryptionInitInfos=c;const p=t.size-Number(e.getPos()-n);p>0?await e.skip(p):p<0&&i.z3(`read pssh error, size: ${t.size}, read: ${t.size-p}`,s,65)}},93574:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/saio.ts";async function r(e,a,t,r){const n=e.getPos(),o=r.currentFragment.currentTrack,c=r.cencs?r.cencs[o.trackId]:null,d=await e.readUint8();if(1&await e.readUint24()){const a=await e.readUint32(),t=await e.readUint32();if(!c)return void await p();if(a!==c.schemeType)return i.R8("Ignoring saio box with non-zero aux_info_type",s,44),void await p();if(0!==t)return i.R8("Ignoring saio box with non-zero aux_info_type_parameter",s,49),void await p()}else if(!c)return void await p();o.cenc||(o.cenc={defaultSampleInfoSize:0,sampleCount:0,offset:0,useSubsamples:!1,sampleEncryption:[],sampleSizes:[],sampleInfoOffset:[]});const f=await e.readUint32();for(let a=0;a<f;a++)o.cenc.sampleInfoOffset.push(0===d?await e.readUint32():await e.readUint64());async function p(){const a=t.size-Number(e.getPos()-n);a>0?await e.skip(a):a<0&&i.z3(`read saio error, size: ${t.size}, read: ${t.size-a}`,s,88)}await p()}},81297:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/saiz.ts";async function r(e,a,t,r){const n=e.getPos(),o=r.currentFragment.currentTrack,c=r.cencs?r.cencs[o.trackId]:null;if(await e.skip(1),1&await e.readUint24()){const a=await e.readUint32(),t=await e.readUint32();if(!c)return void await d();if(a!==c.schemeType)return i.R8("Ignoring saiz box with non-zero aux_info_type",s,47),void await d();if(0!==t)return i.R8("Ignoring saiz box with non-zero aux_info_type_parameter",s,52),void await d()}else if(!c)return void await d();if(o.cenc||(o.cenc={defaultSampleInfoSize:0,sampleCount:0,offset:0,useSubsamples:!1,sampleEncryption:[],sampleSizes:[],sampleInfoOffset:[]}),o.cenc.defaultSampleInfoSize=await e.readUint8(),o.cenc.sampleCount=await e.readUint32(),0===o.cenc.defaultSampleInfoSize){if(!o.cenc.sampleCount)return i.z3("invalid saiz data",s,83),void await d();for(let a=0;a<o.cenc.sampleCount;a++)o.cenc.sampleSizes.push(await e.readUint8())}async function d(){const a=t.size-Number(e.getPos()-n);a>0?await e.skip(a):a<0&&i.z3(`read saiz error, size: ${t.size}, read: ${t.size-a}`,s,99)}await d()}},65391:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/schm.ts";async function r(e,a,t,r){const n=e.getPos();await e.skip(4);const o=a.privData;let c=r.cencs?r.cencs[o.trackId]:null;c||(c={schemeType:0,schemeVersion:0,isProtected:0,defaultPerSampleIVSize:0,defaultKeyId:null,defaultConstantIV:null,cryptByteBlock:0,skipByteBlock:0,pattern:!1}),c.schemeType=await e.readUint32(),c.schemeVersion=await e.readUint32(),r.cencs?r.cencs[o.trackId]=c:r.cencs={[o.trackId]:c};const d=t.size-Number(e.getPos()-n);d>0?await e.skip(d):d<0&&i.z3(`read schm error, size: ${t.size}, read: ${t.size-d}`,s,72)}},22949:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/senc.ts";async function r(e,a,t,r){const n=e.getPos(),o=r.currentFragment.currentTrack,c=r.cencs?r.cencs[o.trackId]:null;await e.readUint8();const d=await e.readUint24();o.cenc||(o.cenc={defaultSampleInfoSize:0,sampleCount:0,offset:0,useSubsamples:!1,sampleEncryption:[],sampleSizes:[],sampleInfoOffset:[]});const f=await e.readUint32(),p=2&d,l=c.defaultPerSampleIVSize;for(let a=0;a<f;a++){const a={iv:l?await e.readBuffer(l):c.defaultConstantIV,subsamples:[]};if(p){const t=await e.readUint16();for(let i=0;i<t;i++)a.subsamples.push({bytesOfClearData:await e.readUint16(),bytesOfProtectedData:await e.readUint32()})}o.cenc.sampleEncryption.push(a)}p&&(o.cenc.useSubsamples=!0);const m=t.size-Number(e.getPos()-n);m>0?await e.skip(m):m<0&&i.z3(`read senc error, size: ${t.size}, read: ${t.size-m}`,s,79)}},8611:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/stco.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=[],d=await e.readUint32();if(0===o)for(let a=0;a<d;a++)c.push(BigInt(Math.floor(await e.readUint32())));a.privData.chunkOffsets=c;const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read stco error, size: ${t.size}, read: ${t.size-f}`,s,54)}},29199:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/stsc.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=a.privData,d=[],f=[],p=[],l=await e.readUint32();if(0===o)for(let a=0;a<l;a++)d.push(await e.readUint32()),f.push(await e.readUint32()),p.push(await e.readUint32());c.stscFirstChunk=d,c.stscSamplesPerChunk=f,c.stscSampleDescriptionIndex=p;const m=t.size-Number(e.getPos()-n);m>0?await e.skip(m):m<0&&i.z3(`read stsc error, size: ${t.size}, read: ${t.size-m}`,s,63)}},11638:(e,a,t)=>{t.d(a,{A:()=>U});var i=t(50012),s=t(76202),r=t(39947),n=t(87339),o=t(87795),c=t(84630),d=t(26556),f=t(50782),p=t(22173),l=t(79039),m=t(19335),u=t(30671),w=t(39782),g=t(55486),h=t(86227),k=t(33343),z=t(33787);const v="packages/avformat/src/formats/isobmff/parsing/stsd.ts";async function U(e,a,t,U){const A=e.getPos(),I=await e.readUint8();await e.skip(3);const y=a.privData,b=await e.readUint32();for(let t=0;t<b;t++){const t=await e.readUint32(),A=await e.readUint32(),b=e.getPos()+BigInt(Math.floor(t-8));if(r.uf[A]&&(a.codecpar.codecId=r.uf[A]),y.format=A,0===t){n.R8("stsd entry invalid box size 0, skip",v,74),await e.skip(Number(b-e.getPos()));break}if(t>=16?(await e.skip(6),await e.skip(2)):t<=7&&n.h2(`invalid size: ${t} in stsd`,v,87),0===a.codecpar.codecType){await e.skip(2),await e.skip(2),a.metadata.vendorId=await e.readString(4),await e.skip(4),await e.skip(4),a.codecpar.width=await e.readUint16(),a.codecpar.height=await e.readUint16(),await e.skip(4),await e.skip(4),await e.skip(4),await e.skip(2);let t=await e.readUint8();for(t>31&&(t=31),a.metadata.encoder=await e.readString(t),t<31&&await e.skip(31-t),await e.skip(2),await e.skip(2);e.getPos()<b;){const t=await e.readUint32(),r=await e.readUint32();0!==t?r===(0,i.A)("avcC")?await(0,o.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("hvcC")?await(0,c.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("vvcC")?await(0,d.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("av1C")?await(0,p.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("vpcC")?await(0,f.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("esds")?await(0,l.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("wave")?await(0,m.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("colr")?await(0,g.A)(e,a,{type:r,size:t-8},U):U.parsers&&U.parsers[r]?await U.parsers[r](e,null,{type:r,size:t-8},U):U.parseOneBox&&s.gQ.some((e=>(0,i.A)(e)===r))?await U.parseOneBox(e,a,{type:r,size:t-8},U):await e.skip(Math.min(t-8,Number(b-e.getPos()))):(n.R8("stsd video invalid box size 0, skip",v,136),await e.skip(Number(b-e.getPos())))}}else if(1===a.codecpar.codecType){const t=await e.readUint16();for(await e.skip(2),a.metadata.vendorId=await e.readString(4),a.codecpar.chLayout.nbChannels=await e.readUint16(),a.codecpar.bitsPerCodedSample=await e.readUint16(),y.audioCid=await e.readUint16(),await e.skip(2),a.codecpar.sampleRate=await e.readUint32()>>>16,(!U.isom||0===I&&t>0)&&(1===t?(y.samplesPerFrame=await e.readUint32(),await e.skip(4),y.bytesPerFrame=await e.readUint32(),await e.skip(4)):2===t&&(await e.skip(4),a.codecpar.sampleRate=Number(await e.readUint64()),a.codecpar.chLayout.nbChannels=await e.readUint32(),await e.skip(4),a.codecpar.bitsPerCodedSample=await e.readUint32(),await e.skip(4),y.bytesPerFrame=await e.readUint32(),y.samplesPerFrame=await e.readUint32()));e.getPos()<b;){const t=await e.readUint32(),r=await e.readUint32();0!==t?r===(0,i.A)("esds")?await(0,l.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("dfLa")?await(0,u.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("dOps")?await(0,w.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("wave")?await(0,m.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("dac3")?await(0,k.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("dec3")?await(0,z.A)(e,a,{type:r,size:t-8},U):r===(0,i.A)("pcmC")?await(0,h.A)(e,a,{type:r,size:t-8},U):U.parsers&&U.parsers[r]?await U.parsers[r](e,null,{type:r,size:t-8},U):U.parseOneBox&&s.gQ.some((e=>(0,i.A)(e)===r))?await U.parseOneBox(e,a,{type:r,size:t-8},U):await e.skip(Math.min(t-8,Number(b-e.getPos()))):(n.R8("stsd audio invalid box size 0, skip",v,309),await e.skip(Number(b-e.getPos())))}}else 3===a.codecpar.codecType?(A===(0,i.A)("stpp")?a.codecpar.codecId=94232:A===(0,i.A)("wvtt")?a.codecpar.codecId=94226:A===(0,i.A)("tx3g")||A===(0,i.A)("text")?a.codecpar.codecId=94213:A===(0,i.A)("c608")&&(a.codecpar.codecId=94218),await e.skip(Math.min(t-8,Number(b-e.getPos())))):await e.skip(Math.min(t-8,Number(b-e.getPos())))}const x=t.size-Number(e.getPos()-A);x>0?await e.skip(x):x<0&&n.z3(`read stsd error, size: ${t.size}, read: ${t.size-x}`,v,447)}},51039:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/stss.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=new Map,d=await e.readUint32();if(0===o)for(let a=0;a<d;a++)c.set(await e.readUint32(),!0);a.privData.stssSampleNumbersMap=c;const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read stss error, size: ${t.size}, read: ${t.size-f}`,s,55)}},16856:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/stsz.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=[];let d=0,f=0;if(0===o){d=await e.readUint32(),f=await e.readUint32();for(let a=0;a<f;a++)0===d?c.push(await e.readUint32()):c[a]=d}a.privData.sampleSizes=c;const p=t.size-Number(e.getPos()-n);p>0?await e.skip(p):p<0&&i.z3(`read stsz error, size: ${t.size}, read: ${t.size-p}`,s,63)}},34316:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/stts.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=a.privData,d=[],f=[],p=await e.readUint32();let l=1;if(0===o)for(let a=0;a<p;a++)d.push(await e.readUint32()),l=await e.readInt32(),l<0&&(i.R8("File uses negative stts sample delta, using value 1 instead, sync may be lost!",s,51),l=1),f.push(l);c.sttsSampleCounts=d,c.sttsSampleDeltas=f;const m=t.size-Number(e.getPos()-n);m>0?await e.skip(m):m<0&&i.z3(`read stts error, size: ${t.size}, read: ${t.size-m}`,s,66)}},15629:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/stz2.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=[];let d=0,f=0;if(0===o)if(await e.skip(3),f=await e.readUint8(),d=await e.readUint32(),4===f)for(let a=0;a<d;a+=2){const t=await e.readUint8();c[a]=t>>4&15,c[a+1]=15&t}else if(8===f)for(let a=0;a<d;a++)c[a]=await e.readUint8();else if(16===f)for(let a=0;a<d;a++)c[a]=await e.readUint16();else i.z3("Error in length field in stz2 box",s,65);a.privData.sampleSizes=c;const p=t.size-Number(e.getPos()-n);p>0?await e.skip(p):p<0&&i.z3(`read stz2 error, size: ${t.size}, read: ${t.size-p}`,s,76)}},9054:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/tenc.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=a.privData;let d=r.cencs?r.cencs[c.trackId]:null;d||(d={schemeType:0,schemeVersion:0,isProtected:0,defaultPerSampleIVSize:0,defaultKeyId:null,defaultConstantIV:null,cryptByteBlock:0,skipByteBlock:0,pattern:!1}),await e.skip(1);const f=await e.readUint8();if(o>0&&(d.pattern=!0,d.cryptByteBlock=f>>>4&15,d.skipByteBlock=15&f),d.isProtected=await e.readUint8(),d.defaultPerSampleIVSize=await e.readUint8(),d.defaultKeyId=await e.readBuffer(16),d.isProtected&&!d.defaultPerSampleIVSize){const a=await e.readUint8();d.defaultConstantIV=await e.readBuffer(a)}r.cencs?r.cencs[c.trackId]=d:r.cencs={[c.trackId]:d};const p=t.size-Number(e.getPos()-n);p>0?await e.skip(p):p<0&&i.z3(`read schm error, size: ${t.size}, read: ${t.size-p}`,s,90)}},7044:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/tfdt.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=r.currentFragment.currentTrack;c&&(c.baseMediaDecodeTime=1===o?await e.readUint64():BigInt(Math.floor(await e.readUint32())));const d=t.size-Number(e.getPos()-n);d>0?await e.skip(d):d<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-d}`,s,55)}},20664:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/tfhd.ts";async function r(e,a,t,r){const n=e.getPos(),o=(await e.readUint8(),await e.readUint24()),c=await e.readUint32(),d=r.currentFragment.currentTrack;d.trackId=c,d&&(1&o&&(d.baseDataOffset=await e.readUint64()),2&o&&await e.skip(4),8&o&&(d.defaultSampleDuration=await e.readUint32()),16&o&&(d.defaultSampleSize=await e.readUint32()),32&o&&(d.defaultSampleFlags=await e.readUint32()),131072&o&&(d.baseIsMoof=!0));const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-f}`,s,73)}},65392:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/tkhd.ts";async function r(e,a,t,r){const n=a.privData,o=e.getPos(),c=await e.readUint8();n.flags=await e.readUint24(),1&n.flags&&(a.disposition|=1),1===c?(a.metadata.creationTime=await e.readUint64(),a.metadata.modificationTime=await e.readUint64(),n.trackId=await e.readUint32(),await e.skip(4),n.duration=await e.readUint64()):(a.metadata.creationTime=BigInt(Math.floor(await e.readUint32())),a.metadata.modificationTime=BigInt(Math.floor(await e.readUint32())),n.trackId=await e.readUint32(),await e.skip(4),n.duration=BigInt(Math.floor(await e.readUint32()))),await e.skip(8),n.layer=await e.readInt16(),n.alternateGroup=await e.readInt16(),n.volume=await e.readInt16()>>8,await e.skip(2);const d=[];n.matrix=new Int32Array(9);for(let a=0;a<9;a++)n.matrix[a]=await e.readInt32(),d[a]=8===a?n.matrix[a]/1073741824:n.matrix[a]/65536;n.width=await e.readUint32()>>16,n.height=await e.readUint32()>>16,a.metadata.matrix=d;const f=t.size-Number(e.getPos()-o);f>0?await e.skip(f):f<0&&i.z3(`read tkhd error, size: ${t.size}, read: ${t.size-f}`,s,89)}},90445:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/trex.ts";async function r(e,a,t,r){const n=e.getPos();await e.readUint8(),await e.skip(3);const o=await e.readUint32();await e.skip(4);const c=await e.readUint32(),d=await e.readUint32(),f=await e.readUint32();r.trexs.push({trackId:o,duration:c,size:d,flags:f});const p=t.size-Number(e.getPos()-n);p>0?await e.skip(p):p<0&&i.z3(`read trex error, size: ${t.size}, read: ${t.size-p}`,s,59)}},42287:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/formats/isobmff/parsing/trun.ts";async function r(e,a,t,r){const n=e.getPos(),o=await e.readUint8(),c=await e.readUint24(),d=r.currentFragment.currentTrack,f=r.trexs.find((e=>e.trackId===d.trackId));if(d){const a=await e.readUint32();1&c&&(d.sampleCount?(d.remainDataOffsets.push(await e.readInt32()),d.remainDataOffsetIndex.push(d.sampleCount)):d.dataOffset=await e.readInt32());let t=-1;4&c&&(t=await e.readUint32());for(let i=0;i<a;i++)256&c?d.sampleDurations.push(await e.readUint32()):d.sampleDurations.push(d.defaultSampleDuration||(null==f?void 0:f.duration)),512&c?d.sampleSizes.push(await e.readUint32()):d.sampleSizes.push(d.defaultSampleSize||(null==f?void 0:f.size)),1024&c?d.sampleFlags.push(await e.readUint32()):d.sampleFlags.push(d.defaultSampleFlags||(null==f?void 0:f.flags)),2048&c?0===o?d.sampleCompositionTimeOffset.push(await e.readUint32()):d.sampleCompositionTimeOffset.push(await e.readInt32()):d.sampleCompositionTimeOffset.push(0),t>-1&&0===i&&(d.sampleFlags.pop(),d.sampleFlags.push(t));d.sampleCount+=a}const p=t.size-Number(e.getPos()-n);p>0?await e.skip(p):p<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-p}`,s,103)}},50782:(e,a,t)=>{t.d(a,{A:()=>c});var i=t(87339),s=t(41863),r=t(93535),n=t(31184);const o="packages/avformat/src/formats/isobmff/parsing/vpcc.ts";async function c(e,a,t,c){const d=e.getPos();if(await e.readUint8(),await e.skip(3),a.codecpar.codecId=167,t.size-4<=0)return;const f=(0,n.sY)(t.size-4),p=await e.readBuffer(t.size-4,(0,s.JW)(f,t.size-4));c.foundMoov?(a.sideData[1]=p.slice(),(0,n.Eb)(f)):(a.codecpar.extradata&&(0,n.Eb)(a.codecpar.extradata),a.codecpar.extradata=f,a.codecpar.extradataSize=t.size-4,r.XC(a,p));const l=t.size-Number(e.getPos()-d);l>0?await e.skip(l):l<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-l}`,o,68)}},26556:(e,a,t)=>{t.d(a,{A:()=>c});var i=t(87339),s=t(41863),r=t(17635),n=t(31184);const o="packages/avformat/src/formats/isobmff/parsing/vvcc.ts";async function c(e,a,t,c){const d=e.getPos();if(await e.readUint8(),await e.skip(3),a.codecpar.codecId=196,t.size-4<=0)return;const f=(0,n.sY)(t.size-4),p=await e.readBuffer(t.size-4,(0,s.JW)(f,t.size-4));c.foundMoov?(a.sideData[1]=p.slice(),(0,n.Eb)(f)):(a.codecpar.extradata&&(0,n.Eb)(a.codecpar.extradata),a.codecpar.extradata=f,a.codecpar.extradataSize=t.size-4,r.XC(a,p));const l=t.size-Number(e.getPos()-d);l>0?await e.skip(l):l<0&&i.z3(`read vvcc error, size: ${t.size}, read: ${t.size-l}`,o,68)}},19335:(e,a,t)=>{t.d(a,{A:()=>o});var i=t(50012),s=t(79039),r=t(87339);const n="packages/avformat/src/formats/isobmff/parsing/wave.ts";async function o(e,a,t,o){const c=e.getPos(),d=c+BigInt(Math.floor(t.size));for(;e.getPos()<d;){const t=await e.readUint32(),c=await e.readUint32();0!==t?c===(0,i.A)("esds")?await(0,s.A)(e,a,{type:c,size:t-8},o):await e.skip(Math.min(t-8,Number(d-e.getPos()))):(r.R8("wave invalid box size 0, skip",n,45),await e.skip(Number(d-e.getPos())))}const f=t.size-Number(e.getPos()-c);f>0?await e.skip(f):f<0&&r.z3(`read vpcc error, size: ${t.size}, read: ${t.size-f}`,n,71)}},51356:(e,a,t)=>{t.d(a,{_B:()=>r,_r:()=>n,pj:()=>s});var i=t(65283);const s={[(0,i.A)("mp4v")]:12,[(0,i.A)("DIVX")]:12,[(0,i.A)("XVID")]:12,[(0,i.A)("3IV2")]:12,[(0,i.A)("vvc1")]:196,[(0,i.A)("vvi1")]:196,[(0,i.A)("hev1")]:173,[(0,i.A)("hvc1")]:173,[(0,i.A)("dvhe")]:173,[(0,i.A)("hev1")]:173,[(0,i.A)("avc1")]:27,[(0,i.A)("avc2")]:27,[(0,i.A)("avc3")]:27,[(0,i.A)("avc4")]:27,[(0,i.A)("ai5p")]:27,[(0,i.A)("ai5q")]:27,[(0,i.A)("ai52")]:27,[(0,i.A)("ai53")]:27,[(0,i.A)("ai55")]:27,[(0,i.A)("ai56")]:27,[(0,i.A)("ai1p")]:27,[(0,i.A)("ai1q")]:27,[(0,i.A)("ai12")]:27,[(0,i.A)("ai13")]:27,[(0,i.A)("ai15")]:27,[(0,i.A)("ai16")]:27,[(0,i.A)("AVin")]:27,[(0,i.A)("aivx")]:27,[(0,i.A)("rv64")]:27,[(0,i.A)("xalg")]:27,[(0,i.A)("avlg")]:27,[(0,i.A)("dva1")]:27,[(0,i.A)("dvav")]:27,[(0,i.A)("vp08")]:139,[(0,i.A)("vp09")]:167,[(0,i.A)("av01")]:225},r={[(0,i.A)("mp4a")]:86018,[(0,i.A)("ac-3")]:86019,[(0,i.A)("sac3")]:86019,[(0,i.A)("ac-4")]:86119,[(0,i.A)("dtsc")]:86020,[(0,i.A)("dtsh")]:86020,[(0,i.A)("dtsl")]:86020,[(0,i.A)("dtse")]:86020,[(0,i.A)("DTS ")]:86020,[(0,i.A)("ec-3")]:86056,[(0,i.A)(".mp3")]:86017,[(0,i.A)("mp3 ")]:86017,1836253269:86017,[(0,i.A)("spex")]:86051,[(0,i.A)("SPXN")]:86051,[(0,i.A)("fLaC")]:86028,[(0,i.A)("Opus")]:86076,[(0,i.A)("alaw")]:65543,[(0,i.A)("ulaw")]:65542,[(0,i.A)("fl32")]:65557,[(0,i.A)("fl64")]:65559,[(0,i.A)("twos")]:65537,[(0,i.A)("lpcm")]:65536,[(0,i.A)("sowt")]:65536,[(0,i.A)("in24")]:65548,[(0,i.A)("in32")]:65544,[(0,i.A)("sowt")]:65540,[(0,i.A)("raw ")]:65541,[(0,i.A)("NONE")]:65541},n={[(0,i.A)("text")]:94213,[(0,i.A)("tx3g")]:94213,[(0,i.A)("c608")]:94218}},30018:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(81819);function s(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,t="";for(let s=0;s<a;s++)i.ai(e)?(t=String.fromCharCode(255&e)+t,e>>>=8):(t=String.fromCharCode(Number(e&BigInt(255)))+t,e>>=BigInt(8));return t}},50012:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/function/mktag.ts";function r(e){4!==e.length&&i.R8(`tag length is not 4, tag: ${e}`,s,31);let a=0;for(let t=0;t<4;t++)a=a<<8|e.charCodeAt(t);return a}},65283:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(87339);const s="packages/avformat/src/function/mktagle.ts";function r(e){4!==e.length&&i.R8(`tag length is not 4, tag: ${e}`,s,30);let a=0;for(let t=3;t>=0;t--)a=a<<8|e.charCodeAt(t);return a}},54829:(e,a,t)=>{t.d(a,{Bq:()=>p,En:()=>c,Ij:()=>f,XC:()=>d,f7:()=>l,hY:()=>o,uF:()=>r});var i=t(91278),s=t(5043);const r={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,i.N_,i.N_,i.N_],c=[i.N_,1,2,3,4,5,6,7];function d(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a){const{profile:t,sampleRate:s,channels:r}=function(e){let a=i.N_,t=i.N_,s=i.N_;return e.length>=2&&(a=e[0]>>3&31,t=o[(7&e[0])<<1|e[1]>>7],s=c[e[1]>>3&15]),{profile:a,sampleRate:t,channels:s}}(a);e.codecpar.profile=t,e.codecpar.sampleRate=s,e.codecpar.chLayout.nbChannels=r,e.codecpar.frameSize=5===t?2048:1024,e.codecpar.format=8}}function f(e){const a=n[e.sampleRate],t=e.chLayout.nbChannels,s=e.profile===i.N_?2:e.profile,r=new Uint8Array(2);return r[0]=(31&s)<<3|(14&a)>>1,r[1]=(1&a)<<7|(15&t)<<3,r}function p(e){if(e.length<7)return-1;const a=e[0]<<4|e[1]>>4;if(4095!==a)return-1;const t=1&e[1],i=(192&e[2])>>>6,s=(60&e[2])>>>2,r=(1&e[2])<<2|(192&e[3])>>>6,n=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,d=3&e[6];let f=1===t?7:9,p=n-f;return{syncWord:a,profile:i+1,sampleRate:o[s],channels:c[r],aacFrameLength:n,numberOfRawDataBlocksInFrame:d,headerLength:f,framePayloadLength:p}}function l(e,a){function t(){const e=a.readU(2);let t=0;for(let i=0;i<=e;i++)t<<=8,t|=a.readU(8);return t}a||(a=new s.A).appendBuffer(e);const i=a.getPointer(),r={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=a.readU(11);if(695!==n)return-1;r.syncWord=n,r.muxLengthBytes=a.readU(13);const d=1===a.readU1();if(r.useSameStreamMux=d,!d){const e=1===a.readU1();if(e&&1===a.readU1())return-1;if(e&&t(),1!==a.readU1())return-1;if(0!==a.readU(6))return-1;if(0!==a.readU(4))return-1;if(0!==a.readU(3))return-1;let i=e?t():0;const s=a.readU(5);i-=5;const n=a.readU(4);i-=4;const d=a.readU(4);if(i-=4,a.readU(3),i-=3,i>0&&a.readU(i),0!==a.readU(3))return-1;if(a.readU(8),1===a.readU1())if(e)t();else{let e=0;for(;;){e<<=8;const t=1===a.readU1();if(e+=a.readU(8),!t)break}}1===a.readU1()&&a.readU(8),r.profile=s+1,r.sampleRate=o[n],r.channels=c[d]}let f=0;for(;;){const e=a.readU(8);if(f+=e,255!==e)break}return r.framePayloadLength=f,r.headerLength=a.getPointer()-i+(8===a.getBitLeft()?0:1),r}},79939:(e,a,t)=>{t.d(a,{R:()=>m,j:()=>s});var i=t(5043);const s=[3,4,3,7,259,263,1539,1543],r=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],n=[4,5,6,5],o=[4,6,7,6],c=[48e3,44100,32e3,0],d=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],f=[2,1,2,3,3,4,4,5],p=[1,2,3,6],l=7;function m(e){const a=new i.A(e.length);a.appendBuffer(e);const t={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(t.syncWord=a.readU(16),2935!==t.syncWord)return-1;if(t.bitstreamId=31&a.peekU(29),t.bitstreamId>16)return-2;if(t.numBlocks=6,t.ac3BitrateCode=-1,t.centerMixLevel=5,t.surroundMixLevel=6,t.dolbySurroundMode=0,t.bitstreamId<=10){if(t.crc1=a.readU(16),t.srCode=a.readU(2),3===t.srCode)return-3;const e=a.readU(6);if(e>37)return-4;t.ac3BitrateCode=e>>1,a.readU(5),t.bitstreamMode=a.readU(3),t.channelMode=a.readU(3),2==t.channelMode?t.dolbySurroundMode=a.readU(2):(1&t.channelMode&&1!=t.channelMode&&(t.centerMixLevel=n[a.readU(2)]),4&t.channelMode&&(t.surroundMixLevel=o[a.readU(2)])),t.lfeOn=a.readU(1),t.srShift=Math.max(t.bitstreamId,8)-8,t.sampleRate=c[t.srCode]>>t.srShift,t.bitrate=1e3*d[t.ac3BitrateCode]>>t.srShift,t.channels=f[t.channelMode]+t.lfeOn,t.frameSize=2*r[e][t.srCode],t.frameType=2,t.substreamId=0}else{if(t.crc1=0,t.frameType=a.readU(2),3==t.frameType)return-5;if(t.substreamId=a.readU(3),t.frameSize=a.readU(11)+1<<1,t.frameSize<l)return-6;if(t.srCode=a.readU(2),3==t.srCode){const e=a.readU(2);if(3==e)return-7;t.sampleRate=c[e]/2,t.srShift=1}else t.numBlocks=p[a.readU(2)],t.sampleRate=c[t.srCode],t.srShift=0;t.channelMode=a.readU(3),t.lfeOn=a.readU(1),t.bitrate=8*t.frameSize*t.sampleRate/(256*t.numBlocks),t.channels=f[t.channelMode]+t.lfeOn}return t.channelLayout=BigInt(s[t.channelMode]),t.lfeOn&&(t.channelLayout|=BigInt(8)),t}},44980:(e,a,t)=>{t.d(a,{Ui:()=>n,XC:()=>r,zk:()=>s});var i=t(5043);const s={0:"Main",1:"High",2:"Professional"};function r(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length>=4){const t=n(a);e.codecpar.profile=t.profile,e.codecpar.level=t.level}}function n(e){const a=new i.A(e.length);a.appendBuffer(e),a.readU1(),a.readU(7);const t=a.readU(3),s=a.readU(5),r=a.readU1();let n=a.readU1()?10:8;return a.readU1()&&(n=12),{profile:t,level:s,tier:r,bitDepth:n,monochrome:a.readU1(),chromaSubsamplingX:a.readU1(),chromaSubsamplingY:a.readU1(),chromaSamplePosition:a.readU(2)}}},59586:(e,a,t)=>{t.d(a,{DK:()=>o,XC:()=>d,Xr:()=>c,jA:()=>r,ob:()=>s,oe:()=>n});var i=t(54570);const s=34,r=8,n=[0,8,12,0,16,20,24,32],o=[0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0],c=[0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768];function d(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length===s){const{bitsPerRawSample:t,sampleRate:s,channels:r}=function(e){const a=new i.A(e);a.skip(10);const t=a.readUint24();return{sampleRate:t>>4,channels:1+((15&t)>>>1),bitsPerRawSample:1+((1&t)<<4|(240&a.readUint8())>>>4)}}(a);e.codecpar.bitsPerRawSample=t,e.codecpar.sampleRate=s,e.codecpar.chLayout.nbChannels=r}}},31027:(e,a,t)=>{t.d(a,{Ij:()=>d,XC:()=>c,kt:()=>o});var i=t(30027),s=t(54570),r=t(21374);const n=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(e){let a=0,t=0,i=0;if(e.length<1)return 0;switch(a=e[0],t=n[a>>3],3&a){case 0:i=1;break;case 1:case 2:i=2;break;case 3:if(e.length<2)return 0;i=63&e[1]}return i*t}function c(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length>=19){const t=new s.A(a,!1);t.skip(9),e.codecpar.chLayout.nbChannels=t.readUint8(),e.codecpar.initialPadding=t.readUint16(),e.codecpar.sampleRate=t.readUint32(),e.codecpar.seekPreroll=Number((0,i.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function d(e){const a=new Uint8Array(19),t=new r.A(a,!1);return t.writeString("OpusHead"),t.writeUint8(1),t.writeUint8(e.chLayout.nbChannels),t.writeUint16(e.initialPadding),t.writeUint32(e.sampleRate),a}},93535:(e,a,t)=>{t.d(a,{Ui:()=>n,XC:()=>r,wN:()=>s});var i=t(5043);const s={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"};function r(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length>=6){const t=n(a);e.codecpar.profile=t.profile,e.codecpar.level=t.level}}function n(e){const a=new i.A(e.length);return a.appendBuffer(e),{profile:a.readU(8),level:a.readU(8),bitDepth:a.readU(4),chromaSubsampling:a.readU(3),fullRangeFlag:a.readU1(),colorPrimaries:a.readU(8),colorTrc:a.readU(8),colorSpace:a.readU(8)}}},null:()=>{},95704:(e,a,t)=>{t.d(a,{ZK:()=>o,bE:()=>c,p$:()=>r,zz:()=>n});var i=t(54570),s=t(21374);function r(e){const a=new i.A(e,!0),t=a.readUint32(),s=a.readUint32(),r=a.readUint32(),n=a.readUint32(),o=a.readUint32(),c=a.readUint32(),d={scheme:t,cryptByteBlock:s,skipByteBlock:r,keyId:a.readBuffer(n),iv:a.readBuffer(o),subsamples:[]};if(c)for(let e=0;e<c;e++)d.subsamples.push({bytesOfClearData:a.readUint32(),bytesOfProtectedData:a.readUint32()});return d}function n(e){const a=new Uint8Array(24+e.keyId.length+e.iv.length+8*e.subsamples.length),t=new s.A(a,!0);return t.writeUint32(e.scheme),t.writeUint32(e.cryptByteBlock),t.writeUint32(e.skipByteBlock),t.writeUint32(e.keyId.length),t.writeUint32(e.iv.length),t.writeUint32(e.subsamples.length),t.writeBuffer(e.keyId),t.writeBuffer(e.iv),e.subsamples.forEach((e=>{t.writeUint32(e.bytesOfClearData),t.writeUint32(e.bytesOfProtectedData)})),a}function o(e){const a=new i.A(e,!0),t=a.readUint32(),s=[];for(let e=0;e<t;e++){const e=a.readUint32(),t=a.readUint32(),i=a.readUint32(),r=a.readUint32(),n={systemId:a.readBuffer(e),keyIds:[],data:null};if(t)for(let e=0;e<t;e++)n.keyIds.push(a.readBuffer(i));n.data=a.readBuffer(r),s.push(n)}return s}function c(e){let a=4;e.forEach((e=>{a+=16+e.systemId.length+e.keyIds.length*(e.keyIds.length?e.keyIds[0].length:0)+e.data.length}));const t=new Uint8Array(a),i=new s.A(t,!0);return i.writeUint32(e.length),e.forEach((e=>{i.writeUint32(e.systemId.length),i.writeUint32(e.keyIds.length),i.writeUint32(e.keyIds.length?e.keyIds[0].length:0),i.writeUint32(e.data.length),i.writeBuffer(e.systemId),e.keyIds.forEach((e=>{i.writeBuffer(e)})),i.writeBuffer(e.data)})),t}},74933:(e,a,t)=>{function i(e,a,t,i){if(e<=0||e>64)return 0;if(a)switch(e){case 32:return t?65556:65557;case 64:return t?65558:65559;default:return 0}else if(e+=7,i&1<<(e>>>=3)-1)switch(e){case 1:return 65540;case 2:return t?65537:65536;case 3:return t?65549:65548;case 4:return t?65545:65544;case 8:return t?65568:65567;default:return 0}else switch(e){case 1:return 65541;case 2:return t?65539:65538;case 3:return t?65551:65550;case 4:return t?65547:65546;default:return 0}}function s(e){switch(e){case 69649:return 2;case 69648:return 3;case 69647:case 69633:case 69632:case 69645:case 69638:return 4;default:return function(e){switch(e){case 86070:case 86071:case 69674:case 69644:case 69678:case 69651:case 69661:case 69677:case 69655:case 69664:case 69636:case 69675:case 69660:case 69646:case 69670:return 4;case 86089:case 86090:case 86091:case 86092:case 65543:case 65542:case 65571:case 65540:case 65563:case 65572:case 65541:case 81924:case 81926:return 8;case 65537:case 65566:case 65536:case 65554:case 65539:case 65538:return 16;case 65552:case 65549:case 65548:case 65564:case 65551:case 65550:return 24;case 65545:case 65544:case 65565:case 65547:case 65546:case 65556:case 65557:case 65570:case 65569:return 32;case 65558:case 65559:case 65568:case 65567:return 64;default:return 0}}(e)}}t.d(a,{MZ:()=>s,uU:()=>i})}}]);