"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[41],{69041:(t,e,i)=>{i.r(e),i.d(e,{default:()=>m});var s=i(19371),n=i(77389),r=i(6072),a=i(67644),o=i(41863),c=i(47378),u=i(31184),h=i(1818),d=i(87339),g=i(4068),f=i(17630);const l="packages/avformat/src/formats/IAssFormat.ts";class m extends r.A{constructor(){super(),(0,s.A)(this,"type",20),(0,s.A)(this,"queue",void 0),(0,s.A)(this,"index",void 0)}init(t){this.queue=[]}async readHeader(t){const e=await t.ioReader.readLine();if("[Script Info]"!==e.trim())return d.z3("the file format is not ass",l,80),c.LR;const i=t.createStream();i.codecpar.codecId=94230,i.codecpar.codecType=3,i.timeBase.den=1e3,i.timeBase.num=1;let s,n=e+"\n",r=!1,h=0,m=0;for(;;){const e=await t.ioReader.readLine();if(!/^;/.test(e)){if("[Events]"===e.trim()&&(r=!0),/^Format:/.test(e)&&r){n+=e,s=a.Bp(e.trim());for(let t=0;t<s.length;t++)"Start"===s[t]?h=t:"End"===s[t]&&(m=t);break}n+=e+"\n"}}const p=g.encode(n);i.codecpar.extradata=(0,u.sY)(p.length),i.codecpar.extradataSize=p.length,(0,o.lW)(i.codecpar.extradata,p.length,p),this.index=0;let B=BigInt(0);try{for(;;){const e=t.ioReader.getPos(),n=(await t.ioReader.readLine()).trim();if(/^;/.test(n)||/^Comment:/.test(n))continue;const{start:r,end:o}=a.Ew(s,n,h,m);i.nbFrames++,i.duration=o;const c={context:n,startTs:r,endTs:o,pos:e};r>=B?(this.queue.push(c),B=r):f._(this.queue,c,(t=>t.startTs<c.startTs?1:-1))}}catch(t){return 0}}async readAVPacket(t,e){if(!this.queue.length)return c.LR;if(this.index>=this.queue.length)return-1048576;const i=t.streams.find((t=>3===t.codecpar.codecType)),s=this.queue[this.index++];n.M[15](e+32,i.index),n.M[15](e+76,i.timeBase.den),n.M[15](e+72,i.timeBase.num),n.M[17](e+16,s.startTs),n.M[17](e+8,s.startTs),n.M[17](e+48,s.endTs-s.startTs);const r=g.encode(s.context),a=(0,u.sY)(r.length);return(0,o.lW)(a,r.length,r),(0,h.NX)(e,a,r.length),0}async seek(t,e,i,s){if(2&s)return BigInt(c.E$);if(i<=BigInt(0))return this.index=0,BigInt(0);const n=f.El(this.queue,(t=>t.startTs>i?-1:1));if(n>=0){for(d.Yz(`seek in cues, found index: ${n}, pts: ${this.queue[n].startTs}, pos: ${this.queue[n].pos}`,l,229),this.index=Math.max(n-1,0);this.index>0&&(this.queue[this.index-1].startTs===this.queue[this.index].startTs||this.queue[this.index-1].endTs>i);)this.index--;return BigInt(0)}return BigInt(c.LR)}getAnalyzeStreamsCount(){return 1}}},6072:(t,e,i)=>{i.d(e,{A:()=>n});var s=i(19371);class n{constructor(){(0,s.A)(this,"type",-1),(0,s.A)(this,"onStreamAdd",void 0)}async destroy(t){}}},99011:(t,e,i)=>{i.d(e,{Q:()=>s});const s=["ReadOrder","Layer","Start","End","Style","Name","MarginL","MarginR","MarginV","Effect","Text"]},67644:(t,e,i)=>{i.d(e,{Bp:()=>o,Ew:()=>u,_T:()=>c});var s=i(99011),n=i(87339),r=i(57102);const a="packages/avformat/src/formats/ass/iass.ts";function o(t){return function(t,e){const i=e.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/),s=[];for(let e=0;e<i.length;e++){const r=t.find((t=>t.toLowerCase()===i[e].toLowerCase()));r||n.R8(`not support ass field(${i[e]})`,a,37),s.push(r||i[e])}return s}(s.Q,t)}function c(t,e){let i=e.split(",");if(i.length>t.length){const e=i.slice(t.length-1).join(",");i=i.slice(0,t.length-1),i.push(e)}return i}function u(t,e,i,s){const[,,n]=e.match(/^(\w+?)\s*:\s*(.*)/i),a=c(t,n);return{start:r.j(a[i]),end:r.j(a[s])}}},57102:(t,e,i)=>{function s(t){if(!t)return-BigInt(1);let e=(t=t.trim()).split(":"),i=BigInt(0);if(3===e.length&&(i+=BigInt(+e.shift().trim())*BigInt(36e5)),i+=BigInt(+e.shift().trim())*BigInt(6e4),e=e.shift().trim().split("."),i+=BigInt(+e.shift().trim())*BigInt(1e3),e.length){let t=e[0].trim().length,s=BigInt(+e.shift().trim());1===t?s*=BigInt(100):2===t&&(s*=BigInt(10)),i+=s}return i}function n(t){if(!t)return-BigInt(1);let e=(t=t.trim()).split(":"),i=BigInt(0);if(3===e.length&&(i+=BigInt(+e.shift().trim())*BigInt(36e5)),i+=BigInt(+e.shift().trim())*BigInt(6e4),e=e.shift().trim().split(","),i+=BigInt(+e.shift().trim())*BigInt(1e3),e.length){let t=e[0].trim().length,s=BigInt(+e.shift().trim());1===t?s*=BigInt(100):2===t&&(s*=BigInt(10)),i+=s}return i}i.d(e,{j:()=>s,t:()=>n})}}]);