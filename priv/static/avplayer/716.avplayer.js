"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[716],{7132:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(19371);class a{constructor(){(0,s.A)(this,"onFlush",void 0)}}},97648:(t,e,i)=>{i.d(e,{A:()=>p});var s=i(19371),a=i(7132),r=i(27669),n=i(80687),o=i(87339),h=i(88583);const l="packages/avnetwork/src/bsp/aes/AESDecryptPipe.ts",d=16;let u=!0;const c=new Uint8Array(d).fill(d);class p extends a.A{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1048576;super(),(0,s.A)(this,"buffer",void 0),(0,s.A)(this,"aesSoftDecryptor",void 0),(0,s.A)(this,"aesWebDecryptor",void 0),(0,s.A)(this,"aesTargetDecryptor",void 0),(0,s.A)(this,"pointer",void 0),(0,s.A)(this,"endPointer",void 0),(0,s.A)(this,"size",void 0),(0,s.A)(this,"ended",void 0),(0,s.A)(this,"iv",void 0),(0,s.A)(this,"key",void 0),(0,s.A)(this,"mode",void 0),(0,s.A)(this,"pos",void 0),this.mode=t,this.size=e,this.pointer=0,this.endPointer=0,this.pos=0,this.ended=!1,this.buffer=new Uint8Array(e),this.aesSoftDecryptor=new r.A(t),n.A.isSupport()&&u&&(this.aesWebDecryptor=new n.A(t)),this.aesTargetDecryptor=this.aesWebDecryptor||this.aesSoftDecryptor}remainingLength(){return this.endPointer-this.pointer}async expandKey(t,e){this.key=t,this.iv=e,this.aesWebDecryptor&&await this.aesWebDecryptor.expandKey(t),t.byteLength<=8&&this.aesSoftDecryptor.expandKey(t)}async flush_(t){for(;;){const e=await this.onFlush(t);if(-1048575!==e)return e;await new h.A(0)}}async flush(){if(this.size-this.remainingLength()<=0)return;this.pointer<this.endPointer?this.pointer&&(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer):this.endPointer=0,this.pointer=0;const t=await this.flush_(this.buffer.subarray(this.endPointer));if(t<0){if(-1048576===t)return void(this.ended=!0);o.h2(`AESPipe error, flush failed, ret: ${t}`,l,130)}this.endPointer+=t}removePadding(t){const e=t.length,i=e&&new DataView(t.buffer).getUint8(e-1);return i?t.subarray(0,e-i):t}async decryptCBC(t){let e,i=0;this.aesTargetDecryptor!==this.aesWebDecryptor||this.ended||(e=this.buffer.subarray(this.pointer+t,this.pointer+t+d).slice(),this.buffer.set((await this.aesWebDecryptor.encryptPadding(c,this.buffer.subarray(this.pointer+t-d,this.pointer+t))).subarray(0,d),this.pointer+t),i=d);try{const s=this.buffer.subarray(this.pointer,this.pointer+t+i),a=await this.aesTargetDecryptor.decrypt(s,this.iv);return this.iv=s.slice(s.length-d-i,s.length-i).buffer,e&&this.buffer.set(e,this.pointer+t),this.pointer+=t,this.pos+=t,new Uint8Array(a)}catch(i){if(this.aesTargetDecryptor===this.aesWebDecryptor&&this.key.byteLength<=8)return o.R8("web aes decrypt failed, try to use soft decryptor",l,180),e&&this.buffer.set(e,this.pointer+t),this.aesTargetDecryptor=this.aesSoftDecryptor,u=!1,this.decryptCBC(t);o.h2("aes decrypt failed",l,190)}}getCTRIv(){const t=new Uint8Array(this.iv).slice();let e=Math.floor(this.pos/d);for(let i=15;i>=0&&e>0;i--){const s=t[i]+(255&e);t[i]=255&s,e=(e>>>8)+(s>>8)}return t.buffer}async decryptCTR(t){try{const e=this.buffer.subarray(this.pointer,this.pointer+t),i=await this.aesTargetDecryptor.decrypt(e,this.getCTRIv());return this.pointer+=t,this.pos+=t,new Uint8Array(i)}catch(e){if(this.aesTargetDecryptor===this.aesWebDecryptor&&this.key.byteLength<=8)return o.R8("web aes decrypt failed, try to use soft decryptor",l,216),this.aesTargetDecryptor=this.aesSoftDecryptor,u=!1,this.decryptCTR(t);o.h2("aes decrypt failed",l,222)}}async read(t){for(;!this.ended&&this.remainingLength()<48;)await this.flush();if(0===this.remainingLength())return-1048576;if(0===this.mode){const e=Math.min(Math.floor((this.remainingLength()-(this.ended?0:32))/d)*d,t.length);let i=await this.decryptCBC(e);return this.ended&&this.aesTargetDecryptor===this.aesSoftDecryptor&&(i=this.removePadding(i)),t.set(i),i.length}{const e=this.ended?this.remainingLength():Math.min(Math.floor(this.remainingLength()/d)*d,t.length);let i=await this.decryptCTR(e);return t.set(i),i.length}}}},90508:(t,e,i)=>{i.r(e),i.d(e,{default:()=>v});var s=i(19371),a=i(88583),r=i(47378),n=i(25092),o=i(87339),h=i(80687),l=i(97494),d=i(16563),u=i(81819),c=i(91390),p=i(59435),m=i(80853),f=i(39989),T=i(97648);const E="packages/avnetwork/src/ioLoader/HlsIOLoader.ts";function y(t){var e,i,s;const a={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};return null!==(e=t.httpOptions)&&void 0!==e&&e.headers&&n.__(t.httpOptions.headers,((t,e)=>{a.headers[e]=t})),null!==(i=t.httpOptions)&&void 0!==i&&i.credentials&&(a.credentials=t.httpOptions.credentials),null!==(s=t.httpOptions)&&void 0!==s&&s.referrerPolicy&&(a.referrerPolicy=t.httpOptions.referrerPolicy),a}async function A(t,e,i,s){return new Promise(((r,n)=>{let h=0;!async function l(){try{const n=await fetch(t,{...y(e),signal:s}),u=await n.text(),c=(0,m.A)(u);if(i.isLive&&(!c.segments||c.segments.length<2)){var d;let t=5;null!==(d=c.segments)&&void 0!==d&&d.length&&(t=c.segments[0].duration*(2-c.segments.length)),o.R8(`wait for min buffer time, now segments: ${c.segments.length}`,E,84),await new a.A(t),h=0,l()}r(c)}catch(t){if("AbortError"===(null==t?void 0:t.name))return void r(null);if(h<i.retryCount)return h++,o.z3(`failed fetch m3u8 file, retry(${h}/3)`,E,98),await new a.A(i.retryInterval),l();o.z3("HLSLoader: exception, fetch slice error",E,103),n()}}()}))}class g{constructor(t,e,i,a){(0,s.A)(this,"options",void 0),(0,s.A)(this,"info",void 0),(0,s.A)(this,"mediaPlayList",void 0),(0,s.A)(this,"fetchedMap",void 0),(0,s.A)(this,"fetchedHistoryList",void 0),(0,s.A)(this,"mediaListUrl",void 0),(0,s.A)(this,"segmentIndex",void 0),(0,s.A)(this,"currentUri",void 0),(0,s.A)(this,"loader",void 0),(0,s.A)(this,"keyMap",void 0),(0,s.A)(this,"currentIV",void 0),(0,s.A)(this,"currentKey",void 0),(0,s.A)(this,"aesDecryptPipe",void 0),(0,s.A)(this,"initLoaded",void 0),(0,s.A)(this,"isInitLoader",void 0),(0,s.A)(this,"minBuffer",void 0),(0,s.A)(this,"pendingBuffer",void 0),(0,s.A)(this,"magicAdded",void 0),(0,s.A)(this,"sleep",void 0),(0,s.A)(this,"aborted",void 0),(0,s.A)(this,"signal",void 0),this.options=t,this.info=e,this.segmentIndex=0,this.fetchedMap=new Map,this.fetchedHistoryList=[],this.keyMap=new Map,this.aborted=!1,i&&a&&this.setMediaPlayList(i,a)}setMediaPlayList(t,e){if(this.options.isLive){this.fetchedMap.clear(),this.fetchedHistoryList.length=0,this.segmentIndex=0;const t=e.segments.find((t=>t.uri===this.currentUri));if(t)for(e.segments.forEach(((e,i)=>{e.mediaSequenceNumber===t.mediaSequenceNumber+1?this.segmentIndex=i:e.mediaSequenceNumber<=t.mediaSequenceNumber&&(this.fetchedMap.set(e.uri,!0),this.fetchedHistoryList.push(e.uri))}));this.fetchedHistoryList.length>=10;)this.fetchedMap.delete(this.fetchedHistoryList.shift())}if(this.mediaListUrl=t,this.mediaPlayList=e,this.minBuffer=this.mediaPlayList.duration||0,this.mediaPlayList.endlist&&(this.options.isLive=!1),this.initLoaded=!0,this.mediaPlayList.segments.length&&this.mediaPlayList.segments[0].map&&(this.initLoaded=!1),this.mediaPlayList.lowLatencyCompatibility){const t=this.mediaPlayList.lowLatencyCompatibility.partHoldBack||this.mediaPlayList.lowLatencyCompatibility.holdBack||this.minBuffer;let e=0,s=!1,a=0;for(let r=this.mediaPlayList.segments.length-1;r>=0;r--){var i;const n=this.mediaPlayList.segments[r];if(null!==(i=n.parts)&&void 0!==i&&i.length){if(!n.uri)continue;for(let i=n.parts.length-1;i>=0;i--){const o=n.parts[i];if(!o.hint&&(e+=o.duration,o.independent&&(s=!0),e>=t&&s)){a=r;break}}if(e>=t&&s)break}else if(e+=n.duration,s=!0,e>=t&&s){a=r;break}}this.fetchedMap.clear(),this.fetchedHistoryList.length=0;for(let t=0;t<a;t++){const e=this.mediaPlayList.segments[t];this.fetchedMap.set(e.uri,!0),this.fetchedHistoryList.push(e.uri)}for(;this.fetchedHistoryList.length>=10;)this.fetchedMap.delete(this.fetchedHistoryList.shift());this.segmentIndex=a,this.minBuffer=e}}getMediaListUrl(){return this.mediaListUrl}async checkNeedDecrypt(t,e,i){if(!t)return void(this.aesDecryptPipe=null);if("aes-128"!==t.method.toLocaleLowerCase()&&"aes-128-ctr"!==t.method.toLocaleLowerCase()&&("aes-256"!==t.method.toLocaleLowerCase()&&"aes-256-ctr"!==t.method.toLocaleLowerCase()||!h.A.isSupport())){if("mp4"===e.split(".").pop())return void(this.aesDecryptPipe=null);o.h2(`m3u8 ts not support EXT-X-KEY METHOD ${t.method}`,E,276)}const s=t.uri;if(this.keyMap.has(s)?this.currentKey=this.keyMap.get(s):(this.currentKey=await(await fetch(l.ll(this.mediaListUrl,s),y(this.info))).arrayBuffer(),this.keyMap.set(s,this.currentKey)),t.iv)this.currentIV=t.iv.buffer;else{const t=new Uint8Array(16);new DataView(t.buffer).setUint32(12,i,!1),this.currentIV=t.buffer}this.aesDecryptPipe=new T.A(t.method.toLocaleLowerCase().indexOf("ctr")>0?1:0),this.aesDecryptPipe.onFlush=async t=>this.loader.read(t),await this.aesDecryptPipe.expandKey(this.currentKey,this.currentIV)}handleSlice(t,e){const i=this.loader.getUrl().split(".").pop();if("mp3"!==i&&!this.magicAdded&&73===e[0]&&68===e[1]&&51===e[2]){var s;const a=null!==(s=c.HR[i])&&void 0!==s?s:-1;return-1===a?t:(t+6>e.length&&(this.pendingBuffer=e.slice(t-6)),e.set(e.slice(0,t-6),6),e[0]=76,e[1]=73,e[2]=77,e[3]=65,e[4]=a>>>8&255,e[5]=255&a,this.magicAdded=!0,this.pendingBuffer?t:t+6)}return t}async read(t){if(this.pendingBuffer){let e=this.pendingBuffer.length;return t.set(this.pendingBuffer),this.pendingBuffer=null,e}let e=0;if(this.loader){if(e=this.aesDecryptPipe?await this.aesDecryptPipe.read(t):await this.loader.read(t),-1048576!==e||this.aborted)return e;if(this.isInitLoader)this.initLoaded=!0;else if(this.options.isLive)this.fetchedMap.set(this.currentUri,!0),10===this.fetchedHistoryList.length&&this.fetchedMap.delete(this.fetchedHistoryList.shift()),this.fetchedHistoryList.push(this.currentUri),this.segmentIndex++;else if(this.segmentIndex++,this.segmentIndex>=this.mediaPlayList.segments.length)return-1048576;this.loader=null}if(this.options.isLive){var i,s;const e=this.mediaPlayList.segments.filter((t=>t.uri&&!this.fetchedMap.get(t.uri)));if(!e.length){var r;if(this.mediaPlayList.endlist)return-1048576;const e=(this.minBuffer-((0,d.A)()-this.mediaPlayList.timestamp)/1e3)/2;return e>0&&(this.sleep=new a.A(e),await this.sleep,this.sleep=null,this.aborted)?-1048576:("function"==typeof AbortController&&(this.signal=new AbortController),this.mediaPlayList=await A(this.mediaListUrl,this.info,this.options,null===(r=this.signal)||void 0===r?void 0:r.signal),this.signal=null,this.aborted?-1048576:this.read(t))}this.isInitLoader=!(null===(i=e[0].map)||void 0===i||!i.uri||this.initLoaded),this.currentUri=e[0].uri,this.isInitLoader?null!==(s=e[0].map)&&void 0!==s&&s.key&&await this.checkNeedDecrypt(e[0].map.key,e[0].map.uri,this.segmentIndex+(this.mediaPlayList.mediaSequenceBase||0)):await this.checkNeedDecrypt(e[0].key,this.currentUri,this.segmentIndex+(this.mediaPlayList.mediaSequenceBase||0)),this.loader=new f.A(n.X$({},this.options,{disableSegment:!0,loop:!1}));const o=l.ll(this.mediaListUrl,this.isInitLoader?e[0].map.uri:this.currentUri),h={from:0,to:-1},u=this.isInitLoader?e[0].map.byterange:e[0].byterange;u&&(h.from=u.offset,h.to=u.offset+u.length),await this.loader.open(n.X$({},this.info,{url:o}),h);const c=await(this.aesDecryptPipe?this.aesDecryptPipe.read(t):this.loader.read(t));return c>10?this.handleSlice(c,t):c}{var o,h;this.loader=new f.A(n.X$({},this.options,{disableSegment:!0,loop:!1}));let e=this.mediaPlayList.segments[this.segmentIndex];for(;e&&!e.uri;)e=this.mediaPlayList.segments[++this.segmentIndex];this.isInitLoader=!(null===(o=e.map)||void 0===o||!o.uri||this.initLoaded),this.isInitLoader?null!==(h=e.map)&&void 0!==h&&h.key&&await this.checkNeedDecrypt(e.map.key,e.map.uri,this.segmentIndex+(this.mediaPlayList.mediaSequenceBase||0)):await this.checkNeedDecrypt(e.key,e.uri,this.segmentIndex+(this.mediaPlayList.mediaSequenceBase||0));const i=l.ll(this.mediaListUrl,this.isInitLoader?e.map.uri:e.uri),s={from:0,to:-1},a=this.isInitLoader?e.map.byterange:e.byterange;a&&(s.from=a.offset,s.to=a.offset+a.length),await this.loader.open(n.X$({},this.info,{url:i}),s);const r=await(this.aesDecryptPipe?this.aesDecryptPipe.read(t):this.loader.read(t));return r>10?this.handleSlice(r,t):r}}async seek(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.loader&&(await this.loader.abort(),this.loader=null);let i=e,s=Number(t),a=-1;for(let t=0;t<this.mediaPlayList.segments.length;t++)if(u.ai(this.mediaPlayList.segments[t].duration)&&(i+=this.mediaPlayList.segments[t].duration,1e3*i>=s)){a=t;break}return-1===a&&(a=this.mediaPlayList.segments.length-1),this.segmentIndex=a,this.aborted=!1,0}abortSleep(){this.aborted=!0,this.loader&&this.loader.abortSleep(),this.sleep&&(this.sleep.stop(),this.sleep=null)}async abort(){this.abortSleep(),this.signal&&(this.signal.abort(),this.signal=null),this.loader&&(await this.loader.abort(),this.loader=null)}getMinBuffer(){return this.minBuffer}getDuration(){return this.mediaPlayList.duration}getNextFragmentStart(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.segmentIndex>=this.mediaPlayList.segments.length-1)return-1;for(let e=0;e<this.segmentIndex+1;e++){if(!u.ai(this.mediaPlayList.segments[e].duration))return-1;t+=this.mediaPlayList.segments[e].duration}return t}}class v extends p.A{constructor(){super(...arguments),(0,s.A)(this,"info",void 0),(0,s.A)(this,"masterPlaylist",void 0),(0,s.A)(this,"mediaPlayListIndex",void 0),(0,s.A)(this,"mainLoader",void 0),(0,s.A)(this,"loaders",void 0),(0,s.A)(this,"audioSelectedIndex",void 0),(0,s.A)(this,"subtitleSelectedIndex",void 0),(0,s.A)(this,"sleep",void 0),(0,s.A)(this,"aborted",void 0),(0,s.A)(this,"start",void 0)}async fetchMasterPlayList(){try{const e=await fetch(this.info.url,y(this.info)),i=await e.text(),s=(0,m.A)(i);if(s.isMasterPlaylist){if(this.masterPlaylist=s,this.options.preferResolution||this.options.preferVideoCodec){let t=1,e=1;if(this.options.preferResolution){const i=this.options.preferResolution.split("*");t=+i[0]||1,e=+i[1]||1}let i=!1,s=1/0,a=this.masterPlaylist.variants.some((t=>t.codecs&&t.codecs.indexOf(this.options.preferVideoCodec)>=0));this.masterPlaylist.variants.forEach(((r,n)=>{if(!(this.options.preferVideoCodec&&a&&r.codecs&&-1===r.codecs.indexOf(this.options.preferVideoCodec))&&(i||(this.mediaPlayListIndex=n,i=!0),r.resolution&&this.options.preferResolution)){const i=1===t?1:r.resolution.width,a=1===e?1:r.resolution.height;Math.abs(i*a-t*e)<s&&(s=Math.abs(i*a-t*e),this.mediaPlayListIndex=n)}}))}const t=this.masterPlaylist.variants[this.mediaPlayListIndex];if(t){if(t.audio.length&&this.options.preferAudioLang){let e=!1;t.audio.forEach(((t,i)=>{t.language&&t.language.indexOf(this.options.preferAudioLang)>=0&&!e&&(this.audioSelectedIndex=i,t.language===this.options.preferAudioLang&&(e=!0))}))}if(t.subtitles.length&&this.options.preferSubtitleLang){let e=!1;t.subtitles.forEach(((t,i)=>{t.language&&t.language.indexOf(this.options.preferSubtitleLang)>=0&&!e&&(this.subtitleSelectedIndex=i,t.language===this.options.preferSubtitleLang&&(e=!0))}))}}}else{const e=s;if(this.options.isLive&&(!e.segments||e.segments.length<2)){var t;let i=5;return null!==(t=e.segments)&&void 0!==t&&t.length&&(i=e.segments[0].duration*(2-e.segments.length)),o.R8(`wait for min buffer time, now segments: ${e.segments.length}`,E,656),await new a.A(i),this.fetchMasterPlayList()}this.mainLoader=new g(n.X$({enableBandwidthReader:!0},this.options),this.info,this.info.url,e),this.loaders.set(0,this.mainLoader)}return s}catch(t){if(this.retryCount<this.options.retryCount)return this.retryCount++,o.z3(`failed fetch m3u8 file, retry(${this.retryCount}/3)`,E,673),this.sleep=new a.A(3),await this.sleep,this.sleep=null,this.aborted&&o.h2("HLSLoader: exception, fetch abort",E,678),this.fetchMasterPlayList();this.status=3,o.h2("HLSLoader: exception, fetch slice error",E,684)}}buildUrl(t){return/^https?/.test(t)||(t=l.ll(this.info.url,t)),t}async createLoader(){if(this.masterPlaylist){const t=this.masterPlaylist.variants[this.mediaPlayListIndex];if(t||o.h2("no media playlist",E,700),t.audio.length){const e=this.buildUrl(t.audio[this.audioSelectedIndex].uri);this.loaders.set(1,new g(this.options,this.info,e,await A(e,this.info,this.options)))}if(t.subtitles.length){const e=this.buildUrl(t.subtitles[this.subtitleSelectedIndex].uri);this.loaders.set(3,new g(this.options,this.info,e,await A(e,this.info,this.options)))}const e=this.buildUrl(t.uri);this.mainLoader=new g(n.X$({enableBandwidthReader:!0},this.options),this.info,e,await A(e,this.info,this.options)),this.loaders.set(0,this.mainLoader)}}async open(t){return 2===this.status?0:0!==this.status?r.lh:(this.info=t,this.mediaPlayListIndex=0,this.audioSelectedIndex=0,this.subtitleSelectedIndex=0,this.loaders=new Map,this.status=1,this.retryCount=0,this.aborted=!1,this.start=0,await this.fetchMasterPlayList(),!this.loaders.size&&this.masterPlaylist&&await this.createLoader(),this.status=2,0)}async read(t,e){if(!e)return r.UY;const i=await this.loaders.get(e.mediaType).read(t);return i<0&&-1048575!==i&&(this.status=-1048576===i?4:3),i}async seek(t,e){return e?(await this.loaders.get(e.mediaType).seek(t,this.start),4===this.status&&(this.status=2),0):r.UY}async size(){return BigInt(0)}async abort(){for(let t of this.loaders)await t[1].abort();this.aborted=!0,this.sleep&&(this.sleep.stop(),this.sleep=null)}async stop(){await this.abort(),this.status=0}getDuration(){var t,e;return null!==(t=null===(e=this.mainLoader)||void 0===e?void 0:e.getDuration())&&void 0!==t?t:0}hasVideo(){return this.masterPlaylist?this.masterPlaylist.variants.length>0:!!this.mainLoader}hasAudio(){if(this.masterPlaylist)return this.masterPlaylist.variants[this.mediaPlayListIndex].audio.length>0}hasSubtitle(){if(this.masterPlaylist)return this.masterPlaylist.variants[this.mediaPlayListIndex].subtitles.length>0}getVideoList(){var t,e;return{list:null!==(t=null===(e=this.masterPlaylist)||void 0===e?void 0:e.variants.map((t=>{var e,i,s,a,r;return{width:null!==(e=null===(i=t.resolution)||void 0===i?void 0:i.width)&&void 0!==e?e:0,height:null!==(s=null===(a=t.resolution)||void 0===a?void 0:a.height)&&void 0!==s?s:0,frameRate:null!==(r=t.frameRate)&&void 0!==r?r:0,codec:t.codecs,bandwidth:t.bandwidth}})))&&void 0!==t?t:[],selectedIndex:this.mediaPlayListIndex||0}}getAudioList(){return this.masterPlaylist&&this.hasAudio()?{list:this.masterPlaylist.variants[this.mediaPlayListIndex].audio.map((t=>({lang:t.language,codec:t.name}))),selectedIndex:this.audioSelectedIndex}:{list:[],selectedIndex:0}}getSubtitleList(){return this.masterPlaylist&&this.hasSubtitle()?{list:this.masterPlaylist.variants[this.mediaPlayListIndex].subtitles.map((t=>({lang:t.language,codec:t.name}))),selectedIndex:this.subtitleSelectedIndex}:{list:[],selectedIndex:0}}async selectVideo(t){if(this.masterPlaylist){const e=this.masterPlaylist.variants[t];if(e){const i=this.buildUrl(e.uri),s=await A(i,this.info,this.options);if(this.loaders.get(0).setMediaPlayList(i,s),this.mediaPlayListIndex=t,1===e.audio.length&&this.loaders.has(1)&&this.buildUrl(e.audio[0].uri)!==this.loaders.get(1).getMediaListUrl()){const t=this.buildUrl(e.audio[0].uri),i=await A(t,this.info,this.options);this.loaders.get(1).setMediaPlayList(t,i)}if(1===e.subtitles.length&&this.loaders.has(3)&&this.buildUrl(e.subtitles[0].uri)!==this.loaders.get(3).getMediaListUrl()){const t=this.buildUrl(e.subtitles[0].uri),i=await A(t,this.info,this.options);this.loaders.get(3).setMediaPlayList(t,i)}return this.loaders.get(0).getNextFragmentStart(this.start)}}return-1}async selectAudio(t){if(this.masterPlaylist){const e=this.masterPlaylist.variants[this.mediaPlayListIndex];if(null!=e&&e.audio[t]){const i=this.buildUrl(e.audio[t].uri),s=await A(i,this.info,this.options);return this.loaders.get(1).setMediaPlayList(i,s),this.audioSelectedIndex=t,this.loaders.get(1).getNextFragmentStart(this.start)}}return-1}async selectSubtitle(t){if(this.masterPlaylist){const e=this.masterPlaylist.variants[this.mediaPlayListIndex];if(null!=e&&e.subtitles[t]){const i=this.buildUrl(e.subtitles[t].uri),s=await A(i,this.info,this.options);return this.loaders.get(3).setMediaPlayList(i,s),this.subtitleSelectedIndex=t,this.loaders.get(3).getNextFragmentStart(this.start)}}return-1}getMinBuffer(){var t,e;return null!==(t=null===(e=this.mainLoader)||void 0===e?void 0:e.getMinBuffer())&&void 0!==t?t:0}setStart(t){this.start=t}}},80853:(t,e,i)=>{i.d(e,{A:()=>b});var s=i(39381),a=i(3137),r=i(87339);const n="packages/avprotocol/src/m3u8/parser.ts";function o(t){return s.Bq(t,'"')}function h(t){const e=s.gI(t,",");return{duration:s.Ro(e[0]),title:decodeURIComponent(escape(e[1]))}}function l(t){const e=s.gI(t,"@");return{length:s.Ro(e[0]),offset:e[1]?s.Ro(e[1]):-1}}function d(t){const e=s.gI(t,"x");return{width:s.Ro(e[0]),height:s.Ro(e[1])}}function u(t){const e="ALLOWED-CPC: Each entry must consit of KEYFORMAT and Content Protection Configuration",i=t.split(",");0===i.length&&r.z3(e,n,105);const a=[];for(const t of i){const[i,o]=s.gI(t,":");i&&o?a.push({format:i,cpcList:o.split("/")}):r.z3(e,n,111)}return a}function c(t){const e=s.m2(t);return 16!==e.length&&r.z3("IV must be a 128-bit unsigned integer",n,122),e}function p(t,e){e.IV&&t.compatibleVersion<2&&(t.compatibleVersion=2),(e.KEYFORMAT||e.KEYFORMATVERSIONS)&&t.compatibleVersion<5&&(t.compatibleVersion=5)}function m(t){const e={};for(const a of s.HG(t)){const[t,h]=s.gI(a,"="),p=o(h);switch(t){case"URI":e[t]=p;break;case"START-DATE":case"END-DATE":e[t]=new Date(p);break;case"IV":e[t]=c(p);break;case"BYTERANGE":e[t]=l(p);break;case"RESOLUTION":e[t]=d(p);break;case"ALLOWED-CPC":e[t]=u(p);break;case"END-ON-NEXT":case"DEFAULT":case"AUTOSELECT":case"FORCED":case"PRECISE":case"CAN-BLOCK-RELOAD":case"INDEPENDENT":case"GAP":e[t]="YES"===p;break;case"DURATION":case"PLANNED-DURATION":case"BANDWIDTH":case"AVERAGE-BANDWIDTH":case"FRAME-RATE":case"TIME-OFFSET":case"CAN-SKIP-UNTIL":case"HOLD-BACK":case"PART-HOLD-BACK":case"PART-TARGET":case"BYTERANGE-START":case"BYTERANGE-LENGTH":case"LAST-MSN":case"LAST-PART":case"SKIPPED-SEGMENTS":case"SCORE":case"PROGRAM-ID":e[t]=s.Ro(p);break;default:t.startsWith("SCTE35-")?e[t]=s.m2(p):t.startsWith("X-")?e[t]=(i=h).startsWith('"')?o(i):i.startsWith("0x")||i.startsWith("0X")?s.m2(i):s.Ro(i):("VIDEO-RANGE"===t&&"SDR"!==p&&"HLG"!==p&&"PQ"!==p&&r.h2(`VIDEO-RANGE: unknown value "${p}"`,n,209),e[t]=p)}}var i;return e}function f(t,e,i){const o=function(t){let{attributes:e}=t;return new a.ru({type:e.TYPE,uri:e.URI,groupId:e["GROUP-ID"],language:e.LANGUAGE,assocLanguage:e["ASSOC-LANGUAGE"],name:e.NAME,isDefault:e.DEFAULT,autoselect:e.AUTOSELECT,forced:e.FORCED,instreamId:e["INSTREAM-ID"],characteristics:e.CHARACTERISTICS,channels:e.CHANNELS})}(e),h=t[s.Th(i)],l=function(t,e){let i=!1;for(const s of t){if(s.name===e.name)return"All EXT-X-MEDIA tags in the same Group MUST have different NAME attributes.";s.isDefault&&(i=!0)}return i&&e.isDefault?"EXT-X-MEDIA A Group MUST NOT have more than one member with a DEFAULT attribute of YES.":""}(h,o);l&&r.h2(l,n,318),h.push(o),o.isDefault&&(t.currentRenditions[s.Th(i)]=h.length-1)}function T(t,e,i,o,h){const l=new a.KT({uri:i,bandwidth:e.BANDWIDTH,averageBandwidth:e["AVERAGE-BANDWIDTH"],score:e.SCORE,codecs:e.CODECS,resolution:e.RESOLUTION,frameRate:e["FRAME-RATE"],hdcpLevel:e["HDCP-LEVEL"],allowedCpc:e["ALLOWED-CPC"],videoRange:e["VIDEO-RANGE"],stableVariantId:e["STABLE-VARIANT-ID"],programId:e["PROGRAM-ID"]});for(const i of t)if("EXT-X-MEDIA"===i.name){const t=i.attributes,s=t.TYPE;if(s&&t["GROUP-ID"]||r.h2("EXT-X-MEDIA TYPE attribute is REQUIRED.",n,358),e[s]===t["GROUP-ID"]&&(f(l,i,s),"CLOSED-CAPTIONS"===s))for(const{instreamId:t}of l.closedCaptions)if(t&&t.startsWith("SERVICE")&&h.compatibleVersion<7){h.compatibleVersion=7;break}}return function(t,e,i){for(const a of["AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS"])"CLOSED-CAPTIONS"===a&&"NONE"===t[a]?(i.isClosedCaptionsNone=!0,e.closedCaptions=[]):t[a]&&!e[s.Th(a)].some((e=>e.groupId===t[a]))&&r.h2(`${a} attribute MUST match the value of the GROUP-ID attribute of an EXT-X-MEDIA tag whose TYPE attribute is ${a}.`,n,333)}(e,l,h),l.isIFrameOnly=o,l}function E(t,e){if(t.method!==e.method)return!1;if(t.uri!==e.uri)return!1;if(t.iv){if(!e.iv)return!1;if(t.iv.length!==e.iv.length)return!1;for(let i=0;i<t.iv.length;i++)if(t.iv[i]!==e.iv[i])return!1}else if(e.iv)return!1;return t.format===e.format&&t.formatVersion===e.formatVersion}function y(t,e,i,s,o,h,l){const d=new a.Y4({uri:e,mediaSequenceNumber:o,discontinuitySequence:h});let u=!1,c=!1;for(let e=i;e<=s;e++){const{name:i,value:s,attributes:o}=t[e];if("EXTINF"===i)!Number.isInteger(s.duration)&&l.compatibleVersion<3&&(l.compatibleVersion=3),Math.round(s.duration)>l.targetDuration&&r.h2("EXTINF duration, when rounded to the nearest integer, MUST be less than or equal to the target duration",n,520),d.duration=s.duration,d.title=s.title;else if("EXT-X-BYTERANGE"===i)l.compatibleVersion<4&&(l.compatibleVersion=4),d.byterange=s;else if("EXT-X-DISCONTINUITY"===i)d.parts.length>0&&r.h2("EXT-X-DISCONTINUITY must appear before the first EXT-X-PART tag of the Parent Segment.",n,533),d.discontinuity=!0;else if("EXT-X-KEY"===i)d.parts.length>0&&r.h2("EXT-X-KEY must appear before the first EXT-X-PART tag of the Parent Segment.",n,539),"NONE"!==o.METHOD?(p(l,o),d.key=new a.Uz({method:o.METHOD,uri:o.URI,iv:o.IV,format:o.KEYFORMAT,formatVersion:o.KEYFORMATVERSIONS})):d.key=null;else if("EXT-X-MAP"===i)d.parts.length>0&&r.h2("EXT-X-MAP must appear before the first EXT-X-PART tag of the Parent Segment.",n,558),l.compatibleVersion<5&&(l.compatibleVersion=5),l.hasMap=!0,d.map=new a.qP({uri:o.URI,byterange:o.BYTERANGE,key:d.key});else if("EXT-X-PROGRAM-DATE-TIME"===i)d.programDateTime=s;else if("EXT-X-DATERANGE"===i){const t={};for(const e of Object.keys(o))(e.startsWith("SCTE35-")||e.startsWith("X-"))&&(t[e]=o[e]);d.dateRange=new a.ad({id:o.ID,classId:o.CLASS,start:o["START-DATE"],end:o["END-DATE"],duration:o.DURATION,plannedDuration:o["PLANNED-DURATION"],endOnNext:o["END-ON-NEXT"],attributes:t})}else if("EXT-X-CUE-OUT"===i)d.markers.push(new a.xC({type:"OUT",duration:o&&o.DURATION||s}));else if("EXT-X-CUE-IN"===i)d.markers.push(new a.xC({type:"IN"}));else if("EXT-X-CUE-OUT-CONT"===i||"EXT-X-CUE"===i||"EXT-OATCLS-SCTE35"===i||"EXT-X-ASSET"===i||"EXT-X-SCTE35"===i)d.markers.push(new a.xC({type:"RAW",tagName:i,value:s}));else if("EXT-X-PRELOAD-HINT"!==i||o.TYPE)if("EXT-X-PRELOAD-HINT"===i&&"PART"===o.TYPE&&c)r.h2("Servers should not add more than one EXT-X-PRELOAD-HINT tag with the same TYPE attribute to a Playlist.",n,619);else if("EXT-X-PART"!==i&&"EXT-X-PRELOAD-HINT"!==i||o.URI){if("EXT-X-PRELOAD-HINT"===i&&"MAP"===o.TYPE)u&&r.h2("Servers should not add more than one EXT-X-PRELOAD-HINT tag with the same TYPE attribute to a Playlist.",n,626),u=!0,l.hasMap=!0,d.map=new a.qP({hint:!0,uri:o.URI,byterange:{length:o["BYTERANGE-LENGTH"],offset:o["BYTERANGE-START"]||0}});else if("EXT-X-PART"===i||"EXT-X-PRELOAD-HINT"===i&&"PART"===o.TYPE){"EXT-X-PART"!==i||o.DURATION||r.h2("EXT-X-PART: DURATION attribute is mandatory",n,638),"EXT-X-PRELOAD-HINT"===i&&(c=!0);const t=new a.nw({hint:"EXT-X-PRELOAD-HINT"===i,uri:o.URI,byterange:"EXT-X-PART"===i?o.BYTERANGE:{length:o["BYTERANGE-LENGTH"],offset:o["BYTERANGE-START"]||0},duration:o.DURATION,independent:o.INDEPENDENT,gap:o.GAP});d.parts.push(t)}}else r.h2("EXT-X-PART / EXT-X-PRELOAD-HINT: URI attribute is mandatory",n,622);else r.h2("EXT-X-PRELOAD-HINT: TYPE attribute is mandatory",n,616)}return d}function A(t,e,i,s,o,h,l){const d=new a.Vd({uri:e,mediaSequenceNumber:o,discontinuitySequence:h});for(let e=i;e<=s;e++){const{name:i,attributes:s}=t[e];"EXTINF"===i?r.h2("A prefetch segment must not be advertised with an EXTINF tag.",n,670):"EXT-X-DISCONTINUITY"===i?r.h2("A prefetch segment must not be advertised with an EXT-X-DISCONTINUITY tag.",n,673):"EXT-X-PREFETCH-DISCONTINUITY"===i?d.discontinuity=!0:"EXT-X-KEY"===i?"NONE"!==s.METHOD&&(p(l,s),d.key=new a.Uz({method:s.METHOD,uri:s.URI,iv:s.IV,format:s.KEYFORMAT,formatVersion:s.KEYFORMATVERSIONS})):"EXT-X-MAP"===i&&r.h2("Prefetch segments must not be advertised with an EXT-X-MAP tag.",n,691)}return d}function g(t,e,i,s,a){const{discontinuity:o,key:h,map:l,byterange:d,uri:u}=e;if(o&&(e.discontinuitySequence=i+1),h||(e.key=s),l||(e.map=a),d&&-1===d.offset){const{segments:e}=t;if(e.length>0){const t=e[e.length-1];t.byterange&&t.uri===u?d.offset=t.byterange.offset+t.byterange.length:r.h2("If offset of EXT-X-BYTERANGE is not present, a previous Media Segment MUST be a sub-range of the same media resource",n,915)}else r.h2("If offset of EXT-X-BYTERANGE is not present, a previous Media Segment MUST appear in the Playlist file",n,919)}return t.segments.push(e),[e.discontinuitySequence,e.key,e.map]}function v(t,e){const[i,a]=function(t){const e=t.indexOf(":");return-1===e?[t.slice(1).trim(),null]:[t.slice(1,e).trim(),t.slice(e+1).trim()]}(t),o=function(t){switch(t){case"EXTM3U":case"EXT-X-VERSION":return"Basic";case"EXTINF":case"EXT-X-BYTERANGE":case"EXT-X-DISCONTINUITY":case"EXT-X-PREFETCH-DISCONTINUITY":case"EXT-X-KEY":case"EXT-X-MAP":case"EXT-X-PROGRAM-DATE-TIME":case"EXT-X-DATERANGE":case"EXT-X-CUE-OUT":case"EXT-X-CUE-IN":case"EXT-X-CUE-OUT-CONT":case"EXT-X-CUE":case"EXT-OATCLS-SCTE35":case"EXT-X-ASSET":case"EXT-X-SCTE35":case"EXT-X-PART":case"EXT-X-PRELOAD-HINT":return"Segment";case"EXT-X-TARGETDURATION":case"EXT-X-MEDIA-SEQUENCE":case"EXT-X-DISCONTINUITY-SEQUENCE":case"EXT-X-ENDLIST":case"EXT-X-PLAYLIST-TYPE":case"EXT-X-I-FRAMES-ONLY":case"EXT-X-SERVER-CONTROL":case"EXT-X-PART-INF":case"EXT-X-PREFETCH":case"EXT-X-RENDITION-REPORT":case"EXT-X-SKIP":return"MediaPlaylist";case"EXT-X-MEDIA":case"EXT-X-STREAM-INF":case"EXT-X-I-FRAME-STREAM-INF":case"EXT-X-SESSION-DATA":case"EXT-X-SESSION-KEY":return"MasterPlaylist";case"EXT-X-INDEPENDENT-SEGMENTS":case"EXT-X-START":return"MediaorMasterPlaylist";default:return"Unknown"}}(i);if(function(t,e){if("Segment"===t||"MediaPlaylist"===t)return void 0===e.isMasterPlaylist?void(e.isMasterPlaylist=!1):void(e.isMasterPlaylist&&r.h2("The file contains both media and master playlist tags.",n,1026));if("MasterPlaylist"===t){if(void 0===e.isMasterPlaylist)return void(e.isMasterPlaylist=!0);!1===e.isMasterPlaylist&&r.h2("The file contains both media and master playlist tags.",n,1036)}}(o,e),"Unknown"===o)return null;"MediaPlaylist"===o&&"EXT-X-RENDITION-REPORT"!==i&&"EXT-X-PREFETCH"!==i&&(e.hash[i]&&r.h2("There MUST NOT be more than one Media Playlist tag of each type in any Media Playlist",n,1057),e.hash[i]=!0);const[d,u]=function(t,e){switch(t){case"EXTM3U":case"EXT-X-DISCONTINUITY":case"EXT-X-ENDLIST":case"EXT-X-I-FRAMES-ONLY":case"EXT-X-INDEPENDENT-SEGMENTS":case"EXT-X-CUE-IN":return[null,null];case"EXT-X-VERSION":case"EXT-X-TARGETDURATION":case"EXT-X-MEDIA-SEQUENCE":case"EXT-X-DISCONTINUITY-SEQUENCE":return[s.Ro(e),null];case"EXT-X-CUE-OUT":return Number.isNaN(Number(e))?[null,m(e)]:[s.Ro(e),null];case"EXT-X-KEY":case"EXT-X-MAP":case"EXT-X-DATERANGE":case"EXT-X-MEDIA":case"EXT-X-STREAM-INF":case"EXT-X-I-FRAME-STREAM-INF":case"EXT-X-SESSION-DATA":case"EXT-X-SESSION-KEY":case"EXT-X-START":case"EXT-X-SERVER-CONTROL":case"EXT-X-PART-INF":case"EXT-X-PART":case"EXT-X-PRELOAD-HINT":case"EXT-X-RENDITION-REPORT":case"EXT-X-SKIP":return[null,m(e)];case"EXTINF":return[h(e),null];case"EXT-X-BYTERANGE":return[l(e),null];case"EXT-X-PROGRAM-DATE-TIME":return[new Date(e),null];default:return[e,null]}}(i,a);return{name:i,category:o,value:d,attributes:u}}function I(t,e){let i;return e.isMasterPlaylist?i=function(t,e){const i=new a.ts;let s=!1;for(const[o,{name:h,value:l,attributes:d}]of t.entries())if("EXT-X-VERSION"===h)i.version=l;else if("EXT-X-STREAM-INF"===h){const a=t[o+1];("string"!=typeof a||a.startsWith("#EXT"))&&r.h2("EXT-X-STREAM-INF must be followed by a URI line",n,420);const h=T(t,d,a,!1,e);h&&("number"==typeof h.score&&(s=!0,h.score<0&&r.h2("SCORE attribute on EXT-X-STREAM-INF must be positive decimal-floating-point number.",n,427)),i.variants.push(h))}else if("EXT-X-I-FRAME-STREAM-INF"===h){const s=T(t,d,d.URI,!0,e);s&&i.variants.push(s)}else if("EXT-X-SESSION-DATA"===h){const t=new a.pf({id:d["DATA-ID"],value:d.VALUE,uri:d.URI,language:d.LANGUAGE});i.sessionDataList.some((e=>e.id===t.id&&e.language===t.language))&&r.h2("A Playlist MUST NOT contain more than one EXT-X-SESSION-DATA tag with the same DATA-ID attribute and the same LANGUAGE attribute.",n,447),i.sessionDataList.push(t)}else if("EXT-X-SESSION-KEY"===h){"NONE"===d.METHOD&&r.h2("EXT-X-SESSION-KEY: The value of the METHOD attribute MUST NOT be NONE",n,453);const t=new a.Uz({method:d.METHOD,uri:d.URI,iv:d.IV,format:d.KEYFORMAT,formatVersion:d.KEYFORMATVERSIONS});i.sessionKeyList.some((e=>E(e,t)))&&r.h2("A Master Playlist MUST NOT contain more than one EXT-X-SESSION-KEY tag with the same METHOD, URI, IV, KEYFORMAT, and KEYFORMATVERSIONS attribute values.",n,463),p(e,d),i.sessionKeyList.push(t)}else"EXT-X-INDEPENDENT-SEGMENTS"===h?(i.independentSegments&&r.h2("EXT-X-INDEPENDENT-SEGMENTS tag MUST NOT appear more than once in a Playlist",n,470),i.independentSegments=!0):"EXT-X-START"===h&&(i.start&&r.h2("EXT-X-START tag MUST NOT appear more than once in a Playlist",n,476),"number"!=typeof d["TIME-OFFSET"]&&r.h2("EXT-X-START: TIME-OFFSET attribute is REQUIRED",n,479),i.start={offset:d["TIME-OFFSET"],precise:d.PRECISE||!1});if(s)for(const t of i.variants)"number"!=typeof t.score&&r.h2("If any Variant Stream contains the SCORE attribute, then all Variant Streams in the Master Playlist SHOULD have a SCORE attribute",n,487);if(e.isClosedCaptionsNone)for(const t of i.variants)t.closedCaptions.length>0&&r.h2("If there is a variant with CLOSED-CAPTIONS attribute of NONE, all EXT-X-STREAM-INF tags MUST have this attribute with a value of NONE",n,494);return i}(t,e):(i=function(t,e){const i=new a.tk;let s=-1,o=0,h=!1,l=!1,d=0,u=null,c=null,p=!1;for(const[m,f]of t.entries()){const{name:T,value:E,attributes:v,category:I}=f;if("Segment"!==I){if("EXT-X-VERSION"===T)void 0===i.version?i.version=E:r.h2("A Playlist file MUST NOT contain more than one EXT-X-VERSION tag.",n,723);else if("EXT-X-TARGETDURATION"===T)i.targetDuration=e.targetDuration=E;else if("EXT-X-MEDIA-SEQUENCE"===T)i.segments.length>0&&r.h2("The EXT-X-MEDIA-SEQUENCE tag MUST appear before the first Media Segment in the Playlist.",n,731),i.mediaSequenceBase=o=E;else if("EXT-X-DISCONTINUITY-SEQUENCE"===T)i.segments.length>0&&r.h2("The EXT-X-DISCONTINUITY-SEQUENCE tag MUST appear before the first Media Segment in the Playlist.",n,737),h&&r.h2("The EXT-X-DISCONTINUITY-SEQUENCE tag MUST appear before any EXT-X-DISCONTINUITY tag.",n,740),i.discontinuitySequenceBase=d=E;else if("EXT-X-ENDLIST"===T)i.endlist=!0;else if("EXT-X-PLAYLIST-TYPE"===T)i.playlistType=E;else if("EXT-X-I-FRAMES-ONLY"===T)e.compatibleVersion<4&&(e.compatibleVersion=4),i.isIFrame=!0;else if("EXT-X-INDEPENDENT-SEGMENTS"===T)i.independentSegments&&r.h2("EXT-X-INDEPENDENT-SEGMENTS tag MUST NOT appear more than once in a Playlist",n,758),i.independentSegments=!0;else if("EXT-X-START"===T)i.start&&r.h2("EXT-X-START tag MUST NOT appear more than once in a Playlist",n,764),"number"!=typeof v["TIME-OFFSET"]&&r.h2("EXT-X-START: TIME-OFFSET attribute is REQUIRED",n,767),i.start={offset:v["TIME-OFFSET"],precise:v.PRECISE||!1};else if("EXT-X-SERVER-CONTROL"===T)v["CAN-BLOCK-RELOAD"]||r.h2("EXT-X-SERVER-CONTROL: CAN-BLOCK-RELOAD=YES is mandatory for Low-Latency HLS",n,773),i.lowLatencyCompatibility={canBlockReload:v["CAN-BLOCK-RELOAD"],canSkipUntil:v["CAN-SKIP-UNTIL"],holdBack:v["HOLD-BACK"],partHoldBack:v["PART-HOLD-BACK"]};else if("EXT-X-PART-INF"===T)v["PART-TARGET"]||r.h2("EXT-X-PART-INF: PART-TARGET attribute is mandatory",n,784),i.partTargetDuration=v["PART-TARGET"];else if("EXT-X-RENDITION-REPORT"===T)v.URI||r.h2("EXT-X-RENDITION-REPORT: URI attribute is mandatory",n,790),0===v.URI.search(/^[a-z]+:/)&&r.h2("EXT-X-RENDITION-REPORT: URI must be relative to the playlist uri",n,793),i.renditionReports.push(new a.h4({uri:v.URI,lastMSN:v["LAST-MSN"],lastPart:v["LAST-PART"]}));else if("EXT-X-SKIP"===T)v["SKIPPED-SEGMENTS"]||r.h2("EXT-X-SKIP: SKIPPED-SEGMENTS attribute is mandatory",n,803),e.compatibleVersion<9&&(e.compatibleVersion=9),i.skip=v["SKIPPED-SEGMENTS"],o+=i.skip;else if("EXT-X-PREFETCH"===T){const a=A(t,E,-1===s?m:s,m-1,o++,d,e);a&&(a.discontinuity&&(a.discontinuitySequence++,d=a.discontinuitySequence),a.key?u=a.key:null===a.key?u=void 0:a.key=u,i.prefetchSegments.push(a)),l=!0,s=-1}else if("string"==typeof f){-1===s&&r.h2("A URI line is not preceded by any segment tags",n,843),i.targetDuration||r.h2("The EXT-X-TARGETDURATION tag is REQUIRED",n,846),l&&r.h2("These segments must appear after all complete segments.",n,849);const a=y(t,f,s,m-1,o++,d,e);a&&(null===a.key&&(u=void 0),[d,u,c]=g(i,a,d,u,c),!p&&a.parts.length>0&&(p=!0)),s=-1}}else-1===s&&(s=m),"EXT-X-DISCONTINUITY"===T&&(h=!0)}if(-1!==s){const a=y(t,"",s,t.length-1,o++,d,e);if(a){var m;null===a.key&&(u=void 0);const{parts:t}=a;!(t.length>0)||i.endlist||null!==(m=t[t.length-1])&&void 0!==m&&m.hint||r.h2("If the Playlist contains EXT-X-PART tags and does not contain an EXT-X-ENDLIST tag, the Playlist must contain an EXT-X-PRELOAD-HINT tag with a TYPE=PART attribute",n,872),g(i,a,d,u,c),!p&&a.parts.length>0&&(p=!0)}}return function(t){const e=new Map,i=new Map;let s=!1,a=!1;for(let o=t.length-1;o>=0;o--){const{programDateTime:h,dateRange:l}=t[o];if(h&&(a=!0),l&&l.start){s=!0,l.endOnNext&&(l.end||l.duration)&&r.h2("An EXT-X-DATERANGE tag with an END-ON-NEXT=YES attribute MUST NOT contain DURATION or END-DATE attributes.",n,939);const t=l.start.getTime(),a=l.duration||0;l.end&&l.duration&&t+1e3*a!==l.end.getTime()&&r.h2("END-DATE MUST be equal to the value of the START-DATE attribute plus the value of the DURATION",n,945),l.endOnNext&&(l.end=e.get(l.classId)),e.set(l.classId,l.start);const o=l.end?l.end.getTime():l.start.getTime()+1e3*(l.duration||0),h=i.get(l.classId);if(h){for(const e of h)(e.start<=t&&e.end>t||e.start>=t&&e.start<o)&&r.h2("DATERANGE tags with the same CLASS should not overlap",n,957);h.push({start:t,end:o})}else l.classId&&i.set(l.classId,[{start:t,end:o}])}}s&&!a&&r.h2("If a Playlist contains an EXT-X-DATERANGE tag, it MUST also contain at least one EXT-X-PROGRAM-DATE-TIME tag.",n,968)}(i.segments),i.lowLatencyCompatibility&&function(t,e){let{lowLatencyCompatibility:i,targetDuration:s,partTargetDuration:a,segments:o,renditionReports:h}=t;const{canSkipUntil:l,holdBack:d,partHoldBack:u}=i;if(l<6*s&&r.h2("The Skip Boundary must be at least six times the EXT-X-TARGETDURATION.",n,975),d<3*s&&r.h2("HOLD-BACK must be at least three times the EXT-X-TARGETDURATION.",n,979),e){void 0===a&&r.h2("EXT-X-PART-INF is required if a Playlist contains one or more EXT-X-PART tags",n,983),void 0===u&&r.h2("EXT-X-PART: PART-HOLD-BACK attribute is mandatory",n,986),u<a&&r.h2("PART-HOLD-BACK must be at least PART-TARGET",n,989);for(const[t,{parts:e}]of o.entries())for(const[t,{duration:i}]of e.entries())void 0!==i&&(i>a&&r.h2("PART-TARGET is the maximum duration of any Partial Segment",n,1e3),t<e.length-1&&i<.85*a&&r.h2("All Partial Segments except the last part of a segment must have a duration of at least 85% of PART-TARGET",n,1003))}for(const t of h){const e=o[o.length-1];null!==t.lastMSN&&void 0!==t.lastMSN||(t.lastMSN=e.mediaSequenceNumber),(null===t.lastPart||void 0===t.lastPart)&&e.parts.length>0&&(t.lastPart=e.parts.length-1)}}(i,p),i.duration=i.segments.reduce(((t,e)=>"number"==typeof e.duration?t+e.duration:t),0),i}(t,e),!i.isIFrame&&e.hasMap&&e.compatibleVersion<6&&(e.compatibleVersion=6)),e.compatibleVersion>1&&(!i.version||i.version<e.compatibleVersion)&&r.h2(`EXT-X-VERSION needs to be ${e.compatibleVersion} or higher.`,n,1107),i}function b(t){const e={version:void 0,isMasterPlaylist:void 0,hasMap:!1,targetDuration:0,compatibleVersion:1,isClosedCaptionsNone:!1,hash:{}},i=function(t,e){const i=[];for(const s of t.split("\n")){const t=s.trim();if(t)if(t.startsWith("#")){if(t.startsWith("#EXT")){const s=v(t,e);s&&i.push(s)}}else i.push(t)}return 0!==i.length&&"EXTM3U"===i[0].name||r.h2("The EXTM3U tag MUST be the first line.",n,1089),i}(t,e),s=I(i,e);return s.source=t,s}},3137:(t,e,i)=>{i.d(e,{KT:()=>n,Uz:()=>h,Vd:()=>y,Y4:()=>T,ad:()=>d,h4:()=>A,nw:()=>E,pf:()=>o,qP:()=>l,ru:()=>r,tk:()=>f,ts:()=>m,xC:()=>u});var s=i(19371),a=i(16563);class r{constructor(t){let{type:e,uri:i,groupId:a,language:r,assocLanguage:n,name:o,isDefault:h,autoselect:l,forced:d,instreamId:u,characteristics:c,channels:p}=t;(0,s.A)(this,"type",void 0),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"groupId",void 0),(0,s.A)(this,"language",void 0),(0,s.A)(this,"assocLanguage",void 0),(0,s.A)(this,"name",void 0),(0,s.A)(this,"isDefault",void 0),(0,s.A)(this,"autoselect",void 0),(0,s.A)(this,"forced",void 0),(0,s.A)(this,"instreamId",void 0),(0,s.A)(this,"characteristics",void 0),(0,s.A)(this,"channels",void 0),this.type=e,this.uri=i,this.groupId=a,this.language=r,this.assocLanguage=n,this.name=o,this.isDefault=h,this.autoselect=l,this.forced=d,this.instreamId=u,this.characteristics=c,this.channels=p}}class n{constructor(t){let{uri:e,isIFrameOnly:i=!1,bandwidth:a,averageBandwidth:r,score:n,codecs:o,resolution:h,frameRate:l,hdcpLevel:d,allowedCpc:u,videoRange:c,stableVariantId:p,programId:m,audio:f=[],video:T=[],subtitles:E=[],closedCaptions:y=[],currentRenditions:A={audio:0,video:0,subtitles:0,closedCaptions:0}}=t;(0,s.A)(this,"uri",void 0),(0,s.A)(this,"isIFrameOnly",void 0),(0,s.A)(this,"bandwidth",void 0),(0,s.A)(this,"averageBandwidth",void 0),(0,s.A)(this,"score",void 0),(0,s.A)(this,"codecs",void 0),(0,s.A)(this,"resolution",void 0),(0,s.A)(this,"frameRate",void 0),(0,s.A)(this,"hdcpLevel",void 0),(0,s.A)(this,"allowedCpc",void 0),(0,s.A)(this,"videoRange",void 0),(0,s.A)(this,"stableVariantId",void 0),(0,s.A)(this,"programId",void 0),(0,s.A)(this,"audio",void 0),(0,s.A)(this,"video",void 0),(0,s.A)(this,"subtitles",void 0),(0,s.A)(this,"closedCaptions",void 0),(0,s.A)(this,"currentRenditions",void 0),this.uri=e,this.isIFrameOnly=i,this.bandwidth=a,this.averageBandwidth=r,this.score=n,this.codecs=o,this.resolution=h,this.frameRate=l,this.hdcpLevel=d,this.allowedCpc=u,this.videoRange=c,this.stableVariantId=p,this.programId=m,this.audio=f,this.video=T,this.subtitles=E,this.closedCaptions=y,this.currentRenditions=A}}class o{constructor(t){let{id:e,value:i,uri:a,language:r}=t;(0,s.A)(this,"id",void 0),(0,s.A)(this,"value",void 0),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"language",void 0),this.id=e,this.value=i,this.uri=a,this.language=r}}class h{constructor(t){let{method:e,uri:i,iv:a,format:r,formatVersion:n}=t;(0,s.A)(this,"method",void 0),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"iv",void 0),(0,s.A)(this,"format",void 0),(0,s.A)(this,"formatVersion",void 0),this.method=e,this.uri=i,this.iv=a,this.format=r,this.formatVersion=n}}class l{constructor(t){let{hint:e=!1,uri:i,mimeType:a,byterange:r,key:n}=t;(0,s.A)(this,"hint",void 0),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"mimeType",void 0),(0,s.A)(this,"byterange",void 0),(0,s.A)(this,"key",void 0),this.hint=e,this.uri=i,this.mimeType=a,this.byterange=r,this.key=n}}class d{constructor(t){let{id:e,classId:i,start:a,end:r,duration:n,plannedDuration:o,endOnNext:h,attributes:l={}}=t;(0,s.A)(this,"id",void 0),(0,s.A)(this,"classId",void 0),(0,s.A)(this,"start",void 0),(0,s.A)(this,"end",void 0),(0,s.A)(this,"duration",void 0),(0,s.A)(this,"plannedDuration",void 0),(0,s.A)(this,"endOnNext",void 0),(0,s.A)(this,"attributes",void 0),this.id=e,this.classId=i,this.start=a,this.end=r,this.duration=n,this.plannedDuration=o,this.endOnNext=h,this.attributes=l}}class u{constructor(t){let{type:e,duration:i,tagName:a,value:r}=t;(0,s.A)(this,"type",void 0),(0,s.A)(this,"duration",void 0),(0,s.A)(this,"tagName",void 0),(0,s.A)(this,"value",void 0),this.type=e,this.duration=i,this.tagName=a,this.value=r}}class c{constructor(t){(0,s.A)(this,"type",void 0),this.type=t}}class p extends c{constructor(t){let{isMasterPlaylist:e,uri:i,version:a,independentSegments:r=!1,start:n,source:o}=t;super("playlist"),(0,s.A)(this,"isMasterPlaylist",void 0),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"version",void 0),(0,s.A)(this,"independentSegments",void 0),(0,s.A)(this,"start",void 0),(0,s.A)(this,"source",void 0),this.isMasterPlaylist=e,this.uri=i,this.version=a,this.independentSegments=r,this.start=n,this.source=o}}class m extends p{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({...t,isMasterPlaylist:!0}),(0,s.A)(this,"variants",void 0),(0,s.A)(this,"currentVariant",void 0),(0,s.A)(this,"sessionDataList",void 0),(0,s.A)(this,"sessionKeyList",void 0);const{variants:e=[],currentVariant:i,sessionDataList:a=[],sessionKeyList:r=[]}=t;this.variants=e,this.currentVariant=i,this.sessionDataList=a,this.sessionKeyList=r}}class f extends p{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({...t,isMasterPlaylist:!1}),(0,s.A)(this,"targetDuration",void 0),(0,s.A)(this,"mediaSequenceBase",void 0),(0,s.A)(this,"discontinuitySequenceBase",void 0),(0,s.A)(this,"endlist",void 0),(0,s.A)(this,"playlistType",void 0),(0,s.A)(this,"isIFrame",void 0),(0,s.A)(this,"segments",void 0),(0,s.A)(this,"prefetchSegments",void 0),(0,s.A)(this,"lowLatencyCompatibility",void 0),(0,s.A)(this,"partTargetDuration",void 0),(0,s.A)(this,"renditionReports",void 0),(0,s.A)(this,"skip",void 0),(0,s.A)(this,"hash",void 0),(0,s.A)(this,"duration",void 0),(0,s.A)(this,"timestamp",void 0);const{targetDuration:e,mediaSequenceBase:i=0,discontinuitySequenceBase:r=0,endlist:n=!1,playlistType:o,isIFrame:h,segments:l=[],prefetchSegments:d=[],lowLatencyCompatibility:u,partTargetDuration:c,renditionReports:p=[],skip:m=0,hash:f,duration:T=0}=t;this.targetDuration=e,this.mediaSequenceBase=i,this.discontinuitySequenceBase=r,this.endlist=n,this.playlistType=o,this.isIFrame=h,this.segments=l,this.prefetchSegments=d,this.lowLatencyCompatibility=u,this.partTargetDuration=c,this.renditionReports=p,this.skip=m,this.hash=f,this.duration=T,this.timestamp=(0,a.A)()}}class T extends c{constructor(t){let{uri:e,mimeType:i,data:a,duration:r,title:n,byterange:o,discontinuity:h,mediaSequenceNumber:l=0,discontinuitySequence:d=0,key:u,map:c,programDateTime:p,dateRange:m,markers:f=[],parts:T=[]}=t;super("segment"),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"mimeType",void 0),(0,s.A)(this,"data",void 0),(0,s.A)(this,"duration",void 0),(0,s.A)(this,"title",void 0),(0,s.A)(this,"byterange",void 0),(0,s.A)(this,"discontinuity",void 0),(0,s.A)(this,"mediaSequenceNumber",void 0),(0,s.A)(this,"discontinuitySequence",void 0),(0,s.A)(this,"key",void 0),(0,s.A)(this,"map",void 0),(0,s.A)(this,"programDateTime",void 0),(0,s.A)(this,"dateRange",void 0),(0,s.A)(this,"markers",void 0),(0,s.A)(this,"parts",void 0),this.uri=e,this.mimeType=i,this.data=a,this.duration=r,this.title=n,this.byterange=o,this.discontinuity=h,this.mediaSequenceNumber=l,this.discontinuitySequence=d,this.key=u,this.map=c,this.programDateTime=p,this.dateRange=m,this.markers=f,this.parts=T}}class E extends c{constructor(t){let{hint:e=!1,uri:i,duration:a,independent:r,byterange:n,gap:o}=t;super("part"),(0,s.A)(this,"hint",void 0),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"duration",void 0),(0,s.A)(this,"independent",void 0),(0,s.A)(this,"byterange",void 0),(0,s.A)(this,"gap",void 0),this.hint=e,this.uri=i,this.duration=a,this.independent=r,this.duration=a,this.byterange=n,this.gap=o}}class y extends c{constructor(t){let{uri:e,discontinuity:i,mediaSequenceNumber:a=0,discontinuitySequence:r=0,key:n}=t;super("prefetch"),(0,s.A)(this,"uri",void 0),(0,s.A)(this,"discontinuity",void 0),(0,s.A)(this,"mediaSequenceNumber",void 0),(0,s.A)(this,"discontinuitySequence",void 0),(0,s.A)(this,"key",void 0),this.uri=e,this.discontinuity=i,this.mediaSequenceNumber=a,this.discontinuitySequence=r,this.key=n}}class A{constructor(t){let{uri:e,lastMSN:i,lastPart:a}=t;(0,s.A)(this,"uri",void 0),(0,s.A)(this,"lastMSN",void 0),(0,s.A)(this,"lastPart",void 0),this.uri=e,this.lastMSN=i,this.lastPart=a}}},39381:(t,e,i)=>{function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if("number"==typeof t)return t;const i=10===e?Number.parseFloat(t):Number.parseInt(t,e);return Number.isNaN(i)?0:i}function a(t){(t.startsWith("0x")||t.startsWith("0X"))&&(t=t.slice(2));const e=[];for(let i=0;i<t.length;i+=2)e.push(s(t.slice(i,i+2),16));return new Uint8Array(e)}function r(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=-1;for(let a=0,r=0;a<t.length;a++)if(t[a]===e){if(r++===i)return[t.slice(0,a),t.slice(a+1)];s=a}return-1!==s?[t.slice(0,s),t.slice(s+1)]:[t]}function n(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ";return t?(t=t.trim()," "===e||(t.startsWith(e)&&(t=t.slice(1)),t.endsWith(e)&&(t=t.slice(0,-1))),t):t}function o(t){const e=[];let i=!0,s=0;const a=[];for(let r=0;r<t.length;r++){const n=t[r];i&&","===n?(e.push(t.slice(s,r).trim()),s=r+1):'"'!==n&&"'"!==n||(i?(a.push(n),i=!1):n===a[a.length-1]?(a.pop(),i=!0):a.push(n))}return e.push(t.slice(s).trim()),e}function h(t){const e=[];let i=!1;for(const s of t)"-"!==s&&"_"!==s?i?(e.push(s.toUpperCase()),i=!1):e.push(s.toLowerCase()):i=!0;return e.join("")}i.d(e,{Bq:()=>n,HG:()=>o,Ro:()=>s,Th:()=>h,gI:()=>r,m2:()=>a})},91390:(t,e,i)=>{i.d(e,{$$:()=>r,Eh:()=>f,HR:()=>a,IY:()=>g,Ki:()=>A,Ld:()=>l,Mb:()=>E,Sz:()=>u,Xp:()=>h,_R:()=>n,_m:()=>m,d8:()=>T,iW:()=>c,mX:()=>p,n1:()=>o,os:()=>s,qO:()=>d,u6:()=>y});const s={86017:"mp3",86018:"mp4a.40",86021:"vorbis",86028:"flac",86076:"opus",65542:"ulaw",65543:"alaw",86019:"ac-3",86056:"ec-3",86020:"dtsc",65541:"pcm-u8",65540:"pcm-s8",65536:"pcm-s16",65537:"pcm-s16be",65548:"pcm-s24",65549:"pcm-s24be",65544:"pcm-s32",65545:"pcm-s32be",65557:"pcm-f32",65556:"pcm-f32be",65559:"pcm-f64",65558:"pcm-f64be",225:"av01",27:"avc1",173:"hev1",196:"vvc1",139:"vp8",167:"vp09",12:"mp4v"},a={flv:0,mp4:1,m4s:1,mov:1,ts:2,mts:2,m2ts:2,ivf:5,opus:4,oggs:4,ogg:4,m3u8:2,m3u:2,mpd:1,mp3:14,mkv:8,mka:8,webm:9,aac:15,flac:17,wav:16,srt:19,vtt:18,ssa:20,ass:20,xml:21,ttml:21,h264:11,264:11,avc:11,h265:12,265:12,hevc:12,h266:13,266:13,vvc:13,mpeg:3,mpg:3,rtsp:6,rtmp:7,avi:10,avif:1,heic:1},r={m3u8:4,m3u:4,mpd:5},n={copy:0,h264:27,h261:3,h263:4,h263i:20,h263p:19,mjpeg:7,wmv1:17,wmv2:18,wmv3:71,avc:27,hevc:173,h265:173,vvc:196,h266:196,av1:225,vp9:167,vp8:139,mpeg4:12,theora:30,mpeg2video:2,rv10:5,rv20:6,rv30:68,rv40:69,png:61,bmp:78,webp:171,tiff:96,gif:97},o={copy:0,aac:86018,ac3:86019,eac3:86056,dts:86020,mp3:86017,opus:86076,flac:86028,speex:86051,vorbis:86021,pcm_alaw:65543,pcm_mulaw:65542,wmav1:86023,wmav2:86024,cook:86036,sipr:86057,ralf:86073,pcm_u8:65541,pcm_s16le:65536,pcm_s24le:65548,pcm_s32le:65544,pcm_s64le:65567,pcm_f32le:65557,pcm_f64le:65559},h={webvtt:94226,subrip:94225,ass:94230,ttml:94232,mov_text:94213,hdmv_pgs:94214,hdmv_text:94231,dvd:94208,dvb:94209,eia_608:94218},l={bin_data:98314},d={yuv420p:0,yuv422p:4,yuv444p:5,yuva420p:33,yuva422p:78,yuva444p:79,yuvj420p:12,yuvj422p:13,yuvj444p:14,yuv420p10le:62,yuv422p10le:64,yuv444p10le:68,yuva420p10le:87,yuva422p10le:89,yuva444p10le:91,yuv420p10be:61,yuv422p10be:63,yuv444p10be:67,yuva420p10be:86,yuva422p10be:88,yuva444p10be:90,rgba:26,rgb24:2,bgr24:3,gray:8},u={u8:0,"u8-planar":5,s16:1,"s16-planar":6,s32:2,"s32-planar":7,s64:10,"s64-planar":11,float:3,"float-planar":8,double:4,"double-planar":9},c={flv:0,isobmff:1,mp4:1,mov:1,ts:2,mpegts:2,mpeg:3,ivf:5,ogg:4,opus:4,m3u8:2,m3u:2,mpd:1,mp3:14,mkv:8,matroska:8,mka:8,webm:9,aac:15,flac:17,wav:16,raw_h264:11,raw_h265:12,raw_vvc:13,rtsp:6,rtmp:7,avi:10,h264:11,h265:12,h266:13},p={tv:1,pc:2},m={bt709:1,fcc:4,bt470bg:5,smpte170m:6,smpte240m:7,ycgco:8,gbr:0,bt2020nc:9},f={bt709:1,bt470m:4,bt470bg:5,smpte170m:6,smpte240m:7,smpte428:10,film:8,smpte431:11,smpte432:12,bt2020:9,"jedec-p22":22,ebu3213:22},T={bt709:1,gamma22:4,gamma28:5,smpte170m:6,smpte240m:7,srgb:13,xvycc:11,"bt2020-10":14,"bt2020-12":15,smpte2084:16,"arib-std-b67":18},E={Audio:1,Video:0,Subtitle:3,Attachment:4,Data:2},y={"Tile Grid":3,"Audio Element":1,"Mix Presentation":2},A={default:1,dub:2,original:4,comment:8,lyrics:16,karaoke:32,forced:64,"hearing impaired":128,"visual impaired":256,"clean effects":512,"attached pic":1024,"timed thumbnails":2048,captions:65536,descriptions:131072,metadata:262144,dependent:524288,"still image":1048576,thumbnail:8192},g={mono:4,stereo:3,2.1:11,"3.0":7,"3.0(back)":259,"4.0":263,quad:51,"quad(side)":1539,3.1:15,"5.0":55,"5.0(side)":1543,4.1:271,5.1:63,"5.1(side)":1551,"6.0":1799,"6.0(front)":1731,"3.1.2":20495,hexagonal:311,6.1:1807,"6.1(back)":319,"6.1(front)":1739,"7.0":1591,"7.0(front)":1735,7.1:1599,"7.1(wide)":255,"7.1(wide-side)":1743,"5.1.2":20543,octagonal:1847,cube:184371,"5.1.4":184383,"7.1.2":22079,"7.1.4":185919,"7.2.3":34359825983,"9.1.4":186111,hexadecagonal:6442710839,downmix:1610612736,22.2:2164663779327}},27669:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(19371);class a{constructor(){(0,s.A)(this,"rcon",[0,1,2,4,8,16,32,64,128,27,54]),(0,s.A)(this,"subMix",[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)]),(0,s.A)(this,"invSubMix",[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)]),(0,s.A)(this,"sBox",new Uint32Array(256)),(0,s.A)(this,"invSBox",new Uint32Array(256)),(0,s.A)(this,"key",new Uint32Array(0)),(0,s.A)(this,"ksRows",0),(0,s.A)(this,"keySize",0),(0,s.A)(this,"keySchedule",void 0),(0,s.A)(this,"invKeySchedule",void 0),this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),i=new Uint32Array(4);for(let t=0;t<4;t++)i[t]=e.getUint32(4*t);return i}initTable(){const t=this.sBox,e=this.invSBox,i=this.subMix,s=i[0],a=i[1],r=i[2],n=i[3],o=this.invSubMix,h=o[0],l=o[1],d=o[2],u=o[3],c=new Uint32Array(256);let p=0,m=0,f=0;for(f=0;f<256;f++)c[f]=f<128?f<<1:f<<1^283;for(f=0;f<256;f++){let i=m^m<<1^m<<2^m<<3^m<<4;i=i>>>8^255&i^99,t[p]=i,e[i]=p;const o=c[p],f=c[o],T=c[f];let E=257*c[i]^16843008*i;s[p]=E<<24|E>>>8,a[p]=E<<16|E>>>16,r[p]=E<<8|E>>>24,n[p]=E,E=16843009*T^65537*f^257*o^16843008*p,h[i]=E<<24|E>>>8,l[i]=E<<16|E>>>16,d[i]=E<<8|E>>>24,u[i]=E,p?(p=o^c[c[c[T^o]]],m^=c[c[m]]):p=m=1}}async expandKey(t){const e=this.uint8ArrayToUint32Array_(t);if(this.key){let t=!0,i=0;for(;i<e.length&&t;)t=e[i]===this.key[i],i++;if(t)return}this.key=e;const i=this.keySize=this.key.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);const s=this.ksRows=4*(i+6+1);let a,r;const n=this.keySchedule=new Uint32Array(s),o=this.invKeySchedule=new Uint32Array(s),h=this.sBox,l=this.rcon,d=this.invSubMix,u=d[0],c=d[1],p=d[2],m=d[3];let f,T;for(a=0;a<s;a++)a<i?f=n[a]=e[a]:(T=f,a%i==0?(T=T<<8|T>>>24,T=h[T>>>24]<<24|h[T>>>16&255]<<16|h[T>>>8&255]<<8|h[255&T],T^=l[a/i|0]<<24):i>6&&a%i==4&&(T=h[T>>>24]<<24|h[T>>>16&255]<<16|h[T>>>8&255]<<8|h[255&T]),n[a]=f=(n[a-i]^T)>>>0);for(r=0;r<s;r++)a=s-r,T=3&r?n[a]:n[a-4],o[r]=r<4||a<=4?T:u[h[T>>>24]]^c[h[T>>>16&255]]^p[h[T>>>8&255]]^m[h[255&T]],o[r]=o[r]>>>0}networkToHostOrderSwap(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24}async decrypt(t,e){const i=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,r=this.invSubMix,n=r[0],o=r[1],h=r[2],l=r[3],d=this.uint8ArrayToUint32Array_(e);let u=d[0],c=d[1],p=d[2],m=d[3];const f=new Int32Array(t.buffer).subarray(t.byteOffset>>>2,(t.byteOffset>>>2)+(t.length>>>2)),T=new Int32Array(f.length);let E,y,A,g,v,I,b,S,X,N,R,P,L,D;const w=this.networkToHostOrderSwap;let O=0;for(;O<f.length;){for(X=w(f[O]),N=w(f[O+1]),R=w(f[O+2]),P=w(f[O+3]),v=X^s[0],I=P^s[1],b=R^s[2],S=N^s[3],L=4,D=1;D<i;D++)E=n[v>>>24]^o[I>>16&255]^h[b>>8&255]^l[255&S]^s[L],y=n[I>>>24]^o[b>>16&255]^h[S>>8&255]^l[255&v]^s[L+1],A=n[b>>>24]^o[S>>16&255]^h[v>>8&255]^l[255&I]^s[L+2],g=n[S>>>24]^o[v>>16&255]^h[I>>8&255]^l[255&b]^s[L+3],v=E,I=y,b=A,S=g,L+=4;E=a[v>>>24]<<24^a[I>>16&255]<<16^a[b>>8&255]<<8^a[255&S]^s[L],y=a[I>>>24]<<24^a[b>>16&255]<<16^a[S>>8&255]<<8^a[255&v]^s[L+1],A=a[b>>>24]<<24^a[S>>16&255]<<16^a[v>>8&255]<<8^a[255&I]^s[L+2],g=a[S>>>24]<<24^a[v>>16&255]<<16^a[I>>8&255]<<8^a[255&b]^s[L+3],T[O]=w(E^u),T[O+1]=w(g^c),T[O+2]=w(A^p),T[O+3]=w(y^m),u=X,c=N,p=R,m=P,O+=4}return T.buffer}}},80687:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(19371);class a{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,s.A)(this,"subtle",void 0),(0,s.A)(this,"key",void 0),(0,s.A)(this,"mode",void 0),(0,s.A)(this,"keyBuffer",void 0),this.mode=t,this.subtle=crypto.subtle||crypto.webkitSubtle}getSubtleAlgoName(){switch(this.mode){case 0:return"AES-CBC";case 1:return"AES-CTR"}}async expandKey(t){let e=new Uint8Array(t);if(this.keyBuffer){let t=!0,i=0;for(;i<e.length&&t;)t=e[i]===this.keyBuffer[i],i++;if(t)return}this.keyBuffer=e,this.key=await this.subtle.importKey("raw",t,{name:this.getSubtleAlgoName()},!1,["encrypt","decrypt"])}async encryptPadding(t,e){return new Uint8Array(await crypto.subtle.encrypt({name:"AES-CBC",iv:e},this.key,t))}async decrypt(t,e){switch(this.mode){case 0:return this.subtle.decrypt({name:"AES-CBC",iv:e},this.key,t);case 1:return this.subtle.decrypt({name:"AES-CTR",counter:e,length:64},this.key,t)}}static isSupport(){return"object"==typeof(crypto.subtle||crypto.webkitSubtle)}}},null:()=>{},97494:(t,e,i)=>{function s(t){const e=t,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],s=/:\/\/([^\/@]*@?)\[(\S+)\]/;let a="";s.test(t)&&(t=t.replace(s,((t,e,i)=>(a=i,`://${e||""}a.b`))));const r={},n=/^(?:(?![^:@\/]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(t);let o=14;for(;o--;){var h;r[i[o]]=null!==(h=n[o])&&void 0!==h?h:""}return a&&(r.host=a,r.source=e,r.authority=a+(r.port?":"+r.port:"")),{protocol:r.protocol,file:r.file,host:r.host,port:r.port,user:r.user,password:r.password,origin:`${r.protocol}://${r.authority}`,pathname:r.path,search:`?${r.query}`,hash:r.anchor?`#${r.anchor}`:""}}i.d(e,{ll:()=>u,qg:()=>s});const a=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,n=/^(?=([^\/?#]*))\1([^]*)$/,o=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/;function h(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}function l(t){const e=o.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null}function d(t){for(t=t.split("").reverse().join("").replace(a,"");t.length!==(t=t.replace(r,"")).length;);return t.split("").reverse().join("")}function u(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;let e=l(t);if(!e)throw new Error("Error trying to parse base URL.");return e.path=d(e.path),h(e)}let s=l(e);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return i.alwaysNormalize?(s.path=d(s.path),h(s)):e;let a=l(t);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){let t=n.exec(a.path);a.netLoc=t[1],a.path=t[2]}a.netLoc&&!a.path&&(a.path="/");const r={scheme:a.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(r.netLoc=a.netLoc,"/"!==s.path[0]))if(s.path){let t=a.path,e=t.substring(0,t.lastIndexOf("/")+1)+s.path;r.path=d(e)}else r.path=a.path,s.params||(r.params=a.params,s.query||(r.query=a.query));return null===r.path&&(r.path=i.alwaysNormalize?d(s.path):s.path),h(r)}}}]);