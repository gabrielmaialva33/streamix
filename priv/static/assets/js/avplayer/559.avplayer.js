"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[559],{6072:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(19371);class r{constructor(){(0,s.A)(this,"type",-1),(0,s.A)(this,"onStreamAdd",void 0)}async destroy(t){}}},38144:(t,e,i)=>{i.d(e,{B:()=>o,h:()=>h});var s=i(19371),r=i(91278),a=i(4068);class n{constructor(){(0,s.A)(this,"list",void 0),this.list=[]}read(t,e){for(let i=0;i<e;i++){const e=t.readUint32();this.list.push(t.readString(e))}}write(t){for(let e=0;e<this.list.length;e++){const i=a.encode(this.list[e]);t.writeUint32(i.length),t.writeBuffer(i)}}addComment(t){this.list.push(t)}}class o{constructor(){(0,s.A)(this,"capturePattern",void 0),(0,s.A)(this,"streamStructureVersion",void 0),(0,s.A)(this,"headerTypeFlag",void 0),(0,s.A)(this,"granulePosition",void 0),(0,s.A)(this,"serialNumber",void 0),(0,s.A)(this,"pageSequenceNumber",void 0),(0,s.A)(this,"crcCheckSum",void 0),(0,s.A)(this,"numberPageSegments",void 0),(0,s.A)(this,"segmentTable",void 0),(0,s.A)(this,"payload",void 0),(0,s.A)(this,"pos",void 0),this.reset()}reset(){this.capturePattern="OggS",this.streamStructureVersion=0,this.headerTypeFlag=0,this.granulePosition=r.Dh,this.serialNumber=0,this.pageSequenceNumber=0,this.crcCheckSum=0,this.numberPageSegments=0,this.segmentTable=[],this.pos=BigInt(0)}async read(t){this.pos=t.getPos(),await this.readPageHeader(t);const e=this.segmentTable.reduce(((t,e)=>t+e),0);e&&(this.payload=await t.readBuffer(e))}async readPageHeader(t){if(this.capturePattern=await t.readString(4),this.streamStructureVersion=await t.readUint8(),this.headerTypeFlag=await t.readUint8(),this.granulePosition=await t.readUint64(),this.serialNumber=await t.readUint32(),this.pageSequenceNumber=await t.readUint32(),this.crcCheckSum=await t.readUint32(),this.numberPageSegments=await t.readUint8(),this.numberPageSegments)for(let e=0;e<this.numberPageSegments;e++){const e=await t.readUint8();this.segmentTable.push(e)}}write(t){if(this.pos=t.getPos(),t.writeString(this.capturePattern),t.writeUint8(this.streamStructureVersion),t.writeUint8(this.headerTypeFlag),t.writeUint64(this.granulePosition),t.writeUint32(this.serialNumber),t.writeUint32(this.pageSequenceNumber),t.writeUint32(this.crcCheckSum),this.payload){this.numberPageSegments=Math.floor(this.payload.length/255)+1;const e=this.payload.length%255;t.writeUint8(this.numberPageSegments);for(let e=0;e<this.numberPageSegments-1;e++)t.writeUint8(255);t.writeUint8(e),t.writeBuffer(this.payload)}else t.writeUint8(0)}}class h{constructor(){(0,s.A)(this,"streamIndex",void 0),(0,s.A)(this,"signature",void 0),(0,s.A)(this,"vendorStringLength",void 0),(0,s.A)(this,"vendorString",void 0),(0,s.A)(this,"userCommentListLength",void 0),(0,s.A)(this,"comments",void 0),this.vendorString="libmedia-v1.2.0-6-g24645bb9",this.vendorStringLength=this.vendorString.length,this.userCommentListLength=0,this.comments=new n}read(t){this.vendorStringLength=t.readUint32(),this.vendorString=t.readString(this.vendorStringLength),this.userCommentListLength=t.readUint32(),this.userCommentListLength&&this.comments.read(t,this.userCommentListLength)}write(t){const e=a.encode(this.vendorString);t.writeUint32(e.length),t.writeBuffer(e),t.writeUint32(this.comments.list.length),this.comments.write(t)}addComment(t){this.comments.addComment(t)}setCodec(t){}}},96013:(t,e,i)=>{i.d(e,{GM:()=>h,mS:()=>o,ol:()=>n});var s=i(19371),r=i(38144);const a={album:"album",artist:"artist",description:"description",encoder:"encoder",title:"title",tracknumber:"track",date:"date",genre:"genre",comment:"comment",albumartist:"albumArtist",composer:"composer",performer:"performer",discnumber:"disc",organization:"vendor",copyright:"copyright",license:"license",isrc:"isrc",lyrics:"lyrics",language:"language",label:"vendor",script:"lyrics",encoded_by:"vendor"};function n(t,e){t&&t.forEach((t=>{const i=t.split("=");if(2===i.length){const t=i[0].trim().toLowerCase(),s=i[1].trim();a[t]?e[a[t]]=s:e[t.toLowerCase()]=s}}))}class o{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vorbis";(0,s.A)(this,"streamIndex",void 0),(0,s.A)(this,"packetType",void 0),(0,s.A)(this,"signature",void 0),(0,s.A)(this,"version",void 0),(0,s.A)(this,"channels",void 0),(0,s.A)(this,"sampleRate",void 0),(0,s.A)(this,"bitrateMaximum",void 0),(0,s.A)(this,"bitrateNominal",void 0),(0,s.A)(this,"bitrateMinimum",void 0),(0,s.A)(this,"blocksize0",void 0),(0,s.A)(this,"blocksize1",void 0),(0,s.A)(this,"framingFlag",void 0),this.signature=t,this.version=0,this.channels=1,this.sampleRate=48e3,this.bitrateMaximum=0,this.bitrateNominal=0,this.bitrateMinimum=0,this.blocksize0=2048,this.blocksize1=256}read(t){this.packetType=t.readUint8(),this.signature=t.readString(6),this.version=t.readUint32(),this.channels=t.readUint8(),this.sampleRate=t.readInt32(),this.bitrateMaximum=t.readInt32(),this.bitrateNominal=t.readInt32(),this.bitrateMinimum=t.readInt32();const e=255&t.readUint8();this.blocksize0=Math.pow(2,e>>>4),this.blocksize1=Math.pow(2,15&e),this.framingFlag=t.readUint8()}write(t){t.writeUint8(1),t.writeString(this.signature),t.writeUint32(this.version),t.writeUint8(this.channels),t.writeInt32(this.sampleRate),t.writeInt32(this.bitrateMaximum),t.writeInt32(this.bitrateNominal),t.writeInt32(this.bitrateMinimum),t.writeUint8(Math.log2(this.blocksize0)<<4|Math.log2(this.blocksize1)),t.writeUint8(1)}setCodec(t){this.sampleRate=t.sampleRate,this.channels=t.chLayout.nbChannels}}class h extends r.h{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vorbis";super(),(0,s.A)(this,"packetType",void 0),(0,s.A)(this,"framingFlag",void 0),this.signature=t,this.packetType=1,this.framingFlag=1}read(t){this.packetType=t.readUint8(),this.signature=t.readString(6),super.read(t),"vorbis"===this.signature&&(this.framingFlag=t.readUint8())}write(t){t.writeUint8(this.packetType),t.writeString(this.signature),super.write(t),"vorbis"===this.signature&&t.writeUint8(this.framingFlag)}addComment(t){this.comments.addComment(t)}setCodec(t){}}},56628:(t,e,i)=>{i.d(e,{d:()=>n});var s=i(17630),r=i(91278),a=i(30027);function n(t,e,i){let n=BigInt(0);return s.__(t,(t=>{n+=t.codecpar.bitrate*(0,a.k)(e,i,r.i0)/BigInt(8e3)})),n}},722:(t,e,i)=>{i.d(e,{A:()=>m});var s=i(42524),r=i(56628),a=i(91278),n=i(30027),o=i(1818),h=i(47378),d=i(87339);const c="packages/avformat/src/function/seekInBytes.ts";async function m(t,e,i,m,g,l){const u=t.ioReader.getPos(),p=await t.ioReader.fileSize();let w=a.Dh,b=i;e.startTime!==a.Dh?b-=e.startTime:b-=e.firstDTS;const v=(0,n.k)(i,e.timeBase,a.i0);if(v<BigInt(1e4))return d.Yz(`seek pts is earlier then 10s, seek to first packet pos(${m}) directly`,c,78),await t.ioReader.seek(m),u;let f=(0,r.d)(t.streams,b,e.timeBase);const k=p-(0,r.d)(t.streams,BigInt(1e4),a.i0),S=(0,r.d)(t.streams,BigInt(1e4),a.i0);if(f>k&&(f=k),f<m)return await t.ioReader.seek(m),u;const A=(0,o._5)();let U=p,y=BigInt(0);t:for(;U-y<S&&(f=y),await t.ioReader.seek(f),await l(t),!(8&t.ioReader.flags);){let i=await g(t,A),r=s.f[17](A+56);if(!(i>=0)){w=a.Dh;break}{const h=(0,n.Mr)(s.f[17](A+8),A+72,a.i0);let m=h-v;if(d.Yz(`try to seek to pos: ${f}, got packet pts: ${s.f[17](A+8)}(${h}ms), diff: ${m}ms`,c,115),m<=BigInt(0)&&-m<BigInt(1e4)||U-y<S){const h=[r];for(;m<=0;){if(s.f[15](A+32)===e.index&&1&s.f[15](A+36)&&h.push(r),(0,o.Up)(A),i=await g(t,A),i<0){if(-1048576===i)break;if(-1048575===i)continue;w=a.Dh;break t}r=s.f[17](A+56),m=(0,n.Mr)(s.f[17](A+8),A+72,a.i0)-v}w=h.pop();break}m>BigInt(0)?(U=f,f=y+U>>BigInt(1)):(y=f,f=y+U>>BigInt(1))}if(8&t.ioReader.flags)break}return(0,o.Qe)(A),w!==a.Dh?(d.Yz(`finally seek to pos ${w}`,c,170),await t.ioReader.seek(w),await l(t),u):(await t.ioReader.seek(u),8&t.ioReader.flags?BigInt(h.LT):BigInt(h.E$))}}}]);