"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[976],{22634:(e,t,i)=>{i.r(t),i.d(t,{default:()=>R});var a=i(19371),r=i(42524),s=i(77389),n=i(6072),o=i(1130),c=i(722),h=i(96013),d=i(76919),f=i(41863),l=i(47378),m=i(31184),u=i(1818),p=i(91278),g=i(30027),w=i(87339),b=i(17630),B=i(33134),x=i(5043);const I="packages/avformat/src/formats/IFlacFormat.ts",k=1024;class R extends n.A{constructor(){super(),(0,a.A)(this,"type",17),(0,a.A)(this,"context",void 0)}init(e){e.ioReader.setEndian(!0),this.context={streamInfo:{minimumBlockSize:0,maximumBlockSize:0,minimumFrameSize:0,maximumFrameSize:0,sampleRate:0,channels:0,bitPerSample:0,samples:BigInt(0),md5:""},frameInfo:{sampleRate:0,channels:0,bps:0,blocksize:0,chMode:0,frameOrSampleNum:BigInt(0),isVarSize:0},seekPoints:[],cueSheet:{catalogNumber:"",leadInSamples:BigInt(0),compactDisc:!1,tracks:[]},picture:{type:0,mimeType:"",description:"",width:0,height:0,colorDepth:0,indexedColor:0,data:null},cacheBuffer:null,cachePos:BigInt(0),bitReader:new x.A(o.pB),fileSize:BigInt(0),firstFramePos:BigInt(0),isVarSize:-1}}async readHeader(e){if("fLaC"!==await e.ioReader.readString(4))return w.z3("the file format is not flac",I,141),l.LR;this.context.fileSize=await e.ioReader.fileSize();const t=e.createStream();for(t.codecpar.codecType=1,t.codecpar.codecId=86028;;){const i=await e.ioReader.readUint8(),a=await e.ioReader.readUint24(),n=-129&i;if(0===n){t.codecpar.extradata=(0,m.sY)(a),t.codecpar.extradataSize=a,(0,f.lW)(t.codecpar.extradata,a,await e.ioReader.peekBuffer(a)),this.context.streamInfo.minimumBlockSize=await e.ioReader.readUint16(),this.context.streamInfo.maximumBlockSize=await e.ioReader.readUint16(),this.context.streamInfo.minimumFrameSize=await e.ioReader.readUint24(),this.context.streamInfo.maximumFrameSize=await e.ioReader.readUint24();const i=await e.ioReader.readUint24();t.codecpar.sampleRate=i>>4,t.codecpar.chLayout.nbChannels=1+((15&i)>>>1),this.context.streamInfo.sampleRate=t.codecpar.sampleRate,this.context.streamInfo.channels=t.codecpar.chLayout.nbChannels;const r=await e.ioReader.readUint8();t.codecpar.bitsPerRawSample=1+((1&i)<<4|(240&r)>>>4),this.context.streamInfo.bitPerSample=t.codecpar.bitsPerRawSample;const s=await e.ioReader.readUint32(),n=BigInt(Math.floor(15&r))<<BigInt(32)|BigInt(Math.floor(s));this.context.streamInfo.samples=n,t.timeBase.den=t.codecpar.sampleRate,t.timeBase.num=1,t.duration=n,t.startTime=BigInt(0),this.context.streamInfo.md5=await e.ioReader.readString(16)}else if(2===n){const t=e.createStream();t.codecpar.codecType=2,t.codecpar.codecTag=await e.ioReader.readUint32(),t.codecpar.extradata=(0,m.sY)(a-4),t.codecpar.extradataSize=a-4,await e.ioReader.readBuffer(a-4,(0,f.JW)(t.codecpar.extradata,t.codecpar.extradataSize))}else if(3===n)for(let t=0;t<a/18;t++){const t=await e.ioReader.readUint64(),i=await e.ioReader.readUint64(),a=await e.ioReader.readUint16();this.context.seekPoints.push({pts:t,pos:i,samples:a})}else if(4===n){e.ioReader.setEndian(!1);const t=await e.ioReader.readUint32(),i=await e.ioReader.readString(t),a=await e.ioReader.readUint32(),r=[];for(let t=0;t<a;t++){const t=await e.ioReader.readUint32();r.push(await e.ioReader.readString(t))}e.metadata.vendor=i,(0,h.ol)(r,e.metadata),e.ioReader.setEndian(!0)}else if(5===n){this.context.cueSheet.catalogNumber=await e.ioReader.readString(128),this.context.cueSheet.leadInSamples=await e.ioReader.readUint64(),this.context.cueSheet.compactDisc=!!(await e.ioReader.readUint8()>>>7),await e.ioReader.skip(258);const t=await e.ioReader.readUint8();for(let i=0;i<t;i++){const t=await e.ioReader.readUint64(),i=await e.ioReader.readUint8(),a=await e.ioReader.readBuffer(12),r=await e.ioReader.readUint8();await e.ioReader.skip(13);const s=await e.ioReader.readUint8(),n=[];for(let t=0;t<s;t++)n.push({offset:await e.ioReader.readUint64(),point:await e.ioReader.readUint8()}),await e.ioReader.skip(3);this.context.cueSheet.tracks.push({offset:t,number:i,isrc:a,type:r>>>7,preEmphasisFlag:r>>>6&1,points:n})}}else if(6===n){this.context.picture.type=await e.ioReader.readUint32();let t=await e.ioReader.readUint32();this.context.picture.mimeType=await e.ioReader.readString(t),t=await e.ioReader.readUint32(),this.context.picture.description=await e.ioReader.readString(t),this.context.picture.width=await e.ioReader.readUint32(),this.context.picture.height=await e.ioReader.readUint32(),this.context.picture.colorDepth=await e.ioReader.readUint32(),this.context.picture.indexedColor=await e.ioReader.readUint32(),t=await e.ioReader.readUint32(),this.context.picture.data=await e.ioReader.readBuffer(t);let i=d.In[this.context.picture.mimeType]||0;if(i){const t=e.createStream();t.codecpar.codecId=i,this.context.picture.data.length>=8&&b.FB(this.context.picture.data.subarray(0,8),new Uint8Array([137,80,78,71,13,10,26,10]))&&(i=61),t.codecpar.width=this.context.picture.width,t.codecpar.height=this.context.picture.height,t.codecpar.codecType=0,t.disposition|=1024,t.attachedPic=(0,u._5)(),s.M[15](t.attachedPic+32,t.index);const a=(0,m.sY)(this.context.picture.data.length);(0,f.lW)(a,this.context.picture.data.length,this.context.picture.data),(0,u.NX)(t.attachedPic,a,this.context.picture.data.length),s.M[15](t.attachedPic+36,1|r.f[15](t.attachedPic+36)),t.metadata.comment=d.fz[this.context.picture.type],this.context.picture.description&&(t.metadata.title=this.context.picture.description)}}else await e.ioReader.skip(a);if(128&i)break}return this.context.firstFramePos=e.ioReader.getPos(),t.privData=this.context,0}async getNextFrame(e){const t=[];for(;;){if(e.ioReader.getPos()===this.context.fileSize){this.context.cacheBuffer&&(t.push(this.context.cacheBuffer),this.context.cacheBuffer=null);break}this.context.cacheBuffer?this.context.cacheBuffer.length<o.pB+1&&(this.context.cacheBuffer=(0,B.A)(Uint8Array,[this.context.cacheBuffer,await e.ioReader.readBuffer(Math.min(k,Number(BigInt.asIntN(32,this.context.fileSize-e.ioReader.getPos()))))])):(this.context.cachePos=e.ioReader.getPos(),this.context.cacheBuffer=await e.ioReader.readBuffer(Math.min(k,Number(BigInt.asIntN(32,this.context.fileSize-e.ioReader.getPos())))));let i=t.length?0:2;const a=this.context.isVarSize<0?[248,249]:this.context.isVarSize?[249]:[248],r=this.context.cacheBuffer.length-2;for(;i<r;i++)if(255===this.context.cacheBuffer[i]&&b.zy(a,this.context.cacheBuffer[i+1])){i&&(t.push(this.context.cacheBuffer.subarray(0,i)),this.context.cacheBuffer=this.context.cacheBuffer.subarray(i),this.context.cachePos+=BigInt(Math.floor(i)));break}if(i===r){e.ioReader.getPos()===this.context.fileSize?(t.push(this.context.cacheBuffer),this.context.cachePos+=BigInt(Math.floor(this.context.cacheBuffer.length)),this.context.cacheBuffer=null):(t.push(this.context.cacheBuffer.subarray(0,i)),this.context.cachePos+=BigInt(Math.floor(i)),this.context.cacheBuffer=this.context.cacheBuffer.subarray(i));continue}this.context.cacheBuffer.length<o.pB&&(this.context.cacheBuffer=(0,B.A)(Uint8Array,[this.context.cacheBuffer,await e.ioReader.readBuffer(Math.min(k,Number(BigInt.asIntN(32,this.context.fileSize-e.ioReader.getPos()))))])),this.context.bitReader.reset(),this.context.bitReader.appendBuffer(this.context.cacheBuffer.subarray(0,o.pB));const s={};let n=0;if(!((n=(0,o.x6)(this.context.bitReader,s,!0))<0||s.frameOrSampleNum-this.context.frameInfo.frameOrSampleNum!==BigInt(0|this.context.frameInfo.blocksize)&&s.frameOrSampleNum!==this.context.frameInfo.frameOrSampleNum+BigInt(1)))break;if(n>=0&&s.frameOrSampleNum>this.context.frameInfo.frameOrSampleNum&&s.sampleRate===this.context.frameInfo.sampleRate&&s.channels===this.context.frameInfo.channels&&s.isVarSize===this.context.frameInfo.isVarSize&&(s.isVarSize||s.blocksize===this.context.frameInfo.blocksize))break;t.push(this.context.cacheBuffer.subarray(0,2)),this.context.cachePos+=BigInt(2),this.context.cacheBuffer=this.context.cacheBuffer.subarray(2)}return 1===t.length?t[0]:(0,B.A)(Uint8Array,t)}async readAVPacket(e,t){const i=e.streams.find((e=>e.codecpar.codecType=1));try{let a=e.ioReader.getPos();if(a===this.context.fileSize)return-1048576;if(this.context.bitReader.reset(),this.context.cacheBuffer?(a=this.context.cachePos,this.context.cacheBuffer.length<o.pB&&(this.context.cacheBuffer=(0,B.A)(Uint8Array,[this.context.cacheBuffer,await e.ioReader.readBuffer(Math.min(k,Number(BigInt.asIntN(32,this.context.fileSize-e.ioReader.getPos()))))])),this.context.bitReader.appendBuffer(this.context.cacheBuffer.subarray(0,o.pB))):this.context.bitReader.appendBuffer(await e.ioReader.peekBuffer(o.pB)),(0,o.x6)(this.context.bitReader,this.context.frameInfo)<0)return l.LR;const n=await this.getNextFrame(e),c=(0,m.sY)(n.length);return(0,f.lW)(c,n.length,n),(0,u.NX)(t,c,n.length),s.M[17](t+56,a),s.M[15](t+32,i.index),s.M[15](t+76,i.timeBase.den),s.M[15](t+72,i.timeBase.num),s.M[15](t+36,1|r.f[15](t+36)),s.M[17](t+48,BigInt(0|this.context.frameInfo.blocksize)),s.M[17](t+16,this.context.frameInfo.isVarSize?this.context.frameInfo.frameOrSampleNum:this.context.frameInfo.frameOrSampleNum*BigInt(0|this.context.frameInfo.blocksize)),s.M[17](t+8,this.context.frameInfo.isVarSize?this.context.frameInfo.frameOrSampleNum:this.context.frameInfo.frameOrSampleNum*BigInt(0|this.context.frameInfo.blocksize)),this.context.frameInfo.isVarSize||e.ioReader.getPos()!==this.context.fileSize||(s.M[17](t+16,this.context.frameInfo.frameOrSampleNum*BigInt(0|this.context.streamInfo.minimumBlockSize)),s.M[17](t+8,this.context.frameInfo.frameOrSampleNum*BigInt(0|this.context.streamInfo.minimumBlockSize))),this.context.isVarSize<0&&(this.context.isVarSize=this.context.frameInfo.isVarSize),0}catch(t){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(w.z3(`read packet error, ${t}`,I,487),l.LR):e.ioReader.error}}async syncFrame(e){let t=p.Dh;for(;;)try{const i=await e.ioReader.peekUint16();if(65529===i||65528===i){t=e.ioReader.getPos(),this.context.bitReader.reset(),this.context.bitReader.appendBuffer(await e.ioReader.peekBuffer(o.pB));const i={};if(!(0,o.x6)(this.context.bitReader,i,!0)&&i.channels===this.context.streamInfo.channels&&i.sampleRate===this.context.streamInfo.sampleRate)break}await e.ioReader.skip(1)}catch(e){break}t!==p.Dh&&await e.ioReader.seek(t)}async seek(e,t,i,a){const r=e.ioReader.getPos(),s=t.privData;if(2&a){const t=await e.ioReader.fileSize();return t<=BigInt(0)?BigInt(l.E$):(i<BigInt(0)?i=BigInt(0):i>t&&(i=t),await e.ioReader.seek(i),4&a||await this.syncFrame(e),r)}if(t&&t.sampleIndexes.length){let a=b.El(t.sampleIndexes,(e=>e.pts>i?-1:1));if(a>0&&(0,g.k)(i-t.sampleIndexes[a-1].pts,t.timeBase,p.i0)<BigInt(5e3))return w.Yz(`seek in sampleIndexes, found index: ${a}, pts: ${t.sampleIndexes[a-1].pts}, pos: ${t.sampleIndexes[a-1].pos}`,I,558),await e.ioReader.seek(t.sampleIndexes[a-1].pos),s.cacheBuffer=null,r}if(s.seekPoints.length){let t=0;for(let e=0;e<s.seekPoints.length;e++){if(s.seekPoints[e].pts===i){t=e;break}if(s.seekPoints[e].pts>i){t=Math.max(e-1,0);break}}const a=s.seekPoints[t];return w.Yz(`seek in seekPoints, found index: ${t}, pts: ${a.pts}, pos: ${a.pos+s.firstFramePos}`,I,578),await e.ioReader.seek(a.pos+s.firstFramePos),s.cacheBuffer=null,r}w.Yz("not found any keyframe index, try to seek in bytes",I,584);const n=await(0,c.A)(e,t,i,s.firstFramePos,this.readAVPacket.bind(this),this.syncFrame.bind(this));return n>0&&(s.cacheBuffer=null),n}getAnalyzeStreamsCount(){return 1}}},6072:(e,t,i)=>{i.d(t,{A:()=>r});var a=i(19371);class r{constructor(){(0,a.A)(this,"type",-1),(0,a.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},1130:(e,t,i)=>{i.d(t,{pB:()=>c,x6:()=>h});var a=i(87339),r=i(59479),s=i(47378),n=i(59586);const o="packages/avformat/src/formats/flac/iflac.ts",c=17;function h(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const c=e.getPointer();if(32764!=(32767&e.readU(15)))return!i&&a.z3("invalid sync code",o,60),s.LR;t.isVarSize=e.readU1();const h=e.readU(4),d=e.readU(4);if(t.chMode=e.readU(4),t.chMode<n.jA)t.channels=t.chMode+1,t.chMode=0;else{if(!(t.chMode<n.jA+3))return!i&&a.z3(`invalid channel mode: ${t.chMode}`,o,79),s.LR;t.channels=2,t.chMode-=n.jA-1}const f=e.readU(3);if(3===f)return!i&&a.z3(`invalid sample size code: ${f}`,o,85),s.LR;if(t.bps=n.oe[f],e.readU1())return!i&&a.z3("broken stream, invalid padding",o,91),s.LR;if(t.frameOrSampleNum=function(e){let t=BigInt(Math.floor(e.readU(8))),i=(t&BigInt(128))>>BigInt(1);if((t&BigInt(192))===BigInt(128)||t>=BigInt(254))return-BigInt(1);for(;t&i;){const a=BigInt(Math.floor(e.readU(8)))-BigInt(128);if(a>>BigInt(6))return-BigInt(1);t=(t<<BigInt(6))+a,i<<=BigInt(5)}return t&=(i<<BigInt(1))-BigInt(1),t}(e),t.frameOrSampleNum<0)return!i&&a.z3("sample/frame number invalid",o,98),s.LR;if(0===h)return!i&&a.z3("reserved blocksize code: 0",o,103),s.LR;if(t.blocksize=6===h?e.readU(8)+1:7===h?e.readU(16)+1:n.Xr[h],d<12)t.sampleRate=n.DK[d];else if(12===d)t.sampleRate=1e3*e.readU(8);else if(13===d)t.sampleRate=e.readU(16);else{if(14!==d)return!i&&a.z3(`illegal sample rate code ${d}`,o,129),s.LR;t.sampleRate=10*e.readU(16)}if((0,r.A)(e.getBuffer().subarray(c,e.getPointer()))!==e.readU(8))return!i&&a.z3("header crc mismatch",o,136),s.LR;const l=8*e.remainingLength()+e.getBitLeft();if(l>0){if(e.readU1())return s.LR;if(l>6){const t=e.readU(6);if(!(0===t||1===t||t>=8&&t<=12||t>=32))return s.LR}}return 0}},76919:(e,t,i)=>{i.d(t,{In:()=>m,fz:()=>u,hm:()=>B,qg:()=>b});var a=i(42524),r=i(77389),s=i(41863),n=i(1818),o=i(31184),c=i(87339),h=i(4068),d=i(17630),f=i(54570);const l="packages/avformat/src/formats/mp3/id3v2.ts",m={JPG:7,PNG:61,"image/gif":97,"image/jpeg":7,"image/jpg":7,"image/png":61,"image/tiff":96,"image/bmp":78,"image/webp":171},u=["Other","32x32 pixels 'file icon'","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];function p(e,t){let i="utf-8";return 0===e?i="iso-8859-1":1===e?i="utf-16":2===e&&(i="utf-16be"),new TextDecoder(i).decode(t)}function g(e){return(127&e)+((32512&e)>>1)+((8323072&e)>>2)+((2130706432&e)>>3)}async function w(e,t){await e.seek(t);const i=await e.readString(4);return/^[A-Z0-9]+$/.test(i)}async function b(e,t,i,a){const r=2!==i.version,s=r?10:6;let n=e.getPos()+BigInt(0|t);async function o(){await e.skip(Number(BigInt.asIntN(32,n-e.getPos())))}if(r&&64&i.flags){let a=await async function(e,t){let i=0;for(;t--;)i=(i<<7)+(127&await e.readUint8());return i}(e,4);if(4===i.version&&(a-=4),a<0)return c.z3("invalid extended header length",l,149),await o();if(await e.skip(a),(t-=a+4)<0)return c.z3("extended header too long",l,155),await o()}for(;t>s;){let n,o;if(r){if(n=await e.readString(4),o=await e.readUint32(),!o){c.z3("invalid frame size",l,168);break}if(4===i.version&&o>127)if(o<t){await e.flush();const t=e.getPos();if(!(1&e.flags||6+o<e.remainingLength()))break;if(await w(e,t+BigInt(2)+BigInt(g(o))))o=g(o);else if(!await w(e,t+BigInt(2)+BigInt(o)))break;await e.seek(t)}else o=g(o);await e.readUint16()}else n=await e.readString(3),o=await e.readUint24();if("APIC"===n)a.apic||(a.apic=[]),a.apic.push(await e.readBuffer(o));else if("USLT"===n){const t=await e.readUint8(),i=await e.readString(3),r=await e.readBuffer(o-4);a.lyrics=`${i} ${p(t,r)}`}else if("COMM"===n||"COM"===n){const t=await e.readUint8(),i=await e.readString(3),r=await e.readBuffer(o-4);a.comment=`${i} ${p(t,r)}`}else if("PRIV"===n){const t=e.getPos(),i=[];for(;;){const t=await e.readUint8();if(0===t)break;i.push(t)}const r=h.decode(new Uint8Array(i));let s;s="com.apple.streaming.transportStreamTimestamp"===r?await e.readUint64():await e.readBuffer(o-Number(e.getPos()-t)),a[r]=s}else{let t;switch(t="T"===n[0]?p(await e.readUint8(),await e.readBuffer(o-1)):await e.readBuffer(o),n){case"TIT2":case"TT2":a.title=t;break;case"TPE1":case"TP1":a.artist=t;break;case"TPE2":case"TP2":a.albumArtist=t;break;case"TPOS":a.disc=t;break;case"TCOP":a.copyright=t;break;case"TALB":case"TAL":a.album=t;break;case"TRCK":case"TRK":a.track=t;break;case"TYER":case"TDRL":case"TDRC":a.date=t;break;case"COMM":case"COM":a.comment=t;break;case"TCON":case"TCO":a.genre=t;break;case"TSSE":case"TEN":a.encoder=t;break;case"TCOM":a.composer=t;break;case"TENC":a.vendor=t;break;case"TLAN":a.language=t;break;case"TPE3":case"TP3":a.performer=t;break;case"TPUB":a.publisher=t;break;case"TCMP":case"TCP":a.compilation=t;break;case"TDEN":a.creationTime=t;break;case"TSOA":a.albumSort=t;break;case"TSOP":a.artistSort=t;break;case"TSOT":a.titleSort=t;break;case"TIT1":a.grouping=t;break;default:a[n]=t}}t-=o+s}4==i.version&&16&i.flags&&(n+=BigInt(10)),await e.skip(Number(BigInt.asIntN(32,n-e.getPos())))}function B(e,t,i){const c=2!==i.version;t.forEach((t=>{const i=new f.A(t),h=i.readUint8();let l;function g(){let e=Number(i.getPos());for(;e<t.length&&t[e];)e++;return e}if(c?(l=i.readString(g()-Number(i.getPos())),i.skip(1)):l=i.readString(3),!m[l])return;const w=i.readUint8();let b;const B=g()-Number(i.getPos());B&&(b=p(h,i.readBuffer(B))),i.skip(1);const x=e.createStream();x.codecpar.codecId=m[l],x.codecpar.codecType=0,x.disposition|=1024,x.attachedPic=(0,n._5)(),r.M[15](x.attachedPic+32,x.index);const I=i.remainingSize(),k=(0,o.sY)(I),R=i.readBuffer(I);(0,s.lW)(k,I,R),R.length>=8&&d.FB(R.subarray(0,8),new Uint8Array([137,80,78,71,13,10,26,10]))&&(x.codecpar.codecId=61),(0,n.NX)(x.attachedPic,k,I),r.M[15](x.attachedPic+36,1|a.f[15](x.attachedPic+36)),x.metadata.comment=u[w],b&&(x.metadata.title=b)}))}},38144:(e,t,i)=>{i.d(t,{B:()=>o,h:()=>c});var a=i(19371),r=i(91278),s=i(4068);class n{constructor(){(0,a.A)(this,"list",void 0),this.list=[]}read(e,t){for(let i=0;i<t;i++){const t=e.readUint32();this.list.push(e.readString(t))}}write(e){for(let t=0;t<this.list.length;t++){const i=s.encode(this.list[t]);e.writeUint32(i.length),e.writeBuffer(i)}}addComment(e){this.list.push(e)}}class o{constructor(){(0,a.A)(this,"capturePattern",void 0),(0,a.A)(this,"streamStructureVersion",void 0),(0,a.A)(this,"headerTypeFlag",void 0),(0,a.A)(this,"granulePosition",void 0),(0,a.A)(this,"serialNumber",void 0),(0,a.A)(this,"pageSequenceNumber",void 0),(0,a.A)(this,"crcCheckSum",void 0),(0,a.A)(this,"numberPageSegments",void 0),(0,a.A)(this,"segmentTable",void 0),(0,a.A)(this,"payload",void 0),(0,a.A)(this,"pos",void 0),this.reset()}reset(){this.capturePattern="OggS",this.streamStructureVersion=0,this.headerTypeFlag=0,this.granulePosition=r.Dh,this.serialNumber=0,this.pageSequenceNumber=0,this.crcCheckSum=0,this.numberPageSegments=0,this.segmentTable=[],this.pos=BigInt(0)}async read(e){this.pos=e.getPos(),await this.readPageHeader(e);const t=this.segmentTable.reduce(((e,t)=>e+t),0);t&&(this.payload=await e.readBuffer(t))}async readPageHeader(e){if(this.capturePattern=await e.readString(4),this.streamStructureVersion=await e.readUint8(),this.headerTypeFlag=await e.readUint8(),this.granulePosition=await e.readUint64(),this.serialNumber=await e.readUint32(),this.pageSequenceNumber=await e.readUint32(),this.crcCheckSum=await e.readUint32(),this.numberPageSegments=await e.readUint8(),this.numberPageSegments)for(let t=0;t<this.numberPageSegments;t++){const t=await e.readUint8();this.segmentTable.push(t)}}write(e){if(this.pos=e.getPos(),e.writeString(this.capturePattern),e.writeUint8(this.streamStructureVersion),e.writeUint8(this.headerTypeFlag),e.writeUint64(this.granulePosition),e.writeUint32(this.serialNumber),e.writeUint32(this.pageSequenceNumber),e.writeUint32(this.crcCheckSum),this.payload){this.numberPageSegments=Math.floor(this.payload.length/255)+1;const t=this.payload.length%255;e.writeUint8(this.numberPageSegments);for(let t=0;t<this.numberPageSegments-1;t++)e.writeUint8(255);e.writeUint8(t),e.writeBuffer(this.payload)}else e.writeUint8(0)}}class c{constructor(){(0,a.A)(this,"streamIndex",void 0),(0,a.A)(this,"signature",void 0),(0,a.A)(this,"vendorStringLength",void 0),(0,a.A)(this,"vendorString",void 0),(0,a.A)(this,"userCommentListLength",void 0),(0,a.A)(this,"comments",void 0),this.vendorString="libmedia-v1.2.0-6-g24645bb9",this.vendorStringLength=this.vendorString.length,this.userCommentListLength=0,this.comments=new n}read(e){this.vendorStringLength=e.readUint32(),this.vendorString=e.readString(this.vendorStringLength),this.userCommentListLength=e.readUint32(),this.userCommentListLength&&this.comments.read(e,this.userCommentListLength)}write(e){const t=s.encode(this.vendorString);e.writeUint32(t.length),e.writeBuffer(t),e.writeUint32(this.comments.list.length),this.comments.write(e)}addComment(e){this.comments.addComment(e)}setCodec(e){}}},96013:(e,t,i)=>{i.d(t,{GM:()=>c,mS:()=>o,ol:()=>n});var a=i(19371),r=i(38144);const s={album:"album",artist:"artist",description:"description",encoder:"encoder",title:"title",tracknumber:"track",date:"date",genre:"genre",comment:"comment",albumartist:"albumArtist",composer:"composer",performer:"performer",discnumber:"disc",organization:"vendor",copyright:"copyright",license:"license",isrc:"isrc",lyrics:"lyrics",language:"language",label:"vendor",script:"lyrics",encoded_by:"vendor"};function n(e,t){e&&e.forEach((e=>{const i=e.split("=");if(2===i.length){const e=i[0].trim().toLowerCase(),a=i[1].trim();s[e]?t[s[e]]=a:t[e.toLowerCase()]=a}}))}class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vorbis";(0,a.A)(this,"streamIndex",void 0),(0,a.A)(this,"packetType",void 0),(0,a.A)(this,"signature",void 0),(0,a.A)(this,"version",void 0),(0,a.A)(this,"channels",void 0),(0,a.A)(this,"sampleRate",void 0),(0,a.A)(this,"bitrateMaximum",void 0),(0,a.A)(this,"bitrateNominal",void 0),(0,a.A)(this,"bitrateMinimum",void 0),(0,a.A)(this,"blocksize0",void 0),(0,a.A)(this,"blocksize1",void 0),(0,a.A)(this,"framingFlag",void 0),this.signature=e,this.version=0,this.channels=1,this.sampleRate=48e3,this.bitrateMaximum=0,this.bitrateNominal=0,this.bitrateMinimum=0,this.blocksize0=2048,this.blocksize1=256}read(e){this.packetType=e.readUint8(),this.signature=e.readString(6),this.version=e.readUint32(),this.channels=e.readUint8(),this.sampleRate=e.readInt32(),this.bitrateMaximum=e.readInt32(),this.bitrateNominal=e.readInt32(),this.bitrateMinimum=e.readInt32();const t=255&e.readUint8();this.blocksize0=Math.pow(2,t>>>4),this.blocksize1=Math.pow(2,15&t),this.framingFlag=e.readUint8()}write(e){e.writeUint8(1),e.writeString(this.signature),e.writeUint32(this.version),e.writeUint8(this.channels),e.writeInt32(this.sampleRate),e.writeInt32(this.bitrateMaximum),e.writeInt32(this.bitrateNominal),e.writeInt32(this.bitrateMinimum),e.writeUint8(Math.log2(this.blocksize0)<<4|Math.log2(this.blocksize1)),e.writeUint8(1)}setCodec(e){this.sampleRate=e.sampleRate,this.channels=e.chLayout.nbChannels}}class c extends r.h{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vorbis";super(),(0,a.A)(this,"packetType",void 0),(0,a.A)(this,"framingFlag",void 0),this.signature=e,this.packetType=1,this.framingFlag=1}read(e){this.packetType=e.readUint8(),this.signature=e.readString(6),super.read(e),"vorbis"===this.signature&&(this.framingFlag=e.readUint8())}write(e){e.writeUint8(this.packetType),e.writeString(this.signature),super.write(e),"vorbis"===this.signature&&e.writeUint8(this.framingFlag)}addComment(e){this.comments.addComment(e)}setCodec(e){}}},56628:(e,t,i)=>{i.d(t,{d:()=>n});var a=i(17630),r=i(91278),s=i(30027);function n(e,t,i){let n=BigInt(0);return a.__(e,(e=>{n+=e.codecpar.bitrate*(0,s.k)(t,i,r.i0)/BigInt(8e3)})),n}},722:(e,t,i)=>{i.d(t,{A:()=>f});var a=i(42524),r=i(56628),s=i(91278),n=i(30027),o=i(1818),c=i(47378),h=i(87339);const d="packages/avformat/src/function/seekInBytes.ts";async function f(e,t,i,f,l,m){const u=e.ioReader.getPos(),p=await e.ioReader.fileSize();let g=s.Dh,w=i;t.startTime!==s.Dh?w-=t.startTime:w-=t.firstDTS;const b=(0,n.k)(i,t.timeBase,s.i0);if(b<BigInt(1e4))return h.Yz(`seek pts is earlier then 10s, seek to first packet pos(${f}) directly`,d,78),await e.ioReader.seek(f),u;let B=(0,r.d)(e.streams,w,t.timeBase);const x=p-(0,r.d)(e.streams,BigInt(1e4),s.i0),I=(0,r.d)(e.streams,BigInt(1e4),s.i0);if(B>x&&(B=x),B<f)return await e.ioReader.seek(f),u;const k=(0,o._5)();let R=p,S=BigInt(0);e:for(;R-S<I&&(B=S),await e.ioReader.seek(B),await m(e),!(8&e.ioReader.flags);){let i=await l(e,k),r=a.f[17](k+56);if(!(i>=0)){g=s.Dh;break}{const c=(0,n.Mr)(a.f[17](k+8),k+72,s.i0);let f=c-b;if(h.Yz(`try to seek to pos: ${B}, got packet pts: ${a.f[17](k+8)}(${c}ms), diff: ${f}ms`,d,115),f<=BigInt(0)&&-f<BigInt(1e4)||R-S<I){const c=[r];for(;f<=0;){if(a.f[15](k+32)===t.index&&1&a.f[15](k+36)&&c.push(r),(0,o.Up)(k),i=await l(e,k),i<0){if(-1048576===i)break;if(-1048575===i)continue;g=s.Dh;break e}r=a.f[17](k+56),f=(0,n.Mr)(a.f[17](k+8),k+72,s.i0)-b}g=c.pop();break}f>BigInt(0)?(R=B,B=S+R>>BigInt(1)):(S=B,B=S+R>>BigInt(1))}if(8&e.ioReader.flags)break}return(0,o.Qe)(k),g!==s.Dh?(h.Yz(`finally seek to pos ${g}`,d,170),await e.ioReader.seek(g),await m(e),u):(await e.ioReader.seek(u),8&e.ioReader.flags?BigInt(c.LT):BigInt(c.E$))}},59586:(e,t,i)=>{i.d(t,{DK:()=>o,XC:()=>h,Xr:()=>c,jA:()=>s,ob:()=>r,oe:()=>n});var a=i(54570);const r=34,s=8,n=[0,8,12,0,16,20,24,32],o=[0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0],c=[0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768];function h(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length===r){const{bitsPerRawSample:i,sampleRate:r,channels:s}=function(e){const t=new a.A(e);t.skip(10);const i=t.readUint24();return{sampleRate:i>>4,channels:1+((15&i)>>>1),bitsPerRawSample:1+((1&i)<<4|(240&t.readUint8())>>>4)}}(t);e.codecpar.bitsPerRawSample=i,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=s}}},21279:(e,t,i)=>{i.d(t,{A:()=>s});var a=i(19371),r=i(4068);class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;if((0,a.A)(this,"data",void 0),(0,a.A)(this,"buffer",void 0),(0,a.A)(this,"pointer",void 0),(0,a.A)(this,"pos",void 0),(0,a.A)(this,"size",void 0),(0,a.A)(this,"littleEndian",void 0),(0,a.A)(this,"error",void 0),(0,a.A)(this,"onFlush",void 0),(0,a.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=e,this.littleEndian=!t,this.error=0,i&&i.view)this.size=i.length,this.buffer=i,this.data=i.view;else if(i&&!i.byteOffset)this.size=i.length,this.buffer=i,this.data=new DataView(this.buffer.buffer);else{if(i)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}writeUint8(e){this.remainingLength()<1&&this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}writeUint16(e){this.remainingLength()<2&&this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeUint24(e){this.remainingLength()<3&&this.flush();const t=(16711680&e)>>16,i=(65280&e)>>8,a=255&e;this.littleEndian?(this.writeUint8(a),this.writeUint8(i),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(i),this.writeUint8(a))}writeUint32(e){this.remainingLength()<4&&this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeUint64(e){this.remainingLength()<8&&this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeInt8(e){this.remainingLength()<1&&this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}writeInt16(e){this.remainingLength()<2&&this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeInt24(e){this.writeUint24(e<0?e+16777216:e)}writeInt32(e){this.remainingLength()<4&&this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeInt64(e){this.remainingLength()<8&&this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeFloat(e){this.remainingLength()<4&&this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeDouble(e){this.remainingLength()<8&&this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}writeBuffer(e){if(!e.length)return;let t=e.length;if(this.remainingLength()<t){let i=0;for(;t>0;){this.flush();const a=Math.min(this.size,t);this.buffer.set(e.subarray(i,i+a),this.pointer),this.pointer+=a,this.pos+=BigInt(a),i+=a,t-=a}}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}writeString(e){const t=r.encode(e);return this.writeBuffer(t),t.length}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}flushToPos(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}seek(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");this.flush();const t=this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}seekInline(e){const t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}skip(e){const t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}back(e){const t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(e){this.littleEndian=!e}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}},59479:(e,t,i)=>{function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i=0;i<e.length;i++){t^=e[i];for(let e=0;e<8;e++)128&t?t=t<<1^7:t<<=1}return 255&t}i.d(t,{A:()=>a})}}]);